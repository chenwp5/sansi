{"config":{"lang":["zh"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"\u4e09\u601d\u800c\u884c\uff0c\u518d\u601d\u53ef\u77e3","text":"<ul> <li>\u6570\u636e\u5e93</li> <li>GIt</li> <li>\u5de5\u5177</li> </ul>"},{"location":"blog/","title":"Blog","text":""},{"location":"blog/2023/01/06/%E8%B5%B0%E8%BF%9Brds%E4%B9%8Bmysql%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E4%B8%8E%E7%AE%A1%E7%90%86%E4%B8%AD%E7%AF%87/","title":"\u3010\u8d70\u8fdbRDS\u3011\u4e4bMySQL\u5185\u5b58\u5206\u914d\u4e0e\u7ba1\u7406\uff08\u4e2d\u7bc7\uff09","text":"<p>\u4f5c\u8005\uff1a\u5b8b\u534e\u96c4\uff08\u6866\u96c4\uff09</p> <p>\u7b80\u8ff0\uff1a\u4e3b\u8981\u4ecb\u7ecdInnoDB\u7684\u5185\u5b58\u6784\u6210\u548c\u4f7f\u7528\uff0c\u6709\u6e90\u7801\u5c42\u9762\u7684\u903b\u8f91\u8bf4\u660e\uff0c\u57fa\u4e8e8.0.25\u7248\u672c\u3002</p> <p>\u539f\u6587\u94fe\u63a5\uff1ahttps://mp.weixin.qq.com/s/LQHcuDoQTdPmmjqnd6JeSg</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/","title":"\u5e96\u4e01\u89e3InnoDB\u4e4bBuffer Pool","text":"<p>\u4f5c\u8005\uff1a\u738b\u5eb7</p> <p>github\uff1agithub.com/CatKang</p> <p>\u7b80\u8ff0\uff1a\u4ecb\u7ecdMySQL8.0\u7248\u672cBuffer Pool\u7684\u6838\u5fc3\u529f\u80fd</p> <p>\u539f\u6587\u94fe\u63a5\uff1ahttp://mysql.taobao.org/monthly/2023/08/01/</p> <p>Buffer Pool\u662fInnoDB\u4e2d\u975e\u5e38\u91cd\u8981\u7684\u7ec4\u6210\u90e8\u5206\uff0c\u4e5f\u662f\u6570\u636e\u5e93\u7528\u6237\u6700\u5173\u5fc3\u7684\u7ec4\u4ef6\u4e4b\u4e00\u3002Buffer Pool\u7684\u57fa\u672c\u529f\u80fd\u5e76\u4e0d\u590d\u6742\uff0c\u8bbe\u8ba1\u5b9e\u73b0\u4e5f\u6bd4\u8f83\u6e05\u6670\uff0c\u4f46\u4f5c\u4e3a\u4e00\u4e2a\u6709\u51e0\u5341\u5e74\u5386\u53f2\u7684\u5de5\u4e1a\u7ea7\u6570\u636e\u5e93\u4ea7\u54c1\uff0c\u4e0d\u53ef\u907f\u514d\u7684\u5728\u4ee3\u7801\u4e0a\u878d\u5408\u4e86\u8d8a\u6765\u8d8a\u591a\u7684\u529f\u80fd\uff0c\u4ee5\u53ca\u5f88\u591a\u7ec6\u8282\u7684\u4f18\u5316\uff0c\u4ece\u800c\u663e\u5f97\u6709\u4e9b\u81c3\u80bf\u548c\u6666\u6da9\u3002\u672c\u6587\u5e0c\u671b\u805a\u7126\u5728Buffer Pool\u7684\u672c\u804c\u529f\u80fd\u4e0a\uff0c\u4ece\u5176\u63d0\u4f9b\u7684\u63a5\u53e3\u3001\u5185\u5b58\u7ec4\u7ec7\u65b9\u5f0f\u3001Page\u83b7\u53d6\u3001\u5237\u810f\u7b49\u65b9\u9762\u8fdb\u884c\u4ecb\u7ecd\uff0c\u5176\u4e2d\u4f1a\u7a7f\u63d2\u4e00\u4e9b\u91cd\u8981\u7684\u4f18\u5316\u624b\u6bb5\uff0c\u4e4b\u540e\u7528\u5355\u72ec\u7684\u4e00\u8282\u4ecb\u7ecd\u5176\u4e2d\u7a0d\u663e\u590d\u6742\u7684\u5e76\u53d1\u63a7\u5236\uff0c\u4e5f\u5c31\u662f\u5404\u79cdmutex\u7684\u8bbe\u8ba1\u53ca\u5b9e\u73b0\u3002\u800c\u9664\u6b64\u4e4b\u5916\uff0c\u50cfChange Buffer\u3001\u538b\u7f29Page\u3001Double Write Buffer\u7b49\u529f\u80fd\u867d\u7136\u5927\u91cf\u7684\u7a7f\u63d2\u5728Buffer Pool\u7684\u5b9e\u73b0\u4e4b\u4e2d\uff0c\u4f46\u5176\u672c\u8eab\u5e76\u4e0d\u5c5e\u4e8eBuffer Pool\u7684\u6838\u5fc3\u903b\u8f91\uff0c\u672c\u6587\u5e76\u4e0d\u4f1a\u5305\u62ec\u8fd9\u90e8\u5206\u5185\u5bb9\uff0c\u672c\u6587\u4ee3\u7801\u76f8\u5173\u5185\u5bb9\u57fa\u4e8eMySQL 8.0[1]\u3002</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#_1","title":"\u80cc\u666f","text":"<p>\u4f20\u7edf\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u662f\u5b8c\u6574\u7684\u4fdd\u5b58\u5728\u78c1\u76d8\u4e0a\u7684\uff0c\u4f46\u8ba1\u7b97\u5374\u53ea\u80fd\u53d1\u751f\u5728\u5185\u5b58\u4e2d\uff0c\u56e0\u6b64\u9700\u8981\u6709\u826f\u597d\u7684\u673a\u5236\u6765\u534f\u8c03\u5185\u5b58\u53ca\u78c1\u76d8\u7684\u6570\u636e\u4ea4\u4e92\uff0c\u8fd9\u5c31\u662fBuffer Pool\u5b58\u5728\u7684\u610f\u4e49\u3002\u4e5f\u56e0\u6b64Buffer Pool\u901a\u5e38\u6309\u56fa\u5b9a\u957f\u5ea6\u7684Page\u6765\u7ba1\u7406\u5185\u5b58\uff0c\u4ece\u800c\u65b9\u4fbf\u7684\u8fdb\u884c\u8ddf\u78c1\u76d8\u7684\u6570\u636e\u6362\u5165\u6362\u51fa\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u78c1\u76d8\u548c\u5185\u5b58\u5728\u8bbf\u95ee\u6027\u80fd\u4e0a\u6709\u7740\u5de8\u5927\u7684\u5dee\u8ddd\uff0c\u5982\u4f55\u6700\u5c0f\u5316\u78c1\u76d8\u7684IO\u5c31\u6210\u4e86Buffer Pool\u7684\u8bbe\u8ba1\u6838\u5fc3\u76ee\u6807\u3002\u300a\u6570\u636e\u5e93\u6545\u969c\u6062\u590d\u7684\u524d\u4e16\u4eca\u751f\u300b[2]\u4e00\u6587\u4e2d\u4ecb\u7ecd\u8fc7\uff0c\u4e3b\u6d41\u7684\u6570\u636e\u5e93\u4f1a\u91c7\u7528REDO LOG\u52a0UNDO LOG\uff0c\u800c\u4e0d\u662f\u9650\u5236\u5237\u810f\u987a\u5e8f\u7684\u65b9\u5f0f\uff0c\u6765\u4fdd\u8bc1\u6570\u636e\u5e93ACID\u7279\u6027\u3002\u8fd9\u79cd\u505a\u6cd5\u4e5f\u4fdd\u8bc1\u4e86Buffer Pool\u53ef\u4ee5\u66f4\u4e13\u6ce8\u5730\u5b9e\u73b0\u9ad8\u6548\u7684Cache\u7b56\u7565\u3002 Buffer Pool\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\uff0c\u5176\u5bf9\u5916\u90e8\u4f7f\u7528\u8005\u63d0\u4f9b\u7684\u5176\u5b9e\u662f\u975e\u5e38\u7b80\u5355\u7684\u63a5\u53e3\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3aFIX-UNFIX\u63a5\u53e3[3]\uff0c\u4e4b\u6240\u4ee5\u9700\u8981FIX\u548cUNFIX\uff0c\u662f\u56e0\u4e3a\u5bf9Buffer Pool\u6765\u8bf4\uff0c\u4e0a\u5c42\u5bf9Page\u7684\u4f7f\u7528\u65f6\u957f\u662f\u672a\u77e5\u7684\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u9700\u8981\u4fdd\u8bc1Page\u88ab\u6b63\u786e\u7684\u7ef4\u62a4\u5728Buffer Pool\u4e2d\uff1a</p> <ul> <li>\u4e0a\u5c42\u8c03\u7528\u8005\u5148\u901a\u8fc7\u7d22\u5f15\u83b7\u5f97\u8981\u8bbf\u95ee\u7684Page Number\uff1b</li> <li>\u4e4b\u540e\u7528\u8fd9\u4e2aPage Number\u8c03\u7528Buffer Pool\u7684FIX\u63a5\u53e3\uff0c\u83b7\u5f97Page\u5e76\u5bf9\u5176\u8fdb\u884c\u8bbf\u95ee\u6216\u4fee\u6539\uff0c\u88abFIX\u7684Page\u4e0d\u4f1a\u88ab\u6362\u51faBuffer Pool\uff1b</li> <li>\u4e4b\u540e\u8c03\u7528\u8005\u901a\u8fc7UNFIX\u91ca\u653ePage\u7684\u9501\u5b9a\u72b6\u6001\u3002</li> </ul> <p>\u4e0d\u540c\u4e8b\u52a1\u3001\u4e0d\u540c\u7ebf\u7a0b\u5e76\u53d1\u7684\u8c03\u7528Buffer Pool\u7684FIX-UNFIX\u63a5\u53e3\u7684\u5e8f\u5217\uff0c\u6211\u4eec\u79f0\u4e3aPage \u8bbf\u95ee\u5e8f\u5217\uff08Page Reference String\uff09\uff0c\u8fd9\u4e2a\u5e8f\u5217\u672c\u8eab\u662fBuffer Pool\u65e0\u5173\u7684\uff0c\u53ea\u53d6\u51b3\u4e8e\u6570\u636e\u5e93\u4e0a\u9762\u7684\u8d1f\u8f7d\u7c7b\u578b\u3001\u8d1f\u8f7d\u5e76\u53d1\u5ea6\u3001\u4e0a\u5c42\u7684\u7d22\u5f15\u5b9e\u73b0\u4ee5\u53ca\u6570\u636e\u6a21\u578b\u3002\u800c\u901a\u7528\u6570\u636e\u5e93\u7684Buffer Pool\u8bbe\u8ba1\u5c31\u662f\u5e0c\u671b\u80fd\u5728\u5927\u591a\u6570\u7684Page \u8bbf\u95ee\u5e8f\u5217\u4e0b\uff0c\u5c3d\u53ef\u80fd\u7684\u5b9e\u73b0\u6700\u5c0f\u5316\u78c1\u76d8IO\u4ee5\u53ca\u9ad8\u6548\u8bbf\u95ee\u7684\u76ee\u6807\u3002 \u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e2a\u76ee\u6807\uff0cBuffer Pool\u5185\u90e8\u505a\u4e86\u5927\u91cf\u7684\u5de5\u4f5c\uff0c\u800c\u66ff\u6362\u7b97\u6cd5\u662f\u5176\u4e2d\u6700\u81f3\u5173\u91cd\u8981\u7684\u90e8\u5206\uff0c\u7531\u4e8e\u5185\u5b58\u5bb9\u91cf\u901a\u5e38\u662f\u8fdc\u5c0f\u4e8e\u78c1\u76d8\u5bb9\u91cf\u7684\uff0c\u66ff\u6362\u7b97\u6cd5\u9700\u8981\u5728\u5185\u5b58\u5bb9\u91cf\u8fbe\u5230\u4e0a\u9650\u65f6\uff0c\u9009\u62e9\u5c06\u73b0\u6709\u7684\u5185\u5b58Page\u8e22\u51fa\uff0c\u66ff\u6362\u6210\u65b0\u7684\u88ab\u8bbf\u95ee\u7684Page\uff0c\u597d\u7684\u66ff\u6362\u7b97\u6cd5\u53ef\u4ee5\u5728\u7ed9\u5b9a\u7684Buffer Size\u4e0b\u5c3d\u91cf\u5c11\u7684\u51fa\u73b0Buffer Miss\u3002\u7406\u60f3\u7684\u60c5\u51b5\u4e0b\uff0c \u6211\u4eec\u6bcf\u6b21\u66ff\u6362\u672a\u6765\u7684\u8bbf\u95ee\u5e8f\u5217\u4e2d\u6700\u8fdc\u7684\u90a3\u4e2aPage\uff0c\u8fd9\u4e5f\u662fOPT\u7b97\u6cd5\u7684\u601d\u8def\uff0c\u4f46\u663e\u7136\u83b7\u5f97\u672a\u6765\u7684Page\u5e8f\u5217\u662f\u4e0d\u5207\u5b9e\u9645\u7684\uff0c\u56e0\u6b64OPT\u7b97\u6cd5\u53ea\u662f\u4e00\u4e2a\u7406\u60f3\u6a21\u578b\uff0c\u4f5c\u4e3a\u8bc4\u5224\u66ff\u6362\u7b97\u6cd5\u7684\u4e00\u4e2a\u6700\u4f18\u8fb9\u754c\u3002\u4e0e\u4e4b\u76f8\u53cd\u7684\u662f\u4f5c\u4e3a\u6700\u52a3\u8fb9\u754c\u7684Random\u7b97\u6cd5\uff0c\u5176\u601d\u8def\u662f\u5b8c\u5168\u968f\u673a\u7684\u66ff\u6362\u3002\u5927\u591a\u6570\u7684\u60c5\u51b5\u4e0b\uff0c Page\u7684\u8bbf\u95ee\u5176\u5b9e\u662f\u6709\u70ed\u5ea6\u533a\u5206\u7684\uff0c\u8fd9\u4e5f\u5c31\u7ed9\u66ff\u6362\u7b97\u6cd5\u4e00\u4e2a\u901a\u8fc7\u5386\u53f2\u5e8f\u5217\u5224\u65ad\u672a\u6765\u5e8f\u5217\u7684\u53ef\u80fd\uff0c\u53c2\u8003\u7684\u6307\u6807\u901a\u5e38\u6709\u4e24\u4e2a\uff1a</p> <ol> <li>\u8bbf\u95ee\u8ddd\u79bb\uff08Age\uff09\uff1a\u5728Page\u8bbf\u95ee\u5e8f\u5217\u4e0a\uff0c\u67d0\u4e2aPage\u4e0a\u4e00\u6b21\u8bbf\u95ee\u5230\u73b0\u5728\u7684\u8ddd\u79bb\uff1b</li> <li>\u5f15\u7528\u6b21\u6570\uff08References\uff09\uff1a\u67d0\u4e2aPage\u5386\u53f2\u4e0a\u6216\u8005\u4e00\u6bb5\u65f6\u95f4\u7684\u5386\u53f2\u4e0a\u88ab\u8bbf\u95ee\u7684\u6b21\u6570\u3002</li> </ol> <p>\u53ea\u8003\u8651\u8bbf\u95ee\u8ddd\u79bb\u7684FIFO\uff08First In First Out\uff09\u7b97\u6cd5\u548c\u53ea\u8003\u8651\u5f15\u7528\u6b21\u6570\u7684LFU\uff08Least Frequently Used\uff09\u7b97\u6cd5\u90fd\u88ab\u8bc1\u660e\u5728\u7279\u5b9a\u5e8f\u5217\u4e0b\u4f1a\u6709\u5de8\u5927\u7684\u7f3a\u9677\u3002\u800c\u597d\u7684\u5b9e\u7528\u7684\u66ff\u6362\u7b97\u6cd5\u4f1a\u540c\u65f6\u8003\u8651\u8fd9\u4e24\u4e2a\u56e0\u7d20\uff0c\u5176\u4e2d\u6709\u6211\u4eec\u719f\u6089\u7684LRU(Least Recently Used)\u7b97\u6cd5\u4ee5\u53caClocks\u7b97\u6cd5\u3002\u672c\u6587\u63a5\u4e0b\u6765\u4f1a\u8be6\u7ec6\u7684\u4ecb\u7ecdInnoDB\u4e2d\u7684LRU\u66ff\u6362\u7b97\u6cd5\u7684\u5b9e\u73b0\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u4f1a\u5305\u62ec\u5982\u4f55\u5b9e\u73b0\u9ad8\u6548\u7684Page\u67e5\u627e\u3001\u5185\u5b58\u7ba1\u7406\u3001\u5237\u810f\u7b56\u7565\u4ee5\u53caPage\u7684\u5e76\u53d1\u8bbf\u95ee\u3002</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#_2","title":"\u4f7f\u7528\u65b9\u5f0f","text":"<p>\u9996\u5148\uff0c\u6211\u4eec\u6765\u770b\u5728InnoDB\u4e2d\uff0cBuffer Pool\u7684\u529f\u80fd\u662f\u5982\u4f55\u88ab\u4f7f\u7528\u7684\u3002\u300aB+\u6811\u6570\u636e\u5e93\u52a0\u9501\u5386\u53f2\u300b[4]\u4ee5\u53ca\u300aB+\u6811\u6570\u636e\u5e93\u6545\u969c\u6062\u590d\u6982\u8ff0\u300b[5]\u4e24\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6307\u51faB+\u6811\u6570\u636e\u5e93\u4e3a\u4e86\u83b7\u5f97\u66f4\u9ad8\u7684\u4e8b\u52a1\u5e76\u53d1\u5ea6\uff0c\u5728\u5e76\u53d1\u63a7\u5236\u548c\u6545\u969c\u6062\u590d\u4e2d\u90fd\u533a\u5206\u903b\u8f91\u5185\u5bb9\u548c\u7269\u7406\u5185\u5bb9\u3002\u5176\u4e2d\u7269\u7406\u5185\u5bb9\u6307\u7684\u5c31\u662f\u5c31\u662f\u5bf9Page\u7684\u8bbf\u95ee\uff0c\u4e00\u4e2a\u903b\u8f91\u4e8b\u52a1\u53ef\u4ee5\u5728\u4e0d\u540c\u65f6\u523b\u53d1\u8d77\u5e76\u63d0\u4ea4\u591a\u4e2aSystem Transaction\uff0cSystem Transaction\u4f1a\u5728\u5f88\u77ed\u7684\u65f6\u95f4\u5185\u5c31\u63d0\u4ea4\uff0c\u5e76\u4e14\u4e0d\u9700\u8981\u56de\u6eda\uff1b\u901a\u5e38\u53ea\u4f1a\u6d89\u53ca\u51e0\u4e2aPage\uff0c\u6bd4\u5982\u53d1\u751f\u5206\u88c2\u6216\u5408\u5e76\u7684\u7236\u5b50\u8282\u70b9\uff0c\u6570\u636e\u8282\u70b9\u548cUndo\u8282\u70b9\uff1bSystem Transaction\u901a\u8fc7Redo + No Steal\u7684\u65b9\u5f0f\u4fdd\u8bc1\u591a\u4e2aPage\u7684Crash Safe\uff1b\u4e0d\u540cSystem Transaction\u4e4b\u95f4\u4f1a\u901a\u8fc7\u6bd4Lock\u66f4\u8f7b\u91cf\u7684Latch\u6765\u4fdd\u8bc1\u5b89\u5168\u7684\u5e76\u53d1\u8bbf\u95ee\u3002 \u7b80\u800c\u8a00\u4e4b\uff0cSystem Transaction\u9700\u8981\u4f9d\u6b21\u83b7\u53d6\u51e0\u4e2a\u4e0d\u540c\u7684Page\uff0c\u5bf9\u83b7\u53d6\u7684Page\u52a0Latch\uff0c\u4f7f\u7528\u6216\u4fee\u6539Page\uff0c\u5e76\u5199Redo Log\uff0c\u6765\u4fdd\u8bc1\u591a\u4e2aPage\u8bbf\u95ee\u7684\u539f\u5b50\u3002\u5728InnoDB\u4e2d\u8fd9\u4e2aSystem Transaction\u5c31\u662fMTR\uff08Mini-Transaction\uff09\u3002\u800cBuffer Pool\u63d0\u4f9b\u7684\u5c31\u662f\u901a\u8fc7Page No\u83b7\u53d6\u5bf9\u5e94Page\u7684\u63a5\u53e3\u3002\u56e0\u6b64\u53ef\u4ee5\u8bf4\uff0c\u5728InnoDB\u4e2dMTR\uff08Min-Transaction\uff09\u5c31\u662fBuffer Pool\u7684\u4e3b\u8981\u4f7f\u7528\u65b9\u5f0f\u3002</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#1-buf_page_get_genpage","title":"1. \u4e0a\u5c42\u7528\u8c03\u7528buf_page_get_gen\u83b7\u53d6\u9700\u8981\u7684Page","text":"<p>\u5982\u4e0b\u662f\u4e0a\u5c42\u901a\u8fc7Buffer Pool\u83b7\u53d6\u4e00\u4e2a\u9700\u8981\u7684Page\u7684\u4ee3\u7801\uff0c<code>buf_page_get_gen</code>\u63a5\u53e3\u5bf9\u5e94\u4e0a\u9762\u63d0\u5230\u7684FIX\u63a5\u53e3\uff1a</p> <pre><code> buf_block_t* block = buf_page_get_gen(page_id, page_size, rw_latch, guess, buf_mode, mtr);\n</code></pre> <p>\u5176\u4e2dbuf_block_t\u662fPage\u5bf9\u5e94\u7684\u5185\u5b58\u7ba1\u7406\u7ed3\u6784\uff0c\u901a\u8fc7block-&gt;frame\u6307\u9488\u53ef\u4ee5\u8bbf\u95ee\u5b8c\u6574\u7684Page\u5185\u5bb9\uff1b\u7b2c\u4e00\u4e2a\u53c2\u6570page_id\u6307\u5b9a\u9700\u8981\u83b7\u53d6\u7684Page\u53f7\uff0c\u8fd9\u4e2apage_id\u901a\u5e38\u662f\u901a\u8fc7\u4e0a\u5c42\u7684BTree\u641c\u7d22\u5f97\u5230\uff1b\u7b2c\u4e09\u4e2a\u53c2\u6570rw_latch\u6307\u5b9a\u9700\u8981\u5bf9Page\u52a0\u7684\u8bfb\u5199Latch\u6a21\u5f0f\uff1b\u6700\u540e\u4e00\u4e2amtr\u53c2\u6570\u5c31\u662f\u4e0a\u9762\u63d0\u5230\u7684Mini-Transaction\uff0c\u540c\u4e00\u4e2amtr\u8bbf\u95ee\u591a\u4e2apage\u65f6\uff0c\u4f1a\u5c06\u8fd9\u4e2amtr\u7ed3\u6784\u5728\u6bcf\u6b21\u8c03\u7528buf_page_get_gen\u7684\u65f6\u5019\u4f20\u9012\u4e0b\u53bb\u3002</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#2-buf_page_get_genpagefix","title":"2. buf_page_get_gen\u5185\u90e8\u83b7\u53d6Page\u5e76\u6807\u8bb0FIX\u53ca\u52a0\u9501","text":"<p>\u5728<code>buf_page_get_gen</code>\u5185\u90e8\u9996\u5148\u9700\u8981\u83b7\u53d6\u9700\u8981\u7684Page\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4f1a\u5728\u540e\u9762\u8be6\u7ec6\u4ecb\u7ecd\uff0c\u5728\u6b64\u4e4b\u540e\u4f1a\u505a\u4e24\u4ef6\u4e8b\u6e05\uff0c\u6807\u8bb0page\u7684FIX\u72b6\u6001\uff08page-&gt;buf_fix_count\uff09\uff0c\u963b\u6b62Page\u7684\u6362\u51fa\uff0c\u4ee5\u53ca\u5bf9Page\u52a0\u5bf9\u5e94\u7684rw_latch\u6a21\u5f0f\u7684\u7684\u9501\uff08block-&gt;lock\uff09</p> <pre><code>...\n/* 1.\u6807\u8bb0page\u7684FIX\u72b6\u6001\uff0c\u963b\u6b62\u5176\u88ab\u6362\u51fa\uff0c\u8fd9\u91cc\u662f\u4e00\u4e2apage\u7ed3\u6784\u4e0a\u7684\u8ba1\u6570\u5668buf_fix_count */\nbuf_block_fix(fix_block);\n\n...\n/* 2. \u5bf9Page\u52a0\u5bf9\u5e94\u7684rw_latch\u6a21\u5f0f\u7684\u7684Latch\uff0c\u4e5f\u5c31\u662fblock\u7ed3\u6784\u4e0a\u7684lock */\nmtr_memo_type_t fix_type;\nswitch (rw_latch) {\n...\n  case RW_S_LATCH:\n    rw_lock_s_lock_inline(&amp;fix_block-&gt;lock, 0, file, line);\n    fix_type = MTR_MEMO_PAGE_S_FIX;\n    break;\n...\n}\n\n/* \u6700\u540e\u8fd9\u4e2ablock\u7684\u6307\u9488\u4ee5\u53ca\u52a0\u9501\u7684\u6a21\u5f0f\u8fd8\u4f1a\u4e00\u8d77\u8bb0\u5f55\u5728mtr\u7684\u7ed3\u6784\u4e2d\uff0c\u65b9\u4fbfmtr commit\u65f6\u7684\u91ca\u653e */\nmtr_memo_push(mtr, fix_block, fix_type);\n...\n</code></pre>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#3-mtr-commitlock","title":"3. MTR Commit\u7684\u65f6\u5019\u91ca\u653eLock","text":"<p>MTR\u7ed3\u6784\u4e2d\u4f1a\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a\u5df2\u7ecf\u6301\u6709\u9501\u7684Page\uff0c\u6700\u540emtr\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u4e00\u8d77\u505aUNFIX\u5e76\u653e\u9501\uff1a</p> <pre><code>static void memo_slot_release(mtr_memo_slot_t *slot) {\n  switch (slot-&gt;type) {\n    buf_block_t *block;\n\n    case MTR_MEMO_BUF_FIX:\n    case MTR_MEMO_PAGE_S_FIX:\n    case MTR_MEMO_PAGE_SX_FIX:\n    case MTR_MEMO_PAGE_X_FIX:\n      block = reinterpret_cast&lt;buf_block_t *&gt;(slot-&gt;object);\n\n    /* 1. \u5bf9Page UNFIX\uff0c\u5373buf_fix_count-- */\n      buf_block_unfix(block);\n      /* 2. \u91ca\u653ePage\u7684\u9501\uff0cblock-&gt;lock */\n      buf_page_release_latch(block, slot-&gt;type);\n      break;\n    ...\n  }\n  ...\n}\n</code></pre> <p>\u901a\u8fc7\u672c\u8282\u7684\u4ecb\u7ecd\uff0c\u6211\u4eec\u5df2\u7ecf\u4e86\u89e3\u4e86InnoDB\u662f\u4e2d\u662f\u5982\u4f55\u4f7f\u7528Buffer Pool\u63d0\u4f9b\u7684\u63a5\u53e3\u8bbf\u95eePage\u7684\u4e86\uff0c\u5728\u5177\u4f53\u4ecb\u7ecd\u5982\u4f55\u7ef4\u62a4Page\u652f\u6301\u9ad8\u6548\u7684\u67e5\u627e\u548c\u5237\u810f\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u4ece\u6574\u4f53\u4e0a\u4e86\u89e3\u4e00\u4e0bBuffer Pool\u7684\u7ec4\u7ec7\u7ed3\u6784\u3002</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#_3","title":"\u7ec4\u7ec7\u7ed3\u6784","text":"<p>\u4e3a\u4e86\u51cf\u5c11\u5e76\u53d1\u8bbf\u95ee\u7684\u51b2\u7a81\uff0cInnoDB\u5c06Buffer Pool\u5212\u5206\u4e3a<code>innodb_buffer_pool_instances</code>\u4e2aBuffer Pool Instances\uff0cInstance\u4e4b\u95f4\u6ca1\u6709\u9501\u51b2\u7a81\uff0c\u6bcf\u4e2aPage\u56fa\u5b9a\u5c5e\u4e8e\u5176\u4e2d\u4e00\u4e2aInstance\u3002\u4ece\u7ed3\u6784\u4e0a\u770b\u6bcf\u4e2aInstance\u90fd\u662f\u5bf9\u7b49\u7684\uff0c\u56e0\u6b64\u672c\u6587\u63a5\u4e0b\u6765\u7684\u5185\u5bb9\u90fd\u4ee5\u4e00\u4e2aInstance\u6765\u8fdb\u884c\u4ecb\u7ecd\u7684\u3002</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#blockpagechunk","title":"Block\u3001Page\u548cChunk","text":"<p>Buffer Pool\u5c06\u5206\u914d\u7684\u5185\u5b58\u5927\u5c0f\u5212\u5206\u4e3a\u76f8\u7b49\u7684Block\uff0c\u540c\u65f6\u4e3a\u6bcf\u4e00\u4e2aBlock\u5206\u914d\u4e86\u4e00\u4e2a\u5185\u5b58\u7ba1\u7406\u7ed3\u6784buf_block_t\uff0c\u7528\u6765\u7ef4\u62a4Block\u76f8\u5173\u7684\u72b6\u6001\u4fe1\u606f\u3001\u52a0\u9501\u4fe1\u606f\u3001\u5185\u5b58\u6570\u636e\u7ed3\u6784\u6307\u9488\u7b49\u3002Block\u662fPage\u5728\u5185\u5b58\u4e2d\u7684\u8f7d\u4f53\uff0c\u5f88\u591a\u573a\u666f\u4e0b\u4ed6\u5c31\u662fPage\u3002\u4ee3\u7801\u4e0a\u770bbuf_block_t\u7684\u5f00\u5934\u5c31\u662f\u7ef4\u62a4Page\u4fe1\u606f\u7684buf_page_t\uff08\u5176\u4e2d\u5305\u62ecpage_id\uff0c\u53d1\u751f\u4fee\u6539\u7684lsn\u4fe1\u606foldest_modification, newest_modification\u7b49\uff09\uff0c\u4ece\u800c\u4ed6\u4eec\u4e4b\u95f4\u53ef\u4ee5\u76f4\u63a5\u505a\u7c7b\u578b\u5f3a\u5236\u8f6c\u6362\uff1a</p> <pre><code>struct buf_block_t {\n  buf_page_t page; /*!&lt; page information; this must\n                   be the first field, so that\n                   buf_pool-&gt;page_hash can point\n                   to buf_page_t or buf_block_t */\n  ...\n}\n</code></pre> <p>\u5355\u4e2abuf_block_t\u9700\u8981\u51e0\u767e\u4e2a\u5b57\u8282\u5b58\u50a8\uff0c\u4ee5100G\u7684Buffer Pool\uff0c16KB\u7684Page Size\u4e3a\u4f8b\uff0c\u5c06\u4f1a\u67096M\u4e2aBlock\uff0c\u8fd9\u4e48\u591a\u7684buf_block_t\u7684\u5185\u5b58\u5360\u7528\u4e5f\u662f\u975e\u5e38\u53ef\u89c2\u7684\u3002\u4e3a\u4e86\u65b9\u4fbf\u8fd9\u90e8\u5206\u5185\u5b58\u7684\u5206\u914d\u548c\u7ba1\u7406\uff0cInnoDB\u5c06\u5176\u76f4\u63a5\u62fc\u63a5\u5230Block\u6570\u7ec4\u4e4b\u524d\uff0c\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48Buffer Pool\u7684\u5b9e\u9645\u5185\u5b58\u5360\u7528\u4f1a\u770b\u5230\u7565\u5927\u4e8e\u914d\u7f6e\u7684<code>innodb_buffer_pool_size</code>\u3002\u540e\u6765\u4e3a\u4e86\u65b9\u4fbf\u5728\u7ebf\u8c03\u6574\u5927\u5c0f\uff0c\u4ece5.7\u5f00\u59cbBuffer Pool\u53c8\u5c06\u5185\u5b58\u5212\u5206\u4e3a\u9ed8\u8ba4128MB\u7684Chunk\uff0c\u6bcf\u4e2aChunk\u5185\u90e8\u90fd\u662f\u5982\u4e0b\u7684\u5185\u5b58\u7ed3\u6784\uff1a</p> <p></p> <p>\u5728\u542f\u52a8\u65f6\uff0c<code>buf_chunk_init</code>\u51fd\u6570\u4e2d\u901a\u8fc7mmap\u5206\u914dBuffer Pool\u9700\u8981\u7684\u6240\u6709\u5185\u5b58\uff0c\u56e0\u6b64InnoDB\u5728\u542f\u52a8\u65f6\u5e76\u4e0d\u4f1a\u771f\u6b63\u5360\u7528\u8fd9\u4e48\u5927\u7684\u7269\u7406\u5185\u5b58\uff0c\u800c\u662f\u968f\u7740Page\u7684\u5206\u914d\u4e0d\u65ad\u4e0a\u6da8\u7684\u3002\u53e6\u5916\uff0c\u7531\u4e8e\u6bcf\u4e2aBlock\u7684\u5185\u5b58\u5730\u5740\u8981\u6c42\u6309\u7167Page Size\u5bf9\u9f50\uff0c\u800cbuf_block_t\u5e76\u4e0d\u662f\u4e00\u5b9a\u5b58\u5728Page Size\u7684\u7ea6\u6570\u5173\u7cfb\uff0c\u5728Page\u6570\u7ec4\u7684\u4e4b\u524d\u8fd8\u53ef\u80fd\u6709\u90e8\u5206\u4e0d\u4f1a\u4f7f\u7528\u7684\u5185\u5b58\u788e\u7247\u3002</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#hash-maplru-listfree-listflush-list","title":"Hash Map\u3001LRU List\u3001Free List\u3001Flush List","text":"<p>\u4ece\u4f7f\u7528\u7684\u89d2\u5ea6\u51fa\u53d1\uff0c \u7528\u6307\u5b9a\u7684page_id\u8c03\u7528\u63a5\u53e3buf_page_get_gen\u662f\u4e00\u4e2a\u7edf\u4e00\u4e14\u975e\u5e38\u9891\u7e41\u7684\u64cd\u4f5c\uff0cInnoDB\u7528\u4e00\u4e2a\u4ecepage_id\u5230Block\u7684Hash Map\u6765\u652f\u6301\u9ad8\u6548\u7684\u67e5\u8be2\uff0c\u6240\u6709\u5728Buffer Pool\u4e2d\u7684Page\u90fd\u53ef\u4ee5\u5728Hash Map\u4e2d\u627e\u5230\u3002\u8fd9\u4e2aHash Map\u91c7\u7528\u94fe\u5f0f\u51b2\u7a81\u7684\u65b9\u5f0f\u5b9e\u73b0\uff0c\u901a\u8fc7buf_pool_t\u4e2d\u7684page_hash\u6307\u9488\u8bbf\u95ee\u3002\u9664\u6b64\u4e4b\u5916\uff0cBuffer Pool\u5728\u5185\u5b58\u4e2d\u8fd8\u7ef4\u62a4\u4e86\u5f88\u591a\u7684\u94fe\u8868\u6765\u7ba1\u7406Block\uff0c\u5176\u4e2dLRU List\u627f\u62c5\u7684\u5c31\u662fLRU\u66ff\u6362\u7b97\u6cd5\u4e2d\u7684\u6808\u7684\u529f\u80fd\uff0cBlock\u88ab\u8bbf\u95ee\u5230\u65f6\u4f1a\u88ab\u79fb\u52a8\u5230LRU List\u7684Header\u4e0a\uff0c\u800c\u957f\u671f\u672a\u88ab\u8bbf\u95ee\u7684Page\u4f1a\u9010\u6b65\u7684\u88ab\u63a8\u5230LRU List\u7684Tail\u4f4d\u7f6e\uff0c\u76f4\u81f3\u88ab\u6362\u51fa\u3002Free List\u4e2d\u7ef4\u62a4\u7684\u662f\u5c1a\u672a\u88ab\u4f7f\u7528\u5230\u7684Block\uff0c\u6bcf\u4e00\u4e2aBlock\uff0c\u5728\u540c\u4e00\u65f6\u523b\u4e00\u5b9a\u5b58\u5728\u4e8eLRU List\u6216\u8005Free List\u4e0a\u3002\u88ab\u4fee\u6539\u7684Page\u5728InnoDB\u4e2d\u88ab\u79f0\u4e3a\u810f\u9875\uff0c\u810f\u9875\u9700\u8981\u5728\u5408\u9002\u7684\u65f6\u5019\u8fdb\u884c\u5237\u76d8\u3002\u4e3a\u4e86\u83b7\u53d6\u53ef\u4ee5Checkpoint\u7684\u4f4d\u7f6e\uff0c\u63a8\u8fdb\u5c1a\u672a\u5237\u810f\u7684\u6700\u5c0f\u810f\u9875\u4f4d\u7f6e\u662f\u5fc5\u8981\u7684\uff0c\u56e0\u6b64\u9700\u8981\u4e00\u4e2a\u6309oldest_modification\u6709\u5e8f\u7684\u810f\u9875\u5e8f\u5217\uff0c\u8fd9\u5c31\u662fFlush List\u7684\u610f\u4e49\uff0c\u810f\u9875\u4e00\u5b9a\u662f\u5728\u4f7f\u7528\u4e2d\u7684Block\uff0c\u56e0\u6b64\u4e00\u5b9a\u540c\u65f6\u4e5f\u5728LRU List\u4e0a\u3002\u6574\u4e2a\u5185\u5b58\u7ed3\u6784\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#page","title":"\u83b7\u53d6Page","text":"<p>\u4f5c\u4e3aBuffer Pool\u7edf\u4e00\u7684\u5bf9\u5916\u63a5\u53e3\uff0c<code>buf_page_get_gen</code>\u4f1a\u9996\u5148\u7528\u7ed9\u5b9a\u7684Page ID\u4eceHash Map\u4e2d\u67e5\u627e\u5bf9\u5e94\u7684Page\uff0c\u6700\u7b80\u5355\u7684\uff0c\u8be5Page\u5df2\u7ecf\u5728Buffer Pool\uff0c\u53ef\u4ee5\u76f4\u63a5\u6807\u8bb0FIX\u52a0Lock\u540e\u8fd4\u56de\u3002\u5bf9\u826f\u597d\u914d\u7f6e\u7684Buffer Pool\uff0c\u7edd\u5927\u591a\u6570\u7684Page\u9700\u6c42\u90fd\u662f\u53ef\u4ee5\u5728\u8fd9\u91cc\u5c31\u6ee1\u8db3\u7684\u3002<code>show engine innodb status</code>\u547d\u4ee4\u7ed3\u679c\u7684Buffer Pool Section\u4e2d\u6709\u4e13\u95e8\u7684hit rate\u7684\u7edf\u8ba1\u3002\u5982\u679cPage\u8fd8\u4e0d\u5728Buffer Pool\u5c31\u9700\u8981\u627e\u5230\u4e00\u5757\u7a7a\u95f2\u7684\u5185\u5b58Block\uff0c\u521d\u59cb\u5316\u5185\u5b58\u7ed3\u6784\uff0c\u7136\u540e\u5c06\u78c1\u76d8\u5bf9\u5e94\u7684Page\u52a0\u8f7d\u8fdb\u6765\u3002</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#free-block","title":"\u83b7\u53d6Free Block","text":"<p>\u83b7\u53d6\u7a7a\u95f2Block\u7684\u903b\u8f91\u5728\u51fd\u6570<code>buf_LRU_get_free_block</code>\u4e2d\u5b9e\u73b0\u3002Free List\u4e2d\u7ef4\u62a4\u4e86\u6240\u6709\u7684\u7a7a\u95f2Block\uff0c\u53ef\u4ee5\u901a\u8fc7<code>buf_LRU_get_free_only</code>\u76f4\u63a5\u6458\u53d6\u4e00\u4e2a\u4e0b\u6765\u4f7f\u7528\u3002\u4f46\u66f4\u5e38\u89c1\u7684\u60c5\u51b5\u662f\uff0cFree List\u6839\u672c\u6ca1\u6709Block\uff0c\u6240\u6709\u7684Block\u5df2\u7ecf\u90fd\u5728LRU List\u4e0a\u3002\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981LRU\u66ff\u6362\u7b97\u6cd5\u6765\u8e22\u51fa\u4e00\u4e2a\u5df2\u6709\u7684Page\uff0c\u5c06\u5176Block\u5206\u914d\u7ed9\u65b0\u7684Page\u4f7f\u7528\u3002<code>buf_LRU_scan_and_free_block</code>\u4f1a\u4eceLRU\u7684\u5c3e\u90e8\u5411\u524d\u904d\u5386<code>innodb_lru_scan_depth</code>\u4e2aPage\uff0c\u88ab\u9009\u62e9\u7684Page\u5fc5\u987b\u8981\u6ee1\u8db3\u4e09\u4e2a\u6761\u4ef6\uff1a\u4e0d\u662f\u810f\u9875\u3001\u6ca1\u6709\u88ab\u4e0a\u5c42FIX\u4ee5\u53ca\u6ca1\u6709\u5728IO\u8fc7\u7a0b\u4e2d\u3002\u5982\u679c\u6ca1\u6709\u627e\u5230\u6ee1\u8db3\u6761\u4ef6\u7684Page\uff0c\u7b2c\u4e8c\u8f6e\u7684\u904d\u5386\u5c31\u4f1a\u8986\u76d6\u6574LRU\u3002\u6781\u7aef\u6761\u4ef6\u4e0b\uff0c\u5230\u8fd9\u91cc\u4ecd\u7136\u6ca1\u80fd\u83b7\u5f97\u4e00\u4e2a\u53ef\u4ee5\u9010\u51fa\u7684Page\uff0c\u53ef\u80fd\u662f\u56e0\u4e3a\u810f\u9875\u592a\u591a\u5bfc\u81f4\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u901a\u8fc7<code>buf_flush_single_page_from_LRU</code>\u6765\u76f4\u63a5Flush\u4e00\u4e2a\u6ca1\u6709\u88abFIX\uff0c\u4e14\u6ca1\u6709IO\u7684Page\uff0c\u4e4b\u540e\u5c06\u5176\u53d8\u6210\u4e00\u4e2a\u4e0a\u9762\u8bb2\u5230\u7684\u53ef\u4ee5\u9010\u51fa\u7684Page\u3002\u88ab\u9009\u62e9\u53ef\u4ee5\u9010\u51fa\u7684Page\u4f1a\u901a\u8fc7<code>buf_LRU_free_page</code>\u4eceLRU List\u53caPage Hash\u4e2d\u5220\u9664\uff0c\u4e4b\u540e\u52a0\u5165\u5230Free List\u4e2d\uff0c\u4f9b\u672c\u6b21\u8bbf\u95ee\u7684Page\u4f7f\u7528\u3002</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#page_1","title":"\u586b\u5145\u65b0\u7684Page\u5185\u5bb9","text":"<p>\u83b7\u53d6\u5230\u7684Free Block\u4f1a\u5148\u901a\u8fc7<code>buf_page_init</code>\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u5176\u4e2d\u4f1a\u5bf9buf_block_t\uff0c\u5305\u62ecbuf_page_t\u7684\u5b57\u6bb5\u8fdb\u884c\u521d\u59cb\u5316\u548c\u586b\u5145\uff0c\u4e4b\u540e\u52a0\u5165\u5230Hash Map\u4e2d\uff0c\u5e76\u901a\u8fc7<code>buf_LRU_add_block</code>\u52a0\u5165\u5230LRU List\u3002\u6700\u540e\u5728\u901a\u8fc7\u78c1\u76d8IO\u5c06Page\u6570\u636e\u586b\u5145\u5230buf_block_t\u7684frame\u5b57\u6bb5\u4e2d\u3002\u5728IO\u8bfb\u53d6\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u5bf9Page\u6807\u8bb0IO FIX\u72b6\u6001\u6765\u963b\u6b62\u5176\u4ed6\u7ebf\u7a0bbuf_page_get_gen\u65f6\u7684\u6362\u51fa\uff0c\u5e76\u4e14\u6301\u6709buf_block_t\u7684lock\u6765\u963b\u6b62\u5176\u4ed6\u7ebf\u7a0b\u5bf9Page\u5185\u5bb9\u7684\u8bbf\u95ee\u3002 \u4e3a\u4e86\u66f4\u597d\u7684\u5229\u7528\u78c1\u76d8\u7684\u987a\u5e8f\u8bfb\u6027\u80fd\uff0cInnoDB\u8fd8\u652f\u6301\u4e24\u79cd\u9884\u8bfb\u65b9\u5f0f\uff0c\u6bcf\u5f53\u8bfb\u4e00\u4e2aPage\u6210\u529f\u540e\u90fd\u4f1a\u5224\u65ad\u662f\u5426\u8981\u5c06\u5468\u56f4Page\u4e00\u8d77\u52a0\u8f7d\u8fdbBuffer Pool\uff0c\u968f\u673a\u9884\u8bfb\u4f1a\u53c2\u8003\u540c\u4e00\u4e2aExtend\u4e2d\u6700\u8fd1\u662f\u4e0d\u662f\u6709\u5927\u91cfPage\u88ab\u8bbf\u95ee\uff0c\u53ef\u4ee5\u901a\u8fc7<code>innodb_random_read_ahead</code>\u914d\u7f6e\uff0c\u800c\u987a\u5e8f\u9884\u8bfb\u53c2\u8003\u7684\u662f\u662f\u5426\u6709\u5927\u91cf\u7684Page\u6b63\u5728\u987a\u5e8f\u88ab\u8bbf\u95ee\u5230\uff0c\u53ef\u4ee5\u901a\u8fc7<code>innodb_read_ahead_threshold</code>\u914d\u7f6e</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#lru","title":"LRU\u5b9e\u73b0","text":"<p>\u4e25\u683c\u7684LRU\u66ff\u6362\u7b97\u6cd5\uff0c\u4f1a\u5728\u6bcf\u6b21\u88ab\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u5c06\u5bf9\u5e94\u7684Page\u79fb\u52a8\u5230LRU List\u7684Header\uff0c\u4e5f\u5c31\u662f\u63d0\u5347\u8fd1\u671f\u521a\u8bbf\u95eePage\u7684\u70ed\u5ea6\uff0c\u4f7f\u4e4b\u66f4\u4e0d\u5bb9\u6613\u88ab\u6362\u51fa\u3002\u4f46\u8fd9\u6837\u7684\u5b9e\u73b0\u4f1a\u5b58\u5728\u4e00\u4e2a\u95ee\u9898\uff0c\u901a\u5e38\u6570\u636e\u5e93\u7684\u4e00\u4e2aScan\u64cd\u4f5c\u53ef\u80fd\u4f1a\u8bbf\u95ee\u5230\u5927\u91cf\u7684\uff0c\u751a\u81f3\u8d85\u8fc7\u5185\u5b58\u5bb9\u91cf\u7684Page\u6570\uff0c\u4f46\u8fd9\u4e9bPage\u5728Scan\u7ed3\u675f\u540e\u53ef\u80fd\u5e76\u4e0d\u4f1a\u7ee7\u7eed\u88ab\u4f7f\u7528\uff0c\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0cLRU List\u88ab\u6574\u4e2a\u66ff\u6362\u4e00\u904d\uff0c\u5bfc\u81f4Scan\u64cd\u4f5c\u7ed3\u675f\u540e\u7684\u4e00\u6bb5\u65f6\u95f4\u5185\uff0cBuffer Pool\u7684\u547d\u4e2d\u7387\u53d8\u7684\u5f88\u4f4e\u3002\u8fd9\u5f53\u7136\u662f\u6211\u4eec\u4e0d\u613f\u610f\u770b\u5230\u7684\u3002InnoDB\u5e94\u5bf9\u8fd9\u4e2a\u95ee\u9898\u7684\u65b9\u5f0f\uff0c\u662f\u5c06LRU List\u5206\u6210\u4e24\u6bb5[6]\uff0c\u5982\u4e0b\u56fe\u6240\u793a[7]\u662fLRU\u5b9e\u73b0\u7684\u793a\u610f\u56fe\uff0c\u901a\u8fc7\u4e00\u4e2aMidpoint\u5c06\u6574\u4e2aList\u5206\u4e3aNew Sublist\u548cOld Sublist\uff0c\u6bcf\u6b21\u9700\u8981Page\u6362\u51fa\u7684\u65f6\u5019\u4f1a\u4eceList\u7684\u5c3e\u90e8\u9009\u62e9\uff1a</p> <p></p> <p>\u5f53LRU List\u7684\u957f\u5ea6\u8d85\u8fc7<code>BUF_LRU_OLD_MIN_LEN(512)</code>\u65f6\uff0c\u65b0\u7684\u63d2\u5165\u4f1a\u5f00\u59cb\u7ef4\u62a4\u51faMidpoint\u4f4d\u7f6e\uff0c\u5b9e\u73b0\u91cc\u662f\u4e00\u4e2a\u53eb\u505aLRU_old\u7684\u6307\u9488\uff0c\u8be5\u6307\u9488\u6307\u5411LRU List\u8ddd\u79bbTail\u5927\u7ea63/8\u7684\u4f4d\u7f6e\u3002\u4e4b\u540e\u65b0\u7684<code>buf_LRU_add_block</code>\u90fd\u4f1a\u5c06Page\u63d2\u5165\u5230LRU_old\u7684\u4f4d\u7f6e\uff0c\u800c\u4e0d\u662fLRU List\u7684Header\u3002\u6bcf\u6b21Page\u63d2\u5165\u6216\u8005\u5220\u9664\u65f6\uff0c\u90fd\u9700\u8981\u901a\u8fc7<code>buf_LRU_old_adjust_len</code>\u6765\u5c1d\u8bd5\u8c03\u6574LRU_old\u4f4d\u7f6e\uff0c\u5c3d\u91cf\u5c06LRU_old\u6307\u9488\u4fdd\u6301\u57283/8\u7684\u4f4d\u7f6e\uff0c\u4e4b\u6240\u4ee5\u8bf4\u5c3d\u91cf\uff0c\u662f\u56e0\u4e3aInnoDB\u4e2d\u4e3a\u4e86\u907f\u514d\u9891\u7e41\u7684\u8c03\u6574LRU_old\uff0c\u8bbe\u7f6e\u4e86<code>BUF_LRU_OLD_TOLERANCE(20)</code>\u7684\u5bb9\u5fcd\u533a\u95f4\u3002 \u90a3\u4e48\uff0c\u4ec0\u4e48\u65f6\u5019\u4f1a\u63d2\u5165\u5230Header\u5462\uff1f\u6bcf\u6b21\u901a\u8fc7<code>buf_page_get_gen</code>\u83b7\u53d6\u4e00\u4e2aPage\u4ee5\u540e\uff0c\u65e0\u8bba\u662f\u76f4\u63a5\u547d\u4e2d\u8fd8\u662f\u4ece\u78c1\u76d8\u6362\u5165\uff0c\u90fd\u4f1a\u901a\u8fc7<code>buf_page_make_young_if_needed</code>\u5224\u65ad\u662f\u5426\u79fb\u52a8\u8fd9\u4e2aPage\u5230LRU List\u7684Header\u4f4d\u7f6e\uff0c\u9009\u62e9\u79fb\u52a8\u7684\u6709\u4e24\u79cd\u60c5\u51b5\uff1a</p> <ol> <li>\u5982\u679c\u8fd9\u4e2aPage\u662f\u5728LRU_old\u4e4b\u540e\u7684\u4f4d\u7f6e\uff0c\u90a3\u4e48\u5fc5\u987b\u6ee1\u8db3\u8ddd\u79bb\u9996\u6b21\u8bbf\u95ee\u8d85\u8fc7<code>innodb_old_blocks_time</code>\u53c2\u6570\u914d\u7f6e\u7684\u65f6\u95f4\uff0c\u5982\u6b64\u4e00\u6765\uff0c\u65e0\u8bba\u591a\u5927\u7684Scan\u64cd\u4f5c\u6700\u591a\u53ea\u4f1a\u6c61\u67d3\u5927\u7ea63/8\u7684LRU List\uff0c\u907f\u514d\u4e86\u524d\u9762\u6240\u8bf4\u7684Buffer Pool\u6548\u7387\u964d\u4f4e\u95ee\u9898\u3002</li> <li>\u5982\u679c\u8fd9\u4e2aPage\u5728LRU_old\u4e4b\u524d\u7684\u4f4d\u7f6e\uff0c\u90a3\u4e48\u9700\u8981\u8ddd\u79bbLRU List\u7684Header\u8d85\u8fc7\u5927\u7ea61/6\u7684\u4f4d\u7f6e\uff0c\u8fd9\u4e2a\u505a\u6cd5\u662f\u4e3a\u4e86\u907f\u514d\u592a\u70ed\u7684Page\u9891\u7e41\u7684\u53cd\u590d\u5411LRU Header\u63d2\u5165\u3002</li> </ol>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#flush","title":"Flush","text":"<p>Buffer Pool\u4e2d\u53d1\u751f\u4fee\u6539\u7684Page\u88ab\u79f0\u4e3a\u810f\u9875\uff0c\u810f\u9875\u6700\u7ec8\u662f\u9700\u8981\u5199\u56de\u5230\u78c1\u76d8\u4e2d\u7684\uff0c\u8fd9\u4e2a\u5c31\u662fBuffer Pool\u7684Flush\u8fc7\u7a0b\u3002\u810f\u9875\u9664\u4e86\u5728LRU List\u4e0a\u4e4b\u5916\uff0c\u8fd8\u4f1a\u88ab\u63d2\u5165\u5230Flush List\uff0cFlush List\u4e0a\u7684Page\u5927\u4f53\u662f\u6309\u7167oldest_modification\u6709\u5e8f\u6392\u5217\u7684\uff0c\u4f46\u5b9e\u73b0\u4e0a\u56e0\u4e3a\u5e76\u53d1\u7684\u539f\u56e0\uff0c\u5176\u5b9e\u662f\u63a5\u53d7\u4e86\u5728\u4e00\u4e2a\u5c0f\u8303\u56f4\uff08log_sys-&gt;recent_closed\u7684\u5bb9\u91cf\u5927\u5c0f\uff09\u5185\u5b58\u5728\u4e71\u5e8f\u7684\uff0c\u5f53\u7136\u8fd9\u4e00\u70b9\u9700\u8981\u5728\u786e\u8ba4checkpoint\u4f4d\u7f6e\u7684\u65f6\u5019\u505a\u5904\u7406[8]\u3002</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#_4","title":"\u810f\u9875\u7684\u4ea7\u751f","text":"<p>\u9996\u5148\uff0c\u5148\u6765\u770b\u810f\u9875\u4ea7\u751f\u7684\u8fc7\u7a0b\u3002\u5f53DB\u9700\u8981\u4fee\u6539\u7684Page\u7684\u65f6\u5019\u4f1a\u5728buf_page_get_gen\u83b7\u53d6\u7684Page\u7684\u65f6\u5019\u6307\u5b9aRW_X_LATCH\u7684latch\u6a21\u5f0f\uff0c\u6765\u5bf9\u83b7\u5f97\u5230\u7684Page\u52a0X Lock\uff1b\u4e4b\u540e\u4fee\u6539Page\u5185\u5bb9\u7684\u540c\u65f6\uff0c\u5c06\u5bf9\u5e94\u7684Redo Log\u5199\u5165\u5230\u72ec\u5360\u7684Min-transaction buffer\u4e2d\uff1bMin-transaction commit\u7684\u65f6\u5019\u5c06log\u62f7\u8d1d\u5230\u5168\u5c40\u7684Log Buffer\u4e2d\uff0c\u5e76\u901a\u8fc7<code>buf_flush_note_modification</code>\u51fd\u6570\u5c06\u8be5Page\u52a0\u5165\u5230Buffer Pool\u7684Flush List\u4e0a\u9762\uff0c\u5e76\u7528mtr\u7684start_lsn\u53caend_lsn\u66f4\u65b0Page\u7684oldest_modification\u53canewest_modification\u3002</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#_5","title":"\u5237\u810f\u65f6\u673a","text":"<p>\u810f\u9875\u6700\u7ec8\u662f\u9700\u8981\u5199\u56de\u5230\u78c1\u76d8\u4e2d\u7684\uff0c\u800c\u8fd9\u4e2a\u5199\u56de\u65f6\u673a\uff0c\u5176\u5b9e\u662f\u6570\u636e\u5e93\u7684\u6545\u969c\u6062\u590d\u7b56\u7565\u51b3\u5b9a\u7684\uff0cInnoDB\u91c7\u7528\u4e86\u300a\u6570\u636e\u5e93\u6545\u969c\u6062\u590d\u673a\u5236\u7684\u524d\u4e16\u4eca\u751f\u300b[9]\u4e2d\u4ecb\u7ecd\u7684Redo + Undo\u7684\u7b56\u7565\uff0c\u5c06Page\u7684\u5237\u810f\u8ddf\u4e8b\u52a1\u7684\u63d0\u4ea4\u65f6\u95f4\u5b8c\u5168\u5265\u79bb\u5f00\u6765\uff0c\u4f7f\u5f97Buffer Pool\u7684\u5237\u810f\u7b56\u7565\u53ef\u4ee5\u66f4\u7075\u6d3b\u3002\u7406\u8bba\u4e0a\u8bb2\uff0c\u5047\u8bbeBuffer Pool\u8db3\u591f\u5927\uff0c\u90a3\u4e48\u5c06Page\u4e00\u76f4\u7f13\u5b58\u5728Buffer Pool\u4e2d\uff0c\u7b49\u6240\u6709\u7684\u4fee\u6539\u5b8c\u6210\u518d\u5199Page\u4e00\u5b9a\u662f\u6700\u9ad8\u6548\u7684\uff0c\u56e0\u4e3a\u8fd9\u6837\u6700\u5c0f\u5316\u4e86\u76f8\u5bf9\u4e8e\u5185\u5b58\u8bbf\u95ee\u5f88\u6162\u7684\u78c1\u76d8IO\u3002\u4f46\u663e\u7136\uff0c\u8fd9\u662f\u4e0d\u73b0\u5b9e\u7684\uff0c\u4e3b\u8981\u5f71\u54cd\u56e0\u7d20\u6709\u4e24\u4e2a\uff0c\u8fd9\u4e24\u4e2a\u56e0\u7d20\u4e5f\u51b3\u5b9a\u4e86InnoDB Buffer Pool\u7684\u5237\u810f\u65f6\u673a\uff1a</p> <ol> <li>\u810f\u9875\u603b\u91cf\uff1a\u7531\u4e8e\u901a\u5e38Buffer Pool\u7684\u5bb9\u91cf\u90fd\u662f\u8fdc\u5c0f\u4e8e\u78c1\u76d8\u6570\u636e\u603b\u91cf\u7684\uff0c\u5f53\u5185\u5b58\u4e0d\u8db3\u65f6\u9700\u8981\u901a\u8fc7LRU\u6362\u51fa\u8001Page\uff0c\u524d\u9762\u4e5f\u63d0\u5230\u4e86\u810f\u9875\u662f\u4e0d\u80fd\u76f4\u63a5\u88ab\u6362\u51fa\u7684\u3002\u810f\u9875\u603b\u91cf\u7684\u56e0\u7d20\u503e\u5411\u4e8e\u4f18\u5148Flush LRU Tail\u9644\u8fd1Page\u3002</li> <li>Active Redo\u603b\u91cf\uff1a\u4e5f\u5c31\u662fCheckpoint LSN\u4e4b\u540e\u7684Redo\u603b\u91cf\uff0c\u300a\u5e96\u4e01\u89e3InnoDB\u4e4bREDO LOG\u300b[8]\u4e2d\u4ecb\u7ecd\u8fc7\uff0cInnoDB\u7684Redo\u662f\u5728<code>innodb_log_files_in_group</code>\u914d\u7f6e\u7684redo\u6570\u91cf\u4e2d\u5faa\u73af\u4f7f\u7528\u7684\uff0c\u843d\u540eCheckpoint\u4f1a\u5bfcActive Redo\u603b\u91cf\u8fc7\u9ad8\uff0c\u81f4\u4f7f\u5269\u4f59\u53ef\u7528\u7684Redo\u7a7a\u95f4\u4e0d\u8db3\uff0c\u800c\u6700\u8001\u810f\u9875\u7684\u4f4d\u7f6e\u662f\u9650\u5236Checkpoint\u63a8\u8fdb\u7684\u6700\u76f4\u63a5\u539f\u56e0\u3002Active Redo\u603b\u91cf\u56e0\u7d20\u503e\u5411\u4e8e\u4f18\u5148\u5c06oldest_modification\u6700\u5c0f\u7684Page\uff0c\u4e5f\u5c31\u662fFlush List\u7684Tail\u4f4d\u7f6e\u8fdb\u884c\u5237\u810f\u3002</li> </ol> <p>\u4f9d\u636e\u8fd9\u4e24\u4e2a\u56e0\u7d20\uff0cInnoDB\u7684Buffer Pool\u63d0\u4f9b\u4e86\u4e09\u79cd\u6a21\u5f0f\u7684Flush\uff0c\u5176\u4e2dSingle Flush\u5e94\u5bf9\u7684\u662f\u810f\u9875\u603b\u91cf\u8fc7\u9ad8\u7684\u6781\u7aef\u60c5\u51b5\uff0c\u7531\u7528\u6237\u7ebf\u7a0b\u5728\u5b8c\u5168\u627e\u4e0d\u5230\u53ef\u4ee5\u6362\u51fa\u7684Clean Page\u65f6\u89e6\u53d1\uff0c\u6bcf\u6b21\u540c\u6b65\u5237\u4e00\u4e2aPage\uff1b\u800cSync Flush\u53ef\u4ee5\u8ba4\u4e3a\u662f\u5e94\u5bf9Active Redo\u603b\u91cf\u8fc7\u9ad8\u7684\u6781\u7aef\u60c5\u51b5\uff0c\u5728\u53ef\u7528\u7684Redo\u7a7a\u95f4\u4e25\u91cd\u4e0d\u8db3\u6216\u9700\u8981\u5f3a\u5236\u63a8\u8fdbCheckpoint\u65f6\u89e6\u53d1\uff0cSync Flush\u4f1a\u5c3d\u53ef\u80fd\u7684\u5c06oldest_modification\u5c0f\u4e8e\u5236\u5b9aLSN\u7684Page\u5168\u90e8\u5237\u810f\uff0c\u56e0\u6b64\u53ef\u80fd\u4f1a\u6d89\u53ca\u5927\u91cfPage\uff0c\u4ece\u800c\u4e25\u91cd\u5f71\u54cd\u7528\u6237\u8bf7\u6c42\u3002\u56e0\u6b64\uff0c\u7406\u60f3\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e24\u79cd\u5237\u810f\u6a21\u5f0f\u90fd\u662f\u5e94\u8be5\u5c3d\u91cf\u907f\u514d\u7684\u3002\u800c\u66f4\u591a\u7684\u65f6\u5019\u5e94\u8be5\u4f9d\u9760\u7684\u662f\u540e\u53f0\u4e00\u76f4\u5728\u8fd0\u884c\u7684Batch Flush\u3002</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#batch-flush","title":"Batch Flush","text":"<p>Batch Flush\u7531\u4e00\u4e2aPage Coordinator\u7ebf\u7a0b\u548c\u4e00\u7ec4Page Cleaner\u7ebf\u7a0b\u8d1f\u8d23\uff0c\u5177\u4f53\u7684\u4e2a\u6570\u8ddfBuffer Pool\u7684Instance\u6570\u7ed1\u5b9a\uff0c\u6240\u6709\u7684\u7ebf\u7a0b\u5171\u7528\u4e00\u4e2a<code>page_cleaner_t</code>\u7ed3\u6784\u4f53\u6765\u505a\u4e00\u4e9b\u7edf\u8ba1\u548c\u72b6\u6001\u7ba1\u7406\u3002\u901a\u5e38\u60c5\u51b5\u4e0bPage Coordinator\u4f1a\u5468\u671f\u6027\u88ab\u5524\u9192\uff0c\u901a\u8fc7<code>page_cleaner_flush_pages_recommendation</code>\u8ba1\u7b97\u6bcf\u4e00\u8f6e\u9700\u8981\u5237\u810f\u7684Page\u6570\uff0c\u7136\u540e\u5c06\u8fd9\u4e2a\u9700\u6c42\u4e0b\u53d1\u7ed9\u6240\u6709\u7684Page Cleaner\u7ebf\u7a0b\uff0c\u5e76\u7b49\u5f85\u6240\u6709\u7684Page Cleaner\u5237\u810f\u5b8c\u6bd5\uff0cPage Coordinator\u81ea\u5df1\u4e5f\u4f1a\u627f\u62c5\u4e00\u4efd\u5237\u810f\u4efb\u52a1\u3002\u800c<code>page_cleaner_flush_pages_recommendation</code>\u5224\u65ad\u5237\u810f\u91cf\u7684\u65f6\u5019\uff0c\u4f1a\u7efc\u5408\u8003\u8651\u5f53\u524d\u7684\u810f\u9875\u603b\u91cf\uff0cActive Redo\u603b\u91cf\uff0c\u4ee5\u53ca\u78c1\u76d8IO\u7684\u627f\u8f7d\u80fd\uff0c\u5176\u4e2d\u78c1\u76d8\u80fd\u529b\u8fd9\u4e2a\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570<code>innodb_io_capacity</code>\u4ee5\u53ca<code>innodb_io_capacity_max</code>\u6307\u5b9a\uff0c\u4e0b\u9762\u662f\u6574\u7406\u8fc7\u7684\u8ba1\u7b97\u516c\u5f0f\uff1a</p> <pre><code>  n_pages = (innodb_io_capacity * (ut_max(pct_for_dirty, pct_for_lsn)) / 100\n            + avg_page_rate\n            + pages_for_lsn\n           ) / 3;\n\n  /* \u4e0a\u9650\u88ab\u53c2\u6570innodb_io_capacity_max \u9650\u5236 */\n  if (n_pages &gt; srv_max_io_capacity) {\n    n_pages = srv_max_io_capacity;\n  }\n</code></pre> <ol> <li>\u9759\u6001\u810f\u9875\u603b\u91cf\uff08pct_for_dirty\uff09\uff1a\u6839\u636e\u5f53\u524d\u5df2\u6709\u7684\u810f\u9875\u603b\u91cf\u8ba1\u7b97\u7684\u4e00\u4e2a\u5237\u810f\u6bd4\u4f8b\u3002\u810f\u9875\u91cf\u4f4e\u4e8e<code>innodb_max_dirty_pages_pct_lwm</code>\u4e0d\u5237\u810f\uff0c\u9ad8\u4e8e<code>innodb_max_dirty_pages_pct_lwm</code>\uff0c\u5219\u6309\u810f\u9875\u91cf\u5360<code>innodb_max_dirty_pages_pct</code>\u7684\u767e\u5206\u6bd4\u5237\u810f\uff0c\u4e5f\u5c31\u8bf4\u5927\u4e8e<code>innodb_max_dirty_pages_pct</code>pct_for_diry\u5c31\u4f1a\u6210\u4e3a\u767e\u5206\u767e\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cpct_for_dirty\u662f\u4e00\u4e2a\u5728pct_lwm\u5230pct\u4e4b\u95f4\uff0c\u4ece0\u5230100\u6309\u810f\u9875\u7387\u7ebf\u6027\u589e\u957f\u7684\u503c\u3002</li> <li>\u9759\u6001Active Redo\uff08pct_for_lsn\uff09\uff1a\u6839\u636e\u5f53\u524d\u7684Active Redo\u8ba1\u7b97\u7684\u5237\u810f\u6bd4\u4f8b\u3002\u5982\u679cActive Redo\u7684\u91cf\u8d85\u8fc7\u4e86\u4e00\u4e2a\u63a5\u8fd1Redo\u7a7a\u95f4\u6ee1\u7684\u503c<code>log_sys-&gt;max_modified_age_async</code>\uff0c\u6216\u8005\u7528\u6237\u914d\u7f6e\u4e86<code>innodb_adaptive_flushing</code>\uff0c\u8fd9\u91cc\u5c31\u7528\u5f53\u524d\u7684Active Redo\u6c34\u4f4d\u8ba1\u7b97\u4e00\u4e2apct_for_lsn\uff0c\u8fd9\u91cc\u5b9e\u73b0\u4e0a\u4e0d\u662f\u4e00\u4e2a\u7eaf\u7ebf\u6027\u7684\u5173\u7cfb\uff0c\u800c\u662f\u968f\u7740Active Redo\u7684\u589e\u52a0pct_for_lsn\u589e\u957f\u901f\u5ea6\u4e5f\u5728\u52a0\u5feb\u3002</li> <li>\u52a8\u6001\u810f\u9875\u91cf\u53d8\u5316\uff08avg_page_rate\uff09\uff1a\u7531\u4e8en_pages\u7684\u5224\u65ad\u8fc7\u7a0b\u662f\u4e00\u4e2a\u5468\u671f\u7684\u6253\u70b9\u884c\u4e3a\uff0c\u53ea\u8003\u8651\u9759\u6001\u7684\u6c34\u4f4d\u663e\u7136\u662f\u4e0d\u591f\u7684\uff0c\u8fd9\u91cc\u8fd8\u4f1a\u5c06\u8fd9\u4e2a\u5468\u671f\u5185\u7684\u810f\u9875\u589e\u957f\u901f\u7387\u4f5c\u4e3a\u4e00\u4e2a\u56e0\u7d20\u8ba1\u7b97\u8fdb\u6765\u3002</li> <li>\u52a8\u6001Active Redo\u53d8\u5316\uff08pages_for_lsn\uff09\uff1a\u7c7b\u4f3c\u7684\u8fd9\u91cc\u4e5f\u4f1a\u8003\u8651\u5468\u671f\u5185\u7684Redo\u589e\u957f\u901f\u7387\uff0c\u8fd9\u91cc\u7684\u8ba1\u7b97\u65b9\u5f0f\u662f\u5c06\u5355\u4f4d\u65f6\u95f4\u5185Redo\u7684\u589e\u957f\u4e4b\u540e\u7684LSN\uff0c\u6295\u5f71\u5230BP\u4e2dPage\u7684oldest_modification\u4e0a\uff0c\u6240\u8986\u76d6\u7684Page\u6570\u5c31\u662fpages_for_lsn\u7684\u503c\u3002</li> </ol> <p>\u901a\u8fc7\u4e0a\u9762\u8fc7\u7a0b\u8ba1\u7b97\u51fa\u7684n_pages\u6570\uff0c\u4f1a\u5e73\u5206\u7ed9\u591a\u4e2aPage Cleaner\uff0c\u7136\u540e\u5c06\u4ed6\u4eec\u5524\u9192\u3002\u6bcf\u4e2aPage Cleaner\u4f1a\u8d1f\u8d23\u81ea\u5df1\u72ec\u7acb\u7684Buffer Pool Instance\uff0c\u56e0\u6b64\u4e4b\u95f4\u6ca1\u6709\u51b2\u7a81\uff0c\u6bcf\u4e2aPage Cleaner\u88ab\u5524\u9192\u540e\uff0c\u4f1a\u5148\u540e\u4eceLRU List\u53caFlush List\u4e0a\u8fdb\u884c\u5237\u810f\uff0c\u4e00\u8f6e\u5237\u810f\u7ed3\u675f\u540e\u624d\u4f1a\u53d1\u8d77\u4e0b\u4e00\u8f6e\u7684\u5237\u810f\u3002\u4e4b\u6240\u4ee5\u8981\u4eceLRU List\u505a\u5237\u810f\u8fd8\u662f\u4e3a\u4e86\u4fdd\u6301\u8db3\u591f\u7528\u7684Free Page\uff0c\u56e0\u6b64\u53ea\u6709\u5f53Free List\u4e0a\u7684Page\u5c0f\u4e8e<code>innodb_lru_scan_depth</code>\u7684\u65f6\u5019\u624d\u4f1a\u53d1\u8d77\u3002\u5982\u679c\u4e0d\u662f\u810f\u9875\u53ef\u4ee5\u76f4\u63a5\u7528<code>buf_LRU_free_page</code>\u4eceLRU\u4e0a\u5220\u9664\uff0c\u5426\u5219\u8fd8\u9700\u8981\u8c03\u7528<code>buf_flush_page_and_try_neighbors</code>\u5148\u8fdb\u884c\u5237\u810f\uff0c\u4ece\u51fd\u6570\u540d\u5b57\u4e5f\u53ef\u4ee5\u770b\u51fa\uff0c\u5237\u6bcf\u4e00\u4e2aPage\u7684\u65f6\u5019\u90fd\u4f1a\u5c1d\u8bd5\u5bf9\u5176\u5468\u56f4\u7684\u5176\u4ed6\u810f\u9875\u4e5f\u8fdb\u884cFlush\uff0c\u8fd9\u4e2a\u4e3b\u8981\u8fd8\u662f\u4e3a\u4e86\u5229\u7528\u78c1\u76d8\u7684\u987a\u5e8f\u5199\u6027\u80fd\uff0c\u53ef\u4ee5\u901a\u8fc7<code>innodb_flush_neighbors</code>\u914d\u7f6e\u5f00\u5173\u3002\u5982\u679c\u4eceLRU List\u4e0a\u6ca1\u6709Flush\u8db3\u591f\u91cf\u7684Page\u5c31\u9700\u8981\u904d\u5386Flush List\uff0c\u540c\u6837\u8c03\u7528<code>buf_flush_page_and_try_neighbors</code>\u8fdb\u884c\u5237\u810f\u3002 \u65e0\u8bba\u54ea\u79cd\u65b9\u5f0f\u7684\u5237\u810f\uff0c\u6700\u7ec8\u90fd\u4f1a\u8fdb\u5165<code>buf_flush_write_block_low</code>\u5199\u76d8\uff0c\u9664\u4e86Single Flush\u4ee5\u5916\uff0c\u6240\u6709\u7684Flush\u64cd\u4f5c\u90fd\u662f\u5f02\u6b65\u8fdb\u884c\u7684\uff0cIO\u7ed3\u675f\u540e\u4f1a\u5728IO\u7ebf\u7a0b\u4e2d\u56de\u8c03<code>buf_page_io_complete</code>\u505a\u6536\u5c3e\u5de5\u4f5c\uff0c\u5305\u62ec\u6e05\u7a7aIO FIX\u72b6\u6001\uff0c\u91ca\u653ePage Lock\uff0c\u4ee5\u53ca\u4eceFlush List\u548cLRU List\u4e0a\u5220\u9664\u3002</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#_6","title":"\u5e76\u53d1\u63a7\u5236","text":"<p>InnoDB\u4e2d\u53ef\u80fd\u5b58\u5728\u5927\u91cf\u7684\u7ebf\u7a0b\u540c\u65f6\u7ade\u4e89\u8bbf\u95eeBuffer Pool\uff0c\u5305\u62ec\u6240\u6709\u901a\u8fc7<code>buf_page_get_gen</code>\u83b7\u53d6Page\u7684\u7528\u6237\u7ebf\u7a0b\u548c\u540e\u53f0\u7ebf\u7a0b\uff1b\u4e0a\u9762\u63d0\u5230\u7684Flush\u7ebf\u7a0b\uff1b\u4ee5\u53caIO\u7ebf\u7a0b\u3002\u4f5c\u4e3a\u6574\u4e2a\u6570\u636e\u5e93\u7684\u6570\u636e\u4e2d\u67a2\uff0cBuffer Pool\u5bf9\u5e76\u53d1\u8bbf\u95ee\u7684\u652f\u6301\u80fd\u529b\u76f4\u63a5\u5f71\u54cd\u6570\u636e\u5e93\u7684\u6027\u80fd\uff0c\u4ece\u4ee3\u7801\u4e2d\u4e5f\u53ef\u4ee5\u770b\u51fa\u5176\u4e2d\u6709\u5927\u91cf\u9501\u76f8\u5173\u7684\u903b\u8f91\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u5de5\u4e1a\u7ea7\u7684\u6570\u636e\u5e93\u5b9e\u73b0\uff0c\u8fd9\u4e9b\u903b\u8f91\u90fd\u7ecf\u8fc7\u4e86\u5927\u91cf\u7ec6\u8282\u4e0a\u7684\u4f18\u5316\uff0c\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u589e\u52a0\u4e86\u4ee3\u7801\u7684\u590d\u6742\u6027\u3002\u800c\u9501\u7684\u4f18\u5316\u601d\u8def\uff0c\u65e0\u5916\u4e4e\u964d\u4f4e\u9501\u7c92\u5ea6\uff0c\u51cf\u5c11\u9501\u65f6\u95f4\uff0c\u6d88\u9664\u9501\u8bf7\u6c42\u7b49\uff0c\u672c\u8282\u5c31\u6cbf\u7740\u8fd9\u6837\u7684\u601d\u8def\u4ecb\u7ecdBuffer Pool\u4e2d\u9501\u7684\u8bbe\u8ba1\u4e0e\u5b9e\u73b0\u3002Buffer Pool\u4e2d\u6d89\u53ca\u5230\u7684\u9501\uff0c\u6309\u7167\u9501\u4fdd\u62a4\u5bf9\u8c61\u7684\u5c42\u6b21\uff0c\u4f9d\u6b21\u5206\u4e3a\uff1a\u4fdd\u62a4Hash\u8868\u7684Hash Map Lock\uff0c\u4fdd\u62a4List\u7ed3\u6784\u7684List Mutex\uff0c\u4fdd\u62a4buf_block_t\u4e2d\u7ed3\u6784\u7684Block Mutex\uff0c\u4fdd\u62a4\u771f\u6b63\u7684Page\u5185\u5bb9\u7684Page Frame Lock\u3002</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#hash-map-lock","title":"Hash Map Lock","text":"<p>\u6240\u6709\u7684buf_page_get_gen\u8bf7\u6c42\u7684\u7b2c\u4e00\u6b65\u5c31\u662f\u901a\u8fc7Hash Map\u5224\u65adBlock\u662f\u5426\u5b58\u5728\u4e8eBuffer Pool\u4e2d\uff0c\u53ef\u60f3\u800c\u77e5\u8fd9\u91cc\u7684\u7ade\u4e89\u662f\u6781\u5176\u5f3a\u70c8\u7684\uff0cInnoDB\u4e2d\u91c7\u7528\u4e86\u5206\u533a\u9501\u7684\u529e\u6cd5\uff0c\u5206\u533a\u7684\u6570\u91cf\u53ef\u4ee5\u901a\u8fc7<code>innodb_page_hash_locks\uff0816\uff09</code>\u6765\u914d\u7f6e\uff0c\u6bcf\u4e2a\u5206\u533a\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u72ec\u7acb\u7684\u8bfb\u5199\u9501\u3002\u6bcf\u6b21\u8bf7\u6c42\u4f1a\u5148\u901a\u8fc7page_id\u6620\u5c04\u5230\u4e00\u4e2a\u5206\u533a\u4e0a\uff0c\u7136\u540e\u8bf7\u6c42\u8fd9\u4e2a\u5206\u533a\u7684\u8bfb\u5199\u9501\u3002\u5982\u6b64\u4e00\u6765\u53ea\u6709\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u5206\u533a\u7684\u8bf7\u6c42\u624d\u4f1a\u4ea7\u751f\u6240\u51b2\u7a81\u3002</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#list-mutex","title":"List Mutex","text":"<p>\u4e0a\u9762\u8bb2\u8fc7Buffer Pool\u4e2d\u7684Block\u662f\u6309\u7167List\u7ef4\u62a4\u7684\uff0c\u6700\u57fa\u7840\u7684\u5305\u62ec\u7ef4\u62a4\u5168\u91cf\u4f7f\u7528Block\u7684LRU List\uff0c\u7a7a\u95f2\u9875\u7684Free List\uff0c\u4ee5\u53ca\u810f\u9875\u7684Flush List\u3002\u8fd9\u4e9bList\u90fd\u6709\u81ea\u5df1\u72ec\u7acb\u7684\u4e92\u65a5\u9501Mutex\uff0c\u5bf9List\u7684\u8bfb\u53d6\u6216\u4fee\u6539\u90fd\u9700\u8981\u6301\u6709List\u672c\u8eab\u7684Mutex\u3002\u8fd9\u4e9b\u9501\u7684\u76ee\u7684\u662f\u4fdd\u62a4\u5bf9\u5e94\u7684List\u672c\u8eab\u7684\u6570\u636e\u7ed3\u6784\uff0c\u56e0\u6b64\u4f1a\u6700\u5c0f\u5316\u5230\u5bf9List\u672c\u8eab\u6570\u636e\u7ed3\u6784\u8bbf\u95ee\u548c\u4fee\u6539\u7684\u8303\u56f4\u5185\u3002</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#block-mutex","title":"Block Mutex","text":"<p>\u6bcf\u4e2aPage\u7684\u63a7\u5236\u7ed3\u6784\u4f53buf_block_t\u4e0a\u90fd\u6709\u4e00\u4e2a<code>block-&gt;mutex</code>\u7528\u6765\u4fdd\u62a4\u8fd9\u4e2ablock\u7684\u4e00\u4e9b\u8bf8\u5982io_fix\uff0cbuf_fix_count\u3001\u8bbf\u95ee\u65f6\u95f4\u7b49\u72b6\u6001\u4fe1\u606f\u3002\u76f8\u5bf9\u4e8e\u5916\u5c42\u65e0\u8bba\u662fHash Map\u8fd8\u662fList Mutex\uff0cBlock Mutex\u7684\u9501\u7c92\u5ea6\u90fd\u5c0f\u7684\u5f88\u591a\uff0c\u901a\u8fc7Block Mutex\u6765\u907f\u514d\u66f4\u957f\u65f6\u95f4\u7684\u6301\u6709\u4e0a\u5c42\u5bb9\u5668\u7684\u9501\u663e\u7136\u662f\u5212\u7b97\u7684\u3002\u800cio_fix\uff0cbuf_fix_count\u8fd9\u4e9b\u4fe1\u606f\u4e5f\u80fd\u663e\u8457\u7684\u51cf\u5c11\u5bf9Page Lock\u7684\u4e89\u62a2\uff0c \u6bd4\u5982\u5f53Buffer Pool\u9700\u8981\u4eceLRU\u4e0a\u8e22\u51fa\u4e00\u4e2a\u8001Page\u65f6\uff0c\u9700\u8981\u786e\u5b9a\u8fd9\u4e2aPage\u6ca1\u6709\u6b63\u5728\u88ab\u4f7f\u7528\uff0c\u4ee5\u53ca\u6ca1\u6709\u5728\u505aIO\u64cd\u4f5c\uff0c\u8fd9\u4e2a\u662f\u4e2a\u975e\u5e38\u5e38\u89c1\u7684\u884c\u4e3a\uff0c\u4f46\u4ed6\u672c\u8eab\u5176\u5b9e\u5e76\u4e0d\u5173\u5fc3Page\u7684\u5185\u5bb9\u3002\u8fd9\u65f6\uff0c\u77ed\u6682\u7684\u6301\u6709Block Mutex\u5e76\u5224\u65adio_fix\u72b6\u6001\u548cbuf_fix_count\u8ba1\u6570\uff0c\u663e\u7136\u4f1a\u6bd4\u4e89\u62a2Page Frame Lock\u66f4\u8f7b\u91cf\u3002</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#page-frame-lock","title":"Page Frame Lock","text":"<p>\u9664\u4e86Block Mutex\uff0cbuf_block_t\u4e0a\u8fd8\u6709\u4e00\u4e2a\u8bfb\u5199\u9501\u7ed3\u6784<code>block-&gt;lock</code>\uff0c\u8fd9\u4e2a\u8bfb\u5199\u9501\u4fdd\u62a4\u7684\u662f\u771f\u6b63\u7684page\u5185\u5bb9\uff0c\u4e5f\u5c31\u662fblock-&gt;frame\u3002\u8fd9\u4e2a\u9501\u5c31\u662f\u300aB+\u6811\u6570\u636e\u5e93\u52a0\u9501\u5386\u53f2\u300b[4]\u4e00\u6587\u4e2d\u8bb2\u5230\u7684\u4fdd\u62a4Page\u7684Latch\uff0c\u5728\u5bf9B+Tree\u7684\u904d\u5386\u548c\u4fee\u6539\u4e2d\u90fd\u53ef\u80fd\u9700\u8981\u83b7\u53d6\u8fd9\u628a\u9501\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u6d89\u53ca\u5230Page\u7684IO\u7684\u8fc7\u7a0b\u4e2d\u4e5f\u9700\u8981\u6301\u6709\u8fd9\u628a\u9501\uff0cPage\u8bfbIO\u7531\u4e8e\u9700\u8981\u76f4\u63a5\u4fee\u6539\u5185\u5b58frame\u5185\u5bb9\uff0c\u9700\u8981\u6301\u6709X lock\uff0c\u800c\u5199IO\u7684\u8fc7\u7a0b\u6301\u6709\u7684\u662fSX Lock\uff0c\u6765\u907f\u514d\u6709\u5176\u4ed6\u5199IO\u64cd\u4f5c\u540c\u65f6\u53d1\u751f\u3002</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#_7","title":"\u6b7b\u9501\u907f\u514d","text":"<p>\u5f53\u4e0a\u9762\u8fd9\u4e9b\u9501\u4e2d\u7684\u591a\u4e2a\u9700\u8981\u540c\u65f6\u83b7\u53d6\u65f6\uff0c\u4e3a\u4e86\u907f\u514d\u4e0d\u540c\u7ebf\u7a0b\u95f4\u53d1\u751f\u6b7b\u9501\uff0cInnoDB\u89c4\u5b9a\u4e86\u4e25\u683c\u7684\u52a0\u9501\u987a\u5e8f\uff0c\u4e5f\u5c31\u662fLatch Order\uff0c\u5982\u4e0b\u6240\u793a\uff0c\u6240\u6709\u5bf9\u9501\u7684\u83b7\u53d6\u5fc5\u987b\u8981\u6309\u7167\u8fd9\u4e2a\u987a\u5e8f\u4ece\u4e0b\u5f80\u4e0a\u8fdb\u884c\u3002\u8fd9\u4e2a\u987a\u5e8f\u8ddf\u5927\u591a\u6570\u573a\u666f\u7684\u4f7f\u7528\u662f\u4e00\u81f4\u7684\uff0c\u4f46\u4e5f\u662f\u6709\u4f8b\u5916\u7684\uff0c\u6bd4\u5982\u4eceFlush List\u4e0a\u9009\u62e9Page\u8fdb\u884c\u5237\u810f\u7684\u65f6\u5019\uff0c\u7531\u4e8eFlush List Mutex\u7684\u7ea7\u522b\u6bd4\u8f83\u4f4e\uff0c\u53ef\u4ee5\u770b\u5230\u653e\u6389Flush List Mutex\u518d\u53bb\u83b7\u53d6Block Mutex\u7684\u60c5\u51b5\u3002</p> <pre><code>enum latch_level_t {\n  ...\n  SYNC_BUF_FLUSH_LIST,   /* Flush List Mutex */\n  SYNC_BUF_FREE_LIST,    /* Free List Mutex */\n  SYNC_BUF_BLOCK,    /* Block Mutex */\n  SYNC_BUF_PAGE_HASH,    /* Hash Map Lock */\n  SYNC_BUF_LRU_LIST,     /* LRU List Mutex */\n...\n}\n</code></pre>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#_8","title":"\u793a\u4f8b\u573a\u666f","text":"<p>\u4e3a\u4e86\u66f4\u597d\u7684\u7406\u89e3Buffer Pool\u7684\u52a0\u9501\u8fc7\u7a0b\uff0c\u6211\u4eec\u8bbe\u60f3\u8fd9\u6837\u4e00\u79cd\u573a\u666f\uff1a\u4e00\u4e2a\u7528\u6237\u8bfb\u8bf7\u6c42\uff0c\u9700\u8981\u901a\u8fc7<code>buf_page_get_gen</code>\u6765\u83b7\u53d6Page a\uff0c\u9996\u5148\u67e5\u627eHash Map\u53d1\u73b0\u5176\u4e0d\u5728\u5185\u5b58\uff0c\u68c0\u67e5Free List\u53d1\u73b0\u4e5f\u6ca1\u6709\u7a7a\u9875\uff0c\u53ea\u597d\u4eceLRU\u7684Tail\u5148\u8e22\u51fa\u4e00\u4e2a\u8001\u7684Page\uff0c\u5c06\u5176Block A\u52a0\u5165Free List\uff0c\u4e4b\u540e\u518d\u4ece\u78c1\u76d8\u5c06Page a\u8bfb\u5165Block A\uff0c\u6700\u540e\u83b7\u5f97\u8fd9\u4e2aPage a\uff0c\u5e76\u6301\u6709\u5176Lock\u53caFIX\u72b6\u6001\u3002\u5f97\u5230\u4e00\u4e2a\u5982\u4e0b\u8868\u6240\u793a\u7684\u52a0\u9501\u8fc7\u7a0b\uff1a</p> <p></p> <p>\u8fd9\u5f20\u8868\u4e2d\u53ef\u4ee5\u6e05\u695a\u7684\u770b\u5230\uff1a1\uff0c\u6bcf\u79cd\u9501\u90fd\u9650\u5236\u5728\u771f\u6b63\u64cd\u4f5c\u5176\u4fdd\u62a4\u7684\u6570\u636e\u7ed3\u6784\u7684\u8f83\u5c0f\u8303\u56f4\u5185\uff1b2\uff0c\u5f53\u9700\u8981\u540c\u65f6\u6301\u6709\u591a\u4e2a\u9501\u65f6\uff0c\u4e25\u683c\u9075\u5b88\u4e0a\u9762\u8bf4\u7684Latch Order\uff0c\u6bd4\u5982\u4eceLRU\u548cHash Map\u4e2d\u52a0\u5165\u6216\u5220\u9664\u65f6\uff0c\u4e25\u683c\u9075\u5b88LRU List Mutex -&gt; Hash Map Mutex -&gt; Block Mutex\u7684\u987a\u5e8f\u30023\uff0c\u5728IO\u8fc7\u7a0b\u4e2d\uff0c\u9664\u4e86Page Frame Lock\u5916\u4e0d\u6301\u6709\u4efb\u4f55\u9501\uff0c\u540c\u65f6\u4e5f\u901a\u8fc7\u8bbe\u7f6eio_fix\uff0c\u907f\u514d\u4e86\u8bf8\u5982LRU\u7b97\u6cd5\u68c0\u67e5\u662f\u5426\u53ef\u4ee5\u6362\u51fa\u65f6\uff0c\u5bf9Page Frame Lock\u52a0\u9501\u3002\u7bc7\u5e45\u5173\u7cfb\uff0c\u8fd9\u91cc\u53ea\u4ecb\u7ecd\u4e86\u8fd9\u4e00\u79cd\u573a\u666f\u7684\u52a0\u9501\u987a\u5e8f\uff0c\u66f4\u591a\u7684\u5185\u5bb9\u53ef\u4ee5\u89c1\u94fe\u63a5\uff1aFlush List\u5237\u810f\u52a0\u9501\uff0cLRU List\u5237\u810f\u52a0\u9501\u3002</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#_9","title":"\u603b\u7ed3","text":"<p>\u672c\u6587\u805a\u7126\u4e8eInnoDB\u4e2d\u7684Buffer Pool\u7684\u6838\u5fc3\u529f\u80fd\uff0c\u9996\u5148\u4ece\u5b8f\u89c2\u4e0a\u4ecb\u7ecd\u5176\u80cc\u666f\uff0c\u5305\u62ec\u8bbe\u8ba1\u76ee\u6807\u3001\u63a5\u53e3\u3001\u9047\u5230\u7684\u95ee\u9898\u53ca\u66ff\u6362\u7b97\u6cd5\u7684\u9009\u62e9\u7b49\uff1b\u7136\u540e\u540e\u4ece\u4f7f\u7528\u8005\u7684\u89d2\u5ea6\u4ecb\u7ecd\u4e86Buffer Pool\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u5bf9\u5916\u66b4\u9732\u7684\u7edf\u4e00\u63a5\u53e3\u548c\u8c03\u7528\u65b9\u5f0f\uff1b\u4e4b\u540e\u4ecb\u7ecd\u4e86Buffer Pool\u5185\u90e8\u83b7\u53d6Page\u7684\u8be6\u7ec6\u8fc7\u7a0b\u4ee5\u53caLRU\u66ff\u6362\u7b97\u6cd5\u7684\u5b9e\u73b0\uff1b\u518d\u4e4b\u540e\u4ecb\u7ecd\u4e86Page\u5237\u810f\u7684\u89e6\u53d1\u56e0\u7d20\u53ca\u8fc7\u7a0b\uff1b\u6700\u540e\u68b3\u7406\u4e86Buffer Pool\u5982\u4f55\u5b89\u5168\u7684\u5b9e\u73b0\u9ad8\u5e76\u53d1\u9ad8\u6027\u80fd\u3002</p>"},{"location":"blog/2023/01/04/%E5%BA%96%E4%B8%81%E8%A7%A3innodb%E4%B9%8Bbuffer-pool/#_10","title":"\u53c2\u8003","text":"<p>[1] MySQL Source Code</p> <p>[2] \u6570\u636e\u5e93\u6545\u969c\u6062\u590d\u7684\u524d\u4e16\u4eca\u751f</p> <p>[3] Effelsberg, Wolfgang, and Theo Haerder. \u201cPrinciples of database buffer management.\u201d ACM Transactions on Database Systems (TODS) 9.4 (1984): 560-595.</p> <p>[4] B+\u6811\u6570\u636e\u5e93\u52a0\u9501\u5386\u53f2</p> <p>[5] B+\u6811\u6570\u636e\u5e93\u6545\u969c\u6062\u590d\u6982\u8ff0</p> <p>[6] MySQL 8.0 Reference Manual 15.8.3.3 Making the Buffer Pool Scan Resistant</p> <p>[7] MySQL 8.0 Reference Manual 15.5.1 Buffer Pool</p> <p>[8] \u5e96\u4e01\u89e3InnoDB\u4e4bREDO LOG</p> <p>[9] \u6570\u636e\u5e93\u6545\u969c\u6062\u590d\u673a\u5236\u7684\u524d\u4e16\u4eca\u751f</p> <p>[10] Buffer pool \u5e76\u53d1\u63a7\u5236</p> <p>[11] Buffer Pool Performance Improvements in the InnoDB Storage Engine of MariaDB Server</p> <p>[12] PolarDB \u6570\u636e\u5e93\u5185\u6838\u6708\u62a5</p>"},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/","title":"\u8c03\u8282\u78c1\u76d8\u548cCPU\u7684\u77db\u76fe\u2014\u2014InnoDB\u7684Buffer Pool","text":"<p>\u4f5c\u8005\uff1a\u5c0f\u5b69\u5b50</p> <p>\u7b80\u8ff0\uff1a\u4ecb\u7ecdMySQL5.7\u7248\u672c\u7684\u7f13\u51b2\u6c60\uff0c\u539f\u6587\u662f\u6536\u8d39\u7684\uff0c\u6709\u80fd\u529b\u7684\u53ef\u4ee5\u652f\u6301\u4e00\u4e0b\uff01</p> <p>\u539f\u6587\u94fe\u63a5\uff1ahttps://juejin.cn/book/6844733769996304392/section/6844733770063429646</p>"},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/#_1","title":"\u7f13\u5b58\u7684\u91cd\u8981\u6027","text":"<p>\u901a\u8fc7\u524d\u8fb9\u7684\u5520\u53e8\u6211\u4eec\u77e5\u9053\uff0c\u5bf9\u4e8e\u4f7f\u7528<code>InnoDB</code>\u4f5c\u4e3a\u5b58\u50a8\u5f15\u64ce\u7684\u8868\u6765\u8bf4\uff0c\u4e0d\u7ba1\u662f\u7528\u4e8e\u5b58\u50a8\u7528\u6237\u6570\u636e\u7684\u7d22\u5f15\uff08\u5305\u62ec\u805a\u7c07\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\uff09\uff0c\u8fd8\u662f\u5404\u79cd\u7cfb\u7edf\u6570\u636e\uff0c\u90fd\u662f\u4ee5<code>\u9875</code>\u7684\u5f62\u5f0f\u5b58\u653e\u5728<code>\u8868\u7a7a\u95f4</code>\u4e2d\u7684\uff0c\u800c\u6240\u8c13\u7684<code>\u8868\u7a7a\u95f4</code>\u53ea\u4e0d\u8fc7\u662f<code>InnoDB</code>\u5bf9\u6587\u4ef6\u7cfb\u7edf\u4e0a\u4e00\u4e2a\u6216\u51e0\u4e2a\u5b9e\u9645\u6587\u4ef6\u7684\u62bd\u8c61\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u7684\u6570\u636e\u8bf4\u5230\u5e95\u8fd8\u662f\u5b58\u50a8\u5728\u78c1\u76d8\u4e0a\u7684\u3002\u4f46\u662f\u5404\u4f4d\u4e5f\u90fd\u77e5\u9053\uff0c\u78c1\u76d8\u7684\u901f\u5ea6\u6162\u7684\u8ddf\u4e4c\u9f9f\u4e00\u6837\uff0c\u600e\u4e48\u80fd\u914d\u5f97\u4e0a\u201c\u5feb\u5982\u98ce\uff0c\u75be\u5982\u7535\u201d\u7684<code>CPU</code>\u5462\uff1f\u6240\u4ee5<code>InnoDB</code>\u5b58\u50a8\u5f15\u64ce\u5728\u5904\u7406\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u65f6\uff0c\u5f53\u9700\u8981\u8bbf\u95ee\u67d0\u4e2a\u9875\u7684\u6570\u636e\u65f6\uff0c\u5c31\u4f1a\u628a\u5b8c\u6574\u7684\u9875\u7684\u6570\u636e\u5168\u90e8\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u4e5f\u5c31\u662f\u8bf4\u5373\u4f7f\u6211\u4eec\u53ea\u9700\u8981\u8bbf\u95ee\u4e00\u4e2a\u9875\u7684\u4e00\u6761\u8bb0\u5f55\uff0c\u90a3\u4e5f\u9700\u8981\u5148\u628a\u6574\u4e2a\u9875\u7684\u6570\u636e\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u3002\u5c06\u6574\u4e2a\u9875\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u540e\u5c31\u53ef\u4ee5\u8fdb\u884c\u8bfb\u5199\u8bbf\u95ee\u4e86\uff0c\u5728\u8fdb\u884c\u5b8c\u8bfb\u5199\u8bbf\u95ee\u4e4b\u540e\u5e76\u4e0d\u7740\u6025\u628a\u8be5\u9875\u5bf9\u5e94\u7684\u5185\u5b58\u7a7a\u95f4\u91ca\u653e\u6389\uff0c\u800c\u662f\u5c06\u5176<code>\u7f13\u5b58</code>\u8d77\u6765\uff0c\u8fd9\u6837\u5c06\u6765\u6709\u8bf7\u6c42\u518d\u6b21\u8bbf\u95ee\u8be5\u9875\u9762\u65f6\uff0c\u5c31\u53ef\u4ee5\u7701\u53bb\u78c1\u76d8<code>IO</code>\u7684\u5f00\u9500\u4e86\u3002</p>"},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/#innodbbuffer-pool","title":"InnoDB\u7684Buffer Pool","text":""},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/#buffer-pool","title":"\u5565\u662f\u4e2aBuffer Pool","text":"<p>\u8bbe\u8ba1<code>InnoDB</code>\u7684\u5927\u53d4\u4e3a\u4e86\u7f13\u5b58\u78c1\u76d8\u4e2d\u7684\u9875\uff0c\u5728<code>MySQL</code>\u670d\u52a1\u5668\u542f\u52a8\u7684\u65f6\u5019\u5c31\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u4e86\u4e00\u7247\u8fde\u7eed\u7684\u5185\u5b58\uff0c\u4ed6\u4eec\u7ed9\u8fd9\u7247\u5185\u5b58\u8d77\u4e86\u4e2a\u540d\uff0c\u53eb\u505a<code>Buffer Pool</code>\uff08\u4e2d\u6587\u540d\u662f<code>\u7f13\u51b2\u6c60</code>\uff09\u3002\u90a3\u5b83\u6709\u591a\u5927\u5462\uff1f\u8fd9\u4e2a\u5176\u5b9e\u770b\u6211\u4eec\u673a\u5668\u7684\u914d\u7f6e\uff0c\u5982\u679c\u4f60\u662f\u571f\u8c6a\uff0c\u4f60\u6709<code>512G</code>\u5185\u5b58\uff0c\u4f60\u5206\u914d\u4e2a\u51e0\u767eG\u4f5c\u4e3a<code>Buffer Pool</code>\u4e5f\u53ef\u4ee5\u554a\uff0c\u5f53\u7136\u4f60\u8981\u662f\u6ca1\u90a3\u4e48\u6709\u94b1\uff0c\u8bbe\u7f6e\u5c0f\u70b9\u4e5f\u884c\u5440\uff5e \u9ed8\u8ba4\u60c5\u51b5\u4e0b<code>Buffer Pool</code>\u53ea\u6709<code>128M</code>\u5927\u5c0f\u3002\u5f53\u7136\u5982\u679c\u4f60\u5acc\u5f03\u8fd9\u4e2a<code>128M</code>\u592a\u5927\u6216\u8005\u592a\u5c0f\uff0c\u53ef\u4ee5\u5728\u542f\u52a8\u670d\u52a1\u5668\u7684\u65f6\u5019\u914d\u7f6e<code>innodb_buffer_pool_size</code>\u53c2\u6570\u7684\u503c\uff0c\u5b83\u8868\u793a<code>Buffer Pool</code>\u7684\u5927\u5c0f\uff0c\u5c31\u50cf\u8fd9\u6837\uff1a</p> <pre><code>ini\u590d\u5236\u4ee3\u7801[server]\ninnodb_buffer_pool_size = 268435456\n</code></pre> <p>\u5176\u4e2d\uff0c<code>268435456</code>\u7684\u5355\u4f4d\u662f\u5b57\u8282\uff0c\u4e5f\u5c31\u662f\u6211\u6307\u5b9a<code>Buffer Pool</code>\u7684\u5927\u5c0f\u4e3a<code>256M</code>\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c<code>Buffer Pool</code>\u4e5f\u4e0d\u80fd\u592a\u5c0f\uff0c\u6700\u5c0f\u503c\u4e3a<code>5M</code>(\u5f53\u5c0f\u4e8e\u8be5\u503c\u65f6\u4f1a\u81ea\u52a8\u8bbe\u7f6e\u6210<code>5M</code>)\u3002</p>"},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/#buffer-pool_1","title":"Buffer Pool\u5185\u90e8\u7ec4\u6210","text":"<p><code>Buffer Pool</code>\u4e2d\u9ed8\u8ba4\u7684\u7f13\u5b58\u9875\u5927\u5c0f\u548c\u5728\u78c1\u76d8\u4e0a\u9ed8\u8ba4\u7684\u9875\u5927\u5c0f\u662f\u4e00\u6837\u7684\uff0c\u90fd\u662f<code>16KB</code>\u3002\u4e3a\u4e86\u66f4\u597d\u7684\u7ba1\u7406\u8fd9\u4e9b\u5728<code>Buffer Pool</code>\u4e2d\u7684\u7f13\u5b58\u9875\uff0c\u8bbe\u8ba1<code>InnoDB</code>\u7684\u5927\u53d4\u4e3a\u6bcf\u4e00\u4e2a\u7f13\u5b58\u9875\u90fd\u521b\u5efa\u4e86\u4e00\u4e9b\u6240\u8c13\u7684<code>\u63a7\u5236\u4fe1\u606f</code>\uff0c\u8fd9\u4e9b\u63a7\u5236\u4fe1\u606f\u5305\u62ec\u8be5\u9875\u6240\u5c5e\u7684\u8868\u7a7a\u95f4\u7f16\u53f7\u3001\u9875\u53f7\u3001\u7f13\u5b58\u9875\u5728<code>Buffer Pool</code>\u4e2d\u7684\u5730\u5740\u3001\u94fe\u8868\u8282\u70b9\u4fe1\u606f\u3001\u4e00\u4e9b\u9501\u4fe1\u606f\u4ee5\u53ca<code>LSN</code>\u4fe1\u606f\uff08\u9501\u548c<code>LSN</code>\u6211\u4eec\u4e4b\u540e\u4f1a\u5177\u4f53\u5520\u53e8\uff0c\u73b0\u5728\u53ef\u4ee5\u5148\u5ffd\u7565\uff09\uff0c\u5f53\u7136\u8fd8\u6709\u4e00\u4e9b\u522b\u7684\u63a7\u5236\u4fe1\u606f\uff0c\u6211\u4eec\u8fd9\u5c31\u4e0d\u5168\u5520\u53e8\u4e00\u904d\u4e86\uff0c\u6311\u91cd\u8981\u7684\u8bf4\u561b\uff5e</p> <p>\u6bcf\u4e2a\u7f13\u5b58\u9875\u5bf9\u5e94\u7684\u63a7\u5236\u4fe1\u606f\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f\u662f\u76f8\u540c\u7684\uff0c\u6211\u4eec\u5c31\u628a\u6bcf\u4e2a\u9875\u5bf9\u5e94\u7684\u63a7\u5236\u4fe1\u606f\u5360\u7528\u7684\u4e00\u5757\u5185\u5b58\u79f0\u4e3a\u4e00\u4e2a<code>\u63a7\u5236\u5757</code>\u5427\uff0c\u63a7\u5236\u5757\u548c\u7f13\u5b58\u9875\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\uff0c\u5b83\u4eec\u90fd\u88ab\u5b58\u653e\u5230 Buffer Pool \u4e2d\uff0c\u5176\u4e2d\u63a7\u5236\u5757\u88ab\u5b58\u653e\u5230 Buffer Pool \u7684\u524d\u8fb9\uff0c\u7f13\u5b58\u9875\u88ab\u5b58\u653e\u5230 Buffer Pool \u540e\u8fb9\uff0c\u6240\u4ee5\u6574\u4e2a<code>Buffer Pool</code>\u5bf9\u5e94\u7684\u5185\u5b58\u7a7a\u95f4\u770b\u8d77\u6765\u5c31\u662f\u8fd9\u6837\u7684\uff1a</p> <p></p> <p>\u54a6\uff1f\u63a7\u5236\u5757\u548c\u7f13\u5b58\u9875\u4e4b\u95f4\u7684\u90a3\u4e2a<code>\u788e\u7247</code>\u662f\u4e2a\u4ec0\u4e48\u73a9\u610f\u513f\uff1f\u4f60\u60f3\u60f3\u554a\uff0c\u6bcf\u4e00\u4e2a\u63a7\u5236\u5757\u90fd\u5bf9\u5e94\u4e00\u4e2a\u7f13\u5b58\u9875\uff0c\u90a3\u5728\u5206\u914d\u8db3\u591f\u591a\u7684\u63a7\u5236\u5757\u548c\u7f13\u5b58\u9875\u540e\uff0c\u53ef\u80fd\u5269\u4f59\u7684\u90a3\u70b9\u513f\u7a7a\u95f4\u4e0d\u591f\u4e00\u5bf9\u63a7\u5236\u5757\u548c\u7f13\u5b58\u9875\u7684\u5927\u5c0f\uff0c\u81ea\u7136\u5c31\u7528\u4e0d\u5230\u55bd\uff0c\u8fd9\u4e2a\u7528\u4e0d\u5230\u7684\u90a3\u70b9\u513f\u5185\u5b58\u7a7a\u95f4\u5c31\u88ab\u79f0\u4e3a<code>\u788e\u7247</code>\u4e86\u3002\u5f53\u7136\uff0c\u5982\u679c\u4f60\u628a<code>Buffer Pool</code>\u7684\u5927\u5c0f\u8bbe\u7f6e\u7684\u521a\u521a\u597d\u7684\u8bdd\uff0c\u4e5f\u53ef\u80fd\u4e0d\u4f1a\u4ea7\u751f<code>\u788e\u7247</code>\uff5e</p> <p>\u5c0f\u8d34\u58eb\uff1a</p> <p>\u6bcf\u4e2a\u63a7\u5236\u5757\u5927\u7ea6\u5360\u7528\u7f13\u5b58\u9875\u5927\u5c0f\u76845%\uff0c\u5728MySQL5.7.21\u8fd9\u4e2a\u7248\u672c\u4e2d\uff0c\u6bcf\u4e2a\u63a7\u5236\u5757\u5360\u7528\u7684\u5927\u5c0f\u662f808\u5b57\u8282\u3002\u800c\u6211\u4eec\u8bbe\u7f6e\u7684innodb_buffer_pool_size\u5e76\u4e0d\u5305\u542b\u8fd9\u90e8\u5206\u63a7\u5236\u5757\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u5927\u5c0f\uff0c\u4e5f\u5c31\u662f\u8bf4InnoDB\u5728\u4e3aBuffer Pool\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u65f6\uff0c\u8fd9\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u4e00\u822c\u4f1a\u6bd4innodb_buffer_pool_size\u7684\u503c\u59275%\u5de6\u53f3\u3002</p>"},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/#free","title":"free\u94fe\u8868\u7684\u7ba1\u7406","text":"<p>\u5f53\u6211\u4eec\u6700\u521d\u542f\u52a8<code>MySQL</code>\u670d\u52a1\u5668\u7684\u65f6\u5019\uff0c\u9700\u8981\u5b8c\u6210\u5bf9<code>Buffer Pool</code>\u7684\u521d\u59cb\u5316\u8fc7\u7a0b\uff0c\u5c31\u662f\u5148\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7<code>Buffer Pool</code>\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u7136\u540e\u628a\u5b83\u5212\u5206\u6210\u82e5\u5e72\u5bf9\u63a7\u5236\u5757\u548c\u7f13\u5b58\u9875\u3002\u4f46\u662f\u6b64\u65f6\u5e76\u6ca1\u6709\u771f\u5b9e\u7684\u78c1\u76d8\u9875\u88ab\u7f13\u5b58\u5230<code>Buffer Pool</code>\u4e2d\uff08\u56e0\u4e3a\u8fd8\u6ca1\u6709\u7528\u5230\uff09\uff0c\u4e4b\u540e\u968f\u7740\u7a0b\u5e8f\u7684\u8fd0\u884c\uff0c\u4f1a\u4e0d\u65ad\u7684\u6709\u78c1\u76d8\u4e0a\u7684\u9875\u88ab\u7f13\u5b58\u5230<code>Buffer Pool</code>\u4e2d\u3002\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u4ece\u78c1\u76d8\u4e0a\u8bfb\u53d6\u4e00\u4e2a\u9875\u5230<code>Buffer Pool</code>\u4e2d\u7684\u65f6\u5019\u8be5\u653e\u5230\u54ea\u4e2a\u7f13\u5b58\u9875\u7684\u4f4d\u7f6e\u5462\uff1f\u6216\u8005\u8bf4\u600e\u4e48\u533a\u5206<code>Buffer Pool</code>\u4e2d\u54ea\u4e9b\u7f13\u5b58\u9875\u662f\u7a7a\u95f2\u7684\uff0c\u54ea\u4e9b\u5df2\u7ecf\u88ab\u4f7f\u7528\u4e86\u5462\uff1f\u6211\u4eec\u6700\u597d\u5728\u67d0\u4e2a\u5730\u65b9\u8bb0\u5f55\u4e00\u4e0bBuffer Pool\u4e2d\u54ea\u4e9b\u7f13\u5b58\u9875\u662f\u53ef\u7528\u7684\uff0c\u8fd9\u4e2a\u65f6\u5019\u7f13\u5b58\u9875\u5bf9\u5e94\u7684<code>\u63a7\u5236\u5757</code>\u5c31\u6d3e\u4e0a\u5927\u7528\u573a\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u6240\u6709\u7a7a\u95f2\u7684\u7f13\u5b58\u9875\u5bf9\u5e94\u7684\u63a7\u5236\u5757\u4f5c\u4e3a\u4e00\u4e2a\u8282\u70b9\u653e\u5230\u4e00\u4e2a\u94fe\u8868\u4e2d\uff0c\u8fd9\u4e2a\u94fe\u8868\u4e5f\u53ef\u4ee5\u88ab\u79f0\u4f5c<code>free\u94fe\u8868</code>\uff08\u6216\u8005\u8bf4\u7a7a\u95f2\u94fe\u8868\uff09\u3002\u521a\u521a\u5b8c\u6210\u521d\u59cb\u5316\u7684<code>Buffer Pool</code>\u4e2d\u6240\u6709\u7684\u7f13\u5b58\u9875\u90fd\u662f\u7a7a\u95f2\u7684\uff0c\u6240\u4ee5\u6bcf\u4e00\u4e2a\u7f13\u5b58\u9875\u5bf9\u5e94\u7684\u63a7\u5236\u5757\u90fd\u4f1a\u88ab\u52a0\u5165\u5230<code>free\u94fe\u8868</code>\u4e2d\uff0c\u5047\u8bbe\u8be5<code>Buffer Pool</code>\u4e2d\u53ef\u5bb9\u7eb3\u7684\u7f13\u5b58\u9875\u6570\u91cf\u4e3a<code>n</code>\uff0c\u90a3\u589e\u52a0\u4e86<code>free\u94fe\u8868</code>\u7684\u6548\u679c\u56fe\u5c31\u662f\u8fd9\u6837\u7684\uff1a</p> <p></p> <p>\u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u6211\u4eec\u4e3a\u4e86\u7ba1\u7406\u597d\u8fd9\u4e2a<code>free\u94fe\u8868</code>\uff0c\u7279\u610f\u4e3a\u8fd9\u4e2a\u94fe\u8868\u5b9a\u4e49\u4e86\u4e00\u4e2a<code>\u57fa\u8282\u70b9</code>\uff0c\u91cc\u8fb9\u513f\u5305\u542b\u7740\u94fe\u8868\u7684\u5934\u8282\u70b9\u5730\u5740\uff0c\u5c3e\u8282\u70b9\u5730\u5740\uff0c\u4ee5\u53ca\u5f53\u524d\u94fe\u8868\u4e2d\u8282\u70b9\u7684\u6570\u91cf\u7b49\u4fe1\u606f\u3002\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u94fe\u8868\u7684\u57fa\u8282\u70b9\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u5e76\u4e0d\u5305\u542b\u5728\u4e3a<code>Buffer Pool</code>\u7533\u8bf7\u7684\u4e00\u5927\u7247\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4\u4e4b\u5185\uff0c\u800c\u662f\u5355\u72ec\u7533\u8bf7\u7684\u4e00\u5757\u5185\u5b58\u7a7a\u95f4\u3002</p> <p>\u5c0f\u8d34\u58eb\uff1a</p> <p>\u94fe\u8868\u57fa\u8282\u70b9\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u5e76\u4e0d\u5927\uff0c\u5728MySQL5.7.21\u8fd9\u4e2a\u7248\u672c\u91cc\uff0c\u6bcf\u4e2a\u57fa\u8282\u70b9\u53ea\u5360\u752840\u5b57\u8282\u5927\u5c0f\u3002\u540e\u8fb9\u6211\u4eec\u5373\u5c06\u4ecb\u7ecd\u8bb8\u591a\u4e0d\u540c\u7684\u94fe\u8868\uff0c\u5b83\u4eec\u7684\u57fa\u8282\u70b9\u548cfree\u94fe\u8868\u7684\u57fa\u8282\u70b9\u7684\u5185\u5b58\u5206\u914d\u65b9\u5f0f\u662f\u4e00\u6837\u4e00\u6837\u7684\uff0c\u90fd\u662f\u5355\u72ec\u7533\u8bf7\u7684\u4e00\u575740\u5b57\u8282\u5927\u5c0f\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5e76\u4e0d\u5305\u542b\u5728\u4e3aBuffer Pool\u7533\u8bf7\u7684\u4e00\u5927\u7247\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4\u4e4b\u5185\u3002</p> <p>\u6709\u4e86\u8fd9\u4e2a<code>free\u94fe\u8868</code>\u4e4b\u540e\u4e8b\u513f\u5c31\u597d\u529e\u4e86\uff0c\u6bcf\u5f53\u9700\u8981\u4ece\u78c1\u76d8\u4e2d\u52a0\u8f7d\u4e00\u4e2a\u9875\u5230<code>Buffer Pool</code>\u4e2d\u65f6\uff0c\u5c31\u4ece<code>free\u94fe\u8868</code>\u4e2d\u53d6\u4e00\u4e2a\u7a7a\u95f2\u7684\u7f13\u5b58\u9875\uff0c\u5e76\u4e14\u628a\u8be5\u7f13\u5b58\u9875\u5bf9\u5e94\u7684<code>\u63a7\u5236\u5757</code>\u7684\u4fe1\u606f\u586b\u4e0a\uff08\u5c31\u662f\u8be5\u9875\u6240\u5728\u7684\u8868\u7a7a\u95f4\u3001\u9875\u53f7\u4e4b\u7c7b\u7684\u4fe1\u606f\uff09\uff0c\u7136\u540e\u628a\u8be5\u7f13\u5b58\u9875\u5bf9\u5e94\u7684<code>free\u94fe\u8868</code>\u8282\u70b9\u4ece\u94fe\u8868\u4e2d\u79fb\u9664\uff0c\u8868\u793a\u8be5\u7f13\u5b58\u9875\u5df2\u7ecf\u88ab\u4f7f\u7528\u4e86\uff5e</p>"},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/#_2","title":"\u7f13\u5b58\u9875\u7684\u54c8\u5e0c\u5904\u7406","text":"<p>\u6211\u4eec\u524d\u8fb9\u8bf4\u8fc7\uff0c\u5f53\u6211\u4eec\u9700\u8981\u8bbf\u95ee\u67d0\u4e2a\u9875\u4e2d\u7684\u6570\u636e\u65f6\uff0c\u5c31\u4f1a\u628a\u8be5\u9875\u4ece\u78c1\u76d8\u52a0\u8f7d\u5230<code>Buffer Pool</code>\u4e2d\uff0c\u5982\u679c\u8be5\u9875\u5df2\u7ecf\u5728<code>Buffer Pool</code>\u4e2d\u7684\u8bdd\u76f4\u63a5\u4f7f\u7528\u5c31\u53ef\u4ee5\u4e86\u3002\u90a3\u4e48\u95ee\u9898\u4e5f\u5c31\u6765\u4e86\uff0c\u6211\u4eec\u600e\u4e48\u77e5\u9053\u8be5\u9875\u5728\u4e0d\u5728<code>Buffer Pool</code>\u4e2d\u5462\uff1f\u96be\u4e0d\u6210\u9700\u8981\u4f9d\u6b21\u904d\u5386<code>Buffer Pool</code>\u4e2d\u5404\u4e2a\u7f13\u5b58\u9875\u4e48\uff1f\u4e00\u4e2a<code>Buffer Pool</code>\u4e2d\u7684\u7f13\u5b58\u9875\u8fd9\u4e48\u591a\u90fd\u904d\u5386\u5b8c\u5c82\u4e0d\u662f\u8981\u7d2f\u6b7b\uff1f</p> <p>\u518d\u56de\u5934\u60f3\u60f3\uff0c\u6211\u4eec\u5176\u5b9e\u662f\u6839\u636e<code>\u8868\u7a7a\u95f4\u53f7 + \u9875\u53f7</code>\u6765\u5b9a\u4f4d\u4e00\u4e2a\u9875\u7684\uff0c\u4e5f\u5c31\u76f8\u5f53\u4e8e<code>\u8868\u7a7a\u95f4\u53f7 + \u9875\u53f7</code>\u662f\u4e00\u4e2a<code>key</code>\uff0c<code>\u7f13\u5b58\u9875</code>\u5c31\u662f\u5bf9\u5e94\u7684<code>value</code>\uff0c\u600e\u4e48\u901a\u8fc7\u4e00\u4e2a<code>key</code>\u6765\u5feb\u901f\u627e\u7740\u4e00\u4e2a<code>value</code>\u5462\uff1f\u54c8\u54c8\uff0c\u90a3\u80af\u5b9a\u662f\u54c8\u5e0c\u8868\u55bd\uff5e</p> <p>\u5c0f\u8d34\u58eb\uff1a</p> <p>\u5565\uff1f\u4f60\u522b\u544a\u8bc9\u6211\u4f60\u4e0d\u77e5\u9053\u54c8\u5e0c\u8868\u662f\u4e2a\u5565\uff1f\u6211\u4eec\u8fd9\u4e2a\u6587\u7ae0\u4e0d\u662f\u8bb2\u54c8\u5e0c\u8868\u7684\uff0c\u5982\u679c\u4f60\u4e0d\u4f1a\u90a3\u5c31\u53bb\u627e\u672c\u6570\u636e\u7ed3\u6784\u7684\u4e66\u770b\u770b\u5427\uff5e \u5565\uff1f\u5916\u5934\u7684\u4e66\u770b\u4e0d\u61c2\uff1f\u522b\u6025\uff0c\u7b49\u6211\uff5e</p> <p>\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7528<code>\u8868\u7a7a\u95f4\u53f7 + \u9875\u53f7</code>\u4f5c\u4e3a<code>key</code>\uff0c<code>\u7f13\u5b58\u9875</code>\u4f5c\u4e3a<code>value</code>\u521b\u5efa\u4e00\u4e2a\u54c8\u5e0c\u8868\uff0c\u5728\u9700\u8981\u8bbf\u95ee\u67d0\u4e2a\u9875\u7684\u6570\u636e\u65f6\uff0c\u5148\u4ece\u54c8\u5e0c\u8868\u4e2d\u6839\u636e<code>\u8868\u7a7a\u95f4\u53f7 + \u9875\u53f7</code>\u770b\u770b\u6709\u6ca1\u6709\u5bf9\u5e94\u7684\u7f13\u5b58\u9875\uff0c\u5982\u679c\u6709\uff0c\u76f4\u63a5\u4f7f\u7528\u8be5\u7f13\u5b58\u9875\u5c31\u597d\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u90a3\u5c31\u4ece<code>free\u94fe\u8868</code>\u4e2d\u9009\u4e00\u4e2a\u7a7a\u95f2\u7684\u7f13\u5b58\u9875\uff0c\u7136\u540e\u628a\u78c1\u76d8\u4e2d\u5bf9\u5e94\u7684\u9875\u52a0\u8f7d\u5230\u8be5\u7f13\u5b58\u9875\u7684\u4f4d\u7f6e\u3002</p>"},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/#flush","title":"flush\u94fe\u8868\u7684\u7ba1\u7406","text":"<p>\u5982\u679c\u6211\u4eec\u4fee\u6539\u4e86<code>Buffer Pool</code>\u4e2d\u67d0\u4e2a\u7f13\u5b58\u9875\u7684\u6570\u636e\uff0c\u90a3\u5b83\u5c31\u548c\u78c1\u76d8\u4e0a\u7684\u9875\u4e0d\u4e00\u81f4\u4e86\uff0c\u8fd9\u6837\u7684\u7f13\u5b58\u9875\u4e5f\u88ab\u79f0\u4e3a<code>\u810f\u9875</code>\uff08\u82f1\u6587\u540d\uff1a<code>dirty page</code>\uff09\u3002\u5f53\u7136\uff0c\u6700\u7b80\u5355\u7684\u505a\u6cd5\u5c31\u662f\u6bcf\u53d1\u751f\u4e00\u6b21\u4fee\u6539\u5c31\u7acb\u5373\u540c\u6b65\u5230\u78c1\u76d8\u4e0a\u5bf9\u5e94\u7684\u9875\u4e0a\uff0c\u4f46\u662f\u9891\u7e41\u7684\u5f80\u78c1\u76d8\u4e2d\u5199\u6570\u636e\u4f1a\u4e25\u91cd\u7684\u5f71\u54cd\u7a0b\u5e8f\u7684\u6027\u80fd\uff08\u6bd5\u7adf\u78c1\u76d8\u6162\u7684\u50cf\u4e4c\u9f9f\u4e00\u6837\uff09\u3002\u6240\u4ee5\u6bcf\u6b21\u4fee\u6539\u7f13\u5b58\u9875\u540e\uff0c\u6211\u4eec\u5e76\u4e0d\u7740\u6025\u7acb\u5373\u628a\u4fee\u6539\u540c\u6b65\u5230\u78c1\u76d8\u4e0a\uff0c\u800c\u662f\u5728\u672a\u6765\u7684\u67d0\u4e2a\u65f6\u95f4\u70b9\u8fdb\u884c\u540c\u6b65\uff0c\u81f3\u4e8e\u8fd9\u4e2a\u540c\u6b65\u7684\u65f6\u95f4\u70b9\u6211\u4eec\u540e\u8fb9\u4f1a\u4f5c\u8bf4\u660e\u8bf4\u660e\u7684\uff0c\u73b0\u5728\u5148\u4e0d\u7528\u7ba1\u54c8\uff5e</p> <p>\u4f46\u662f\u5982\u679c\u4e0d\u7acb\u5373\u540c\u6b65\u5230\u78c1\u76d8\u7684\u8bdd\uff0c\u90a3\u4e4b\u540e\u518d\u540c\u6b65\u7684\u65f6\u5019\u6211\u4eec\u600e\u4e48\u77e5\u9053<code>Buffer Pool</code>\u4e2d\u54ea\u4e9b\u9875\u662f<code>\u810f\u9875</code>\uff0c\u54ea\u4e9b\u9875\u4ece\u6765\u6ca1\u88ab\u4fee\u6539\u8fc7\u5462\uff1f\u603b\u4e0d\u80fd\u628a\u6240\u6709\u7684\u7f13\u5b58\u9875\u90fd\u540c\u6b65\u5230\u78c1\u76d8\u4e0a\u5427\uff0c\u5047\u5982<code>Buffer Pool</code>\u88ab\u8bbe\u7f6e\u7684\u5f88\u5927\uff0c\u6bd4\u65b9\u8bf4<code>300G</code>\uff0c\u90a3\u4e00\u6b21\u6027\u540c\u6b65\u8fd9\u4e48\u591a\u6570\u636e\u5c82\u4e0d\u662f\u8981\u6162\u6b7b\uff01\u6240\u4ee5\uff0c\u6211\u4eec\u4e0d\u5f97\u4e0d\u518d\u521b\u5efa\u4e00\u4e2a\u5b58\u50a8\u810f\u9875\u7684\u94fe\u8868\uff0c\u51e1\u662f\u4fee\u6539\u8fc7\u7684\u7f13\u5b58\u9875\u5bf9\u5e94\u7684\u63a7\u5236\u5757\u90fd\u4f1a\u4f5c\u4e3a\u4e00\u4e2a\u8282\u70b9\u52a0\u5165\u5230\u4e00\u4e2a\u94fe\u8868\u4e2d\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u94fe\u8868\u8282\u70b9\u5bf9\u5e94\u7684\u7f13\u5b58\u9875\u90fd\u662f\u9700\u8981\u88ab\u5237\u65b0\u5230\u78c1\u76d8\u4e0a\u7684\uff0c\u6240\u4ee5\u4e5f\u53eb<code>flush\u94fe\u8868</code>\u3002\u94fe\u8868\u7684\u6784\u9020\u548c<code>free\u94fe\u8868</code>\u5dee\u4e0d\u591a\uff0c\u5047\u8bbe\u67d0\u4e2a\u65f6\u95f4\u70b9<code>Buffer Pool</code>\u4e2d\u7684\u810f\u9875\u6570\u91cf\u4e3a<code>n</code>\uff0c\u90a3\u4e48\u5bf9\u5e94\u7684<code>flush\u94fe\u8868</code>\u5c31\u957f\u8fd9\u6837\uff1a</p> <p></p>"},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/#lru","title":"LRU\u94fe\u8868\u7684\u7ba1\u7406","text":""},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/#_3","title":"\u7f13\u5b58\u4e0d\u591f\u7684\u7a98\u5883","text":"<p><code>Buffer Pool</code>\u5bf9\u5e94\u7684\u5185\u5b58\u5927\u5c0f\u6bd5\u7adf\u662f\u6709\u9650\u7684\uff0c\u5982\u679c\u9700\u8981\u7f13\u5b58\u7684\u9875\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f\u8d85\u8fc7\u4e86<code>Buffer Pool</code>\u5927\u5c0f\uff0c\u4e5f\u5c31\u662f<code>free\u94fe\u8868</code>\u4e2d\u5df2\u7ecf\u6ca1\u6709\u591a\u4f59\u7684\u7a7a\u95f2\u7f13\u5b58\u9875\u7684\u65f6\u5019\u5c82\u4e0d\u662f\u5f88\u5c34\u5c2c\uff0c\u53d1\u751f\u4e86\u8fd9\u6837\u7684\u4e8b\u513f\u8be5\u548b\u529e\uff1f\u5f53\u7136\u662f\u628a\u67d0\u4e9b\u65e7\u7684\u7f13\u5b58\u9875\u4ece<code>Buffer Pool</code>\u4e2d\u79fb\u9664\uff0c\u7136\u540e\u518d\u628a\u65b0\u7684\u9875\u653e\u8fdb\u6765\u55bd\uff5e \u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u79fb\u9664\u54ea\u4e9b\u7f13\u5b58\u9875\u5462\uff1f</p> <p>\u4e3a\u4e86\u56de\u7b54\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u56de\u5230\u6211\u4eec\u8bbe\u7acb<code>Buffer Pool</code>\u7684\u521d\u8877\uff0c\u6211\u4eec\u5c31\u662f\u60f3\u51cf\u5c11\u548c\u78c1\u76d8\u7684<code>IO</code>\u4ea4\u4e92\uff0c\u6700\u597d\u6bcf\u6b21\u5728\u8bbf\u95ee\u67d0\u4e2a\u9875\u7684\u65f6\u5019\u5b83\u90fd\u5df2\u7ecf\u88ab\u7f13\u5b58\u5230<code>Buffer Pool</code>\u4e2d\u4e86\u3002\u5047\u8bbe\u6211\u4eec\u4e00\u5171\u8bbf\u95ee\u4e86<code>n</code>\u6b21\u9875\uff0c\u90a3\u4e48\u88ab\u8bbf\u95ee\u7684\u9875\u5df2\u7ecf\u5728\u7f13\u5b58\u4e2d\u7684\u6b21\u6570\u9664\u4ee5<code>n</code>\u5c31\u662f\u6240\u8c13\u7684<code>\u7f13\u5b58\u547d\u4e2d\u7387</code>\uff0c\u6211\u4eec\u7684\u671f\u671b\u5c31\u662f\u8ba9<code>\u7f13\u5b58\u547d\u4e2d\u7387</code>\u8d8a\u9ad8\u8d8a\u597d\uff5e \u4ece\u8fd9\u4e2a\u89d2\u5ea6\u51fa\u53d1\uff0c\u56de\u60f3\u4e00\u4e0b\u6211\u4eec\u7684\u5fae\u4fe1\u804a\u5929\u5217\u8868\uff0c\u6392\u5728\u524d\u8fb9\u7684\u90fd\u662f\u6700\u8fd1\u5f88\u9891\u7e41\u4f7f\u7528\u7684\uff0c\u6392\u5728\u540e\u8fb9\u7684\u81ea\u7136\u5c31\u662f\u6700\u8fd1\u5f88\u5c11\u4f7f\u7528\u7684\uff0c\u5047\u5982\u5217\u8868\u80fd\u5bb9\u7eb3\u4e0b\u7684\u8054\u7cfb\u4eba\u6709\u9650\uff0c\u4f60\u662f\u4f1a\u628a\u6700\u8fd1\u5f88\u9891\u7e41\u4f7f\u7528\u7684\u7559\u4e0b\u8fd8\u662f\u6700\u8fd1\u5f88\u5c11\u4f7f\u7528\u7684\u7559\u4e0b\u5462\uff1f\u5e9f\u8bdd\uff0c\u5f53\u7136\u662f\u7559\u4e0b\u6700\u8fd1\u5f88\u9891\u7e41\u4f7f\u7528\u7684\u4e86\uff5e</p>"},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/#lru_1","title":"\u7b80\u5355\u7684LRU\u94fe\u8868","text":"<p>\u7ba1\u7406<code>Buffer Pool</code>\u7684\u7f13\u5b58\u9875\u5176\u5b9e\u4e5f\u662f\u8fd9\u4e2a\u9053\u7406\uff0c\u5f53<code>Buffer Pool</code>\u4e2d\u4e0d\u518d\u6709\u7a7a\u95f2\u7684\u7f13\u5b58\u9875\u65f6\uff0c\u5c31\u9700\u8981\u6dd8\u6c70\u6389\u90e8\u5206\u6700\u8fd1\u5f88\u5c11\u4f7f\u7528\u7684\u7f13\u5b58\u9875\u3002\u4e0d\u8fc7\uff0c\u6211\u4eec\u600e\u4e48\u77e5\u9053\u54ea\u4e9b\u7f13\u5b58\u9875\u6700\u8fd1\u9891\u7e41\u4f7f\u7528\uff0c\u54ea\u4e9b\u6700\u8fd1\u5f88\u5c11\u4f7f\u7528\u5462\uff1f\u5475\u5475\uff0c\u795e\u5947\u7684\u94fe\u8868\u518d\u4e00\u6b21\u6d3e\u4e0a\u4e86\u7528\u573a\uff0c\u6211\u4eec\u53ef\u4ee5\u518d\u521b\u5efa\u4e00\u4e2a\u94fe\u8868\uff0c\u7531\u4e8e\u8fd9\u4e2a\u94fe\u8868\u662f\u4e3a\u4e86<code>\u6309\u7167\u6700\u8fd1\u6700\u5c11\u4f7f\u7528</code>\u7684\u539f\u5219\u53bb\u6dd8\u6c70\u7f13\u5b58\u9875\u7684\uff0c\u6240\u4ee5\u8fd9\u4e2a\u94fe\u8868\u53ef\u4ee5\u88ab\u79f0\u4e3a<code>LRU\u94fe\u8868</code>\uff08LRU\u7684\u82f1\u6587\u5168\u79f0\uff1aLeast Recently Used\uff09\u3002\u5f53\u6211\u4eec\u9700\u8981\u8bbf\u95ee\u67d0\u4e2a\u9875\u65f6\uff0c\u53ef\u4ee5\u8fd9\u6837\u5904\u7406<code>LRU\u94fe\u8868</code>\uff1a</p> <ul> <li>\u5982\u679c\u8be5\u9875\u4e0d\u5728<code>Buffer Pool</code>\u4e2d\uff0c\u5728\u628a\u8be5\u9875\u4ece\u78c1\u76d8\u52a0\u8f7d\u5230<code>Buffer Pool</code>\u4e2d\u7684\u7f13\u5b58\u9875\u65f6\uff0c\u5c31\u628a\u8be5\u7f13\u5b58\u9875\u5bf9\u5e94\u7684<code>\u63a7\u5236\u5757</code>\u4f5c\u4e3a\u8282\u70b9\u585e\u5230\u94fe\u8868\u7684\u5934\u90e8\u3002</li> <li>\u5982\u679c\u8be5\u9875\u5df2\u7ecf\u7f13\u5b58\u5728<code>Buffer Pool</code>\u4e2d\uff0c\u5219\u76f4\u63a5\u628a\u8be5\u9875\u5bf9\u5e94\u7684<code>\u63a7\u5236\u5757</code>\u79fb\u52a8\u5230<code>LRU\u94fe\u8868</code>\u7684\u5934\u90e8\u3002</li> </ul> <p>\u4e5f\u5c31\u662f\u8bf4\uff1a\u53ea\u8981\u6211\u4eec\u4f7f\u7528\u5230\u67d0\u4e2a\u7f13\u5b58\u9875\uff0c\u5c31\u628a\u8be5\u7f13\u5b58\u9875\u8c03\u6574\u5230<code>LRU\u94fe\u8868</code>\u7684\u5934\u90e8\uff0c\u8fd9\u6837<code>LRU\u94fe\u8868</code>\u5c3e\u90e8\u5c31\u662f\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u7f13\u5b58\u9875\u55bd\uff5e \u6240\u4ee5\u5f53<code>Buffer Pool</code>\u4e2d\u7684\u7a7a\u95f2\u7f13\u5b58\u9875\u4f7f\u7528\u5b8c\u65f6\uff0c\u5230<code>LRU\u94fe\u8868</code>\u7684\u5c3e\u90e8\u627e\u4e9b\u7f13\u5b58\u9875\u6dd8\u6c70\u5c31OK\u5566\uff0c\u771f\u7b80\u5355\uff0c\u5567\u5567...</p>"},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/#lru_2","title":"\u5212\u5206\u533a\u57df\u7684LRU\u94fe\u8868","text":"<p>\u9ad8\u5174\u7684\u592a\u65e9\u4e86\uff0c\u4e0a\u8fb9\u7684\u8fd9\u4e2a\u7b80\u5355\u7684<code>LRU\u94fe\u8868</code>\u7528\u4e86\u6ca1\u591a\u957f\u65f6\u95f4\u5c31\u53d1\u73b0\u95ee\u9898\u4e86\uff0c\u56e0\u4e3a\u5b58\u5728\u8fd9\u4e24\u79cd\u6bd4\u8f83\u5c34\u5c2c\u7684\u60c5\u51b5\uff1a</p> <ul> <li> <p>\u60c5\u51b5\u4e00\uff1a<code>InnoDB</code>\u63d0\u4f9b\u4e86\u4e00\u4e2a\u770b\u8d77\u6765\u6bd4\u8f83\u8d34\u5fc3\u7684\u670d\u52a1\u2014\u2014<code>\u9884\u8bfb</code>\uff08\u82f1\u6587\u540d\uff1a<code>read ahead</code>\uff09\u3002\u6240\u8c13<code>\u9884\u8bfb</code>\uff0c\u5c31\u662f<code>InnoDB</code>\u8ba4\u4e3a\u6267\u884c\u5f53\u524d\u7684\u8bf7\u6c42\u53ef\u80fd\u4e4b\u540e\u4f1a\u8bfb\u53d6\u67d0\u4e9b\u9875\u9762\uff0c\u5c31\u9884\u5148\u628a\u5b83\u4eec\u52a0\u8f7d\u5230<code>Buffer Pool</code>\u4e2d\u3002\u6839\u636e\u89e6\u53d1\u65b9\u5f0f\u7684\u4e0d\u540c\uff0c<code>\u9884\u8bfb</code>\u53c8\u53ef\u4ee5\u7ec6\u5206\u4e3a\u4e0b\u8fb9\u4e24\u79cd\uff1a</p> </li> <li> <p>\u7ebf\u6027\u9884\u8bfb</p> <p>\u8bbe\u8ba1<code>InnoDB</code>\u7684\u5927\u53d4\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7cfb\u7edf\u53d8\u91cf<code>innodb_read_ahead_threshold</code>\uff0c\u5982\u679c\u987a\u5e8f\u8bbf\u95ee\u4e86\u67d0\u4e2a\u533a\uff08<code>extent</code>\uff09\u7684\u9875\u9762\u8d85\u8fc7\u8fd9\u4e2a\u7cfb\u7edf\u53d8\u91cf\u7684\u503c\uff0c\u5c31\u4f1a\u89e6\u53d1\u4e00\u6b21<code>\u5f02\u6b65</code>\u8bfb\u53d6\u4e0b\u4e00\u4e2a\u533a\u4e2d\u5168\u90e8\u7684\u9875\u9762\u5230<code>Buffer Pool</code>\u7684\u8bf7\u6c42\uff0c\u6ce8\u610f<code>\u5f02\u6b65</code>\u8bfb\u53d6\u610f\u5473\u7740\u4ece\u78c1\u76d8\u4e2d\u52a0\u8f7d\u8fd9\u4e9b\u88ab\u9884\u8bfb\u7684\u9875\u9762\u5e76\u4e0d\u4f1a\u5f71\u54cd\u5230\u5f53\u524d\u5de5\u4f5c\u7ebf\u7a0b\u7684\u6b63\u5e38\u6267\u884c\u3002\u8fd9\u4e2a<code>innodb_read_ahead_threshold</code>\u7cfb\u7edf\u53d8\u91cf\u7684\u503c\u9ed8\u8ba4\u662f<code>56</code>\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u670d\u52a1\u5668\u542f\u52a8\u65f6\u901a\u8fc7\u542f\u52a8\u53c2\u6570\u6216\u8005\u670d\u52a1\u5668\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u76f4\u63a5\u8c03\u6574\u8be5\u7cfb\u7edf\u53d8\u91cf\u7684\u503c\uff0c\u4e0d\u8fc7\u5b83\u662f\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\uff0c\u6ce8\u610f\u4f7f\u7528<code>SET GLOBAL</code>\u547d\u4ee4\u6765\u4fee\u6539\u54e6\u3002</p> <p>\u5c0f\u8d34\u58eb\uff1a</p> <p>InnoDB\u662f\u600e\u4e48\u5b9e\u73b0\u5f02\u6b65\u8bfb\u53d6\u7684\u5462\uff1f\u5728Windows\u6216\u8005Linux\u5e73\u53f0\u4e0a\uff0c\u53ef\u80fd\u662f\u76f4\u63a5\u8c03\u7528\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u63d0\u4f9b\u7684AIO\u63a5\u53e3\uff0c\u5728\u5176\u5b83\u7c7bUnix\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u4f7f\u7528\u4e86\u4e00\u79cd\u6a21\u62dfAIO\u63a5\u53e3\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u5f02\u6b65\u8bfb\u53d6\uff0c\u5176\u5b9e\u5c31\u662f\u8ba9\u522b\u7684\u7ebf\u7a0b\u53bb\u8bfb\u53d6\u9700\u8981\u9884\u8bfb\u7684\u9875\u9762\u3002\u5982\u679c\u4f60\u8bfb\u4e0d\u61c2\u4e0a\u8fb9\u8fd9\u6bb5\u8bdd\uff0c\u90a3\u4e5f\u5c31\u6ca1\u5fc5\u8981\u61c2\u4e86\uff0c\u548c\u6211\u4eec\u4e3b\u9898\u5176\u5b9e\u6ca1\u592a\u591a\u5173\u7cfb\uff0c\u4f60\u53ea\u9700\u8981\u77e5\u9053\u5f02\u6b65\u8bfb\u53d6\u5e76\u4e0d\u4f1a\u5f71\u54cd\u5230\u5f53\u524d\u5de5\u4f5c\u7ebf\u7a0b\u7684\u6b63\u5e38\u6267\u884c\u5c31\u597d\u4e86\u3002\u5176\u5b9e\u8fd9\u4e2a\u8fc7\u7a0b\u6d89\u53ca\u5230\u64cd\u4f5c\u7cfb\u7edf\u5982\u4f55\u5904\u7406IO\u4ee5\u53ca\u591a\u7ebf\u7a0b\u7684\u95ee\u9898\uff0c\u627e\u672c\u64cd\u4f5c\u7cfb\u7edf\u7684\u4e66\u770b\u770b\u5427\uff0c\u4ec0\u4e48\uff1f\u64cd\u4f5c\u7cfb\u7edf\u7684\u4e66\u5199\u7684\u90fd\u5f88\u96be\u61c2\uff1f\u6ca1\u5173\u7cfb\uff0c\u7b49\u6211\uff5e</p> </li> <li> <p>\u968f\u673a\u9884\u8bfb</p> <p>\u5982\u679c<code>Buffer Pool</code>\u4e2d\u5df2\u7ecf\u7f13\u5b58\u4e86\u67d0\u4e2a\u533a\u768413\u4e2a\u8fde\u7eed\u7684\u9875\u9762\uff0c\u4e0d\u8bba\u8fd9\u4e9b\u9875\u9762\u662f\u4e0d\u662f\u987a\u5e8f\u8bfb\u53d6\u7684\uff0c\u90fd\u4f1a\u89e6\u53d1\u4e00\u6b21<code>\u5f02\u6b65</code>\u8bfb\u53d6\u672c\u533a\u4e2d\u6240\u6709\u5176\u7684\u9875\u9762\u5230<code>Buffer Pool</code>\u7684\u8bf7\u6c42\u3002\u8bbe\u8ba1<code>InnoDB</code>\u7684\u5927\u53d4\u540c\u65f6\u63d0\u4f9b\u4e86<code>innodb_random_read_ahead</code>\u7cfb\u7edf\u53d8\u91cf\uff0c\u5b83\u7684\u9ed8\u8ba4\u503c\u4e3a<code>OFF</code>\uff0c\u4e5f\u5c31\u610f\u5473\u7740<code>InnoDB</code>\u5e76\u4e0d\u4f1a\u9ed8\u8ba4\u5f00\u542f\u968f\u673a\u9884\u8bfb\u7684\u529f\u80fd\uff0c\u5982\u679c\u6211\u4eec\u60f3\u5f00\u542f\u8be5\u529f\u80fd\uff0c\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u542f\u52a8\u53c2\u6570\u6216\u8005\u76f4\u63a5\u4f7f\u7528<code>SET GLOBAL</code>\u547d\u4ee4\u628a\u8be5\u53d8\u91cf\u7684\u503c\u8bbe\u7f6e\u4e3a<code>ON</code>\u3002</p> </li> </ul> <p><code>\u9884\u8bfb</code>\u672c\u6765\u662f\u4e2a\u597d\u4e8b\u513f\uff0c\u5982\u679c\u9884\u8bfb\u5230<code>Buffer Pool</code>\u4e2d\u7684\u9875\u6210\u529f\u7684\u88ab\u4f7f\u7528\u5230\uff0c\u90a3\u5c31\u53ef\u4ee5\u6781\u5927\u7684\u63d0\u9ad8\u8bed\u53e5\u6267\u884c\u7684\u6548\u7387\u3002\u53ef\u662f\u5982\u679c\u7528\u4e0d\u5230\u5462\uff1f\u8fd9\u4e9b\u9884\u8bfb\u7684\u9875\u90fd\u4f1a\u653e\u5230<code>LRU</code>\u94fe\u8868\u7684\u5934\u90e8\uff0c\u4f46\u662f\u5982\u679c\u6b64\u65f6<code>Buffer Pool</code>\u7684\u5bb9\u91cf\u4e0d\u592a\u5927\u800c\u4e14\u5f88\u591a\u9884\u8bfb\u7684\u9875\u9762\u90fd\u6ca1\u6709\u7528\u5230\u7684\u8bdd\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u5904\u5728<code>LRU\u94fe\u8868</code>\u5c3e\u90e8\u7684\u4e00\u4e9b\u7f13\u5b58\u9875\u4f1a\u5f88\u5feb\u7684\u88ab\u6dd8\u6c70\u6389\uff0c\u4e5f\u5c31\u662f\u6240\u8c13\u7684<code>\u52a3\u5e01\u9a71\u9010\u826f\u5e01</code>\uff0c\u4f1a\u5927\u5927\u964d\u4f4e\u7f13\u5b58\u547d\u4e2d\u7387\u3002</p> <ul> <li>\u60c5\u51b5\u4e8c\uff1a\u6709\u7684\u5c0f\u4f19\u4f34\u53ef\u80fd\u4f1a\u5199\u4e00\u4e9b\u9700\u8981\u626b\u63cf\u5168\u8868\u7684\u67e5\u8be2\u8bed\u53e5\uff08\u6bd4\u5982\u6ca1\u6709\u5efa\u7acb\u5408\u9002\u7684\u7d22\u5f15\u6216\u8005\u538b\u6839\u513f\u6ca1\u6709WHERE\u5b50\u53e5\u7684\u67e5\u8be2\uff09\u3002</li> </ul> <p>\u626b\u63cf\u5168\u8868\u610f\u5473\u7740\u4ec0\u4e48\uff1f\u610f\u5473\u7740\u5c06\u8bbf\u95ee\u5230\u8be5\u8868\u6240\u5728\u7684\u6240\u6709\u9875\uff01\u5047\u8bbe\u8fd9\u4e2a\u8868\u4e2d\u8bb0\u5f55\u975e\u5e38\u591a\u7684\u8bdd\uff0c\u90a3\u8be5\u8868\u4f1a\u5360\u7528\u7279\u522b\u591a\u7684<code>\u9875</code>\uff0c\u5f53\u9700\u8981\u8bbf\u95ee\u8fd9\u4e9b\u9875\u65f6\uff0c\u4f1a\u628a\u5b83\u4eec\u7edf\u7edf\u90fd\u52a0\u8f7d\u5230<code>Buffer Pool</code>\u4e2d\uff0c\u8fd9\u4e5f\u5c31\u610f\u5473\u7740\u5427\u5527\u4e00\u4e0b\uff0c<code>Buffer Pool</code>\u4e2d\u7684\u6240\u6709\u9875\u90fd\u88ab\u6362\u4e86\u4e00\u6b21\u8840\uff0c\u5176\u4ed6\u67e5\u8be2\u8bed\u53e5\u5728\u6267\u884c\u65f6\u53c8\u5f97\u6267\u884c\u4e00\u6b21\u4ece\u78c1\u76d8\u52a0\u8f7d\u5230<code>Buffer Pool</code>\u7684\u64cd\u4f5c\u3002\u800c\u8fd9\u79cd\u5168\u8868\u626b\u63cf\u7684\u8bed\u53e5\u6267\u884c\u7684\u9891\u7387\u4e5f\u4e0d\u9ad8\uff0c\u6bcf\u6b21\u6267\u884c\u90fd\u8981\u628a<code>Buffer Pool</code>\u4e2d\u7684\u7f13\u5b58\u9875\u6362\u4e00\u6b21\u8840\uff0c\u8fd9\u4e25\u91cd\u7684\u5f71\u54cd\u5230\u5176\u4ed6\u67e5\u8be2\u5bf9 <code>Buffer Pool</code>\u7684\u4f7f\u7528\uff0c\u4ece\u800c\u5927\u5927\u964d\u4f4e\u4e86\u7f13\u5b58\u547d\u4e2d\u7387\u3002</p> <p>\u603b\u7ed3\u4e00\u4e0b\u4e0a\u8fb9\u8bf4\u7684\u53ef\u80fd\u964d\u4f4e<code>Buffer Pool</code>\u7684\u4e24\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u52a0\u8f7d\u5230<code>Buffer Pool</code>\u4e2d\u7684\u9875\u4e0d\u4e00\u5b9a\u88ab\u7528\u5230\u3002</li> <li>\u5982\u679c\u975e\u5e38\u591a\u7684\u4f7f\u7528\u9891\u7387\u504f\u4f4e\u7684\u9875\u88ab\u540c\u65f6\u52a0\u8f7d\u5230<code>Buffer Pool</code>\u65f6\uff0c\u53ef\u80fd\u4f1a\u628a\u90a3\u4e9b\u4f7f\u7528\u9891\u7387\u975e\u5e38\u9ad8\u7684\u9875\u4ece<code>Buffer Pool</code>\u4e2d\u6dd8\u6c70\u6389\u3002</li> </ul> <p>\u56e0\u4e3a\u6709\u8fd9\u4e24\u79cd\u60c5\u51b5\u7684\u5b58\u5728\uff0c\u6240\u4ee5\u8bbe\u8ba1<code>InnoDB</code>\u7684\u5927\u53d4\u628a\u8fd9\u4e2a<code>LRU\u94fe\u8868</code>\u6309\u7167\u4e00\u5b9a\u6bd4\u4f8b\u5206\u6210\u4e24\u622a\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>\u4e00\u90e8\u5206\u5b58\u50a8\u4f7f\u7528\u9891\u7387\u975e\u5e38\u9ad8\u7684\u7f13\u5b58\u9875\uff0c\u6240\u4ee5\u8fd9\u4e00\u90e8\u5206\u94fe\u8868\u4e5f\u53eb\u505a<code>\u70ed\u6570\u636e</code>\uff0c\u6216\u8005\u79f0<code>young\u533a\u57df</code>\u3002</li> <li>\u53e6\u4e00\u90e8\u5206\u5b58\u50a8\u4f7f\u7528\u9891\u7387\u4e0d\u662f\u5f88\u9ad8\u7684\u7f13\u5b58\u9875\uff0c\u6240\u4ee5\u8fd9\u4e00\u90e8\u5206\u94fe\u8868\u4e5f\u53eb\u505a<code>\u51b7\u6570\u636e</code>\uff0c\u6216\u8005\u79f0<code>old\u533a\u57df</code>\u3002</li> </ul> <p>\u4e3a\u4e86\u65b9\u4fbf\u5927\u5bb6\u7406\u89e3\uff0c\u6211\u4eec\u628a\u793a\u610f\u56fe\u505a\u4e86\u7b80\u5316\uff0c\u5404\u4f4d\u9886\u4f1a\u7cbe\u795e\u5c31\u597d\uff1a</p> <p></p> <p>\u5927\u5bb6\u8981\u7279\u522b\u6ce8\u610f\u4e00\u4e2a\u4e8b\u513f\uff1a\u6211\u4eec\u662f\u6309\u7167\u67d0\u4e2a\u6bd4\u4f8b\u5c06LRU\u94fe\u8868\u5206\u6210\u4e24\u534a\u7684\uff0c\u4e0d\u662f\u67d0\u4e9b\u8282\u70b9\u56fa\u5b9a\u662fyoung\u533a\u57df\u7684\uff0c\u67d0\u4e9b\u8282\u70b9\u56fa\u5b9a\u662fold\u533a\u57df\u7684\uff0c\u968f\u7740\u7a0b\u5e8f\u7684\u8fd0\u884c\uff0c\u67d0\u4e2a\u8282\u70b9\u6240\u5c5e\u7684\u533a\u57df\u4e5f\u53ef\u80fd\u53d1\u751f\u53d8\u5316\u3002\u90a3\u8fd9\u4e2a\u5212\u5206\u6210\u4e24\u622a\u7684\u6bd4\u4f8b\u600e\u4e48\u786e\u5b9a\u5462\uff1f\u5bf9\u4e8e<code>InnoDB</code>\u5b58\u50a8\u5f15\u64ce\u6765\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b\u7cfb\u7edf\u53d8\u91cf<code>innodb_old_blocks_pct</code>\u7684\u503c\u6765\u786e\u5b9a<code>old</code>\u533a\u57df\u5728<code>LRU\u94fe\u8868</code>\u4e2d\u6240\u5360\u7684\u6bd4\u4f8b\uff0c\u6bd4\u65b9\u8bf4\u8fd9\u6837\uff1a</p> <pre><code>sql\u590d\u5236\u4ee3\u7801mysql&gt; SHOW VARIABLES LIKE 'innodb_old_blocks_pct';\n+-----------------------+-------+\n| Variable_name         | Value |\n+-----------------------+-------+\n| innodb_old_blocks_pct | 37    |\n+-----------------------+-------+\n1 row in set (0.01 sec)\n</code></pre> <p>\u4ece\u7ed3\u679c\u53ef\u4ee5\u770b\u51fa\u6765\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>old</code>\u533a\u57df\u5728<code>LRU\u94fe\u8868</code>\u4e2d\u6240\u5360\u7684\u6bd4\u4f8b\u662f<code>37%</code>\uff0c\u4e5f\u5c31\u662f\u8bf4<code>old</code>\u533a\u57df\u5927\u7ea6\u5360<code>LRU\u94fe\u8868</code>\u7684<code>3/8</code>\u3002\u8fd9\u4e2a\u6bd4\u4f8b\u6211\u4eec\u662f\u53ef\u4ee5\u8bbe\u7f6e\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u542f\u52a8\u65f6\u4fee\u6539<code>innodb_old_blocks_pct</code>\u53c2\u6570\u6765\u63a7\u5236<code>old</code>\u533a\u57df\u5728<code>LRU\u94fe\u8868</code>\u4e2d\u6240\u5360\u7684\u6bd4\u4f8b\uff0c\u6bd4\u65b9\u8bf4\u8fd9\u6837\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff1a</p> <pre><code>ini\u590d\u5236\u4ee3\u7801[server]\ninnodb_old_blocks_pct = 40\n</code></pre> <p>\u8fd9\u6837\u6211\u4eec\u5728\u542f\u52a8\u670d\u52a1\u5668\u540e\uff0c<code>old</code>\u533a\u57df\u5360<code>LRU\u94fe\u8868</code>\u7684\u6bd4\u4f8b\u5c31\u662f<code>40%</code>\u3002\u5f53\u7136\uff0c\u5982\u679c\u5728\u670d\u52a1\u5668\u8fd0\u884c\u671f\u95f4\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4fee\u6539\u8fd9\u4e2a\u7cfb\u7edf\u53d8\u91cf\u7684\u503c\uff0c\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u4e2a\u7cfb\u7edf\u53d8\u91cf\u5c5e\u4e8e<code>\u5168\u5c40\u53d8\u91cf</code>\uff0c\u4e00\u7ecf\u4fee\u6539\uff0c\u4f1a\u5bf9\u6240\u6709\u5ba2\u6237\u7aef\u751f\u6548\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u80fd\u8fd9\u6837\u4fee\u6539\uff1a</p> <pre><code>ini\n\u590d\u5236\u4ee3\u7801SET GLOBAL innodb_old_blocks_pct = 40;\n</code></pre> <p>\u6709\u4e86\u8fd9\u4e2a\u88ab\u5212\u5206\u6210<code>young</code>\u548c<code>old</code>\u533a\u57df\u7684<code>LRU</code>\u94fe\u8868\u4e4b\u540e\uff0c\u8bbe\u8ba1<code>InnoDB</code>\u7684\u5927\u53d4\u5c31\u53ef\u4ee5\u9488\u5bf9\u6211\u4eec\u4e0a\u8fb9\u63d0\u5230\u7684\u4e24\u79cd\u53ef\u80fd\u964d\u4f4e\u7f13\u5b58\u547d\u4e2d\u7387\u7684\u60c5\u51b5\u8fdb\u884c\u4f18\u5316\u4e86\uff1a</p> <ul> <li>\u9488\u5bf9\u9884\u8bfb\u7684\u9875\u9762\u53ef\u80fd\u4e0d\u8fdb\u884c\u540e\u7eed\u8bbf\u95ee\u60c5\u51b5\u7684\u4f18\u5316</li> </ul> <p>\u8bbe\u8ba1<code>InnoDB</code>\u7684\u5927\u53d4\u89c4\u5b9a\uff0c\u5f53\u78c1\u76d8\u4e0a\u7684\u67d0\u4e2a\u9875\u9762\u5728\u521d\u6b21\u52a0\u8f7d\u5230Buffer Pool\u4e2d\u7684\u67d0\u4e2a\u7f13\u5b58\u9875\u65f6\uff0c\u8be5\u7f13\u5b58\u9875\u5bf9\u5e94\u7684\u63a7\u5236\u5757\u4f1a\u88ab\u653e\u5230old\u533a\u57df\u7684\u5934\u90e8\u3002\u8fd9\u6837\u9488\u5bf9\u9884\u8bfb\u5230<code>Buffer Pool</code>\u5374\u4e0d\u8fdb\u884c\u540e\u7eed\u8bbf\u95ee\u7684\u9875\u9762\u5c31\u4f1a\u88ab\u9010\u6e10\u4ece<code>old</code>\u533a\u57df\u9010\u51fa\uff0c\u800c\u4e0d\u4f1a\u5f71\u54cd<code>young</code>\u533a\u57df\u4e2d\u88ab\u4f7f\u7528\u6bd4\u8f83\u9891\u7e41\u7684\u7f13\u5b58\u9875\u3002</p> <ul> <li>\u9488\u5bf9\u5168\u8868\u626b\u63cf\u65f6\uff0c\u77ed\u65f6\u95f4\u5185\u8bbf\u95ee\u5927\u91cf\u4f7f\u7528\u9891\u7387\u975e\u5e38\u4f4e\u7684\u9875\u9762\u60c5\u51b5\u7684\u4f18\u5316</li> </ul> <p>\u5728\u8fdb\u884c\u5168\u8868\u626b\u63cf\u65f6\uff0c\u867d\u7136\u9996\u6b21\u88ab\u52a0\u8f7d\u5230<code>Buffer Pool</code>\u7684\u9875\u88ab\u653e\u5230\u4e86<code>old</code>\u533a\u57df\u7684\u5934\u90e8\uff0c\u4f46\u662f\u540e\u7eed\u4f1a\u88ab\u9a6c\u4e0a\u8bbf\u95ee\u5230\uff0c\u6bcf\u6b21\u8fdb\u884c\u8bbf\u95ee\u7684\u65f6\u5019\u53c8\u4f1a\u628a\u8be5\u9875\u653e\u5230<code>young</code>\u533a\u57df\u7684\u5934\u90e8\uff0c\u8fd9\u6837\u4ecd\u7136\u4f1a\u628a\u90a3\u4e9b\u4f7f\u7528\u9891\u7387\u6bd4\u8f83\u9ad8\u7684\u9875\u9762\u7ed9\u9876\u4e0b\u53bb\u3002\u6709\u540c\u5b66\u4f1a\u60f3\uff1a\u53ef\u4e0d\u53ef\u4ee5\u5728\u7b2c\u4e00\u6b21\u8bbf\u95ee\u8be5\u9875\u9762\u65f6\u4e0d\u5c06\u5176\u4ece<code>old</code>\u533a\u57df\u79fb\u52a8\u5230<code>young</code>\u533a\u57df\u7684\u5934\u90e8\uff0c\u540e\u7eed\u8bbf\u95ee\u65f6\u518d\u5c06\u5176\u79fb\u52a8\u5230<code>young</code>\u533a\u57df\u7684\u5934\u90e8\u3002\u56de\u7b54\u662f\uff1a\u884c\u4e0d\u901a\uff01\u56e0\u4e3a\u8bbe\u8ba1<code>InnoDB</code>\u7684\u5927\u53d4\u89c4\u5b9a\u6bcf\u6b21\u53bb\u9875\u9762\u4e2d\u8bfb\u53d6\u4e00\u6761\u8bb0\u5f55\u65f6\uff0c\u90fd\u7b97\u662f\u8bbf\u95ee\u4e00\u6b21\u9875\u9762\uff0c\u800c\u4e00\u4e2a\u9875\u9762\u4e2d\u53ef\u80fd\u4f1a\u5305\u542b\u5f88\u591a\u6761\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u8bf4\u8bfb\u53d6\u5b8c\u67d0\u4e2a\u9875\u9762\u7684\u8bb0\u5f55\u5c31\u76f8\u5f53\u4e8e\u8bbf\u95ee\u4e86\u8fd9\u4e2a\u9875\u9762\u597d\u591a\u6b21\u3002</p> <p>\u548b\u529e\uff1f\u5168\u8868\u626b\u63cf\u6709\u4e00\u4e2a\u7279\u70b9\uff0c\u90a3\u5c31\u662f\u5b83\u7684\u6267\u884c\u9891\u7387\u975e\u5e38\u4f4e\uff0c\u8c01\u4e5f\u4e0d\u4f1a\u6ca1\u4e8b\u513f\u8001\u5728\u90a3\u5199\u5168\u8868\u626b\u63cf\u7684\u8bed\u53e5\u73a9\uff0c\u800c\u4e14\u5728\u6267\u884c\u5168\u8868\u626b\u63cf\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5373\u4f7f\u67d0\u4e2a\u9875\u9762\u4e2d\u6709\u5f88\u591a\u6761\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u53bb\u591a\u6b21\u8bbf\u95ee\u8fd9\u4e2a\u9875\u9762\u6240\u82b1\u8d39\u7684\u65f6\u95f4\u4e5f\u662f\u975e\u5e38\u5c11\u7684\u3002\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u89c4\u5b9a\uff0c\u5728\u5bf9\u67d0\u4e2a\u5904\u5728<code>old</code>\u533a\u57df\u7684\u7f13\u5b58\u9875\u8fdb\u884c\u7b2c\u4e00\u6b21\u8bbf\u95ee\u65f6\u5c31\u5728\u5b83\u5bf9\u5e94\u7684\u63a7\u5236\u5757\u4e2d\u8bb0\u5f55\u4e0b\u6765\u8fd9\u4e2a\u8bbf\u95ee\u65f6\u95f4\uff0c\u5982\u679c\u540e\u7eed\u7684\u8bbf\u95ee\u65f6\u95f4\u4e0e\u7b2c\u4e00\u6b21\u8bbf\u95ee\u7684\u65f6\u95f4\u5728\u67d0\u4e2a\u65f6\u95f4\u95f4\u9694\u5185\uff0c\u90a3\u4e48\u8be5\u9875\u9762\u5c31\u4e0d\u4f1a\u88ab\u4eceold\u533a\u57df\u79fb\u52a8\u5230young\u533a\u57df\u7684\u5934\u90e8\uff0c\u5426\u5219\u5c06\u5b83\u79fb\u52a8\u5230young\u533a\u57df\u7684\u5934\u90e8\u3002\u4e0a\u8ff0\u7684\u8fd9\u4e2a\u95f4\u9694\u65f6\u95f4\u662f\u7531\u7cfb\u7edf\u53d8\u91cf<code>innodb_old_blocks_time</code>\u63a7\u5236\u7684\uff0c\u4f60\u770b\uff1a</p> <pre><code>sql\u590d\u5236\u4ee3\u7801mysql&gt; SHOW VARIABLES LIKE 'innodb_old_blocks_time';\n+------------------------+-------+\n| Variable_name          | Value |\n+------------------------+-------+\n| innodb_old_blocks_time | 1000  |\n+------------------------+-------+\n1 row in set (0.01 sec)\n</code></pre> <p>\u8fd9\u4e2a<code>innodb_old_blocks_time</code>\u7684\u9ed8\u8ba4\u503c\u662f<code>1000</code>\uff0c\u5b83\u7684\u5355\u4f4d\u662f\u6beb\u79d2\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u5bf9\u4e8e\u4ece\u78c1\u76d8\u4e0a\u88ab\u52a0\u8f7d\u5230<code>LRU</code>\u94fe\u8868\u7684<code>old</code>\u533a\u57df\u7684\u67d0\u4e2a\u9875\u6765\u8bf4\uff0c\u5982\u679c\u7b2c\u4e00\u6b21\u548c\u6700\u540e\u4e00\u6b21\u8bbf\u95ee\u8be5\u9875\u9762\u7684\u65f6\u95f4\u95f4\u9694\u5c0f\u4e8e<code>1s</code>\uff08\u5f88\u660e\u663e\u5728\u4e00\u6b21\u5168\u8868\u626b\u63cf\u7684\u8fc7\u7a0b\u4e2d\uff0c\u591a\u6b21\u8bbf\u95ee\u4e00\u4e2a\u9875\u9762\u4e2d\u7684\u65f6\u95f4\u4e0d\u4f1a\u8d85\u8fc7<code>1s</code>\uff09\uff0c\u90a3\u4e48\u8be5\u9875\u662f\u4e0d\u4f1a\u88ab\u52a0\u5165\u5230<code>young</code>\u533a\u57df\u7684\uff5e \u5f53\u7136\uff0c\u50cf<code>innodb_old_blocks_pct</code>\u4e00\u6837\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u670d\u52a1\u5668\u542f\u52a8\u6216\u8fd0\u884c\u65f6\u8bbe\u7f6e<code>innodb_old_blocks_time</code>\u7684\u503c\uff0c\u8fd9\u91cc\u5c31\u4e0d\u8d58\u8ff0\u4e86\uff0c\u4f60\u81ea\u5df1\u8bd5\u8bd5\u5427\uff5e \u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u6211\u4eec\u628a<code>innodb_old_blocks_time</code>\u7684\u503c\u8bbe\u7f6e\u4e3a<code>0</code>\uff0c\u90a3\u4e48\u6bcf\u6b21\u6211\u4eec\u8bbf\u95ee\u4e00\u4e2a\u9875\u9762\u65f6\u5c31\u4f1a\u628a\u8be5\u9875\u9762\u653e\u5230<code>young</code>\u533a\u57df\u7684\u5934\u90e8\u3002</p> <p>\u7efc\u4e0a\u6240\u8ff0\uff0c\u6b63\u662f\u56e0\u4e3a\u5c06<code>LRU</code>\u94fe\u8868\u5212\u5206\u4e3a<code>young</code>\u548c<code>old</code>\u533a\u57df\u8fd9\u4e24\u4e2a\u90e8\u5206\uff0c\u53c8\u6dfb\u52a0\u4e86<code>innodb_old_blocks_time</code>\u8fd9\u4e2a\u7cfb\u7edf\u53d8\u91cf\uff0c\u624d\u4f7f\u5f97\u9884\u8bfb\u673a\u5236\u548c\u5168\u8868\u626b\u63cf\u9020\u6210\u7684\u7f13\u5b58\u547d\u4e2d\u7387\u964d\u4f4e\u7684\u95ee\u9898\u5f97\u5230\u4e86\u904f\u5236\uff0c\u56e0\u4e3a\u7528\u4e0d\u5230\u7684\u9884\u8bfb\u9875\u9762\u4ee5\u53ca\u5168\u8868\u626b\u63cf\u7684\u9875\u9762\u90fd\u53ea\u4f1a\u88ab\u653e\u5230<code>old</code>\u533a\u57df\uff0c\u800c\u4e0d\u5f71\u54cd<code>young</code>\u533a\u57df\u4e2d\u7684\u7f13\u5b58\u9875\u3002</p>"},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/#lru_3","title":"\u66f4\u8fdb\u4e00\u6b65\u4f18\u5316LRU\u94fe\u8868","text":"<p><code>LRU\u94fe\u8868</code>\u8fd9\u5c31\u8bf4\u5b8c\u4e86\u4e48\uff1f\u6ca1\u6709\uff0c\u65e9\u7740\u5462\uff5e \u5bf9\u4e8e<code>young</code>\u533a\u57df\u7684\u7f13\u5b58\u9875\u6765\u8bf4\uff0c\u6211\u4eec\u6bcf\u6b21\u8bbf\u95ee\u4e00\u4e2a\u7f13\u5b58\u9875\u5c31\u8981\u628a\u5b83\u79fb\u52a8\u5230<code>LRU\u94fe\u8868</code>\u7684\u5934\u90e8\uff0c\u8fd9\u6837\u5f00\u9500\u662f\u4e0d\u662f\u592a\u5927\u5566\uff0c\u6bd5\u7adf\u5728<code>young</code>\u533a\u57df\u7684\u7f13\u5b58\u9875\u90fd\u662f\u70ed\u70b9\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u53ef\u80fd\u88ab\u7ecf\u5e38\u8bbf\u95ee\u7684\uff0c\u8fd9\u6837\u9891\u7e41\u7684\u5bf9<code>LRU\u94fe\u8868</code>\u8fdb\u884c\u8282\u70b9\u79fb\u52a8\u64cd\u4f5c\u662f\u4e0d\u662f\u4e0d\u592a\u597d\u554a\uff1f\u662f\u7684\uff0c\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5176\u5b9e\u6211\u4eec\u8fd8\u53ef\u4ee5\u63d0\u51fa\u4e00\u4e9b\u4f18\u5316\u7b56\u7565\uff0c\u6bd4\u5982\u53ea\u6709\u88ab\u8bbf\u95ee\u7684\u7f13\u5b58\u9875\u4f4d\u4e8e<code>young</code>\u533a\u57df\u7684<code>1/4</code>\u7684\u540e\u8fb9\uff0c\u624d\u4f1a\u88ab\u79fb\u52a8\u5230<code>LRU\u94fe\u8868</code>\u5934\u90e8\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u964d\u4f4e\u8c03\u6574<code>LRU\u94fe\u8868</code>\u7684\u9891\u7387\uff0c\u4ece\u800c\u63d0\u5347\u6027\u80fd\uff08\u4e5f\u5c31\u662f\u8bf4\u5982\u679c\u67d0\u4e2a\u7f13\u5b58\u9875\u5bf9\u5e94\u7684\u8282\u70b9\u5728<code>young</code>\u533a\u57df\u7684<code>1/4</code>\u4e2d\uff0c\u518d\u6b21\u8bbf\u95ee\u8be5\u7f13\u5b58\u9875\u65f6\u4e5f\u4e0d\u4f1a\u5c06\u5176\u79fb\u52a8\u5230<code>LRU</code>\u94fe\u8868\u5934\u90e8\uff09\u3002</p> <p>\u5c0f\u8d34\u58eb\uff1a</p> <p>\u6211\u4eec\u4e4b\u524d\u4ecb\u7ecd\u968f\u673a\u9884\u8bfb\u7684\u65f6\u5019\u66fe\u8bf4\uff0c\u5982\u679cBuffer Pool\u4e2d\u6709\u67d0\u4e2a\u533a\u768413\u4e2a\u8fde\u7eed\u9875\u9762\u5c31\u4f1a\u89e6\u53d1\u968f\u673a\u9884\u8bfb\uff0c\u8fd9\u5176\u5b9e\u662f\u4e0d\u4e25\u8c28\u7684\uff08\u4e0d\u5e78\u7684\u662fMySQL\u6587\u6863\u5c31\u662f\u8fd9\u4e48\u8bf4\u7684[\u644a\u624b]\uff09\uff0c\u5176\u5b9e\u8fd8\u8981\u6c42\u8fd913\u4e2a\u9875\u9762\u662f\u975e\u5e38\u70ed\u7684\u9875\u9762\uff0c\u6240\u8c13\u7684\u975e\u5e38\u70ed\uff0c\u6307\u7684\u662f\u8fd9\u4e9b\u9875\u9762\u5728\u6574\u4e2ayoung\u533a\u57df\u7684\u59341/4\u5904\u3002</p> <p>\u8fd8\u6709\u6ca1\u6709\u4ec0\u4e48\u522b\u7684\u9488\u5bf9<code>LRU\u94fe\u8868</code>\u7684\u4f18\u5316\u63aa\u65bd\u5462\uff1f\u5f53\u7136\u6709\u554a\uff0c\u4f60\u8981\u662f\u597d\u597d\u5b66\uff0c\u5199\u7bc7\u8bba\u6587\uff0c\u5199\u672c\u4e66\u90fd\u4e0d\u662f\u95ee\u9898\uff0c\u53ef\u662f\u8fd9\u6bd5\u7adf\u662f\u4e00\u4e2a\u4ecb\u7ecd<code>MySQL</code>\u57fa\u7840\u77e5\u8bc6\u7684\u6587\u7ae0\uff0c\u518d\u8bf4\u591a\u4e86\u7bc7\u5e45\u5c31\u53d7\u4e0d\u4e86\u4e86\uff0c\u4e5f\u5f71\u54cd\u5927\u5bb6\u7684\u9605\u8bfb\u4f53\u9a8c\uff0c\u6240\u4ee5\u9002\u53ef\u800c\u6b62\uff0c\u60f3\u4e86\u89e3\u66f4\u591a\u7684\u4f18\u5316\u77e5\u8bc6\uff0c\u81ea\u5df1\u53bb\u770b\u6e90\u7801\u6216\u8005\u66f4\u591a\u5173\u4e8e<code>LRU</code>\u94fe\u8868\u7684\u77e5\u8bc6\u55bd\uff5e \u4f46\u662f\u4e0d\u8bba\u600e\u4e48\u4f18\u5316\uff0c\u5343\u4e07\u522b\u5fd8\u4e86\u6211\u4eec\u7684\u521d\u5fc3\uff1a\u5c3d\u91cf\u9ad8\u6548\u7684\u63d0\u9ad8 Buffer Pool \u7684\u7f13\u5b58\u547d\u4e2d\u7387\u3002</p>"},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/#_4","title":"\u5176\u4ed6\u7684\u4e00\u4e9b\u94fe\u8868","text":"<p>\u4e3a\u4e86\u66f4\u597d\u7684\u7ba1\u7406<code>Buffer Pool</code>\u4e2d\u7684\u7f13\u5b58\u9875\uff0c\u9664\u4e86\u6211\u4eec\u4e0a\u8fb9\u63d0\u5230\u7684\u4e00\u4e9b\u63aa\u65bd\uff0c\u8bbe\u8ba1<code>InnoDB</code>\u7684\u5927\u53d4\u4eec\u8fd8\u5f15\u8fdb\u4e86\u5176\u4ed6\u7684\u4e00\u4e9b<code>\u94fe\u8868</code>\uff0c\u6bd4\u5982<code>unzip LRU\u94fe\u8868</code>\u7528\u4e8e\u7ba1\u7406\u89e3\u538b\u9875\uff0c<code>zip clean\u94fe\u8868</code>\u7528\u4e8e\u7ba1\u7406\u6ca1\u6709\u88ab\u89e3\u538b\u7684\u538b\u7f29\u9875\uff0c<code>zip free\u6570\u7ec4</code>\u4e2d\u6bcf\u4e00\u4e2a\u5143\u7d20\u90fd\u4ee3\u8868\u4e00\u4e2a\u94fe\u8868\uff0c\u5b83\u4eec\u7ec4\u6210\u6240\u8c13\u7684<code>\u4f19\u4f34\u7cfb\u7edf</code>\u6765\u4e3a\u538b\u7f29\u9875\u63d0\u4f9b\u5185\u5b58\u7a7a\u95f4\u7b49\u7b49\uff0c\u53cd\u6b63\u662f\u4e3a\u4e86\u66f4\u597d\u7684\u7ba1\u7406\u8fd9\u4e2a<code>Buffer Pool</code>\u5f15\u5165\u4e86\u5404\u79cd\u94fe\u8868\u6216\u5176\u4ed6\u6570\u636e\u7ed3\u6784\uff0c\u5177\u4f53\u7684\u4f7f\u7528\u65b9\u5f0f\u5c31\u4e0d\u5570\u55e6\u4e86\uff0c\u5927\u5bb6\u6709\u5174\u8da3\u6df1\u7a76\u7684\u518d\u53bb\u627e\u4e9b\u66f4\u6df1\u7684\u4e66\u6216\u8005\u76f4\u63a5\u770b\u6e90\u4ee3\u7801\u5427\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u6765\u627e\u6211\u54c8\uff5e</p> <p>\u5c0f\u8d34\u58eb\uff1a</p> <p>\u6211\u4eec\u538b\u6839\u513f\u6ca1\u6709\u6df1\u5165\u5520\u53e8\u8fc7InnoDB\u4e2d\u7684\u538b\u7f29\u9875\uff0c\u5bf9\u4e0a\u8fb9\u7684\u8fd9\u4e9b\u94fe\u8868\u4e5f\u53ea\u662f\u4e3a\u4e86\u5b8c\u6574\u6027\u987a\u4fbf\u63d0\u4e00\u4e0b\uff0c\u5982\u679c\u4f60\u770b\u4e0d\u61c2\u5343\u4e07\u4e0d\u8981\u6291\u90c1\uff0c\u56e0\u4e3a\u6211\u538b\u6839\u513f\u5c31\u6ca1\u6253\u7b97\u5411\u5927\u5bb6\u4ecb\u7ecd\u5b83\u4eec\u3002</p>"},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/#_5","title":"\u5237\u65b0\u810f\u9875\u5230\u78c1\u76d8","text":"<p>\u540e\u53f0\u6709\u4e13\u95e8\u7684\u7ebf\u7a0b\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u8d1f\u8d23\u628a\u810f\u9875\u5237\u65b0\u5230\u78c1\u76d8\uff0c\u8fd9\u6837\u53ef\u4ee5\u4e0d\u5f71\u54cd\u7528\u6237\u7ebf\u7a0b\u5904\u7406\u6b63\u5e38\u7684\u8bf7\u6c42\u3002\u4e3b\u8981\u6709\u4e24\u79cd\u5237\u65b0\u8def\u5f84\uff1a</p> <ul> <li>\u4ece<code>LRU\u94fe\u8868</code>\u7684\u51b7\u6570\u636e\u4e2d\u5237\u65b0\u4e00\u90e8\u5206\u9875\u9762\u5230\u78c1\u76d8\u3002</li> </ul> <p>\u540e\u53f0\u7ebf\u7a0b\u4f1a\u5b9a\u65f6\u4ece<code>LRU\u94fe\u8868</code>\u5c3e\u90e8\u5f00\u59cb\u626b\u63cf\u4e00\u4e9b\u9875\u9762\uff0c\u626b\u63cf\u7684\u9875\u9762\u6570\u91cf\u53ef\u4ee5\u901a\u8fc7\u7cfb\u7edf\u53d8\u91cf<code>innodb_lru_scan_depth</code>\u6765\u6307\u5b9a\uff0c\u5982\u679c\u4ece\u91cc\u8fb9\u513f\u53d1\u73b0\u810f\u9875\uff0c\u4f1a\u628a\u5b83\u4eec\u5237\u65b0\u5230\u78c1\u76d8\u3002\u8fd9\u79cd\u5237\u65b0\u9875\u9762\u7684\u65b9\u5f0f\u88ab\u79f0\u4e4b\u4e3a<code>BUF_FLUSH_LRU</code>\u3002</p> <ul> <li>\u4ece<code>flush\u94fe\u8868</code>\u4e2d\u5237\u65b0\u4e00\u90e8\u5206\u9875\u9762\u5230\u78c1\u76d8\u3002</li> </ul> <p>\u540e\u53f0\u7ebf\u7a0b\u4e5f\u4f1a\u5b9a\u65f6\u4ece<code>flush\u94fe\u8868</code>\u4e2d\u5237\u65b0\u4e00\u90e8\u5206\u9875\u9762\u5230\u78c1\u76d8\uff0c\u5237\u65b0\u7684\u901f\u7387\u53d6\u51b3\u4e8e\u5f53\u65f6\u7cfb\u7edf\u662f\u4e0d\u662f\u5f88\u7e41\u5fd9\u3002\u8fd9\u79cd\u5237\u65b0\u9875\u9762\u7684\u65b9\u5f0f\u88ab\u79f0\u4e4b\u4e3a<code>BUF_FLUSH_LIST</code>\u3002</p> <p>\u6709\u65f6\u5019\u540e\u53f0\u7ebf\u7a0b\u5237\u65b0\u810f\u9875\u7684\u8fdb\u5ea6\u6bd4\u8f83\u6162\uff0c\u5bfc\u81f4\u7528\u6237\u7ebf\u7a0b\u5728\u51c6\u5907\u52a0\u8f7d\u4e00\u4e2a\u78c1\u76d8\u9875\u5230<code>Buffer Pool</code>\u65f6\u6ca1\u6709\u53ef\u7528\u7684\u7f13\u5b58\u9875\uff0c\u8fd9\u65f6\u5c31\u4f1a\u5c1d\u8bd5\u770b\u770b<code>LRU\u94fe\u8868</code>\u5c3e\u90e8\u6709\u6ca1\u6709\u53ef\u4ee5\u76f4\u63a5\u91ca\u653e\u6389\u7684\u672a\u4fee\u6539\u9875\u9762\uff0c\u5982\u679c\u6ca1\u6709\u7684\u8bdd\u4f1a\u4e0d\u5f97\u4e0d\u5c06<code>LRU\u94fe\u8868</code>\u5c3e\u90e8\u7684\u4e00\u4e2a\u810f\u9875\u540c\u6b65\u5237\u65b0\u5230\u78c1\u76d8\uff08\u548c\u78c1\u76d8\u4ea4\u4e92\u662f\u5f88\u6162\u7684\uff0c\u8fd9\u4f1a\u964d\u4f4e\u5904\u7406\u7528\u6237\u8bf7\u6c42\u7684\u901f\u5ea6\uff09\u3002\u8fd9\u79cd\u5237\u65b0\u5355\u4e2a\u9875\u9762\u5230\u78c1\u76d8\u4e2d\u7684\u5237\u65b0\u65b9\u5f0f\u88ab\u79f0\u4e4b\u4e3a<code>BUF_FLUSH_SINGLE_PAGE</code>\u3002</p> <p>\u5f53\u7136\uff0c\u6709\u65f6\u5019\u7cfb\u7edf\u7279\u522b\u7e41\u5fd9\u65f6\uff0c\u4e5f\u53ef\u80fd\u51fa\u73b0\u7528\u6237\u7ebf\u7a0b\u6279\u91cf\u7684\u4ece<code>flush\u94fe\u8868</code>\u4e2d\u5237\u65b0\u810f\u9875\u7684\u60c5\u51b5\uff0c\u5f88\u663e\u7136\u5728\u5904\u7406\u7528\u6237\u8bf7\u6c42\u8fc7\u7a0b\u4e2d\u53bb\u5237\u65b0\u810f\u9875\u662f\u4e00\u79cd\u4e25\u91cd\u964d\u4f4e\u5904\u7406\u901f\u5ea6\u7684\u884c\u4e3a\uff08\u6bd5\u7adf\u78c1\u76d8\u7684\u901f\u5ea6\u6162\u7684\u8981\u6b7b\uff09\uff0c\u8fd9\u5c5e\u4e8e\u4e00\u79cd\u8feb\u4e0d\u5f97\u5df2\u7684\u60c5\u51b5\uff0c\u4e0d\u8fc7\u8fd9\u5f97\u653e\u5728\u540e\u8fb9\u5520\u53e8<code>redo</code>\u65e5\u5fd7\u7684<code>checkpoint</code>\u65f6\u8bf4\u4e86\u3002</p>"},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/#buffer-pool_2","title":"\u591a\u4e2aBuffer Pool\u5b9e\u4f8b","text":"<p>\u6211\u4eec\u4e0a\u8fb9\u8bf4\u8fc7\uff0c<code>Buffer Pool</code>\u672c\u8d28\u662f<code>InnoDB</code>\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u7684\u4e00\u5757\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\uff0c\u8bbf\u95ee<code>Buffer Pool</code>\u4e2d\u7684\u5404\u79cd\u94fe\u8868\u90fd\u9700\u8981\u52a0\u9501\u5904\u7406\u5565\u7684\uff0c\u5728<code>Buffer Pool</code>\u7279\u522b\u5927\u800c\u4e14\u591a\u7ebf\u7a0b\u5e76\u53d1\u8bbf\u95ee\u7279\u522b\u9ad8\u7684\u60c5\u51b5\u4e0b\uff0c\u5355\u4e00\u7684<code>Buffer Pool</code>\u53ef\u80fd\u4f1a\u5f71\u54cd\u8bf7\u6c42\u7684\u5904\u7406\u901f\u5ea6\u3002\u6240\u4ee5\u5728<code>Buffer Pool</code>\u7279\u522b\u5927\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u4eec\u62c6\u5206\u6210\u82e5\u5e72\u4e2a\u5c0f\u7684<code>Buffer Pool</code>\uff0c\u6bcf\u4e2a<code>Buffer Pool</code>\u90fd\u79f0\u4e3a\u4e00\u4e2a<code>\u5b9e\u4f8b</code>\uff0c\u5b83\u4eec\u90fd\u662f\u72ec\u7acb\u7684\uff0c\u72ec\u7acb\u7684\u53bb\u7533\u8bf7\u5185\u5b58\u7a7a\u95f4\uff0c\u72ec\u7acb\u7684\u7ba1\u7406\u5404\u79cd\u94fe\u8868\uff0c\u72ec\u7acb\u7684\u5427\u5566\u5427\u5566\uff0c\u6240\u4ee5\u5728\u591a\u7ebf\u7a0b\u5e76\u53d1\u8bbf\u95ee\u65f6\u5e76\u4e0d\u4f1a\u76f8\u4e92\u5f71\u54cd\uff0c\u4ece\u800c\u63d0\u9ad8\u5e76\u53d1\u5904\u7406\u80fd\u529b\u3002\u6211\u4eec\u53ef\u4ee5\u5728\u670d\u52a1\u5668\u542f\u52a8\u7684\u65f6\u5019\u901a\u8fc7\u8bbe\u7f6e<code>innodb_buffer_pool_instances</code>\u7684\u503c\u6765\u4fee\u6539<code>Buffer Pool</code>\u5b9e\u4f8b\u7684\u4e2a\u6570\uff0c\u6bd4\u65b9\u8bf4\u8fd9\u6837\uff1a</p> <pre><code>ini\u590d\u5236\u4ee3\u7801[server]\ninnodb_buffer_pool_instances = 2\n</code></pre> <p>\u8fd9\u6837\u5c31\u8868\u660e\u6211\u4eec\u8981\u521b\u5efa2\u4e2a<code>Buffer Pool</code>\u5b9e\u4f8b\uff0c\u793a\u610f\u56fe\u5c31\u662f\u8fd9\u6837\uff1a</p> <p></p> <p>\u5c0f\u8d34\u58eb\uff1a</p> <p>\u4e3a\u4e86\u7b80\u4fbf\uff0c\u6211\u53ea\u628a\u5404\u4e2a\u94fe\u8868\u7684\u57fa\u8282\u70b9\u753b\u51fa\u6765\u4e86\uff0c\u5927\u5bb6\u5e94\u8be5\u5fc3\u91cc\u6e05\u695a\u8fd9\u4e9b\u94fe\u8868\u7684\u8282\u70b9\u5176\u5b9e\u5c31\u662f\u6bcf\u4e2a\u7f13\u5b58\u9875\u5bf9\u5e94\u7684\u63a7\u5236\u5757\uff01</p> <p>\u90a3\u6bcf\u4e2a<code>Buffer Pool</code>\u5b9e\u4f8b\u5b9e\u9645\u5360\u591a\u5c11\u5185\u5b58\u7a7a\u95f4\u5462\uff1f\u5176\u5b9e\u4f7f\u7528\u8fd9\u4e2a\u516c\u5f0f\u7b97\u51fa\u6765\u7684\uff1a</p> <pre><code>bash\n\u590d\u5236\u4ee3\u7801innodb_buffer_pool_size/innodb_buffer_pool_instances\n</code></pre> <p>\u4e5f\u5c31\u662f\u603b\u5171\u7684\u5927\u5c0f\u9664\u4ee5\u5b9e\u4f8b\u7684\u4e2a\u6570\uff0c\u7ed3\u679c\u5c31\u662f\u6bcf\u4e2a<code>Buffer Pool</code>\u5b9e\u4f8b\u5360\u7528\u7684\u5927\u5c0f\u3002</p> <p>\u4e0d\u8fc7\u4e5f\u4e0d\u662f\u8bf4<code>Buffer Pool</code>\u5b9e\u4f8b\u521b\u5efa\u7684\u8d8a\u591a\u8d8a\u597d\uff0c\u5206\u522b\u7ba1\u7406\u5404\u4e2a<code>Buffer Pool</code>\u4e5f\u662f\u9700\u8981\u6027\u80fd\u5f00\u9500\u7684\uff0c\u8bbe\u8ba1<code>InnoDB</code>\u7684\u5927\u53d4\u4eec\u89c4\u5b9a\uff1a\u5f53innodb_buffer_pool_size\u7684\u503c\u5c0f\u4e8e1G\u7684\u65f6\u5019\u8bbe\u7f6e\u591a\u4e2a\u5b9e\u4f8b\u662f\u65e0\u6548\u7684\uff0cInnoDB\u4f1a\u9ed8\u8ba4\u628ainnodb_buffer_pool_instances \u7684\u503c\u4fee\u6539\u4e3a1\u3002\u800c\u6211\u4eec\u9f13\u52b1\u5728<code>Buffer Pool</code>\u5927\u4e8e\u6216\u7b49\u4e8e1G\u7684\u65f6\u5019\u8bbe\u7f6e\u591a\u4e2a<code>Buffer Pool</code>\u5b9e\u4f8b\u3002</p>"},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/#innodb_buffer_pool_chunk_size","title":"innodb_buffer_pool_chunk_size","text":"<p>\u5728<code>MySQL 5.7.5</code>\u4e4b\u524d\uff0c<code>Buffer Pool</code>\u7684\u5927\u5c0f\u53ea\u80fd\u5728\u670d\u52a1\u5668\u542f\u52a8\u65f6\u901a\u8fc7\u914d\u7f6e<code>innodb_buffer_pool_size</code>\u542f\u52a8\u53c2\u6570\u6765\u8c03\u6574\u5927\u5c0f\uff0c\u5728\u670d\u52a1\u5668\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u662f\u4e0d\u5141\u8bb8\u8c03\u6574\u8be5\u503c\u7684\u3002\u4e0d\u8fc7\u8bbe\u8ba1<code>MySQL</code>\u7684\u5927\u53d4\u5728<code>5.7.5</code>\u4ee5\u53ca\u4e4b\u540e\u7684\u7248\u672c\u4e2d\u652f\u6301\u4e86\u5728\u670d\u52a1\u5668\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u8c03\u6574<code>Buffer Pool</code>\u5927\u5c0f\u7684\u529f\u80fd\uff0c\u4f46\u662f\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u6bcf\u6b21\u5f53\u6211\u4eec\u8981\u91cd\u65b0\u8c03\u6574<code>Buffer Pool</code>\u5927\u5c0f\u65f6\uff0c\u90fd\u9700\u8981\u91cd\u65b0\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u4e00\u5757\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u7136\u540e\u5c06\u65e7\u7684<code>Buffer Pool</code>\u4e2d\u7684\u5185\u5bb9\u590d\u5236\u5230\u8fd9\u4e00\u5757\u65b0\u7a7a\u95f4\uff0c\u8fd9\u662f\u6781\u5176\u8017\u65f6\u7684\u3002\u6240\u4ee5\u8bbe\u8ba1<code>MySQL</code>\u7684\u5927\u53d4\u4eec\u51b3\u5b9a\u4e0d\u518d\u4e00\u6b21\u6027\u4e3a\u67d0\u4e2a<code>Buffer Pool</code>\u5b9e\u4f8b\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u4e00\u5927\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u800c\u662f\u4ee5\u4e00\u4e2a\u6240\u8c13\u7684<code>chunk</code>\u4e3a\u5355\u4f4d\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u7a7a\u95f4\u3002\u4e5f\u5c31\u662f\u8bf4\u4e00\u4e2a<code>Buffer Pool</code>\u5b9e\u4f8b\u5176\u5b9e\u662f\u7531\u82e5\u5e72\u4e2a<code>chunk</code>\u7ec4\u6210\u7684\uff0c\u4e00\u4e2a<code>chunk</code>\u5c31\u4ee3\u8868\u4e00\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u91cc\u8fb9\u513f\u5305\u542b\u4e86\u82e5\u5e72\u7f13\u5b58\u9875\u4e0e\u5176\u5bf9\u5e94\u7684\u63a7\u5236\u5757\uff0c\u753b\u4e2a\u56fe\u8868\u793a\u5c31\u662f\u8fd9\u6837\uff1a</p> <p></p> <p>\u4e0a\u56fe\u4ee3\u8868\u7684<code>Buffer Pool</code>\u5c31\u662f\u75312\u4e2a\u5b9e\u4f8b\u7ec4\u6210\u7684\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u4e2d\u53c8\u5305\u542b2\u4e2a<code>chunk</code>\u3002</p> <p>\u6b63\u662f\u56e0\u4e3a\u53d1\u660e\u4e86\u8fd9\u4e2a<code>chunk</code>\u7684\u6982\u5ff5\uff0c\u6211\u4eec\u5728\u670d\u52a1\u5668\u8fd0\u884c\u671f\u95f4\u8c03\u6574<code>Buffer Pool</code>\u7684\u5927\u5c0f\u65f6\u5c31\u662f\u4ee5<code>chunk</code>\u4e3a\u5355\u4f4d\u589e\u52a0\u6216\u8005\u5220\u9664\u5185\u5b58\u7a7a\u95f4\uff0c\u800c\u4e0d\u9700\u8981\u91cd\u65b0\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u4e00\u7247\u5927\u7684\u5185\u5b58\uff0c\u7136\u540e\u8fdb\u884c\u7f13\u5b58\u9875\u7684\u590d\u5236\u3002\u8fd9\u4e2a\u6240\u8c13\u7684<code>chunk</code>\u7684\u5927\u5c0f\u662f\u6211\u4eec\u5728\u542f\u52a8\u64cd\u4f5c<code>MySQL</code>\u670d\u52a1\u5668\u65f6\u901a\u8fc7<code>innodb_buffer_pool_chunk_size</code>\u542f\u52a8\u53c2\u6570\u6307\u5b9a\u7684\uff0c\u5b83\u7684\u9ed8\u8ba4\u503c\u662f<code>134217728</code>\uff0c\u4e5f\u5c31\u662f<code>128M</code>\u3002\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cinnodb_buffer_pool_chunk_size\u7684\u503c\u53ea\u80fd\u5728\u670d\u52a1\u5668\u542f\u52a8\u65f6\u6307\u5b9a\uff0c\u5728\u670d\u52a1\u5668\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u662f\u4e0d\u53ef\u4ee5\u4fee\u6539\u7684\u3002</p> <p>\u5c0f\u8d34\u58eb\uff1a</p> <p>\u4e3a\u4ec0\u4e48\u4e0d\u5141\u8bb8\u5728\u670d\u52a1\u5668\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u4fee\u6539innodb_buffer_pool_chunk_size\u7684\u503c\uff1f\u8fd8\u4e0d\u662f\u56e0\u4e3ainnodb_buffer_pool_chunk_size\u7684\u503c\u4ee3\u8868InnoDB\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u7684\u4e00\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u7684\u5927\u5c0f\uff0c\u5982\u679c\u4f60\u5728\u670d\u52a1\u5668\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u4fee\u6539\u4e86\u8be5\u503c\uff0c\u5c31\u610f\u5473\u7740\u8981\u91cd\u65b0\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u5e76\u4e14\u5c06\u539f\u5148\u7684\u7f13\u5b58\u9875\u548c\u5b83\u4eec\u5bf9\u5e94\u7684\u63a7\u5236\u5757\u590d\u5236\u5230\u8fd9\u4e2a\u65b0\u7684\u5185\u5b58\u7a7a\u95f4\u4e2d\uff0c\u8fd9\u662f\u5341\u5206\u8017\u65f6\u7684\u64cd\u4f5c\uff01</p> <p>\u53e6\u5916\uff0c\u8fd9\u4e2ainnodb_buffer_pool_chunk_size\u7684\u503c\u5e76\u4e0d\u5305\u542b\u7f13\u5b58\u9875\u5bf9\u5e94\u7684\u63a7\u5236\u5757\u7684\u5185\u5b58\u7a7a\u95f4\u5927\u5c0f\uff0c\u6240\u4ee5\u5b9e\u9645\u4e0aInnoDB\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4\u65f6\uff0c\u6bcf\u4e2achunk\u7684\u5927\u5c0f\u8981\u6bd4innodb_buffer_pool_chunk_size\u7684\u503c\u5927\u4e00\u4e9b\uff0c\u7ea65%\u3002</p>"},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/#buffer-pool_3","title":"\u914d\u7f6eBuffer Pool\u65f6\u7684\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li><code>innodb_buffer_pool_size</code>\u5fc5\u987b\u662f<code>innodb_buffer_pool_chunk_size \u00d7 innodb_buffer_pool_instances</code>\u7684\u500d\u6570\uff08\u8fd9\u4e3b\u8981\u662f\u60f3\u4fdd\u8bc1\u6bcf\u4e00\u4e2a<code>Buffer Pool</code>\u5b9e\u4f8b\u4e2d\u5305\u542b\u7684<code>chunk</code>\u6570\u91cf\u76f8\u540c\uff09\u3002</li> </ul> <p>\u5047\u8bbe\u6211\u4eec\u6307\u5b9a\u7684<code>innodb_buffer_pool_chunk_size</code>\u7684\u503c\u662f<code>128M</code>\uff0c<code>innodb_buffer_pool_instances</code>\u7684\u503c\u662f<code>16</code>\uff0c\u90a3\u4e48\u8fd9\u4e24\u4e2a\u503c\u7684\u4e58\u79ef\u5c31\u662f<code>2G</code>\uff0c\u4e5f\u5c31\u662f\u8bf4<code>innodb_buffer_pool_size</code>\u7684\u503c\u5fc5\u987b\u662f<code>2G</code>\u6216\u8005<code>2G</code>\u7684\u6574\u6570\u500d\u3002\u6bd4\u65b9\u8bf4\u6211\u4eec\u5728\u542f\u52a8<code>MySQL</code>\u670d\u52a1\u5668\u662f\u8fd9\u6837\u6307\u5b9a\u542f\u52a8\u53c2\u6570\u7684\uff1a</p> <pre><code>arduino\n\u590d\u5236\u4ee3\u7801mysqld --innodb-buffer-pool-size=8G --innodb-buffer-pool-instances=16\n</code></pre> <p>\u9ed8\u8ba4\u7684<code>innodb_buffer_pool_chunk_size</code>\u503c\u662f<code>128M</code>\uff0c\u6307\u5b9a\u7684<code>innodb_buffer_pool_instances</code>\u7684\u503c\u662f<code>16</code>\uff0c\u6240\u4ee5<code>innodb_buffer_pool_size</code>\u7684\u503c\u5fc5\u987b\u662f<code>2G</code>\u6216\u8005<code>2G</code>\u7684\u6574\u6570\u500d\uff0c\u4e0a\u8fb9\u4f8b\u5b50\u4e2d\u6307\u5b9a\u7684<code>innodb_buffer_pool_size</code>\u7684\u503c\u662f<code>8G</code>\uff0c\u7b26\u5408\u89c4\u5b9a\uff0c\u6240\u4ee5\u5728\u670d\u52a1\u5668\u542f\u52a8\u5b8c\u6210\u4e4b\u540e\u6211\u4eec\u67e5\u770b\u4e00\u4e0b\u8be5\u53d8\u91cf\u7684\u503c\u5c31\u662f\u6211\u4eec\u6307\u5b9a\u7684<code>8G</code>\uff088589934592\u5b57\u8282\uff09\uff1a</p> <pre><code>sql\u590d\u5236\u4ee3\u7801mysql&gt; show variables like 'innodb_buffer_pool_size';\n+-------------------------+------------+\n| Variable_name           | Value      |\n+-------------------------+------------+\n| innodb_buffer_pool_size | 8589934592 |\n+-------------------------+------------+\n1 row in set (0.00 sec)\n</code></pre> <p>\u5982\u679c\u6211\u4eec\u6307\u5b9a\u7684<code>innodb_buffer_pool_size</code>\u5927\u4e8e<code>2G</code>\u5e76\u4e14\u4e0d\u662f<code>2G</code>\u7684\u6574\u6570\u500d\uff0c\u90a3\u4e48\u670d\u52a1\u5668\u4f1a\u81ea\u52a8\u7684\u628a<code>innodb_buffer_pool_size</code>\u7684\u503c\u8c03\u6574\u4e3a<code>2G</code>\u7684\u6574\u6570\u500d\uff0c\u6bd4\u65b9\u8bf4\u6211\u4eec\u5728\u542f\u52a8\u670d\u52a1\u5668\u65f6\u6307\u5b9a\u7684<code>innodb_buffer_pool_size</code>\u7684\u503c\u662f<code>9G</code>\uff1a</p> <pre><code>arduino\n\u590d\u5236\u4ee3\u7801mysqld --innodb-buffer-pool-size=9G --innodb-buffer-pool-instances=16\n</code></pre> <p>\u90a3\u4e48\u670d\u52a1\u5668\u4f1a\u81ea\u52a8\u628a<code>innodb_buffer_pool_size</code>\u7684\u503c\u8c03\u6574\u4e3a<code>10G</code>\uff0810737418240\u5b57\u8282\uff09\uff0c\u4e0d\u4fe1\u4f60\u770b\uff1a</p> <pre><code>sql\u590d\u5236\u4ee3\u7801mysql&gt; show variables like 'innodb_buffer_pool_size';\n+-------------------------+-------------+\n| Variable_name           | Value       |\n+-------------------------+-------------+\n| innodb_buffer_pool_size | 10737418240 |\n+-------------------------+-------------+\n1 row in set (0.01 sec)\n</code></pre> <ul> <li>\u5982\u679c\u5728\u670d\u52a1\u5668\u542f\u52a8\u65f6\uff0c<code>innodb_buffer_pool_chunk_size \u00d7 innodb_buffer_pool_instances</code>\u7684\u503c\u5df2\u7ecf\u5927\u4e8e<code>innodb_buffer_pool_size</code>\u7684\u503c\uff0c\u90a3\u4e48<code>innodb_buffer_pool_chunk_size</code>\u7684\u503c\u4f1a\u88ab\u670d\u52a1\u5668\u81ea\u52a8\u8bbe\u7f6e\u4e3a<code>innodb_buffer_pool_size/innodb_buffer_pool_instances</code>\u7684\u503c\u3002</li> </ul> <p>\u6bd4\u65b9\u8bf4\u6211\u4eec\u5728\u542f\u52a8\u670d\u52a1\u5668\u65f6\u6307\u5b9a\u7684<code>innodb_buffer_pool_size</code>\u7684\u503c\u4e3a<code>2G</code>\uff0c<code>innodb_buffer_pool_instances</code>\u7684\u503c\u4e3a16\uff0c<code>innodb_buffer_pool_chunk_size</code>\u7684\u503c\u4e3a<code>256M</code>\uff1a</p> <pre><code>arduino\n\u590d\u5236\u4ee3\u7801mysqld --innodb-buffer-pool-size=2G --innodb-buffer-pool-instances=16 --innodb-buffer-pool-chunk-size=256M\n</code></pre> <p>\u7531\u4e8e<code>256M \u00d7 16 = 4G</code>\uff0c\u800c<code>4G &gt; 2G</code>\uff0c\u6240\u4ee5<code>innodb_buffer_pool_chunk_size</code>\u503c\u4f1a\u88ab\u670d\u52a1\u5668\u6539\u5199\u4e3a<code>innodb_buffer_pool_size/innodb_buffer_pool_instances</code>\u7684\u503c\uff0c\u4e5f\u5c31\u662f\uff1a<code>2G/16 = 128M</code>\uff08134217728\u5b57\u8282\uff09\uff0c\u4e0d\u4fe1\u4f60\u770b\uff1a</p> <pre><code>sql\u590d\u5236\u4ee3\u7801mysql&gt; show variables like 'innodb_buffer_pool_size';\n+-------------------------+------------+\n| Variable_name           | Value      |\n+-------------------------+------------+\n| innodb_buffer_pool_size | 2147483648 |\n+-------------------------+------------+\n1 row in set (0.01 sec)\n\nmysql&gt; show variables like 'innodb_buffer_pool_chunk_size';\n+-------------------------------+-----------+\n| Variable_name                 | Value     |\n+-------------------------------+-----------+\n| innodb_buffer_pool_chunk_size | 134217728 |\n+-------------------------------+-----------+\n1 row in set (0.00 sec)\n</code></pre>"},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/#buffer-pool_4","title":"Buffer Pool\u4e2d\u5b58\u50a8\u7684\u5176\u5b83\u4fe1\u606f","text":"<p><code>Buffer Pool</code>\u7684\u7f13\u5b58\u9875\u9664\u4e86\u7528\u6765\u7f13\u5b58\u78c1\u76d8\u4e0a\u7684\u9875\u9762\u4ee5\u5916\uff0c\u8fd8\u53ef\u4ee5\u5b58\u50a8\u9501\u4fe1\u606f\u3001\u81ea\u9002\u5e94\u54c8\u5e0c\u7d22\u5f15\u7b49\u4fe1\u606f\uff0c\u8fd9\u4e9b\u5185\u5bb9\u7b49\u6211\u4eec\u4e4b\u540e\u9047\u5230\u4e86\u518d\u8be6\u7ec6\u8ba8\u8bba\u54c8\uff5e</p>"},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/#buffer-pool_5","title":"\u67e5\u770bBuffer Pool\u7684\u72b6\u6001\u4fe1\u606f","text":"<p>\u8bbe\u8ba1<code>MySQL</code>\u7684\u5927\u53d4\u8d34\u5fc3\u7684\u7ed9\u6211\u4eec\u63d0\u4f9b\u4e86<code>SHOW ENGINE INNODB STATUS</code>\u8bed\u53e5\u6765\u67e5\u770b\u5173\u4e8e<code>InnoDB</code>\u5b58\u50a8\u5f15\u64ce\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684\u4e00\u4e9b\u72b6\u6001\u4fe1\u606f\uff0c\u5176\u4e2d\u5c31\u5305\u62ec<code>Buffer Pool</code>\u7684\u4e00\u4e9b\u4fe1\u606f\uff0c\u6211\u4eec\u770b\u4e00\u4e0b\uff08\u4e3a\u4e86\u7a81\u51fa\u91cd\u70b9\uff0c\u6211\u4eec\u53ea\u628a\u8f93\u51fa\u4e2d\u5173\u4e8e<code>Buffer Pool</code>\u7684\u90e8\u5206\u63d0\u53d6\u4e86\u51fa\u6765\uff09\uff1a</p> <pre><code>bash\u590d\u5236\u4ee3\u7801mysql&gt; SHOW ENGINE INNODB STATUS\\G\n\n(...\u7701\u7565\u524d\u8fb9\u7684\u8bb8\u591a\u72b6\u6001)\n----------------------\nBUFFER POOL AND MEMORY\n----------------------\nTotal memory allocated 13218349056;\nDictionary memory allocated 4014231\nBuffer pool size   786432\nFree buffers       8174\nDatabase pages     710576\nOld database pages 262143\nModified db pages  124941\nPending reads 0\nPending writes: LRU 0, flush list 0, single page 0\nPages made young 6195930012, not young 78247510485\n108.18 youngs/s, 226.15 non-youngs/s\nPages read 2748866728, created 29217873, written 4845680877\n160.77 reads/s, 3.80 creates/s, 190.16 writes/s\nBuffer pool hit rate 956 / 1000, young-making rate 30 / 1000 not 605 / 1000\nPages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s\nLRU len: 710576, unzip_LRU len: 118\nI/O sum[134264]:cur[144], unzip sum[16]:cur[0]\n--------------\n(...\u7701\u7565\u540e\u8fb9\u7684\u8bb8\u591a\u72b6\u6001)\n\nmysql&gt;\n</code></pre> <p>\u6211\u4eec\u6765\u8be6\u7ec6\u770b\u4e00\u4e0b\u8fd9\u91cc\u8fb9\u7684\u6bcf\u4e2a\u503c\u90fd\u4ee3\u8868\u4ec0\u4e48\u610f\u601d\uff1a</p> <ul> <li> <p><code>Total memory allocated</code>\uff1a\u4ee3\u8868<code>Buffer Pool</code>\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u7684\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4\u5927\u5c0f\uff0c\u5305\u62ec\u5168\u90e8\u63a7\u5236\u5757\u3001\u7f13\u5b58\u9875\u3001\u4ee5\u53ca\u788e\u7247\u7684\u5927\u5c0f\u3002</p> </li> <li> <p><code>Dictionary memory allocated</code>\uff1a\u4e3a\u6570\u636e\u5b57\u5178\u4fe1\u606f\u5206\u914d\u7684\u5185\u5b58\u7a7a\u95f4\u5927\u5c0f\uff0c\u6ce8\u610f\u8fd9\u4e2a\u5185\u5b58\u7a7a\u95f4\u548c<code>Buffer Pool</code>\u6ca1\u5565\u5173\u7cfb\uff0c\u4e0d\u5305\u62ec\u5728<code>Total memory allocated</code>\u4e2d\u3002</p> </li> <li> <p><code>Buffer pool size</code>\uff1a\u4ee3\u8868\u8be5<code>Buffer Pool</code>\u53ef\u4ee5\u5bb9\u7eb3\u591a\u5c11\u7f13\u5b58<code>\u9875</code>\uff0c\u6ce8\u610f\uff0c\u5355\u4f4d\u662f<code>\u9875</code>\uff01</p> </li> <li> <p><code>Free buffers</code>\uff1a\u4ee3\u8868\u5f53\u524d<code>Buffer Pool</code>\u8fd8\u6709\u591a\u5c11\u7a7a\u95f2\u7f13\u5b58\u9875\uff0c\u4e5f\u5c31\u662f<code>free\u94fe\u8868</code>\u4e2d\u8fd8\u6709\u591a\u5c11\u4e2a\u8282\u70b9\u3002</p> </li> <li> <p><code>Database pages</code>\uff1a\u4ee3\u8868<code>LRU</code>\u94fe\u8868\u4e2d\u7684\u9875\u7684\u6570\u91cf\uff0c\u5305\u542b<code>young</code>\u548c<code>old</code>\u4e24\u4e2a\u533a\u57df\u7684\u8282\u70b9\u6570\u91cf\u3002</p> </li> <li> <p><code>Old database pages</code>\uff1a\u4ee3\u8868<code>LRU</code>\u94fe\u8868<code>old</code>\u533a\u57df\u7684\u8282\u70b9\u6570\u91cf\u3002</p> </li> <li> <p><code>Modified db pages</code>\uff1a\u4ee3\u8868\u810f\u9875\u6570\u91cf\uff0c\u4e5f\u5c31\u662f<code>flush\u94fe\u8868</code>\u4e2d\u8282\u70b9\u7684\u6570\u91cf\u3002</p> </li> <li> <p><code>Pending reads</code>\uff1a\u6b63\u5728\u7b49\u5f85\u4ece\u78c1\u76d8\u4e0a\u52a0\u8f7d\u5230<code>Buffer Pool</code>\u4e2d\u7684\u9875\u9762\u6570\u91cf\u3002</p> </li> </ul> <p>\u5f53\u51c6\u5907\u4ece\u78c1\u76d8\u4e2d\u52a0\u8f7d\u67d0\u4e2a\u9875\u9762\u65f6\uff0c\u4f1a\u5148\u4e3a\u8fd9\u4e2a\u9875\u9762\u5728<code>Buffer Pool</code>\u4e2d\u5206\u914d\u4e00\u4e2a\u7f13\u5b58\u9875\u4ee5\u53ca\u5b83\u5bf9\u5e94\u7684\u63a7\u5236\u5757\uff0c\u7136\u540e\u628a\u8fd9\u4e2a\u63a7\u5236\u5757\u6dfb\u52a0\u5230<code>LRU</code>\u7684<code>old</code>\u533a\u57df\u7684\u5934\u90e8\uff0c\u4f46\u662f\u8fd9\u4e2a\u65f6\u5019\u771f\u6b63\u7684\u78c1\u76d8\u9875\u5e76\u6ca1\u6709\u88ab\u52a0\u8f7d\u8fdb\u6765\uff0c<code>Pending reads</code>\u7684\u503c\u4f1a\u8ddf\u7740\u52a01\u3002</p> <ul> <li> <p><code>Pending writes LRU</code>\uff1a\u5373\u5c06\u4ece<code>LRU</code>\u94fe\u8868\u4e2d\u5237\u65b0\u5230\u78c1\u76d8\u4e2d\u7684\u9875\u9762\u6570\u91cf\u3002</p> </li> <li> <p><code>Pending writes flush list</code>\uff1a\u5373\u5c06\u4ece<code>flush</code>\u94fe\u8868\u4e2d\u5237\u65b0\u5230\u78c1\u76d8\u4e2d\u7684\u9875\u9762\u6570\u91cf\u3002</p> </li> <li> <p><code>Pending writes single page</code>\uff1a\u5373\u5c06\u4ee5\u5355\u4e2a\u9875\u9762\u7684\u5f62\u5f0f\u5237\u65b0\u5230\u78c1\u76d8\u4e2d\u7684\u9875\u9762\u6570\u91cf\u3002</p> </li> <li> <p><code>Pages made young</code>\uff1a\u4ee3\u8868<code>LRU</code>\u94fe\u8868\u4e2d\u66fe\u7ecf\u4ece<code>old</code>\u533a\u57df\u79fb\u52a8\u5230<code>young</code>\u533a\u57df\u5934\u90e8\u7684\u8282\u70b9\u6570\u91cf\u3002</p> </li> </ul> <p>\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\uff0c\u4e00\u4e2a\u8282\u70b9\u6bcf\u6b21\u53ea\u6709\u4ece<code>old</code>\u533a\u57df\u79fb\u52a8\u5230<code>young</code>\u533a\u57df\u5934\u90e8\u65f6\u624d\u4f1a\u5c06<code>Pages made young</code>\u7684\u503c\u52a01\uff0c\u4e5f\u5c31\u662f\u8bf4\u5982\u679c\u8be5\u8282\u70b9\u672c\u6765\u5c31\u5728<code>young</code>\u533a\u57df\uff0c\u7531\u4e8e\u5b83\u7b26\u5408\u5728<code>young</code>\u533a\u57df1/4\u540e\u8fb9\u7684\u8981\u6c42\uff0c\u4e0b\u4e00\u6b21\u8bbf\u95ee\u8fd9\u4e2a\u9875\u9762\u65f6\u4e5f\u4f1a\u5c06\u5b83\u79fb\u52a8\u5230<code>young</code>\u533a\u57df\u5934\u90e8\uff0c\u4f46\u8fd9\u4e2a\u8fc7\u7a0b\u5e76\u4e0d\u4f1a\u5bfc\u81f4<code>Pages made young</code>\u7684\u503c\u52a01\u3002</p> <ul> <li><code>Page made not young</code>\uff1a\u5728\u5c06<code>innodb_old_blocks_time</code>\u8bbe\u7f6e\u7684\u503c\u5927\u4e8e0\u65f6\uff0c\u9996\u6b21\u8bbf\u95ee\u6216\u8005\u540e\u7eed\u8bbf\u95ee\u67d0\u4e2a\u5904\u5728<code>old</code>\u533a\u57df\u7684\u8282\u70b9\u65f6\u7531\u4e8e\u4e0d\u7b26\u5408\u65f6\u95f4\u95f4\u9694\u7684\u9650\u5236\u800c\u4e0d\u80fd\u5c06\u5176\u79fb\u52a8\u5230<code>young</code>\u533a\u57df\u5934\u90e8\u65f6\uff0c<code>Page made not young</code>\u7684\u503c\u4f1a\u52a01\u3002</li> </ul> <p>\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\uff0c\u5bf9\u4e8e\u5904\u5728<code>young</code>\u533a\u57df\u7684\u8282\u70b9\uff0c\u5982\u679c\u7531\u4e8e\u5b83\u5728<code>young</code>\u533a\u57df\u76841/4\u5904\u800c\u5bfc\u81f4\u5b83\u6ca1\u6709\u88ab\u79fb\u52a8\u5230<code>young</code>\u533a\u57df\u5934\u90e8\uff0c\u8fd9\u6837\u7684\u8bbf\u95ee\u5e76\u4e0d\u4f1a\u5c06<code>Page made not young</code>\u7684\u503c\u52a01\u3002</p> <ul> <li> <p><code>youngs/s</code>\uff1a\u4ee3\u8868\u6bcf\u79d2\u4ece<code>old</code>\u533a\u57df\u88ab\u79fb\u52a8\u5230<code>young</code>\u533a\u57df\u5934\u90e8\u7684\u8282\u70b9\u6570\u91cf\u3002</p> </li> <li> <p><code>non-youngs/s</code>\uff1a\u4ee3\u8868\u6bcf\u79d2\u7531\u4e8e\u4e0d\u6ee1\u8db3\u65f6\u95f4\u9650\u5236\u800c\u4e0d\u80fd\u4ece<code>old</code>\u533a\u57df\u79fb\u52a8\u5230<code>young</code>\u533a\u57df\u5934\u90e8\u7684\u8282\u70b9\u6570\u91cf\u3002</p> </li> <li> <p><code>Pages read</code>\u3001<code>created</code>\u3001<code>written</code>\uff1a\u4ee3\u8868\u8bfb\u53d6\uff0c\u521b\u5efa\uff0c\u5199\u5165\u4e86\u591a\u5c11\u9875\u3002\u540e\u8fb9\u8ddf\u7740\u8bfb\u53d6\u3001\u521b\u5efa\u3001\u5199\u5165\u7684\u901f\u7387\u3002</p> </li> <li> <p><code>Buffer pool hit rate</code>\uff1a\u8868\u793a\u5728\u8fc7\u53bb\u67d0\u6bb5\u65f6\u95f4\uff0c\u5e73\u5747\u8bbf\u95ee1000\u6b21\u9875\u9762\uff0c\u6709\u591a\u5c11\u6b21\u8be5\u9875\u9762\u5df2\u7ecf\u88ab\u7f13\u5b58\u5230<code>Buffer Pool</code>\u4e86\u3002</p> </li> <li> <p><code>young-making rate</code>\uff1a\u8868\u793a\u5728\u8fc7\u53bb\u67d0\u6bb5\u65f6\u95f4\uff0c\u5e73\u5747\u8bbf\u95ee1000\u6b21\u9875\u9762\uff0c\u6709\u591a\u5c11\u6b21\u8bbf\u95ee\u4f7f\u9875\u9762\u79fb\u52a8\u5230<code>young</code>\u533a\u57df\u7684\u5934\u90e8\u4e86\u3002</p> </li> </ul> <p>\u9700\u8981\u5927\u5bb6\u6ce8\u610f\u7684\u4e00\u70b9\u662f\uff0c\u8fd9\u91cc\u7edf\u8ba1\u7684\u5c06\u9875\u9762\u79fb\u52a8\u5230<code>young</code>\u533a\u57df\u7684\u5934\u90e8\u6b21\u6570\u4e0d\u4ec5\u4ec5\u5305\u542b\u4ece<code>old</code>\u533a\u57df\u79fb\u52a8\u5230<code>young</code>\u533a\u57df\u5934\u90e8\u7684\u6b21\u6570\uff0c\u8fd8\u5305\u62ec\u4ece<code>young</code>\u533a\u57df\u79fb\u52a8\u5230<code>young</code>\u533a\u57df\u5934\u90e8\u7684\u6b21\u6570\uff08\u8bbf\u95ee\u67d0\u4e2a<code>young</code>\u533a\u57df\u7684\u8282\u70b9\uff0c\u53ea\u8981\u8be5\u8282\u70b9\u5728<code>young</code>\u533a\u57df\u76841/4\u5904\u5f80\u540e\uff0c\u5c31\u4f1a\u628a\u5b83\u79fb\u52a8\u5230<code>young</code>\u533a\u57df\u7684\u5934\u90e8\uff09\u3002</p> <ul> <li><code>not (young-making rate)</code>\uff1a\u8868\u793a\u5728\u8fc7\u53bb\u67d0\u6bb5\u65f6\u95f4\uff0c\u5e73\u5747\u8bbf\u95ee1000\u6b21\u9875\u9762\uff0c\u6709\u591a\u5c11\u6b21\u8bbf\u95ee\u6ca1\u6709\u4f7f\u9875\u9762\u79fb\u52a8\u5230<code>young</code>\u533a\u57df\u7684\u5934\u90e8\u3002</li> </ul> <p>\u9700\u8981\u5927\u5bb6\u6ce8\u610f\u7684\u4e00\u70b9\u662f\uff0c\u8fd9\u91cc\u7edf\u8ba1\u7684\u6ca1\u6709\u5c06\u9875\u9762\u79fb\u52a8\u5230<code>young</code>\u533a\u57df\u7684\u5934\u90e8\u6b21\u6570\u4e0d\u4ec5\u4ec5\u5305\u542b\u56e0\u4e3a\u8bbe\u7f6e\u4e86<code>innodb_old_blocks_time</code>\u7cfb\u7edf\u53d8\u91cf\u800c\u5bfc\u81f4\u8bbf\u95ee\u4e86<code>old</code>\u533a\u57df\u4e2d\u7684\u8282\u70b9\u4f46\u6ca1\u628a\u5b83\u4eec\u79fb\u52a8\u5230<code>young</code>\u533a\u57df\u7684\u6b21\u6570\uff0c\u8fd8\u5305\u542b\u56e0\u4e3a\u8be5\u8282\u70b9\u5728<code>young</code>\u533a\u57df\u7684\u524d1/4\u5904\u800c\u6ca1\u6709\u88ab\u79fb\u52a8\u5230<code>young</code>\u533a\u57df\u5934\u90e8\u7684\u6b21\u6570\u3002</p> <ul> <li> <p><code>LRU len</code>\uff1a\u4ee3\u8868<code>LRU\u94fe\u8868</code>\u4e2d\u8282\u70b9\u7684\u6570\u91cf\u3002</p> </li> <li> <p><code>unzip_LRU</code>\uff1a\u4ee3\u8868<code>unzip_LRU\u94fe\u8868</code>\u4e2d\u8282\u70b9\u7684\u6570\u91cf\uff08\u7531\u4e8e\u6211\u4eec\u6ca1\u6709\u5177\u4f53\u5520\u53e8\u8fc7\u8fd9\u4e2a\u94fe\u8868\uff0c\u73b0\u5728\u53ef\u4ee5\u5ffd\u7565\u5b83\u7684\u503c\uff09\u3002</p> </li> <li> <p><code>I/O sum</code>\uff1a\u6700\u8fd150s\u8bfb\u53d6\u78c1\u76d8\u9875\u7684\u603b\u6570\u3002</p> </li> <li> <p><code>I/O cur</code>\uff1a\u73b0\u5728\u6b63\u5728\u8bfb\u53d6\u7684\u78c1\u76d8\u9875\u6570\u91cf\u3002</p> </li> <li> <p><code>I/O unzip sum</code>\uff1a\u6700\u8fd150s\u89e3\u538b\u7684\u9875\u9762\u6570\u91cf\u3002</p> </li> <li> <p><code>I/O unzip cur</code>\uff1a\u6b63\u5728\u89e3\u538b\u7684\u9875\u9762\u6570\u91cf\u3002</p> </li> </ul>"},{"location":"blog/2023/01/04/%E8%B0%83%E8%8A%82%E7%A3%81%E7%9B%98%E5%92%8Ccpu%E7%9A%84%E7%9F%9B%E7%9B%BEinnodb%E7%9A%84buffer-pool/#_6","title":"\u603b\u7ed3","text":"<ol> <li> <p>\u78c1\u76d8\u592a\u6162\uff0c\u7528\u5185\u5b58\u4f5c\u4e3a\u7f13\u5b58\u5f88\u6709\u5fc5\u8981\u3002</p> </li> <li> <p><code>Buffer Pool</code>\u672c\u8d28\u4e0a\u662f<code>InnoDB</code>\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u7684\u4e00\u6bb5\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u53ef\u4ee5\u901a\u8fc7<code>innodb_buffer_pool_size</code>\u6765\u8c03\u6574\u5b83\u7684\u5927\u5c0f\u3002</p> </li> <li> <p><code>Buffer Pool</code>\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u7684\u8fde\u7eed\u5185\u5b58\u7531\u63a7\u5236\u5757\u548c\u7f13\u5b58\u9875\u7ec4\u6210\uff0c\u6bcf\u4e2a\u63a7\u5236\u5757\u548c\u7f13\u5b58\u9875\u90fd\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\uff0c\u5728\u586b\u5145\u8db3\u591f\u591a\u7684\u63a7\u5236\u5757\u548c\u7f13\u5b58\u9875\u7684\u7ec4\u5408\u540e\uff0c<code>Buffer Pool</code>\u5269\u4f59\u7684\u7a7a\u95f4\u53ef\u80fd\u4ea7\u751f\u4e0d\u591f\u586b\u5145\u4e00\u7ec4\u63a7\u5236\u5757\u548c\u7f13\u5b58\u9875\uff0c\u8fd9\u90e8\u5206\u7a7a\u95f4\u4e0d\u80fd\u88ab\u4f7f\u7528\uff0c\u4e5f\u88ab\u79f0\u4e3a<code>\u788e\u7247</code>\u3002</p> </li> <li> <p><code>InnoDB</code>\u4f7f\u7528\u4e86\u8bb8\u591a<code>\u94fe\u8868</code>\u6765\u7ba1\u7406<code>Buffer Pool</code>\u3002</p> </li> <li> <p><code>free\u94fe\u8868</code>\u4e2d\u6bcf\u4e00\u4e2a\u8282\u70b9\u90fd\u4ee3\u8868\u4e00\u4e2a\u7a7a\u95f2\u7684\u7f13\u5b58\u9875\uff0c\u5728\u5c06\u78c1\u76d8\u4e2d\u7684\u9875\u52a0\u8f7d\u5230<code>Buffer Pool</code>\u65f6\uff0c\u4f1a\u4ece<code>free\u94fe\u8868</code>\u4e2d\u5bfb\u627e\u7a7a\u95f2\u7684\u7f13\u5b58\u9875\u3002</p> </li> <li> <p>\u4e3a\u4e86\u5feb\u901f\u5b9a\u4f4d\u67d0\u4e2a\u9875\u662f\u5426\u88ab\u52a0\u8f7d\u5230<code>Buffer Pool</code>\uff0c\u4f7f\u7528<code>\u8868\u7a7a\u95f4\u53f7 + \u9875\u53f7</code>\u4f5c\u4e3a<code>key</code>\uff0c\u7f13\u5b58\u9875\u4f5c\u4e3a<code>value</code>\uff0c\u5efa\u7acb\u54c8\u5e0c\u8868\u3002</p> </li> <li> <p>\u5728<code>Buffer Pool</code>\u4e2d\u88ab\u4fee\u6539\u7684\u9875\u79f0\u4e3a<code>\u810f\u9875</code>\uff0c\u810f\u9875\u5e76\u4e0d\u662f\u7acb\u5373\u5237\u65b0\uff0c\u800c\u662f\u88ab\u52a0\u5165\u5230<code>flush\u94fe\u8868</code>\u4e2d\uff0c\u5f85\u4e4b\u540e\u7684\u67d0\u4e2a\u65f6\u523b\u540c\u6b65\u5230\u78c1\u76d8\u4e0a\u3002</p> </li> <li> <p><code>LRU\u94fe\u8868</code>\u5206\u4e3a<code>young</code>\u548c<code>old</code>\u4e24\u4e2a\u533a\u57df\uff0c\u53ef\u4ee5\u901a\u8fc7<code>innodb_old_blocks_pct</code>\u6765\u8c03\u8282<code>old</code>\u533a\u57df\u6240\u5360\u7684\u6bd4\u4f8b\u3002\u9996\u6b21\u4ece\u78c1\u76d8\u4e0a\u52a0\u8f7d\u5230<code>Buffer Pool</code>\u7684\u9875\u4f1a\u88ab\u653e\u5230<code>old</code>\u533a\u57df\u7684\u5934\u90e8\uff0c\u5728<code>innodb_old_blocks_time</code>\u95f4\u9694\u65f6\u95f4\u5185\u8bbf\u95ee\u8be5\u9875\u4e0d\u4f1a\u628a\u5b83\u79fb\u52a8\u5230<code>young</code>\u533a\u57df\u5934\u90e8\u3002\u5728<code>Buffer Pool</code>\u6ca1\u6709\u53ef\u7528\u7684\u7a7a\u95f2\u7f13\u5b58\u9875\u65f6\uff0c\u4f1a\u9996\u5148\u6dd8\u6c70\u6389<code>old</code>\u533a\u57df\u7684\u4e00\u4e9b\u9875\u3002</p> </li> <li> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a<code>innodb_buffer_pool_instances</code>\u6765\u63a7\u5236<code>Buffer Pool</code>\u5b9e\u4f8b\u7684\u4e2a\u6570\uff0c\u6bcf\u4e2a<code>Buffer Pool</code>\u5b9e\u4f8b\u4e2d\u90fd\u6709\u5404\u81ea\u72ec\u7acb\u7684\u94fe\u8868\uff0c\u4e92\u4e0d\u5e72\u6270\u3002</p> </li> <li> <p>\u81ea<code>MySQL 5.7.5</code>\u7248\u672c\u4e4b\u540e\uff0c\u53ef\u4ee5\u5728\u670d\u52a1\u5668\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u8c03\u6574<code>Buffer Pool</code>\u5927\u5c0f\u3002\u6bcf\u4e2a<code>Buffer Pool</code>\u5b9e\u4f8b\u7531\u82e5\u5e72\u4e2a<code>chunk</code>\u7ec4\u6210\uff0c\u6bcf\u4e2a<code>chunk</code>\u7684\u5927\u5c0f\u53ef\u4ee5\u5728\u670d\u52a1\u5668\u542f\u52a8\u65f6\u901a\u8fc7\u542f\u52a8\u53c2\u6570\u8c03\u6574\u3002</p> </li> <li> <p>\u53ef\u4ee5\u7528\u4e0b\u8fb9\u7684\u547d\u4ee4\u67e5\u770b<code>Buffer Pool</code>\u7684\u72b6\u6001\u4fe1\u606f\uff1a</p> <pre><code>sql\n\u590d\u5236\u4ee3\u7801SHOW ENGINE INNODB STATUS\\G\n</code></pre> </li> </ol>"},{"location":"blog/2023/10/18/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/","title":"Linux\u5e38\u7528\u547d\u4ee4\u8bb0\u5f55","text":""},{"location":"blog/2023/10/18/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/#linux","title":"Linux\u5e38\u7528\u547d\u4ee4\u8bb0\u5f55","text":""},{"location":"blog/2023/10/18/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/#sed","title":"\u4e00\u3001sed\u547d\u4ee4","text":"<pre><code># \u5bf9\u6bcf\u884c\u5339\u914d\u5230\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e32\u8fdb\u884c\u66ff\u6362\nsed -i 's/\u539f\u5b57\u7b26\u4e32/\u65b0\u5b57\u7b26\u4e32/' ab.txt \n\n# \u5bf9\u5168\u5c40\u5339\u914d\u4e0a\u7684\u6240\u6709\u5b57\u7b26\u4e32\u8fdb\u884c\u66ff\u6362\nsed -i 's/\u539f\u5b57\u7b26\u4e32/\u65b0\u5b57\u7b26\u4e32/g' ab.txt \n\n# \u5220\u9664\u6240\u6709\u5339\u914d\u5230\u5b57\u7b26\u4e32\u7684\u884c\nsed -i '/\u5339\u914d\u5b57\u7b26\u4e32/d'  ab.txt  \n\n# \u7279\u5b9a\u5b57\u7b26\u4e32\u7684\u884c\u540e\u63d2\u5165\u65b0\u884c\nsed -i '/\u7279\u5b9a\u5b57\u7b26\u4e32/a \u65b0\u884c\u5b57\u7b26\u4e32' ab.txt \n\n# \u7279\u5b9a\u5b57\u7b26\u4e32\u7684\u884c\u524d\u63d2\u5165\u65b0\u884c\nsed -i '/\u7279\u5b9a\u5b57\u7b26\u4e32/i \u65b0\u884c\u5b57\u7b26\u4e32' ab.txt\n\n# \u628a\u5339\u914d\u884c\u4e2d\u7684\u67d0\u4e2a\u5b57\u7b26\u4e32\u66ff\u6362\u4e3a\u76ee\u6807\u5b57\u7b26\u4e32\nsed -i '/\u5339\u914d\u5b57\u7b26\u4e32/s/\u6e90\u5b57\u7b26\u4e32/\u76ee\u6807\u5b57\u7b26\u4e32/g' ab.txt\n\n# \u5728\u6587\u4ef6ab.txt\u4e2d\u7684\u672b\u884c\u4e4b\u540e\uff0c\u6dfb\u52a0bye\nsed -i '$a bye' ab.txt   \n\n# \u5bf9\u4e8e\u6587\u4ef6\u7b2c3\u884c\uff0c\u628a\u5339\u914d\u4e0a\u7684\u6240\u6709\u5b57\u7b26\u4e32\u8fdb\u884c\u66ff\u6362\nsed -i '3s/\u539f\u5b57\u7b26\u4e32/\u65b0\u5b57\u7b26\u4e32/g' ab.txt \n</code></pre>"},{"location":"git/Git%E4%BA%A4%E4%BA%92%E5%BC%8F%E6%9A%82%E5%AD%98/","title":"Git\u4ea4\u4e92\u5f0f\u6682\u5b58","text":"<p>\u5f53\u60a8\u770b\u5230\u8fd9\u7bc7\u6587\u7ae0\u7684\u65f6\u5019\uff0c\u9996\u5148\u9700\u8981\u53cd\u601d\u4e0b\u662f\u51fa\u4e8e\u4ec0\u4e48\u6837\u7684\u76ee\u7684\u3002\u5982\u679c\u662f\u51fa\u4e8e\u5b66\u4e60\u3001\u4e86\u89e3\u7684\u76ee\u7684\uff0c\u90a3\u4e48\u8fd9\u975e\u5e38\u597d\u3002\u5982\u679c\u662f\u7531\u4e8e\u60a8\u5de5\u4f5c\u4e2d\u7ecf\u5e38\u6709\u5927\u91cf\u53d8\u66f4\u6587\u4ef6\u60f3\u8981\u62c6\u5206\u4e3a\u591a\u6b21\u63d0\u4ea4\u800c\u4e0d\u662f\u6df7\u6742\u4e3a\u4e00\u6b21\u63d0\u4ea4\uff0c\u90a3\u4e48\u60a8\u7684Git\u4f7f\u7528\u4e60\u60ef\u5c31\u4e0d\u662f\u5f88\u597d\u3002\u5f53\u7136\u4e8b\u65e0\u7edd\u5bf9\uff0c\u5c31\u6709\u4eba\u559c\u6b22\u8fd9\u79cd\u64cd\u4f5c\u65b9\u5f0f\uff0c\u6bd4\u5982\u6211\u7684\u67d0\u4f4d\u540c\u4e8b\u3002\u56fa\u7136\u4ed6\u89c9\u5f97\u8fd9\u5f88\u6709\u903c\u683c\uff0c\u4f46\u662f\u8fd9\u5728\u672c\u5c31\u6c89\u91cd\u7684\u5de5\u4f5c\u4e2d\uff0c\u53c8\u589e\u52a0\u4e86\u4e00\u4e9b\u8d1f\u62c5\uff0c\u90a3\u5fc5\u7136\u4e5f\u5c06\u4f34\u968f\u7740\u5176\u4ed6\u98ce\u9669\uff1a</p> <p></p>"},{"location":"git/Git%E4%BA%A4%E4%BA%92%E5%BC%8F%E6%9A%82%E5%AD%98/#_1","title":"\u4e00\u3001\u547d\u4ee4\u7b80\u4ecb","text":"<p>Git\u4ea4\u4e92\u5f0f\u6682\u5b58\u4f7f\u6211\u4eec\u53ef\u4ee5\u6309\u7167\u81ea\u5df1\u7684\u610f\u613f\u9009\u62e9\u4e00\u4e2a\u6216\u591a\u4e2a\u53d8\u66f4\u6587\u4ef6\uff0c\u751a\u81f3\u662f\u4e00\u4e2a\u6587\u4ef6\u4e2d\u7684\u90e8\u5206\u53d8\u66f4\u5185\u5bb9\uff0c\u5c06\u90a3\u4e9b\u76f8\u5173\u7684\u5185\u5bb9\u6dfb\u52a0\u5230\u6682\u5b58\u533a\uff0c\u4ee5\u4fbf\u5f62\u6210\u4e00\u6b21\u63d0\u4ea4\u3002</p> <p>\u6267\u884c\u547d\u4ee4<code>git add -i</code>\u65f6\uff0cGit\u8fdb\u5165\u5982\u4e0b\u4ea4\u4e92\u754c\u9762\uff0c\u4ee5\u4e2d\u95f4\u7a7a\u884c\u4e3a\u5206\u754c\uff0c\u6211\u5c06\u5176\u5206\u4e3a\u4e0a\u4e0b\u4e24\u90e8\u5206\uff0c\u4e0a\u90e8\u5206\u4e3a\u5de5\u4f5c\u76ee\u5f55\u4e2d\u7684\u53d8\u66f4\u6587\u4ef6\uff0c\u4f46\u4e0d\u5305\u62ec\u65b0\u589e\u7684\u6587\u4ef6\u3002\u4e0b\u90e8\u5206\u4e3aGit\u4ea4\u4e92\u5f0f\u6682\u5b58\u652f\u6301\u7684\u547d\u4ee4\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u51718\u79cd\uff0c\u800c<code>What now&gt;</code>\u540e\u8f93\u5165\u547d\u4ee4\u5bf9\u5e94\u7684\u7f16\u53f7\u540e\u56de\u8f66\u5373\u53ef\u6267\u884c\u8be5\u547d\u4ee4\u3002</p> <pre><code>frost2@frost2-pc MINGW64 /e/Frost2-Files/IdeaWorkSpace/gitdemo/add-demo (master)\n$ git add -i\n           staged     unstaged path\n  1:    unchanged        +1/-1 feature\n  2:    unchanged        +1/-1 name\n  3:    unchanged        +8/-6 sitemap.json\n\n*** Commands ***\n  1: status       2: update       3: revert       4: add untracked\n  5: patch        6: diff         7: quit         8: help\nWhat now&gt;\n</code></pre> <p>\u4f8b\u5982\u8f93\u51658\u540e\u56de\u8f66\uff0c\u51fa\u73b0\u5982\u4e0b\u63d0\u793a\uff1a</p> <pre><code>frost2@frost2-pc MINGW64 /e/Frost2-Files/IdeaWorkSpace/gitdemo/add-demo (master)\n$ git add -i\n           staged     unstaged path\n  1:    unchanged        +1/-1 feature\n  2:    unchanged        +1/-1 name\n  3:    unchanged        +8/-6 sitemap.json\n\n*** Commands ***\n  1: status       2: update       3: revert       4: add untracked\n  5: patch        6: diff         7: quit         8: help\nWhat now&gt; 8\nstatus        - show paths with changes\nupdate        - add working tree state to the staged set of changes\nrevert        - revert staged set of changes back to the HEAD version\npatch         - pick hunks and update selectively\ndiff          - view diff between HEAD and index\nadd untracked - add contents of untracked files to the staged set of changes\n*** Commands ***\n  1: status       2: update       3: revert       4: add untracked\n  5: patch        6: diff         7: quit         8: help\nWhat now&gt;\n</code></pre> <p>\u547d\u4ee4<code>help</code>\u4f1a\u7ed9\u51fa\u547d\u4ee4\u7684\u7b80\u4ecb\u4fe1\u606f\uff1a</p> \u547d\u4ee4 \u8bf4\u660e status \u67e5\u770b\u53d1\u751f\u4e86\u53d8\u66f4\u7684\u6587\u4ef6 update \u9009\u62e9\u53d8\u66f4\u6587\u4ef6\u5c06\u53d8\u4ed6\u4eec\u6dfb\u52a0\u5230\u6682\u5b58\u533a revert \u5c06\u5df2\u6dfb\u52a0\u7684\u6682\u5b58\u533a\u7684\u6587\u4ef6\u56de\u9000\u5230modified\u72b6\u6001 add untracked \u9009\u62e9Git\u672a\u8ddf\u8e2a\u7684\u6587\u4ef6\uff0c\u6dfb\u52a0\u5230\u6682\u5b58\u533a patch diff \u67e5\u770b\u6682\u5b58\u533a\u7684\u6587\u4ef6\u53d8\u66f4\u5185\u5bb9 quit \u9000\u51faGit\u4ea4\u4e92\u5f0f\u6682\u5b58 help \u5e2e\u52a9\u547d\u4ee4"},{"location":"git/Git%E4%BA%A4%E4%BA%92%E5%BC%8F%E6%9A%82%E5%AD%98/#update","title":"\u4e8c\u3001update","text":"<p>\u8f93\u5165\u5e8f\u53f72\u6267\u884c\u547d\u4ee4update\uff0c\u9009\u62e9\u9700\u8981\u6dfb\u52a0\u5230\u6682\u5b58\u533a\u7684\u6587\u4ef6\uff0c\u5b8c\u6574\u64cd\u4f5c\u5982\u4e0b\u6240\u793a\u3002\u5f53\u6211\u4eec\u8f93\u51652\u56de\u8f66\u540e\uff0c\u63d0\u793a\u7531<code>What now</code>\u53d8\u4e3a<code>Update</code>\uff0c\u5728update\u540e\u8f93\u5165\u6211\u4eec\u60f3\u8981\u6dfb\u52a0\u5230\u6682\u5b58\u533a\u7684\u6587\u4ef6\u5e8f\u53f7\uff0c\u591a\u4e2a\u6587\u4ef6\u7528\u9017\u53f7\u9694\u5f00\uff0c\u4e5f\u53ef\u7528<code>1-3</code>\u8fd9\u79cd\u683c\u5f0f\u6765\u9009\u62e9\u8fd9\u4e2a\u5e8f\u53f7\u8303\u56f4\u7684\u6587\u4ef6\u3002\u9009\u62e9\u5b8c\u6210\u540e\u56de\u8f66\u53ef\u4ee5\u770b\u5230\u88ab\u9009\u62e9\u7684\u6587\u4ef6\u524d\u4f1a\u51fa\u73b0<code>*</code>,\u6b64\u65f6\u4e0d\u7528\u8f93\u5165\u76f4\u63a5\u56de\u8f66\u5373\u53ef\u5c06\u9009\u4e2d\u7684\u6587\u4ef6\u6dfb\u52a0\u5230\u6682\u5b58\u533a\u3002</p> <pre><code>frost2@frost2-pc MINGW64 /e/Frost2-Files/IdeaWorkSpace/gitdemo/add-demo (master)\n$ git add -i\n           staged     unstaged path\n  1:    unchanged        +1/-1 feature\n  2:    unchanged        +1/-1 name\n  3:    unchanged        +8/-6 sitemap.json\n\n*** Commands ***\n  1: status       2: update       3: revert       4: add untracked\n  5: patch        6: diff         7: quit         8: help\nWhat now&gt; 2\n           staged     unstaged path\n  1:    unchanged        +1/-1 feature\n  2:    unchanged        +1/-1 name\n  3:    unchanged        +8/-6 sitemap.json\nUpdate&gt;&gt; 1,2\n           staged     unstaged path\n* 1:    unchanged        +1/-1 feature\n* 2:    unchanged        +1/-1 name\n  3:    unchanged        +8/-6 sitemap.json\nUpdate&gt;&gt;\nupdated 2 paths\n\n*** Commands ***\n  1: status       2: update       3: revert       4: add untracked\n  5: patch        6: diff         7: quit         8: help\nWhat now&gt;\n</code></pre>"},{"location":"git/Git%E4%BA%A4%E4%BA%92%E5%BC%8F%E6%9A%82%E5%AD%98/#revert","title":"\u4e09\u3001revert","text":"<p>\u4e0a\u4e00\u6b65\u5c06\u6587\u4ef6<code>name</code>\u548c<code>feature</code>\u6dfb\u52a0\u5230\u4e86\u6682\u5b58\u533a\uff0c\u8f93\u51651\u67e5\u770b\u72b6\u6001\u5982\u4e0b\u6240\u793a\u3002</p> <p>\u6b64\u65f6\u5982\u679c\u60f3\u8981\u5c06\u6dfb\u52a0\u5230\u6682\u5b58\u533a\u7684\u6587\u4ef6\u56de\u9000\uff0c\u53ef\u4ee5\u5728<code>What now</code>\u8f93\u51653\uff0c\u63d0\u793a\u53d8\u4e3a<code>Revert</code>,\u540c\u6837\u8f93\u5165\u5e8f\u53f7\u9009\u62e9\u60f3\u8981\u56de\u9000\u7684\u6587\u4ef6\uff0c\u5982\u679c\u9009\u62e9\u4e86\u6ca1\u6709\u6dfb\u52a0\u5230\u6682\u5b58\u533a\u7684\u6587\u4ef6\uff0c\u4f8b\u5982\u672c\u4f8b\u4e2d\u7684\u6587\u4ef6<code>sitemap.json</code>\uff0c\u90a3\u4e48\u8be5\u6587\u4ef6\u4e0d\u4f1a\u6709\u4efb\u52a1\u53d8\u5316\uff0c\u53e6\u5916\u4e24\u4e2a\u6587\u4ef6\u6210\u529f\u9000\u56demodified\u72b6\u6001\u3002</p> <pre><code>*** Commands ***\n  1: status       2: update       3: revert       4: add untracked\n  5: patch        6: diff         7: quit         8: help\nWhat now&gt; 1\nwarning: LF will be replaced by CRLF in sitemap.json.\nThe file will have its original line endings in your working directory\n           staged     unstaged path\n  1:        +1/-1      nothing feature\n  2:        +1/-1      nothing name\n  3:    unchanged        +8/-6 sitemap.json\n\n*** Commands ***\n  1: status       2: update       3: revert       4: add untracked\n  5: patch        6: diff         7: quit         8: help\nWhat now&gt; 3\nwarning: LF will be replaced by CRLF in sitemap.json.\nThe file will have its original line endings in your working directory\n           staged     unstaged path\n  1:        +1/-1      nothing feature\n  2:        +1/-1      nothing name\n  3:    unchanged        +8/-6 sitemap.json\nRevert&gt;&gt; 1,2,3\n           staged     unstaged path\n* 1:        +1/-1      nothing feature\n* 2:        +1/-1      nothing name\n* 3:    unchanged        +8/-6 sitemap.json\nRevert&gt;&gt;\nreverted 3 paths\n</code></pre>"},{"location":"git/Git%E4%BA%A4%E4%BA%92%E5%BC%8F%E6%9A%82%E5%AD%98/#add-untracked","title":"\u56db\u3001add untracked","text":"<p>\u7531\u4e8e\u4e0a\u4e00\u6b65\u4e2d\u5c06\u6682\u5b58\u533a\u7684\u6587\u4ef6\u90fd\u56de\u9000\u4e86\uff0c\u6545\u76ee\u524d<code>git status</code>\u72b6\u6001\u5982\u4e0b\uff1a</p> <pre><code>frost2@frost2-pc MINGW64 /e/Frost2-Files/IdeaWorkSpace/gitdemo/add-demo (master)\n$ git status\nOn branch master\nChanges not staged for commit:\n  (use \"git add &lt;file&gt;...\" to update what will be committed)\n  (use \"git checkout -- &lt;file&gt;...\" to discard changes in working directory)\n\n        modified:   feature\n        modified:   name\n        modified:   sitemap.json\n\nUntracked files:\n  (use \"git add &lt;file&gt;...\" to include in what will be committed)\n\n        newfile\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u76ee\u524d\u5de5\u4f5c\u76ee\u5f55\u4e2d\u6709\u4e00\u4e2a\u65b0\u6dfb\u52a0\u7684\u6587\u4ef6<code>newfile</code>\uff0c\u4f46\u662fGit\u4ea4\u4e92\u5f0f\u6682\u5b58\u4e2dstatus\u4e0d\u4f1a\u663e\u793a\u4e3a\u8ddf\u8e2a\u7684\u6587\u4ef6\uff0c\u5982\u679c\u9700\u8981\u5c06\u5b83\u6dfb\u52a0\u5230\u6682\u5b58\u533a\uff0c\u9700\u8981\u901a\u8fc7\u547d\u4ee4<code>add untracked</code>\uff0c\u5177\u4f53\u6b65\u9aa4\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>*** Commands ***\n  1: status       2: update       3: revert       4: add untracked\n  5: patch        6: diff         7: quit         8: help\nWhat now&gt; 4\n  1: newfile\nAdd untracked&gt;&gt; 1\n* 1: newfile\nAdd untracked&gt;&gt;\nwarning: LF will be replaced by CRLF in newfile.\nThe file will have its original line endings in your working directory\nadded 1 path\n\n*** Commands ***\n  1: status       2: update       3: revert       4: add untracked\n  5: patch        6: diff         7: quit         8: help\nWhat now&gt; 1\n           staged     unstaged path\n  1:    unchanged        +1/-1 feature\n  2:    unchanged        +1/-1 name\n  3:        +1/-0      nothing newfile\n  4:    unchanged        +8/-6 sitemap.json\n\n*** Commands ***\n  1: status       2: update       3: revert       4: add untracked\n  5: patch        6: diff         7: quit         8: help\nWhat now&gt;\n</code></pre>"},{"location":"git/Git%E4%BA%A4%E4%BA%92%E5%BC%8F%E6%9A%82%E5%AD%98/#patch","title":"\u4e94\u3001patch","text":"<p>\u901a\u8fc7patch\u547d\u4ee4\u6211\u4eec\u53ef\u4ee5\u5c06\u6587\u4ef6\u4e2d\u7684\u4fee\u6539\u5185\u5bb9\u5206\u6210\u4e0d\u7528\u5757\uff0c\u7136\u540e\u9009\u62e9\u5176\u4e2d\u4e00\u4e2a\u6216\u591a\u4e2a\u5757\u5c06\u4ed6\u4eec\u6dfb\u52a0\u5230\u6682\u5b58\u533a\uff0c\u9996\u5148\u8f93\u51655\uff0c\u9009\u62e9\u5bf9\u5e94\u7684\u6587\u4ef6\u540e\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>*** Commands ***\n  1: status       2: update       3: revert       4: add untracked\n  5: patch        6: diff         7: quit         8: help\nWhat now&gt; 5\n           staged     unstaged path\n  1:    unchanged        +1/-1 feature\n  2:    unchanged        +1/-1 name\n  3:    unchanged        +3/-2 suggest.json\nPatch update&gt;&gt; 3\n           staged     unstaged path\n  1:    unchanged        +1/-1 feature\n  2:    unchanged        +1/-1 name\n* 3:    unchanged        +3/-2 suggest.json\nPatch update&gt;&gt;\ndiff --git a/suggest.json b/suggest.json\nindex 3caab45..4ba5661 100644\n--- a/suggest.json\n+++ b/suggest.json\n@@ -1,9 +1,10 @@\n {\n   \"desc\": \"Git\u4e66\u7c4d\u63a8\u8350\",\n-  \"book\": \"Pro Git\",\n+  \"book_name\": \"Pro Git\",\n   \"book_url\": \"https://git-scm.com/book/zh/v2\",\n   \"suggest\": \"git\u521d\u5b66\u8005\u5b9e\u4e0d\u5efa\u8bae\u770b\u5404\u79cd\u535a\u5ba2\u3001\u7f51\u7ad9\uff0cGit\u5b98\u7f51\u4e66\u7c4d\u300aPro Git\u300b\u5b89\u5fc3\u8bfb\u4e00\u904d\u8db3\u77e3\"\n },\n {\n-  \"author\": \"frost2\"\n+  \"author\": \"frost2\",\n+  \"date\": \"2021-12-30\"\n }\nStage this hunk [y,n,q,a,d,s,e,?]?\n</code></pre> <p>\u6b64\u65f6\u63d0\u793a\u7684<code>[y,n,q,a,d,s,e,?]</code>\u4e3a\u76ee\u524d\u652f\u6301\u7684\u547d\u4ee4\uff0c\u8f93\u5165<code>?</code>\u53ef\u4ee5\u5c55\u793a\u8fd9\u4e9b\u547d\u4ee4\u7684\u8bf4\u660e\u3002\u5982\u4e0b\u6240\u793a</p> <pre><code>Stage this hunk [y,n,q,a,d,s,e,?]? ?\ny - stage this hunk\nn - do not stage this hunk\nq - quit; do not stage this hunk or any of the remaining ones\na - stage this hunk and all later hunks in the file\nd - do not stage this hunk or any of the later hunks in the file\ns - split the current hunk into smaller hunks\ne - manually edit the current hunk\n? - print help\n@@ -1,9 +1,10 @@\n {\n   \"desc\": \"Git\u4e66\u7c4d\u63a8\u8350\",\n-  \"book\": \"Pro Git\",\n+  \"book_name\": \"Pro Git\",\n   \"book_url\": \"https://git-scm.com/book/zh/v2\",\n   \"suggest\": \"git\u521d\u5b66\u8005\u5b9e\u4e0d\u5efa\u8bae\u770b\u5404\u79cd\u535a\u5ba2\u3001\u7f51\u7ad9\uff0cGit\u5b98\u7f51\u4e66\u7c4d\u300aPro Git\u300b\u5b89\u5fc3\u8bfb\u4e00\u904d\u8db3\u77e3\"\n },\n {\n-  \"author\": \"frost2\"\n+  \"author\": \"frost2\",\n+  \"date\": \"2021-12-30\"\n }\nStage this hunk [y,n,q,a,d,s,e,?]?\n</code></pre> <p>\u6b64\u65f6\u8f93\u5165<code>s</code>\uff0cGit\u4f1a\u5c06\u4fee\u6539\u5185\u5bb9\u5206\u5757\uff0c\u5982\u4e0b\u6240\u793a\u4f1a\u663e\u793a\u7b2c\u4e00\u5757\u53d8\u66f4\u5185\u5bb9\uff0c\u901a\u8fc7<code>y</code>\u548c<code>n</code>\u53ef\u4ee5\u9009\u62e9\u6dfb\u52a0\u6216\u8005\u4e0d\u6dfb\u52a0\u5230\u6682\u5b58\u533a\uff0c\u672c\u4f8b\u4e2d\u6211\u4eec\u5c06\u7b2c\u4e00\u5757\u53d8\u66f4\u6dfb\u52a0\u5230\u6682\u5b58\u533a\uff0c\u6dfb\u52a0\u540e\u4f1a\u8c03\u5230\u4e0b\u4e00\u5757\u5185\u5bb9\uff0c\u518d\u9009\u62e9<code>n</code>\u4e0d\u6dfb\u52a0\u7b2c\u4e8c\u5757\u5185\u5bb9\u5230\u6682\u5b58\u533a\uff0c\u5177\u4f53\u64cd\u4f5c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>Stage this hunk [y,n,q,a,d,s,e,?]? s\nSplit into 2 hunks.\n@@ -1,7 +1,7 @@\n {\n   \"desc\": \"Git\u4e66\u7c4d\u63a8\u8350\",\n-  \"book\": \"Pro Git\",\n+  \"book_name\": \"Pro Git\",\n   \"book_url\": \"https://git-scm.com/book/zh/v2\",\n   \"suggest\": \"git\u521d\u5b66\u8005\u5b9e\u4e0d\u5efa\u8bae\u770b\u5404\u79cd\u535a\u5ba2\u3001\u7f51\u7ad9\uff0cGit\u5b98\u7f51\u4e66\u7c4d\u300aPro Git\u300b\u5b89\u5fc3\u8bfb\u4e00\u904d\u8db3\u77e3\"\n },\n {\nStage this hunk [y,n,q,a,d,j,J,g,/,e,?]? y\n@@ -4,6 +4,7 @@\n   \"book_url\": \"https://git-scm.com/book/zh/v2\",\n   \"suggest\": \"git\u521d\u5b66\u8005\u5b9e\u4e0d\u5efa\u8bae\u770b\u5404\u79cd\u535a\u5ba2\u3001\u7f51\u7ad9\uff0cGit\u5b98\u7f51\u4e66\u7c4d\u300aPro Git\u300b\u5b89\u5fc3\u8bfb\u4e00\u904d\u8db3\u77e3\"\n },\n {\n-  \"author\": \"frost2\"\n+  \"author\": \"frost2\",\n+  \"date\": \"2021-12-30\"\n }\nStage this hunk [y,n,q,a,d,K,g,/,e,?]? n\n\n*** Commands ***\n  1: status       2: update       3: revert       4: add untracked\n  5: patch        6: diff         7: quit         8: help\nWhat now&gt; 1\nwarning: LF will be replaced by CRLF in feature.\nThe file will have its original line endings in your working directory\nwarning: LF will be replaced by CRLF in name.\nThe file will have its original line endings in your working directory\nwarning: LF will be replaced by CRLF in suggest.json.\nThe file will have its original line endings in your working directory\n           staged     unstaged path\n  1:    unchanged        +1/-1 feature\n  2:    unchanged        +1/-1 name\n  3:        +1/-0      nothing newfile\n  4:        +1/-1        +2/-1 suggest.json\n\n*** Commands ***\n  1: status       2: update       3: revert       4: add untracked\n  5: patch        6: diff         7: quit         8: help\nWhat now&gt;\n</code></pre>"},{"location":"git/Git%E4%BA%A4%E4%BA%92%E5%BC%8F%E6%9A%82%E5%AD%98/#diff","title":"\u516d\u3001diff","text":"<p>\u547d\u4ee4<code>diff</code>\u53ef\u4ee5\u67e5\u770b\u6dfb\u52a0\u5230\u6682\u5b58\u533a\u6587\u4ef6\u7684\u53d8\u66f4\uff0c\u4e0a\u4e00\u6b65\u6211\u4eec\u5c06<code>suggest.json</code>\u7684\u7b2c\u4e00\u5757\u53d8\u66f4\u6dfb\u52a0\u5230\u4e86\u6682\u5b58\u533a\uff0c\u6b63\u597d\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4<code>diff</code>\u9a8c\u8bc1\u4e00\u4e0b\u3002</p> <pre><code>What now&gt; 6\nwarning: LF will be replaced by CRLF in feature.\nThe file will have its original line endings in your working directory\nwarning: LF will be replaced by CRLF in name.\nThe file will have its original line endings in your working directory\nwarning: LF will be replaced by CRLF in suggest.json.\nThe file will have its original line endings in your working directory\n           staged     unstaged path\n  1:        +1/-0      nothing newfile\n  2:        +1/-1        +2/-1 suggest.json\nReview diff&gt;&gt; 2\ndiff --git a/suggest.json b/suggest.json\nindex 3caab45..39fe4a5 100644\n--- a/suggest.json\n+++ b/suggest.json\n@@ -1,6 +1,6 @@\n {\n   \"desc\": \"Git\u4e66\u7c4d\u63a8\u8350\",\n-  \"book\": \"Pro Git\",\n+  \"book_name\": \"Pro Git\",\n   \"book_url\": \"https://git-scm.com/book/zh/v2\",\n   \"suggest\": \"git\u521d\u5b66\u8005\u5b9e\u4e0d\u5efa\u8bae\u770b\u5404\u79cd\u535a\u5ba2\u3001\u7f51\u7ad9\uff0cGit\u5b98\u7f51\u4e66\u7c4d\u300aPro Git\u300b\u5b89\u5fc3\u8bfb\u4e00\u904d\u8db3\u77e3\"\n },\n*** Commands ***\n  1: status       2: update       3: revert       4: add untracked\n  5: patch        6: diff         7: quit         8: help\nWhat now&gt;\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6682\u5b58\u533a\u4e2d\u7684\u6587\u4ef6<code>suggest.json</code>\u7684\u53d8\u66f4\u786e\u4e3a\u6211\u4eec\u6dfb\u52a0\u7684\u7b2c\u4e00\u5757\u5185\u5bb9\uff0c\u8f93\u5165<code>7</code>\u9000\u51faGit\u4ea4\u4e92\u5f0f\u6682\u5b58\uff0c\u6267\u884c<code>git status</code>\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>frost2@frost2-pc MINGW64 /e/Frost2-Files/IdeaWorkSpace/gitdemo/add-demo (master)\n$ git status\nOn branch master\nChanges to be committed:\n  (use \"git reset HEAD &lt;file&gt;...\" to unstage)\n\n        new file:   newfile\n        modified:   suggest.json\n\nChanges not staged for commit:\n  (use \"git add &lt;file&gt;...\" to update what will be committed)\n  (use \"git checkout -- &lt;file&gt;...\" to discard changes in working directory)\n\n        modified:   feature\n        modified:   name\n        modified:   suggest.json\n</code></pre> <p>\u73b0\u5047\u8bbe\u76ee\u524d\u6682\u5b58\u533a\u5c31\u662f\u6211\u4eec\u60f3\u8981\u7684\u4e00\u6b21\u63d0\u4ea4\uff0c\u6b64\u65f6\u5c31\u53ef\u4ee5\u6267\u884c<code>git commit</code>\u547d\u4ee4\u751f\u6210\u4e00\u6b21\u63d0\u4ea4\u3002</p>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/","title":"Git\u77e5\u8bc6\u603b\u7ed3","text":""},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#git_1","title":"\u4e00\u3001Git\u5e38\u7528\u547d\u4ee4","text":""},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#1","title":"1\u3001\u5217\u8868","text":"\u547d\u4ee4 \u8bf4\u660e <code>git checkout -B localBranchName origin/remoteBranchName</code> \u65b0\u5efa\u8fdc\u7a0b\u5206\u652f\u5bf9\u5e94\u7684\u672c\u5730\u5206\u652f <code>git branch -a | grep feature</code> \u67e5\u770b\u5206\u652f\u540d\u79f0\u5305\u62ecfeature\u7684\u5206\u652f <code>git branch | xargs git branch -D</code> \u5220\u9664\u51fa\u5f53\u524d\u5206\u652f\u5916\u7684\u5176\u4ed6\u672c\u5730\u5206\u652f <code>git branch --set-upstream-to=origin/&lt;branch&gt; &lt;localbranch&gt;</code> \u8bbe\u7f6e\u5206\u652flocalbranch\u8ddf\u8e2a\u8fdc\u7a0b\u5206\u652fbranch <code>git push --set-upstream origin master</code> \u672c\u5730\u5206\u652f\u9996\u6b21\u63a8\u9001\u5230\u8fdc\u7a0b\u4ed3\u5e93 <code>git checkout -b temp &lt;commit id&gt;</code> \u6839\u636ecommit id\u521b\u5efatemp\u5206\u652f"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#2","title":"2\u3001\u4e2a\u4eba\u8bb0\u5f55","text":"<pre><code>git checkout -B localBranchName origin/remoteBranchName\n\u8be5\u547d\u4ee4\u53ef\u4ee5\u5206\u6210\u4e09\u6b65\n1:\u521b\u5efa\u5206\u652f\ngit branch localBranchName\n2:\u5207\u6362\u5206\u652f\ngit checkout localBranchName\n3:\u8bbe\u7f6e\u672c\u5730\u5206\u652f\u8ddf\u8e2a\u8fdc\u7a0b\u5206\u652f\ngit branch --set-upstream-to=origin/remoteBranchName localBranchName\n</code></pre>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#git_2","title":"\u4e8c\u3001Git\u57fa\u672c\u77e5\u8bc6","text":""},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#1githubssh","title":"1\u3001GitHub\u6dfb\u52a0SSH\u516c\u94a5","text":"<p>\u6267\u884c\u547d\u4ee4<code>ssh-keygen</code>\u751f\u6210\u516c\u94a5</p> <pre><code>$ ssh-keygen\nGenerating public/private rsa key pair.\nEnter file in which to save the key (/c/Users/frost2/.ssh/id_rsa):\n/c/Users/frost2/.ssh/id_rsa already exists.\nOverwrite (y/n)? y\nEnter passphrase (empty for no passphrase):\nEnter same passphrase again:\nYour identification has been saved in /c/Users/frost2/.ssh/id_rsa.\nYour public key has been saved in /c/Users/frost2/.ssh/id_rsa.pub.\nThe key fingerprint is:\nSHA256:ht3k1v/x4xBn7zHO58G91tYkfBjuDGW7HKfyrBO2JjY frost2@frost2-pc\nThe key's randomart image is:\n+---[RSA 2048]----+\n|                 |\n|                 |\n|          .      |\n|       o + .  +  |\n|      . S + .* * |\n|       . .  +.% *|\n|           . O.#=|\n|          E =.X=%|\n|         . +.==BB|\n+----[SHA256]-----+\n</code></pre> <p>\u67e5\u770b\u516c\u94a5\uff08\u6ce8\u610f\u4fdd\u5b58\u597d\u81ea\u5df1\u7684\u516c\u94a5\uff0c\u8be5\u516c\u94a5\u4e3a\u793a\u4f8b\u503c\uff09</p> <pre><code>$ cat /c/Users/frost2/.ssh/id_rsa.pub\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC3SGL/P6NLLoV4f+nAZlFf4Rc86xNtnHoLrnPEcmW2u+HhlEfDz1yCPOuTu//cDVvrvDUDg/Tzz5w9feCch+Yq/ehq9Chy+3CoRD/DsYklHTZItS39nSTmPw1S/NQJYaQVTTPYhvP947mb6ThS/86M2TSVi1zvfAuVLDEuA1V3oqkXm1Y0yFclc4M2AjRkABCkCrrydG08Da0UUNM5fs8ZtaNKZjsuGctTvbfhYmj5pArrdhwdG6S3Fl56xpuhcWY6vYk06rpKSxyilaL++G559FBmjSThwx1o2CrcyAvw8ISMo7LbRf1B2S60+vf9x+I7Y2l1ODY3TMguBQK8gqkR frost2@frost2-pc\n</code></pre> <p>GitHub\u6dfb\u52a0\u516c\u94a5</p> <p></p> <p></p>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#2mergerebase","title":"2\u3001merge\u548crebase","text":"<p>\u5728Git\u4e2d\u5408\u5e76\u4e24\u4e2a\u5206\u652f\u7684\u4ee3\u7801\u7684\u4e3b\u8981\u65b9\u6cd5\u6709\u4e24\u79cd\uff1a<code>merge</code>\u548c<code>rebase</code>\u3002\u73b0\u5047\u8bbe\u6709\u5982\u4e0b\u4e24\u4e2a\u5206\u652f\uff1a</p> <p></p>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#21merge","title":"2.1\u3001merge","text":"<p>\u5982\u679c\u6211\u4eec\u4f7f\u7528merge\u5c06branch2\u5408\u5e76\u5230branch1\uff0c\u90a3\u4e48\u5b83\u4f1a\u628a\u4e24\u4e2a\u5206\u652f\u7684\u6700\u65b0\u5feb\u7167\uff08commit4 \u548c commit5\uff09\u4ee5\u53ca\u4e8c\u8005\u6700\u8fd1\u7684\u5171\u540c\u7956\u5148\uff08commit3\uff09\u8fdb\u884c\u4e09\u65b9\u5408\u5e76\uff0c\u5408\u5e76\u7684\u7ed3\u679c\u662f\u751f\u6210\u4e00\u4e2a\u65b0\u7684\u5feb\u7167\uff08\u5e76\u63d0\u4ea4\uff09\u3002</p> <p>\u5177\u4f53\u64cd\u4f5c\u5982\u4e0b\uff1a</p> <ul> <li>\u5207\u6362\u5230branch1\uff1a<code>git checkout branch1</code></li> <li>\u5c06branch2\u5408\u5e76\u5230\u5f53\u524d\u5206\u652f(branch1)\uff1a<code>git merge branch2</code></li> </ul> <p>\u5408\u5e76\u540e\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#22rebase","title":"2.2\u3001rebase","text":"<p>\u5982\u679c\u4f7f\u7528rebase\u5c06branch2\u5408\u5e76\u5230branch1\u7684\u8bdd\uff0c\u9996\u5148\u5b83\u4f1a\u627e\u5230\u4e24\u4e2a\u5206\u652f\u5171\u540c\u7684\u7956\u5148commit3\uff0c\u5bf9\u6bd4\u5f53\u524d\u5206\u652fbranch1\u76f8\u5bf9\u4e8e\u8be5\u7956\u5148\u7684\u5386\u6b21\u63d0\u4ea4\uff0c\u63d0\u53d6\u76f8\u5e94\u7684\u4fee\u6539\u5e76\u5b58\u4e3a\u4e34\u65f6\u6587\u4ef6\uff0c \u7136\u540e\u5c06\u5f53\u524d\u5206\u652f\u6307\u5411\u76ee\u6807\u5206\u652fbranch2\u6700\u65b0\u7684commit\u8282\u70b9\uff0c\u6700\u540e\u5c06\u4e34\u65f6\u6587\u4ef6\u7684\u4fee\u6539\u4f9d\u6b21\u5e94\u7528\u3002</p> <p>\u5177\u4f53\u64cd\u4f5c\u5982\u4e0b\uff1a</p> <ul> <li>\u5207\u6362\u5230branch1\uff1a<code>git checkout branch1</code></li> <li>\u5c06branch2\u5408\u5e76\u5230\u5f53\u524d\u5206\u652f(branch1)\uff1a<code>git rebase branch2</code></li> </ul> <p>\u5408\u5e76\u540e\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#23rebase","title":"2.3\u3001\u4ea4\u4e92\u5f0f\u7684rebase","text":"<p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7<code>git rebase -i &lt;startcommit&gt;</code>\u6765\u8fdb\u884c\u4ea4\u4e92\u5f0f\u7684rebase\u64cd\u4f5c\uff0c\u901a\u8fc7\u5b83\u6211\u4eec\u53ef\u4ee5\u4fee\u6539\u5206\u652f\u7684\u63d0\u4ea4\u5386\u53f2\u3002</p> <p>\u73b0\u6709\u5206\u652ffeature_2112\uff0c\u5176\u8fd13\u6b21\u63d0\u4ea4\u5386\u53f2\u5982\u4e0b\u3002</p> <pre><code>$ git log --graph -n3\n* commit 992d6e9701f77e6eb4e2f9920667e8c44d67df65 (HEAD -&gt; feature_2112)\n| Author: frost2 &lt;frost2@163.com&gt;\n| Date:   Wed Dec 29 15:03:58 2021 +0800\n|\n|     rebase\u547d\u4ee4\u4fee\u6539\n|\n* commit bc9a90b1c28db88b854777965bb616a4f94a4cbc\n| Author: frost2 &lt;frost2@163.com&gt;\n| Date:   Wed Dec 29 14:42:14 2021 +0800\n|\n|     rebase/merge\u547d\u4ee4\u89e3\u91ca\n|\n* commit 9be8006e35c6e6059b0253dd76ba29d64924e263\n| Author: frost2 &lt;frost2@163.com&gt;\n| Date:   Sun Dec 26 18:30:11 2021 +0800\n|\n|     \u65b0\u589e\u5206\u652f\u5408\u5e76\u51b2\u7a81\u89e3\u51b3\u6b65\u9aa4\n</code></pre>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#231","title":"2.3.1\u3001\u6253\u5f00\u4ea4\u4e92\u6587\u4ef6","text":"<p>\u5982\u679c\u6211\u4eec\u60f3\u8981\u5408\u5e76\u6700\u8fd1\u4e24\u6b21\u7684\u63d0\u4ea4\u8bb0\u5f55\uff0c\u6267\u884c\u547d\u4ee4<code>git rebase -i bc9a90bc</code>\u6216\u8005<code>git rebase -i HEAD~2</code>\uff0c\u5c31\u4f1a\u6253\u5f00\u5982\u4e0b\u6587\u4ef6</p> <p></p> <p>\u90e8\u5206\u53c2\u6570\u8bf4\u660e\u5982\u4e0b\uff1a</p> \u53c2\u6570 \u8bf4\u660e pick \u91c7\u7528\u8be5\u63d0\u4ea4 reword \u91c7\u7528\u8be5\u63d0\u4ea4\uff0c\u4f46\u662f\u4fee\u6539\u63d0\u4ea4\u5907\u6ce8\u4fe1\u606f edit \u91c7\u7528\u8be5\u63d0\u4ea4\uff0c\u4f46\u8981\u6c42\u4fee\u6539\u63d0\u4ea4\u8bb0\u5f55\u7684\u4fe1\u606f\uff0c\u5305\u62ec\u5907\u6ce8\u3001\u7528\u6237\u548c\u90ae\u7bb1 squash \u91c7\u7528\u8be5\u63d0\u4ea4\uff0c\u4f46\u662f\u4f1a\u628a\u8be5\u63d0\u4ea4\u5408\u5e76\u5230\u524d\u4e00\u6b21\u63d0\u4ea4\u4e2d fixup \u7c7b\u4f3c\u4e8esquash\uff0c\u4f46\u662f\u4f1a\u4e22\u5f03\u5bf9\u5e94\u63d0\u4ea4\u7684\u65e5\u5fd7\u4fe1\u606f exec \u5b9e\u884cshell\u811a\u672c drop \u5220\u9664\u8be5commit"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#232","title":"2.3.2\u3001\u7f16\u8f91\u4ea4\u4e92\u6587\u4ef6","text":"<p>\u7f16\u8f91\u6587\u4ef6\uff0c\u5c06\u6700\u540e\u4e00\u6b21\u63d0\u4ea4\u5408\u5e76\u5230\u524d\u4e00\u6b21\u63d0\u4ea4\u3002</p> <p></p> <p>\u7f16\u8f91\u5b8c\u6210\u4fdd\u5b58\u9000\u51fa\uff0c\u4f1a\u5f39\u51fa\u53e6\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u5408\u5e76\u4e24\u6b21\u63d0\u4ea4\u7684\u5907\u6ce8\u4fe1\u606f\uff0c\u5982\u4e0b\u6240\u793a</p> <p></p> <p>\u4fee\u6539\u5408\u5e76\u4e24\u6b21\u63d0\u4ea4\u4fe1\u606f\u5982\u4e0b\uff1a</p> <p></p> <p>\u4fdd\u5b58\u9000\u51fa\u8be5\u6587\u4ef6\u540e\uff0c\u6700\u5f00\u59cb\u6267\u884c\u7684<code>git rebase -i HEAD~2</code>\u547d\u4ee4\u6210\u529f\u7ed3\u675f\u3002</p> <pre><code>$ git rebase -i HEAD~2\n[detached HEAD e6acd2a] \u65b0\u589erebase/merge\u547d\u4ee4\u89e3\u91ca\n Date: Wed Dec 29 14:42:14 2021 +0800\n 1 file changed, 33 insertions(+), 1 deletion(-)\nSuccessfully rebased and updated refs/heads/feature_2112.\n</code></pre> <p>\u81f3\u6b64\u6211\u4eec\u6210\u529f\u7684\u5c06\u6700\u8fd1\u7684\u4e24\u6b21\u5408\u5e76\u5408\u5e76\u4e3a\u540c\u4e00\u6b21\u63d0\u4ea4\uff0c\u6b64\u65f6\u63d0\u4ea4\u5386\u53f2\u5982\u4e0b\uff1a</p> <pre><code>$ git log --graph -n2\n* commit e6acd2a7bdd30fb7b589ff972e61c6f63ca71590 (HEAD -&gt; feature_2112)\n| Author: frost2 &lt;frost2@163.com&gt;\n| Date:   Wed Dec 29 14:42:14 2021 +0800\n|\n|     \u65b0\u589erebase/merge\u547d\u4ee4\u89e3\u91ca\n|\n* commit 9be8006e35c6e6059b0253dd76ba29d64924e263\n| Author: frost2 &lt;frost2@163.com&gt;\n| Date:   Sun Dec 26 18:30:11 2021 +0800\n|\n|     \u65b0\u589e\u5206\u652f\u5408\u5e76\u51b2\u7a81\u89e3\u51b3\u6b65\u9aa4\n</code></pre>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#3","title":"3\u3001\u51b2\u7a81\u5408\u5e76","text":"<p>Git\u51b2\u7a81\u4e00\u822c\u6709\u4e24\u79cd\u60c5\u51b5\uff0c\u4e00\u79cd\u662f\u62c9\u53d6\u5206\u652f\u65f6\uff0c\u4f60\u672c\u5730\u4fee\u6539\u7684\u6587\u4ef6\u548c\u8fdc\u7a0b\u6587\u4ef6\u51fa\u73b0\u51b2\u7a81\uff0c\u53e6\u4e00\u79cd\u60c5\u51b5\u662f\u5206\u652f\u5408\u5e76\u65f6\uff0c\u5728\u4e24\u4e2a\u5206\u652f\u4e2d\u90fd\u5bf9\u67d0\u4e2a\u6587\u4ef6\u8fdb\u884c\u4e86\u4fee\u6539\u3002</p>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#31","title":"3.1\u3001\u4ee3\u7801\u51b2\u7a81\u5408\u5e76","text":"<p>\u5f53\u6211\u4eec\u672c\u5730\u4fee\u6539\u4e86\u67d0\u4e2a\u6587\u4ef6\u5e76\u4e14\u5df2\u7ecfcommit\uff0c\u540c\u65f6\u6709\u4eba\u4e5f\u6539\u4e86\u8be5\u6587\u4ef6\u5e76\u4e14\u5df2\u7ecf\u63d0\u4ea4\u5230\u4e86\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u8fd9\u65f6\u5982\u679c\u6211\u4eec\u62c9\u53d6\u4ee3\u7801\u5c31\u4f1a\u62a5\u5408\u5e76\u51b2\u7a81\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\u89e3\u51b3\u8fd9\u79cd\u51b2\u7a81\u5e94\u8be5\u4ee5\u8fdc\u7a0b\u5206\u652f\u4ee3\u7801\u4e3a\u51c6\uff0c\u5c06\u81ea\u5df1\u7684\u53d8\u66f4\u589e\u52a0\u4e0a\u53bb\uff0c\u7136\u540e\u5408\u5e76\u4ee3\u7801\u3002\u5177\u4f53\u6b65\u9aa4\u770b\u540e\u6587\u3002</p> <p>Git\u62c9\u53d6\u5408\u5e76\u4ee3\u7801\u5206\u4e3amerge\u548crebase\u4e24\u79cd\u65b9\u5f0f\uff0cgit pull\u9ed8\u8ba4\u4f7f\u7528merge\u65b9\u5f0f\uff0c\u5373\u9ed8\u8ba4\u60c5\u51b5\u4e0b<code>git pull = git fetch + git merge</code>\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570<code>--rebase</code>\u8bbe\u7f6epull\u4f7f\u7528rebase\u65b9\u5f0f\uff0c\u5f53\u7136\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4<code>git config --global pull.rebase true</code>\uff0c\u5c06pull\u64cd\u4f5c\u7684\u5408\u5e76\u65b9\u5f0f\u6539\u4e3arebase\u3002</p>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#311git-pull-rebase","title":"3.1.1\u3001git pull --rebase","text":"<pre><code>frost2@frost2-pc MINGW64 /e/Frost2-Files/IdeaWorkSpace/frost2 (master)\n$ git pull --rebase\nFirst, rewinding head to replay your work on top of it...\nApplying: \u6ce8\u91ca\u4ee3\u7801\nUsing index info to reconstruct a base tree...\nM       src/main/java/code/hutool/http/TestPost.java\nFalling back to patching base and 3-way merge...\nAuto-merging src/main/java/code/hutool/http/TestPost.java\nCONFLICT (content): Merge conflict in src/main/java/code/hutool/http/TestPost.java\nerror: Failed to merge in the changes.\nhint: Use 'git am --show-current-patch' to see the failed patch\nPatch failed at 0001 \u6ce8\u91ca\u4ee3\u7801\nResolve all conflicts manually, mark them as resolved with\n\"git add/rm &lt;conflicted_files&gt;\", then run \"git rebase --continue\".\nYou can instead skip this commit: run \"git rebase --skip\".\nTo abort and get back to the state before \"git rebase\", run \"git rebase --abort\".\n\nfrost2@frost2-pc MINGW64 /e/Frost2-Files/IdeaWorkSpace/frost2 (master|REBASE 1/1)\n$ git status\nrebase in progress; onto 8c4202d\nYou are currently rebasing branch 'master' on '8c4202d'.\n  (fix conflicts and then run \"git rebase --continue\")\n  (use \"git rebase --skip\" to skip this patch)\n  (use \"git rebase --abort\" to check out the original branch)\n\nUnmerged paths:\n  (use \"git reset HEAD &lt;file&gt;...\" to unstage)\n  (use \"git add &lt;file&gt;...\" to mark resolution)\n\n        both modified:   src/main/java/code/hutool/http/TestPost.java\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\n</code></pre>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#312git-pull","title":"3.1.2\u3001git pull","text":"<pre><code>frost2@frost2-pc MINGW64 /e/Frost2-Files/IdeaWorkSpace/frost2 (master)\n$ git pull\nAuto-merging src/main/java/code/hutool/http/TestPost.java\nCONFLICT (content): Merge conflict in src/main/java/code/hutool/http/TestPost.java\nAutomatic merge failed; fix conflicts and then commit the result.\n\nfrost2@frost2-pc MINGW64 /e/Frost2-Files/IdeaWorkSpace/frost2 (master|MERGING)\n$ git status\nOn branch master\nYour branch and 'origin/master' have diverged,\nand have 1 and 1 different commits each, respectively.\n  (use \"git pull\" to merge the remote branch into yours)\n\nYou have unmerged paths.\n  (fix conflicts and run \"git commit\")\n  (use \"git merge --abort\" to abort the merge)\n\nUnmerged paths:\n  (use \"git add &lt;file&gt;...\" to mark resolution)\n\n        both modified:   src/main/java/code/hutool/http/TestPost.java\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\n</code></pre>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#313","title":"3.1.3\u3001\u7f16\u8f91\u51b2\u7a81\u6587\u4ef6","text":"<p>\u672c\u4f8b\u6bd4\u8f83\u7b80\u5355\uff0c\u6545\u6211\u4f7f\u7528VIM\u76f4\u63a5\u7f16\u8f91\u3002\u53ef\u4ee5\u770b\u5230\u4e0b\u56fe\u7ea2\u6846\u6240\u793a\uff0cGit\u4e2d\u6587\u4ef6\u4e2d\u7684\u51b2\u7a81\u5185\u5bb9\u4f1a\u4f7f\u7528<code>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</code>\u548c<code>&gt;&gt;&gt;&gt;&gt;&gt;&gt;</code>\u5305\u8d77\u6765\uff0crebase\u5408\u5e76\u65f6\uff1a\u5176\u4e2d<code>&lt;&lt;&lt;&lt;&lt;&lt;&lt;</code>\u5230<code>=======</code>\u4e2d\u95f4\u7684\u5185\u5bb9\u4e3a\u8fdc\u7a0b\u4ed3\u5e93\u7684\u4ee3\u7801\uff0c<code>=======</code>\u5230<code>&gt;&gt;&gt;&gt;&gt;&gt;&gt;</code>\u7684\u5185\u5bb9\u4e3a\u672c\u5730\u5206\u652f\u7684\u4ee3\u7801\u3002\u800cmerge\u5408\u5e76\u4fdd\u5b58\u7684\u5185\u5bb9\u6070\u597d\u76f8\u53cd\u3002</p> <p>\u672c\u4f8bGit\u7248\u672c\u4e3a\uff1a2.20.1.windows.1\uff0c\u6211\u6d4b\u8bd5\u7ed3\u679c\u5982\u4e0b</p> \u5408\u5e76\u65b9\u5f0f \u90e8\u5206 \u4fdd\u5b58\u7684\u5185\u5bb9 rebase <code>&lt;&lt;&lt;&lt;&lt;&lt;&lt;</code>\u5230<code>=======</code> \u8fdc\u7a0b\u4ed3\u5e93\u7684\u4ee3\u7801 <code>=======</code>\u5230<code>&gt;&gt;&gt;&gt;&gt;&gt;&gt;</code> \u672c\u5730\u5206\u652f\u7684\u4ee3\u7801 merge <code>&lt;&lt;&lt;&lt;&lt;&lt;&lt;</code>\u5230<code>=======</code> \u672c\u5730\u5206\u652f\u7684\u4ee3\u7801 <code>=======</code>\u5230<code>&gt;&gt;&gt;&gt;&gt;&gt;&gt;</code> \u8fdc\u7a0b\u4ed3\u5e93\u7684\u4ee3\u7801 <p></p>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#314rebase","title":"3.1.4\u3001\u5408\u5e76\u51b2\u7a81\uff08rebase\uff09","text":"<p>\u624b\u52a8\u89e3\u51b3\u5b8c\u51b2\u7a81\u540e\uff0c\u63d0\u4ea4\u4ee3\u7801\u5230\u6682\u5b58\u533a\u8868\u793a\u51b2\u7a81\u89e3\u51b3\u5b8c\u6210\u3002\u67e5\u770b\u5f53\u524dGit\u72b6\u6001\u5982\u4e0b\uff1a</p> <pre><code>frost2@frost2-pc MINGW64 /e/Frost2-Files/IdeaWorkSpace/frost2 (master|REBASE 1/1)\n$ git add src/main/java/code/hutool/http/TestPost.java\n\nfrost2@frost2-pc MINGW64 /e/Frost2-Files/IdeaWorkSpace/frost2 (master|REBASE 1/1)\n$ git status\nrebase in progress; onto 8c4202d\nYou are currently rebasing branch 'master' on '8c4202d'.\n  (all conflicts fixed: run \"git rebase --continue\")\n\nChanges to be committed:\n  (use \"git reset HEAD &lt;file&gt;...\" to unstage)\n\n        modified:   src/main/java/code/hutool/http/TestPost.java\n</code></pre> <p>\u89e3\u51b3\u5b8c\u6210\u901a\u8fc7\u547d\u4ee4\u7ee7\u7eed\u8ba9Git\u8fdb\u884c\u5408\u5e76\u3002\u6b64\u65f6\u672c\u5730\u5206\u652f\u4ee3\u7801\u6bd4\u8fdc\u7a0b\u4ee3\u7801\u8d85\u524d\u4e00\u6b21\u63d0\u4ea4\uff0c\u6267\u884c<code>git push</code>\u5c06\u672c\u5730\u53d8\u66f4\u540c\u6b65\u5230\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u81f3\u6b64\u4ee3\u7801\u51b2\u7a81\u5c31\u89e3\u51b3\u5b8c\u6210\u4e86\u3002</p> <pre><code>frost2@frost2-pc MINGW64 /e/Frost2-Files/IdeaWorkSpace/frost2 (master|REBASE 1/1)\n$ git rebase --continue\nApplying: \u6ce8\u91ca\u4ee3\u7801\n</code></pre>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#315merge","title":"3.1.5\u3001\u5408\u5e76\u51b2\u7a81\uff08merge\uff09","text":"<p>\u540c\u6837\u9700\u8981\u624b\u52a8\u89e3\u51b3\u51b2\u7a81\uff0c\u7136\u540e\u5c06\u51b2\u7a81\u6587\u4ef6\u6dfb\u52a0\u5230\u6682\u5b58\u533a\u4ee5\u8868\u793a\u51b2\u7a81\u89e3\u51b3\u5b8c\u6210\u3002\u64cd\u4f5c\u5982\u4e0b\uff1a</p> <pre><code>frost2@frost2-pc MINGW64 /e/Frost2-Files/IdeaWorkSpace/frost2 (master|MERGING)\n$ git add src/main/java/code/hutool/http/TestPost.java\n\nfrost2@frost2-pc MINGW64 /e/Frost2-Files/IdeaWorkSpace/frost2 (master|MERGING)\n$ git status\nOn branch master\nYour branch and 'origin/master' have diverged,\nand have 1 and 1 different commits each, respectively.\n  (use \"git pull\" to merge the remote branch into yours)\n\nAll conflicts fixed but you are still merging.\n  (use \"git commit\" to conclude merge)\n\nChanges to be committed:\n\n        modified:   src/main/java/code/hutool/http/TestPost.java\n</code></pre> <p>\u63a5\u4e0b\u6765\u7684\u64cd\u4f5c\u4e0erebase\u6709\u6240\u4e0d\u540c\uff0c\u6267\u884c<code>git commit</code>\u5408\u5e76\u51b2\u7a81\uff0c\u6267\u884c\u540e\u8df3\u8f6c\u5230\u4e0b\u56fe\u6240\u793a\u754c\u9762\u4e2d\uff0c\u56fe\u4e2d\u7ea2\u6846\u90e8\u5206\u4e3a\u672c\u6b21\u5408\u5e76\u7684\u6ce8\u91ca\u4fe1\u606f\u3002\u66f4\u6539\u4e3a\u81ea\u5df1\u672c\u6b21\u5408\u5e76\u7684\u6ce8\u91ca\u4fe1\u606f\u540e\uff0c\u4fdd\u5b58\u9000\u51fa\u5373\u53ef\u3002</p> <p></p> <p>\u6b64\u65f6\u4ee3\u7801\u51b2\u7a81\u5c31\u89e3\u51b3\u5b8c\u6210\u4e86\uff0c\u67e5\u770b\u73b0\u5728\u7684Git\u4ed3\u5e93\u72b6\u6001\uff0c\u53ef\u4ee5\u770b\u5230\u5f53\u524d\u5206\u652f\u6bd4\u8fdc\u7a0b\u5206\u652f\u8d85\u524d\u4e24\u6b21\u63d0\u4ea4\u3002\u6b64\u65f6\u6211\u4eec\u6267\u884c<code>git push</code>\u5c06\u672c\u5730\u53d8\u66f4\u540c\u6b65\u5230\u8fdc\u7a0b\u4ed3\u5e93\u5373\u53ef\u3002</p> <pre><code>frost2@frost2-pc MINGW64 /e/Frost2-Files/IdeaWorkSpace/frost2 (master)\n$ git status\nOn branch master\nYour branch is ahead of 'origin/master' by 2 commits.\n  (use \"git push\" to publish your local commits)\n\nnothing to commit, working tree clean\n</code></pre> <pre><code>\u6ce8: \u7ec6\u5fc3\u7684\u4eba\u4f1a\u6ce8\u610f\u5230\uff0cmerge\u5408\u5e76\u51b2\u7a81\u89e3\u51b3\u540e\u672c\u6b21\u5206\u652f\u9886\u5148\u8fdc\u7a0b\u5206\u652f\u4e24\u6b21\u63d0\u4ea4\uff0c\u800crebase\u9886\u5148\u4e00\u6b21\u63d0\u4ea4\u3002\u5176\u5b9e\u5c31\u662fmerge\u548crebase\u7684\u533a\u522b\uff0cmerge\u4f1a\u5c06\u672c\u5730\u5206\u652f\u548c\u8fdc\u7a0b\u5206\u652f\u7684\u4ee3\u7801\u5408\u5e76\u5230\u4e00\u4e2a\u65b0\u7684\u8282\u70b9\u3002\n</code></pre> <p>\u6b64\u65f6git\u63d0\u4ea4\u8bb0\u5f55\u5982\u4e0b\uff1a</p> <pre><code>frost2@frost2-pc MINGW64 /e/Frost2-Files/IdeaWorkSpace/frost2 (master)\n$ git log --graph -n 3\n*   commit 357c6610a887ca86d26f29521e33de4364fe2f90 (HEAD -&gt; master)\n|\\  Merge: de6567b 1a831c3\n| | Author: frost2 &lt;frost2@163.com&gt;\n| | Date:   Sat Dec 25 19:43:58 2021 +0800\n| |\n| |     Merge branch 'master' of github.com:frost-2/frost2\n| |\n| * commit 1a831c30d5beb39767ce01d16ea2f2e9e3eb80c9 (origin/master, origin/HEAD)\n| | Author: frost-2 &lt;59042444+frost-2@users.noreply.github.com&gt;\n| | Date:   Sat Dec 25 19:25:11 2021 +0800\n| |\n| |     Update TestPost.java\n| |\n* | commit de6567bfa033328c182d798bf2bf7860e2d0e960\n|/  Author: frost2 &lt;frost2@163.com&gt;\n|   Date:   Sat Dec 25 19:27:56 2021 +0800\n|\n|       update file\n</code></pre>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#316git","title":"3.1.6\u3001Git\u5408\u5e76\u63d0\u793a\u65e0\u4fee\u6539","text":"<p>rebase\u5408\u5e76\u65f6\uff0c\u5982\u679c\u4f60\u4fee\u6539\u540e\u7684\u51b2\u7a81\u6587\u4ef6\u548c\u8fdc\u7a0b\u4ed3\u5e93\u7684\u6070\u597d\u4e00\u81f4\uff0c\u5c31\u4f1a\u51fa\u73b0\u5982\u4e0b\u63d0\u793a\u3002\u6b64\u65f6\u6267\u884c<code>git rebase --skip</code>\u5373\u53ef\u3002\u6ce8merge\u5408\u5e76\u4e0d\u4f1a\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\u3002</p> <pre><code>frost2@frost2-pc MINGW64 /e/Frost2-Files/IdeaWorkSpace/frost2 (master|REBASE 1/1)\n$ git rebase --continue\nApplying: \u6ce8\u91ca\u4ee3\u7801\nNo changes - did you forget to use 'git add'?\nIf there is nothing left to stage, chances are that something else\nalready introduced the same changes; you might want to skip this patch.\nResolve all conflicts manually, mark them as resolved with\n\"git add/rm &lt;conflicted_files&gt;\", then run \"git rebase --continue\".\nYou can instead skip this commit: run \"git rebase --skip\".\nTo abort and get back to the state before \"git rebase\", run \"git rebase --abort\".\n\nfrost2@frost2-pc MINGW64 /e/Frost2-Files/IdeaWorkSpace/frost2 (master|REBASE 1/1)\n$ git status\nrebase in progress; onto 8c4202d\nYou are currently rebasing branch 'master' on '8c4202d'.\n  (all conflicts fixed: run \"git rebase --continue\")\n\nnothing to commit, working tree clean\n</code></pre>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#32","title":"3.2\u3001\u5206\u652f\u51b2\u7a81\u5408\u5e76","text":"<p>\u73b0\u89c4\u5b9arelease\u5206\u652f\u53ea\u7528\u4e8e\u5408\u5e76\u5206\u652f\uff0c\u4e0d\u80fd\u76f4\u63a5\u63d0\u4ea4\u4ee3\u7801\u3002</p> <p>\u5047\u8bbe\u73b0\u5728\u6709\u4e00\u4e2a\u5206\u652frelease_2112\uff0c\u8fd8\u6709\u4e24\u4e2a\u5206\u652ffeature_iss01\u548cfeature_iss02\uff0c\u6211\u4eec\u5728\u8fd9\u4e24\u4e2a\u5206\u652f\u4e0a\u5404\u81ea\u8fdb\u884c\u5f00\u53d1\uff0c\u5f00\u53d1\u5b8c\u6210\u540e\u5c06\u8fd9\u4e24\u4e2a\u5206\u652f\u5408\u5e76\u5230release_2112\u5206\u652f\u4e0a\u3002</p>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#321","title":"3.2.1\u3001\u5408\u5e76\u5206\u652f","text":"<p>\u6b64\u65f6\u5982\u679c\u4e24\u4e2a\u5206\u652f\u90fd\u6539\u5230\u4e86\u540c\u4e00\u4e2a\u6587\u4ef6\uff0c\u90a3\u4e48\u5c06\u5176\u4e2d\u4e00\u4e2a\u5408\u5e76\u5230release_2112\u5206\u4e4b\u540e\uff0c\u518d\u5408\u5e76\u53e6\u4e00\u4e2a\u5206\u652f\u65f6\u5c31\u4f1a\u62a5\u5408\u5e76\u51b2\u7a81\u3002\u5177\u4f53\u64cd\u4f5c\u5982\u4e0b\uff0c\u9996\u5148\u6267\u884c<code>git checkout release_2112</code>\u547d\u4ee4\u5207\u6362\u5206\u652f\uff0c\u7136\u540e\u4f9d\u6b21\u6267\u884c<code>git merge feature_iss01</code>\u548c<code>git merge feature_iss02</code>\u547d\u4ee4\u5c06\u5206\u652f\u5408\u5e76\u5230release_2112\u5206\u652f\u3002</p> <pre><code>frost2@frost2-pc MINGW64 /e/Frost2-Files/frost2 (release_2112)\n$ git merge feature_iss01\nUpdating 597d0f4..1eab2da\nFast-forward\n src/main/java/code/hutool/core/test.txt | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n</code></pre> <p>\u73b0\u5728\u6211\u4eec\u518d\u5408\u5e76\u5206\u652ffeature_iss02\u5230release_2112</p> <pre><code>$ git merge feature_iss02\nAuto-merging src/main/java/code/hutool/core/test.txt\nCONFLICT (content): Merge conflict in src/main/java/code/hutool/core/test.txt\nAutomatic merge failed; fix conflicts and then commit the result.\n</code></pre> <p>\u67e5\u770bGit\u72b6\u6001\uff0c\u53ef\u4ee5\u770b\u5230\u662f\u56e0\u4e3afeature_iss01\u548cfeature_iss02\u90fd\u6539\u4e86test.txt\u6587\u4ef6\uff0c\u6240\u4ee5\u5408\u5e76\u51b2\u7a81\u4e86</p> <pre><code>frost2@frost2-pc MINGW64 /e/Frost2-Files/IdeaWorkSpace/frost2 (release_2112|MERGING)\n$ git status\nOn branch release_2112\nYou have unmerged paths.\n  (fix conflicts and run \"git commit\")\n  (use \"git merge --abort\" to abort the merge)\n\nUnmerged paths:\n  (use \"git add &lt;file&gt;...\" to mark resolution)\n\n        both modified:   src/main/java/code/hutool/core/test.txt\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\n</code></pre>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#322","title":"3.2.2\u3001\u7f16\u8bd1\u51b2\u7a81\u6587\u4ef6","text":"<p>\u8be5\u90e8\u5206\u64cd\u4f5c\u4e0e2.1.4\u8282\u7c7b\u4f3c\uff0c\u624b\u52a8\u89e3\u51b3\u51b2\u7a81\u6587\u4ef6\u7684\u5185\u5bb9\u7136\u540e\u4fdd\u5b58\u9000\u51fa\u3002</p>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#323","title":"3.2.3\u3001\u5408\u5e76\u51b2\u7a81","text":"<p>\u8be5\u90e8\u5206\u64cd\u4f5c\u4e0e2.1.5\u8282\u7c7b\u4f3c\u3002\u624b\u52a8\u89e3\u51b3\u51b2\u7a81\u540e\u5148git add\u51b2\u7a81\u6587\u4ef6\uff0c\u8868\u793a\u51b2\u7a81\u89e3\u51b3\u5b8c\u6210\uff0c\u518d\u6267\u884cgit commit\u547d\u4ee4\u5408\u5e76\u51b2\u7a81\u3002\u81f3\u6b64\u5206\u652f\u5408\u5e76\u51b2\u7a81\u5c31\u89e3\u51b3\u5b8c\u6210\u4e86\u3002</p> <p>\u540e\u7eed\u5f00\u53d1\u53ea\u8981\u4ee5release\u5206\u652f\u4e3a\u57fa\u7840\u65b0\u5efa\u51fa\u5206\u652f\u5f00\u53d1\u5373\u53ef\u3002\u4f46\u662f\u5982\u679c\u6211\u4eec\u7684release_2112\u5df2\u7ecf\u6709\u5bf9\u5e94\u4e3b\u8981\u5f00\u53d1\u5206\u652ffeature_2112\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u5c06release_2112\u5206\u652f\u5408\u5e76\u5230feature_2112\u5206\u652f\uff0c\u4f7f\u4e24\u4e2a\u5206\u652f\u4ee3\u7801\u4e00\u81f4\u3002\u5982\u679c\u4e0d\u5e78\u53c8\u51fa\u73b0\u4e86\u51b2\u7a81\u518d\u6309\u7167\u4e0a\u8ff0\u6b65\u9aa4\u64cd\u4f5c\u4e00\u904d\u5373\u53ef\u3002</p>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#4git","title":"4\u3001Git\u5de5\u4f5c\u6a21\u5f0f","text":""},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#41","title":"4.1\u3001\u56fe\u793a","text":"<p>\u5206\u652f\u7c7b\u578b\uff1a</p> <ul> <li>\u4e3b\u5e72\u5206\u652f(master)\uff1a\u751f\u4ea7\u5bf9\u7b49\u5206\u652f\uff0c\u8981\u6c42\u4ee3\u7801\u548c\u751f\u4ea7\u73b0\u72b6\u4fdd\u6301\u4e00\u81f4\uff0c\u4e0d\u5141\u8bb8\u968f\u4fbf\u63d0\u4ea4\u4ee3\u7801\u5230\u4e3b\u5e72\u5206\u652f\u3002</li> <li>\u7279\u6027\u5206\u652f(feature)\uff1a\u4e3a\u4e86\u5b8c\u6210\u9700\u6c42/\u95ee\u9898/\u4efb\u52a1\u4ece\u6700\u65b0\u7684\u4e3b\u5e72\u5206\u652f\u4e0a\u521b\u5efa\u7684\u5206\u652f\u3002\u89c4\u5b9a\u4ee5feature\u5f00\u5934\u547d\u540d\u3002</li> <li>\u53d1\u5e03\u5206\u652f(release)\uff1a\u7ecf\u7279\u6027\u5206\u652f\u5408\u5e76\u5f62\u6210\uff0c\u7528\u4e8e\u529f\u80fd\u6295\u4ea7\uff0c\u6295\u4ea7\u6210\u529f\u540e\u5408\u5e76\u5230\u4e3b\u5e72\u5206\u652f\u3002\u89c4\u5b9a\u4ee5release\u5f00\u5934\u547d\u540d\u3002</li> <li>\u8865\u4e01\u5206\u652f(hotfix)\uff1a\u7528\u4e8e\u89e3\u51b3\u6295\u4ea7\u540e\u51fa\u73b0\u7684\u751f\u4ea7\u95ee\u9898\uff0c\u89c4\u5b9a\u4ee5hotfix\u5f00\u5934\u547d\u540d\u3002\u8865\u4e01\u5206\u652f\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u7279\u6027\u5206\u652f\u3002</li> </ul>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#42","title":"4.2\u3001\u5f00\u53d1\u89c4\u5219","text":"<ul> <li> <p>\u89c4\u5219\u4e00\uff1a\u5f00\u53d1\u524d\u4ece\u4e3b\u5e72\u5206\u652f\u521b\u5efa\u7279\u6027\u5206\u652f</p> </li> <li> <p>\u89c4\u5219\u4e8c\uff1a\u5408\u5e76\u7279\u6027\u5206\u652f\u5f62\u6210\u53d1\u5e03\u5206\u652f</p> </li> <li> <p>\u89c4\u5219\u4e09\uff1a\u6295\u4ea7\u540e\u5408\u5e76\u53d1\u5e03\u5206\u652f\u5230\u4e3b\u5e72\u5206\u652f</p> </li> <li> <p>\u89c4\u5219\u56db\uff1a\u6295\u4ea7\u51fa\u73b0\u95ee\u9898\uff0c\u5c06\u53d1\u5e03\u5206\u652f\u5408\u5e76\u5230\u4ece\u4e3b\u5e72\u5206\u652f\u521b\u5efa\u8865\u4e01\u5206\u652f\u89e3\u51b3\u95ee\u9898</p> </li> </ul>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#git_3","title":"\u4e09\u3001Git\u5e95\u5c42\u547d\u4ee4","text":""},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#1git","title":"1\u3001.git\u76ee\u5f55","text":""},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#11git","title":"1.1\u3001git\u7248\u672c","text":"<p>\u672c\u6587\u4f7f\u7528Git\u7248\u672c\u4e3a\uff1a</p> <p></p>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#12git","title":"1.2\u3001.git\u76ee\u5f55\u5185\u5bb9\u8bf4\u660e","text":"<p>\u5f53\u4f60\u5728\u4e00\u4e2a\u65b0\u76ee\u5f55\u6216\u5df2\u6709\u76ee\u5f55\u5185\u6267\u884c <code>git init</code> \u65f6\uff0cgit \u4f1a\u521b\u5efa\u4e00\u4e2a <code>.git</code> \u76ee\u5f55\uff0c\u51e0\u4e4e\u6240\u6709 git \u5b58\u50a8\u548c\u64cd\u4f5c\u7684\u5185\u5bb9\u90fd\u4f4d\u4e8e\u8be5\u76ee\u5f55\u4e0b\u3002\u65b0\u5efa\u7684<code>.git</code>\u76ee\u5f55\u4e2d\u4e0d\u662f\u5305\u62ec\u4e0b\u56fe\u7684<code>index</code>\u6587\u4ef6\u7684\uff0c\u5f53git\u7b2c\u4e00\u4e2a\u5411\u6682\u5b58\u533a\u6dfb\u52a0\u5185\u5bb9\u65f6\u624d\u4f1a\u521b\u5efa\u8be5\u6587\u4ef6\u3002</p> <p></p> <p><code>.git</code>\u76ee\u5f55\u4e0b\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u4f5c\u7528\u5982\u4e0b\uff1a</p> \u6587\u4ef6/\u6587\u4ef6\u5939 \u8bf4\u660e config <code>config</code> \u6587\u4ef6\u5305\u542b\u4e86\u9879\u76ee\u7279\u6709\u7684\u914d\u7f6e\u9009\u9879\u3002 description <code>description</code> \u6587\u4ef6\u4ec5\u4f9b GitWeb \u7a0b\u5e8f\u4f7f\u7528\uff0c\u6240\u4ee5\u4e0d\u7528\u5173\u5fc3\u8fd9\u4e9b\u5185\u5bb9\u3002 HEAD <code>HEAD</code> \u6587\u4ef6\u6307\u5411\u5f53\u524d\u5206\u652f hooks/ <code>hooks</code> \u76ee\u5f55\u4fdd\u5b58\u4e86\u5ba2\u6237\u7aef\u6216\u670d\u52a1\u7aef\u94a9\u5b50\u811a\u672c\u3002 index <code>index</code> \u6587\u4ef6\u4fdd\u5b58\u4e86\u6682\u5b58\u533a\u57df\u4fe1\u606f info/ <code>info</code> \u76ee\u5f55\u4fdd\u5b58\u4e86\u4e00\u4efd\u4e0d\u5e0c\u671b\u5728 .gitignore \u6587\u4ef6\u4e2d\u7ba1\u7406\u7684\u5ffd\u7565\u6a21\u5f0f (ignored patterns) \u7684\u5168\u5c40\u53ef\u6267\u884c\u6587\u4ef6\u3002 objects/ <code>objects</code> \u76ee\u5f55\u5b58\u50a8\u6240\u6709\u6570\u636e\u5185\u5bb9 refs/ <code>refs</code> \u76ee\u5f55\u5b58\u50a8\u6307\u5411\u6570\u636e (\u5206\u652f) \u7684\u63d0\u4ea4\u5bf9\u8c61\u7684\u6307\u9488"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#2git","title":"2\u3001git\u5bf9\u8c61","text":""},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#21blob","title":"2.1\u3001blob\u5bf9\u8c61","text":"<p>git \u662f\u4e00\u5957\u5185\u5bb9\u5bfb\u5740\u6587\u4ef6\u7cfb\u7edf\u3002\u8fd9\u79cd\u8bf4\u6cd5\u7684\u610f\u601d\u662f\uff0cGit \u4ece\u6838\u5fc3\u4e0a\u6765\u770b\u4e0d\u8fc7\u662f\u7b80\u5355\u5730\u5b58\u50a8\u952e\u503c\u5bf9\uff08key-value\uff09\u3002\u5b83\u5141\u8bb8\u63d2\u5165\u4efb\u610f\u7c7b\u578b\u7684\u5185\u5bb9\uff0c\u5e76\u4f1a\u8fd4\u56de\u4e00\u4e2a\u952e\u503c\uff0c\u901a\u8fc7\u8be5\u952e\u503c\u53ef\u4ee5\u5728\u4efb\u4f55\u65f6\u5019\u518d\u53d6\u51fa\u8be5\u5185\u5bb9\u3002\u53ef\u4ee5\u901a\u8fc7\u5e95\u5c42\u547d\u4ee4 <code>hash-object</code> \u6765\u5b9e\u73b0\u8fd9\u70b9\uff0c\u4f20\u4e00\u4e9b\u6570\u636e\u7ed9\u8be5\u547d\u4ee4\uff0c\u5b83\u4f1a\u5c06\u6570\u636e\u4fdd\u5b58\u5728 <code>.git</code> \u76ee\u5f55\u4e0b\u7684<code>objects</code>\u6587\u4ef6\u5939\u4e0b\u5e76\u8fd4\u56de\u8868\u793a\u8fd9\u4e9b\u6570\u636e\u7684\u952e\u503c\u3002</p> <pre><code>$ echo 'first demo' | git hash-object -w --stdin\n1d1ef0ad031c84a62374eb3044da50198622c6da\n</code></pre> <p>\u53c2\u6570 <code>-w</code> \u6307\u793a <code>hash-object</code> \u547d\u4ee4\u5b58\u50a8 (\u6570\u636e) \u5bf9\u8c61\uff0c\u82e5\u4e0d\u6307\u5b9a\u8fd9\u4e2a\u53c2\u6570\u8be5\u547d\u4ee4\u4ec5\u4ec5\u8fd4\u56de\u952e\u503c\u3002<code>--stdin</code> \u6307\u5b9a\u4ece\u6807\u51c6\u8f93\u5165\u8bbe\u5907 (stdin) \u6765\u8bfb\u53d6\u5185\u5bb9\uff0c\u82e5\u4e0d\u6307\u5b9a\u8fd9\u4e2a\u53c2\u6570\u5219\u9700\u6307\u5b9a\u4e00\u4e2a\u8981\u5b58\u50a8\u7684\u6587\u4ef6\u7684\u8def\u5f84\u3002\u8be5\u547d\u4ee4\u8f93\u51fa\u957f\u5ea6\u4e3a 40 \u4e2a\u5b57\u7b26\u7684\u6821\u9a8c\u548c\u3002\u8fd9\u662f\u4e2a SHA-1 \u54c8\u5e0c\u503c\u2014\u2014\u5176\u503c\u4e3a\u8981\u5b58\u50a8\u7684\u6570\u636e\u52a0\u4e0a\u4e00\u79cd\u5934\u4fe1\u606f\u7684\u6821\u9a8c\u548c\u3002</p> <p>\u67e5\u770bobject\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u3002</p> <pre><code>$ find objects/ -type f\nobjects/1d/1ef0ad031c84a62374eb3044da50198622c6da\n</code></pre> <p>\u53ef\u4ee5\u5728 <code>objects</code> \u76ee\u5f55\u4e0b\u770b\u5230\u4e00\u4e2a\u6587\u4ef6\u3002git\u4f1a\u4e3a\u6bcf\u4efd\u5185\u5bb9\u90fd\u751f\u6210\u4e00\u4e2a\u6587\u4ef6\uff0c\u53d6\u8be5\u5185\u5bb9\u4e0e\u7279\u5b9a\u5934\u4fe1\u606f\u7684SHA-1\u6821\u9a8c\u548c\uff0c\u5e76\u4ee5\u8be5\u6821\u9a8c\u548c\u524d\u4e24\u4e2a\u5b57\u7b26\u4e3a\u540d\u79f0\u521b\u5efa\u5b50\u76ee\u5f55\uff0c\u5e76\u4ee5 (\u6821\u9a8c\u548c) \u5269\u4e0b 38 \u4e2a\u5b57\u7b26\u4e3a\u540d\u79f0\u521b\u5efa\u6587\u4ef6(\u4fdd\u5b58\u81f3\u5b50\u76ee\u5f55\u4e0b)\u3002</p> <p>\u901a\u8fc7 <code>cat-file</code> \u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u4fdd\u5b58\u6570\u636e\u4fe1\u606f\u3002 <code>-p</code> \uff1a\u5c55\u793a\u6587\u4ef6\u5185\u5bb9\u3001<code>-t</code>:\u5c55\u793a\u6587\u4ef6\u7c7b\u578b\uff0c<code>-s</code>\uff1a\u5c55\u793a\u6587\u4ef6\u5927\u5c0f\u3002</p> <pre><code>$ git cat-file -p 1d1ef0ad031c84a62374eb3044da50198622c6da\nfirst demo\n</code></pre> <pre><code>$ git cat-file -t 1d1ef0ad031c84a62374eb3044da50198622c6da\nblob\n</code></pre> <p>\u6545\u901a\u8fc7<code>git hash-object</code>\u751f\u6210\u7684\u4fdd\u5b58\u6587\u4ef6\u5185\u5bb9\u7684\u5bf9\u8c61\u79f0\u4e3ablob\u5bf9\u8c61\u3002</p>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#22tree","title":"2.2\u3001tree\u5bf9\u8c61","text":"<p>tree\u5bf9\u8c61\u53ef\u4ee5\u5b58\u50a8\u6587\u4ef6\u540d\uff0c\u540c\u65f6\u4e5f\u5141\u8bb8\u5b58\u50a8\u4e00\u7ec4\u6587\u4ef6\u3002\u4e00\u4e2a\u5355\u72ec\u7684 tree \u5bf9\u8c61\u5305\u542b\u4e00\u6761\u6216\u591a\u6761 tree \u8bb0\u5f55\uff0c\u6bcf\u4e00\u6761\u8bb0\u5f55\u542b\u6709\u4e00\u4e2a\u6307\u5411 blob \u6216\u5b50 tree \u5bf9\u8c61\u7684 SHA-1 \u6307\u9488\uff0c\u5e76\u9644\u6709\u8be5\u5bf9\u8c61\u7684\u6743\u9650\u6a21\u5f0f (mode)\u3001\u7c7b\u578b\u548c\u6587\u4ef6\u540d\u4fe1\u606f\u3002</p> <p>\u4ece\u6982\u5ff5\u4e0a\u6765\u8bb2\uff0cGit \u4fdd\u5b58\u7684\u6570\u636e\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <pre><code>graph TB\n    tree(tree) --&gt; blob1(blob)\n    tree --&gt; blob2(blob)\n    tree --&gt; tree1(tree)\n    tree1 --&gt; blob3(blob)\n</code></pre> <p>\u4e3e\u4f8b\uff1a</p> <p>\u521d\u59cb\u5316git\uff0c\u5e76\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6</p> <pre><code>$ git init\nInitialized empty Git repository in E:/Frost2-Files/IdeaWorkSpace/gitdemo/.git/\n\n$ echo 'version 1' &gt; test.txt\n</code></pre> <p>\u5c06\u6587\u4ef6\u5185\u5bb9\u4fdd\u5b58\u5230git\uff0c\u5e76\u751f\u6210SHA-1\u68c0\u9a8c\u548c</p> <pre><code>$ git hash-object -w test.txt\nwarning: LF will be replaced by CRLF in test.txt.\nThe file will have its original line endings in your working directory\n83baae61804e65cc73a7201a7252750c76066a30\n</code></pre> <p>\u5c06SHA-1\u68c0\u9a8c\u548c\u4fdd\u5b58\u5230\u6682\u5b58\u533a</p> <pre><code>$ git update-index --add --cacheinfo 100644 83baae61804e65cc73a7201a7252750c76066a30 test.txt\n</code></pre> <p>\u751f\u6210\u6811\u5bf9\u8c61</p> <pre><code>$ git write-tree\nd8329fc1cc938780ffdd9f94e0d364e0ea74f579\n</code></pre> <p>\u67e5\u770b\u8be5\u6811\u5bf9\u8c61</p> <pre><code>$ git cat-file -p d8329fc1cc938780ffdd9f94e0d364e0ea74f579\n100644 blob 83baae61804e65cc73a7201a7252750c76066a30    test.txt\n</code></pre> <p>\u6b64\u65f6\u7684\u6682\u5b58\u533a\u548c\u5bf9\u8c61\u5e93\u5982\u4e0b\uff1a</p> <pre><code>$ git ls-files -s\n100644 83baae61804e65cc73a7201a7252750c76066a30 0       test.txt\n\n$ find .git/objects/ -type f\n.git/objects/83/baae61804e65cc73a7201a7252750c76066a30\n.git/objects/d8/329fc1cc938780ffdd9f94e0d364e0ea74f579\n</code></pre> <p>\u73b0\u5728git\u4fdd\u5b58\u7684\u6570\u636e\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <pre><code>graph LR\n    tree(tree:d8329f) --&gt; blob(blob:83baae) --&gt; content[version 1]\n</code></pre> <p>\u63a5\u4e0b\u6765\u66f4\u65b0<code>test.txt</code>\u5230\u7248\u672c\u4e8c\uff0c\u5e76\u5c06\u4fee\u6539\u6dfb\u52a0\u5230\u6682\u5b58\u533a</p> <pre><code>$ echo 'version 2' &gt; test.txt\n\n$ git update-index test.txt\nwarning: LF will be replaced by CRLF in test.txt.\nThe file will have its original line endings in your working directory\n</code></pre> <p>\u6b64\u65f6\u7684\u6682\u5b58\u533a\u548c\u5bf9\u8c61\u5e93\u5982\u4e0b\uff1a</p> <pre><code>$ git ls-files -s\n100644 1f7a7a472abf3dd9643fd615f6da379c4acb3e3a 0       test.txt\n\nfrost2@frost2-pc MINGW64 /e/Frost2-Files/IdeaWorkSpace/gitdemo (master)\n$ find .git/objects/ -type f\n.git/objects/1f/7a7a472abf3dd9643fd615f6da379c4acb3e3a\n.git/objects/83/baae61804e65cc73a7201a7252750c76066a30\n.git/objects/d8/329fc1cc938780ffdd9f94e0d364e0ea74f579\n</code></pre> <p>\u751f\u6210\u6811\u5bf9\u8c61\uff0c\u5e76\u67e5\u770b</p> <pre><code>$ git write-tree\n2f39845a4a2c3ad86adebb00b1ddabd959c131c4\n\n$ git cat-file -p 2f39845a4a2c3ad86adebb00b1ddabd959c131c4\n100644 blob 1f7a7a472abf3dd9643fd615f6da379c4acb3e3a    test.txt\n</code></pre> <p>\u73b0\u5728git\u4fdd\u5b58\u7684\u6570\u636e\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <pre><code>graph LR\n    tree(tree:2f3984) --&gt; blob(blob:1f7a7a) --&gt; content[version 2]\n</code></pre> <p>\u73b0\u5728\u6765\u70b9\u66f4\u6709\u8da3\u7684\uff0c\u4f60\u53ef\u4ee5\u7528 <code>read-tree</code> \u547d\u4ee4\u5c06 tree \u5bf9\u8c61\u8bfb\u53d6\u5230\u6682\u5b58\u533a\u57df\u4e2d\u3002\u901a\u8fc7\u4f20\u4e00\u4e2a <code>--prefix</code> \u53c2\u6570\u7ed9 <code>read-tree</code>\uff0c\u5c06\u4e00\u4e2a\u5df2\u6709\u7684 tree \u5bf9\u8c61\u4f5c\u4e3a\u4e00\u4e2a\u5b50 tree \u8bfb\u5230\u6682\u5b58\u533a\u57df\u4e2d\uff1a</p> <pre><code>$ git read-tree --prefix=bak d8329fc1cc938780ffdd9f94e0d364e0ea74f579\n</code></pre> <p>\u67e5\u770b\u6682\u5b58\u533a</p> <pre><code>$ git ls-files -s\n100644 83baae61804e65cc73a7201a7252750c76066a30 0       bak/test.txt\n100644 1f7a7a472abf3dd9643fd615f6da379c4acb3e3a 0       test.txt\n</code></pre> <p>\u751f\u6210\u6811\u5bf9\u8c61</p> <pre><code>$ git write-tree\nb9c6a44acc8cf4303f3b8a7520e15df999e6057d\n</code></pre> <p>\u67e5\u770b\u6811\u5bf9\u8c61</p> <pre><code>$ git cat-file -p b9c6a44acc8cf4303f3b8a7520e15df999e6057d\n040000 tree d8329fc1cc938780ffdd9f94e0d364e0ea74f579    bak\n100644 blob 1f7a7a472abf3dd9643fd615f6da379c4acb3e3a    test.txt\n</code></pre> <p>\u73b0\u5728git\u4fdd\u5b58\u7684\u6570\u636e\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <pre><code>graph TB\n    tree(tree:b9c6a4) --&gt; blob2(blob:1f7a7a) --&gt;|\u5185\u5bb9| content2[version 2]\n    tree --&gt; tree1(tree:d8329f) --&gt; blob1(blob:83baae) --&gt;|\u5185\u5bb9| content1[version 1]\n</code></pre>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#23commit","title":"2.3\u3001commit\u5bf9\u8c61","text":"<p>\u73b0\u5728\u6211\u4eec\u6709\u4e09\u4e2atree\u5bf9\u8c61\uff0c\u5b83\u4eec\u6307\u5411\u4e86\u9879\u76ee\u7684\u4e0d\u540c\u5feb\u7167\uff0c\u53ef\u662f\u5148\u524d\u7684\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff1a\u5fc5\u987b\u8bb0\u5f80\u4e09\u4e2a SHA-1 \u503c\u4ee5\u83b7\u5f97\u8fd9\u4e9b\u5feb\u7167\u3002\u4e5f\u6ca1\u6709\u5173\u4e8e\u8c01\u3001\u4f55\u65f6\u4ee5\u53ca\u4e3a\u4f55\u4fdd\u5b58\u4e86\u8fd9\u4e9b\u5feb\u7167\u7684\u4fe1\u606f\u3002commit \u5bf9\u8c61\u4e3a\u4f60\u4fdd\u5b58\u4e86\u8fd9\u4e9b\u57fa\u672c\u4fe1\u606f\u3002</p> <p>\u8981\u521b\u5efa\u4e00\u4e2a commit \u5bf9\u8c61\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>commit-tree</code> \u547d\u4ee4\uff0c\u6307\u5b9a\u4e00\u4e2a tree \u7684 SHA-1\uff0c\u5982\u679c\u6709\u4efb\u4f55\u524d\u7ee7\u63d0\u4ea4\u5bf9\u8c61\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a\u3002</p> <pre><code>$ echo 'first commit' | git commit-tree d8329f\n81e8e6d220ca1b70b9ffb0e01b80dc7f11dcb40f\n</code></pre> <p>\u67e5\u770b\u8be5commit\u5bf9\u8c61</p> <pre><code>$ git log --stat 81e8e6d220ca1b70b9ffb0e01b80dc7f11dcb40f\ncommit 81e8e6d220ca1b70b9ffb0e01b80dc7f11dcb40f\nAuthor: frost2 &lt;frost2@163.com&gt;\nDate:   Sun Oct 24 20:34:54 2021 +0800\n\n    first commit\n\n test.txt | 1 +\n 1 file changed, 1 insertion(+)\n</code></pre> <p>\u521b\u5efa\u7b2c\u4e8c\u4e2acommit\u5bf9\u8c61\uff0c\u5e76\u7b2c\u4e00\u4e2acommit\u5bf9\u8c61\u4e3a\u524d\u7ee7\u63d0\u4ea4\u5bf9\u8c61\u3002</p> <pre><code>$ echo 'second commit' | git commit-tree 2f3984 -p 81e8e6d220ca1b70b9ffb0e01b80dc7f11dcb40f\n5298972dd73fa4a18dc51c811a60a8dfe4d770b8\n</code></pre> <p>\u67e5\u770b\u8be5\u5bf9\u8c61</p> <pre><code>$ git log --stat 5298972dd73fa4a18dc51c811a60a8dfe4d770b8\ncommit 5298972dd73fa4a18dc51c811a60a8dfe4d770b8\nAuthor: frost2 &lt;frost2@163.com&gt;\nDate:   Sun Oct 24 20:42:46 2021 +0800\n\n    second commit\n\n test.txt | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ncommit 81e8e6d220ca1b70b9ffb0e01b80dc7f11dcb40f\nAuthor: frost2 &lt;frost2@163.com&gt;\nDate:   Sun Oct 24 20:34:54 2021 +0800\n\n    first commit\n\n test.txt | 1 +\n 1 file changed, 1 insertion(+)\n</code></pre> <p>\u6ce8\u610f\uff1a\u73b0\u5728\u4f7f\u7528<code>git log</code>\u547d\u4ee4\u4f1a\u663e\u793a\u5f53\u524d\u5206\u652f\u6ca1\u6709\u63d0\u4ea4\uff0c\u5982\u4e0b</p> <pre><code>$ git log\nfatal: your current branch 'master' does not have any commits yet\n</code></pre>"},{"location":"git/Git%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#3git-reference","title":"3\u3001git reference","text":"<p>\u73b0\u5728\u4f60\u53ef\u4ee5\u6267\u884c\u50cf <code>git log 529897</code> \u8fd9\u6837\u7684\u547d\u4ee4\u6765\u67e5\u770b\u5b8c\u6574\u7684\u5386\u53f2\uff0c\u4f46\u662f\u8fd9\u6837\u4f60\u5c31\u8981\u8bb0\u5f97 <code>529897</code> \u662f\u4f60\u6700\u540e\u4e00\u6b21\u63d0\u4ea4\uff0c\u8fd9\u6837\u624d\u80fd\u5728\u63d0\u4ea4\u5386\u53f2\u4e2d\u627e\u5230\u8fd9\u4e9b\u5bf9\u8c61\u3002\u6240\u4ee5\u4f60\u9700\u8981\u4e00\u4e2a\u6587\u4ef6\u6765\u7528\u4e00\u4e2a\u7b80\u5355\u7684\u540d\u5b57\u6765\u8bb0\u5f55\u8fd9\u4e9b SHA-1 \u503c\uff0c\u8fd9\u6837\u4f60\u5c31\u53ef\u4ee5\u7528\u8fd9\u4e9b\u6307\u9488\u800c\u4e0d\u662f\u539f\u6765\u7684 SHA-1 \u503c\u53bb\u68c0\u7d22\u4e86\u3002</p> <p>\u5728 Git \u4e2d\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u201c\u5f15\u7528\u201d\uff08references \u6216\u8005 refs\uff0c\u8bd1\u8005\u6ce8\uff09\u3002\u4f60\u53ef\u4ee5\u5728 <code>.git/refs</code> \u76ee\u5f55\u4e0b\u9762\u627e\u5230\u8fd9\u4e9b\u5305\u542b SHA-1 \u503c\u7684\u6587\u4ef6\u3002\u5728\u8fd9\u4e2a\u9879\u76ee\u91cc\uff0c\u8fd9\u4e2a\u76ee\u5f55\u8fd8\u6ca1\u4e0d\u5305\u542b\u4efb\u4f55\u6587\u4ef6\uff0c\u4f46\u662f\u5305\u542b\u8fd9\u6837\u4e00\u4e2a\u7b80\u5355\u7684\u7ed3\u6784\uff1a</p> <pre><code>$ find .git/refs/\n.git/refs/\n.git/refs/heads\n.git/refs/tags\n</code></pre> <p>Git \u63d0\u4f9b\u4e86\u4e00\u4e2a\u5b89\u5168\u7684\u547d\u4ee4 <code>update-ref</code>\u5e2e\u52a9\u6211\u4eec\u5b9e\u73b0\u5c06SHA-1\u68c0\u9a8c\u548c\u6dfb\u52a0\u5230<code>refs</code>\u4e2d\u3002</p> <pre><code>$ git update-ref refs/heads/master 5298972dd73fa4a18dc51c811a60a8dfe4d770b8\n</code></pre> <p>\u6b64\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528<code>git log</code>\u67e5\u770b\u65e5\u5fd7\uff0c\u800c\u4e0d\u9700\u8981\u8bb0\u5f55\u6700\u540e\u4e00\u4e2a\u63d0\u4ea4\u7684SHA-1\u68c0\u9a8c\u548c\u3002</p> <pre><code>$ git log\ncommit 5298972dd73fa4a18dc51c811a60a8dfe4d770b8 (HEAD -&gt; master)\nAuthor: frost2 &lt;frost2@163.com&gt;\nDate:   Sun Oct 24 20:42:46 2021 +0800\n\n    second commit\n\ncommit 81e8e6d220ca1b70b9ffb0e01b80dc7f11dcb40f\nAuthor: frost2 &lt;frost2@163.com&gt;\nDate:   Sun Oct 24 20:34:54 2021 +0800\n\n    first commit\n</code></pre> <p>\u57fa\u672c\u4e0a Git \u4e2d\u7684\u4e00\u4e2a\u5206\u652f\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u6307\u5411\u67d0\u4e2a\u5de5\u4f5c\u7248\u672c\u4e00\u6761 HEAD \u8bb0\u5f55\u7684\u6307\u9488\u6216\u5f15\u7528\u3002\u4f60\u53ef\u4ee5\u7528\u8fd9\u6761\u547d\u4ee4\u521b\u5efa\u4e00\u4e2a\u6307\u5411\u7b2c\u4e8c\u6b21\u63d0\u4ea4\u7684\u5206\u652f\uff1a</p> <pre><code>$ git update-ref refs/heads/test 81e8e6d220ca1b70b9ffb0e01b80dc7f11dcb40f\n</code></pre> <p>\u6b64\u65f6\u67e5\u770b\u65e5\u5fd7\u5982\u4e0b\uff1a</p> <pre><code>$ git log test\ncommit 81e8e6d220ca1b70b9ffb0e01b80dc7f11dcb40f (test)\nAuthor: frost2 &lt;frost2@163.com&gt;\nDate:   Sun Oct 24 20:34:54 2021 +0800\n\n    first commit\n</code></pre> <p>\u6bcf\u5f53\u4f60\u521b\u5efa\u65b0\u5206\u652f\u65f6\uff0cGit \u57fa\u672c\u4e0a\u5c31\u662f\u6267\u884c <code>update-ref</code> \u547d\u4ee4\uff0c\u628a\u4f60\u73b0\u5728\u6240\u5728\u5206\u652f\u4e2d\u6700\u540e\u4e00\u6b21\u63d0\u4ea4\u7684 SHA-1 \u503c\uff0c\u6dfb\u52a0\u5230\u4f60\u8981\u521b\u5efa\u7684\u5206\u652f\u7684\u5f15\u7528\u3002</p> <p>\u672c\u4eba\u4f1a\u7ecf\u5e38\u66f4\u65b0\u535a\u5ba2\uff0c\u5e76\u5728\u6587\u7ae0\u9644\u4e0a\u66f4\u65b0\u65f6\u95f4\uff01 \u8f6c\u8f7d\u8bf7\u9644\u4e0a\u539f\u6587\u51fa\u5904\u94fe\u63a5\u548c\u672c\u58f0\u660e\u3002 \u672c\u6587\u94fe\u63a5\uff1ahttps://blog.csdn.net/weipinggg/article/details/122101866 \u6b22\u8fce\u5927\u5bb6\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7\uff1afrost2</p>"},{"location":"mysql/Buffer%20Pool/","title":"Buffer Pool","text":""},{"location":"mysql/Buffer%20Pool/#_1","title":"\u4e00\u3001\u6982\u8ff0","text":"<p>\u7f13\u51b2\u6c60\uff08<code>Buffer Pool</code>\uff09\u662f\u4e3b\u5185\u5b58\u4e2d\u7684\u4e00\u4e2a\u533a\u57df\uff0c\u5b83\u4e3b\u8981\u7528\u4e8e\u7f13\u5b58\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u548c\u7d22\u5f15\uff0c\u4ee5\u51cf\u5c11\u76f4\u63a5\u4ece\u78c1\u76d8\u8fdb\u884cIO\u64cd\u4f5c\u7684\u6b21\u6570\uff0c\u4ece\u800c\u63d0\u9ad8\u6570\u636e\u5e93\u7684\u6027\u80fd\u3002\u5728\u4e13\u7528\u670d\u52a1\u5668\u4e0a\uff0c\u9ad8\u8fbe 80% \u7684\u7269\u7406\u5185\u5b58\u901a\u5e38\u5206\u914d\u7ed9\u7f13\u51b2\u6c60\u3002</p> <p>\u4e3a\u4e86\u63d0\u9ad8\u5927\u5bb9\u91cf\u8bfb\u53d6\u64cd\u4f5c\u7684\u6548\u7387\uff0c\u7f13\u51b2\u6c60\u88ab\u5212\u5206\u4e3a\u53ef\u4ee5\u5bb9\u7eb3\u591a\u884c\u7684\u9875\u9762\u3002\u4e3a\u4e86\u63d0\u9ad8\u7f13\u5b58\u7ba1\u7406\u7684\u6548\u7387\uff0c\u7f13\u51b2\u6c60\u88ab\u5b9e\u73b0\u4e3a\u9875\u9762\u7684\u94fe\u8868\uff0c\u4f7f\u7528LRU\u7b97\u6cd5\u7684\u53d8\u4f53\uff0c\u5f88\u5c11\u4f7f\u7528\u7684\u6570\u636e\u4f1a\u4ece\u7f13\u5b58\u4e2d\u8001\u5316\u3002</p>"},{"location":"mysql/Buffer%20Pool/#_2","title":"\u4e8c\u3001\u7ec4\u7ec7\u7ed3\u6784","text":"<p>\u4e3a\u4e86\u51cf\u5c11\u5e76\u53d1\u8bbf\u95ee\u7684\u51b2\u7a81\uff0cInnoDB\u5c06Buffer Pool\u5212\u5206\u4e3a\u4e00\u4e2a\u6216\u591a\u4e2aBuffer Pool Instances\uff0c\u6bcf\u4e2aInstance\u4e4b\u95f4\u6ca1\u6709\u9501\u51b2\u7a81\uff0c\u6bcf\u4e2aPage\u56fa\u5b9a\u5c5e\u4e8e\u5176\u4e2d\u4e00\u4e2aInstance\u3002\u4ece\u7ed3\u6784\u4e0a\u770b\u6bcf\u4e2aInstance\u90fd\u662f\u5bf9\u7b49\u7684\uff0c\u5355\u4e2aInstance\u7684\u6570\u636e\u7ed3\u6784\u4e3abuf_pool_t\uff0c\u56e0\u6b64\u672c\u6587\u63a5\u4e0b\u6765\u7684\u5185\u5bb9\u90fd\u4ee5\u4e00\u4e2aInstance\u6765\u8fdb\u884c\u4ecb\u7ecd\u7684\u3002</p> <ul> <li>\u901a\u8fc7<code>innodb_buffer_pool_size</code>\u8bbe\u7f6e\u7f13\u51b2\u6c60\u603b\u5927\u5c0f</li> </ul> <pre><code>mysql&gt; show variables like 'innodb_buffer_pool_size'; //128M\n+-------------------------+-----------+\n| Variable_name           | Value     |\n+-------------------------+-----------+\n| innodb_buffer_pool_size | 134217728 |\n+-------------------------+-----------+\n1 row in set (0.00 sec)\n</code></pre> <ul> <li>\u901a\u8fc7<code>innodb_buffer_pool_instances</code>\u8bbe\u7f6e\u7f13\u51b2\u6c60\u5b9e\u4f8b\u6570</li> </ul> <pre><code>mysql&gt; show variables like 'innodb_buffer_pool_instances';\n+------------------------------+-------+\n| Variable_name                | Value |\n+------------------------------+-------+\n| innodb_buffer_pool_instances | 1     |\n+------------------------------+-------+\n1 row in set (0.20 sec)\n</code></pre>"},{"location":"mysql/Buffer%20Pool/#21-buffer-chunks","title":"2.1 Buffer Chunks","text":"<p>\u5728MySQL 5.7.5\u4e4b\u524d\uff0cBuffer Pool\u53ea\u80fd\u5728\u542f\u52a8\u65f6\u901a\u8fc7innodb_buffer_pool_size\u53c2\u6570\u6765\u8c03\u6574\u5927\u5c0f\u3002\u5728MySQL 5.7.5\u53ca\u4e4b\u540e\u7684\u7248\u672c\u4e2d\u652f\u6301\u5728\u6570\u636e\u5e93\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u8c03\u6574Buffer Pool\u5927\u5c0f\u3002\u4e3a\u6b64\uff0cInnoDB\u5b58\u50a8\u5f15\u64ce\u5c06\u4e00\u4e2aInstance\u5212\u5206\u4e3a\u82e5\u5e72\u4e2aChunk\u7ec4\u6210\uff0c\u6bcf\u6b21\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u7f13\u5b58\u65f6\u5c31\u4ee5\u4e00\u4e2aChunk\u4e3a\u5355\u4f4d\u3002\u5176\u6570\u636e\u7ed3\u6784\u4e3abuf_chunk_t\u3002</p> <ul> <li>\u901a\u8fc7\u53c2\u6570<code>innodb_buffer_pool_chunk_size</code>\u8bbe\u7f6eChunk\u5927\u5c0f</li> </ul> <pre><code>mysql&gt; show variables like 'innodb_buffer_pool_chunk_size';\n+-------------------------------+-----------+\n| Variable_name                 | Value     |\n+-------------------------------+-----------+\n| innodb_buffer_pool_chunk_size | 134217728 |\n+-------------------------------+-----------+\n1 row in set (0.00 sec)\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff1a</p> <p>innodb_buffer_pool_chunk_size\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5927\u5c0f\u4e3a128M\uff0c\u53ea\u80fd\u5728\u6570\u636e\u5e93\u542f\u52a8\u65f6\u8bbe\u7f6e\uff0c\u4e0d\u80fd\u5728\u8fd0\u884c\u671f\u95f4\u4fee\u6539\uff0c\u4ee5\u4fdd\u8bc1\u6bcf\u6b21\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u7684\u8fde\u7eed\u7a7a\u95f4\u5927\u5c0f\u4e00\u81f4\u3002</p> <ul> <li>Buffer Pool Size\u3001Instance\u3001Chunk\u5173\u7cfb</li> </ul> <p>InnoDB\u5b58\u50a8\u5f15\u64ce\u89c4\u5b9a\u4e86<code>innodb_buffer_pool_size</code>\u5fc5\u987b\u662f<code>innodb_buffer_pool_chunk_size</code> \u4e58\u4ee5 <code>innodb_buffer_pool_instances</code>\u7684\u500d\u6570\u3002\u5047\u5982\u6211\u6545\u610f\u4fee\u6539\u53c2\u6570\u503c\u4f7f\u5176\u4e0d\u6ee1\u8db3\u4e0a\u9762\u8fd9\u4e2a\u5173\u7cfb\uff0c\u90a3\u4e48InnoDB\u4f1a\u81ea\u52a8\u8c03\u6574\u53d8\u91cf\u503c\uff0c\u4f7f\u5176\u6ee1\u8db3\u4e0a\u8ff0\u5173\u7cfb\u3002\u7ec6\u8282\u6211\u5c31\u4e0d\u8d58\u8ff0\u4e86\uff0c\u53ef\u4ee5\u770b\u5b98\u7f51\u8bf4\u660e\uff0c\u8fd9\u91cc\u8be6\u7ec6\u8bb2\u8ff0\u4e86\u4e09\u8005\u5173\u7cfb\uff1aConfiguring InnoDB Buffer Pool Size</p>"},{"location":"mysql/Buffer%20Pool/#21-blockpage","title":"2.1 Block\u3001Page","text":"<p>InnoDB\u5b58\u50a8\u5f15\u64ce\u5c06\u5206\u914d\u7684\u5185\u5b58\uff08Chunk\uff09\u5212\u5206\u4e3a\u5927\u5c0f\u76f8\u7b49\u7684Block\uff0c\u540c\u65f6\u4e3a\u6bcf\u4e00\u4e2aBlock\u90fd\u5206\u914d\u4e86\u4e00\u4e2a\u5185\u5b58\u7ba1\u7406\u7ed3\u6784buf_block_t\uff0c\u7528\u6765\u7ef4\u62a4Block\u76f8\u5173\u7684\u72b6\u6001\u4fe1\u606f\u3001\u52a0\u9501\u4fe1\u606f\u3001\u5185\u5b58\u6570\u636e\u7ed3\u6784\u6307\u9488\u7b49\u3002Block\u662fPage\u5728\u5185\u5b58\u4e2d\u7684\u8f7d\u4f53\uff0c\u771f\u6b63\u7684\u6570\u636e\u9875\u5c31\u4fdd\u5b58\u5728Block\u4e2d\uff0c\u5176\u90e8\u5206\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>/** The buffer control block structure */\nstruct buf_block_t {\n\n  /** page information; this must be the first field, so \n  that buf_pool-&gt;page_hash can point to buf_page_t or buf_block_t\n  */\n  buf_page_t page; //page\u9875\u6570\u636e\u7ed3\u6784\n\n  /** read-write lock of the buffer frame */\n  BPageLock lock;\n\n  /** pointer to buffer frame which is of size UNIV_PAGE_SIZE, \n  and aligned to an address divisible by UNIV_PAGE_SIZE */\n  byte *frame;\n\n  ......\n}\n</code></pre> <p>Buffer Chunks\u4e2d\u63a7\u5236\u5757\u88ab\u5b58\u653e\u5230\u524d\u8fb9\uff0c\u7f13\u5b58\u9875\u88ab\u5b58\u653e\u5230\u540e\u8fb9\uff0c\u63a7\u5236\u5757\u4e2dbuf_block_t\u901a\u8fc7\u6307\u9488\u6307\u5411block\uff0c\u5176\u7ed3\u6784\u5927\u81f4\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <p>\u5728InnoDB\u542f\u52a8\u65f6\uff0c\u9ed8\u8ba4\u4f7f\u7528<code>mmap</code>\u6765\u5206\u914d\u5185\u5b58\u3002 \u5206\u914d\u4e4b\u540e\u901a\u8fc7<code>buf_chunk_init</code>\u51fd\u6570\u521d\u59cb\u5316Buffer Chunks\uff0c\u56e0\u6b64InnoDB\u5728\u542f\u52a8\u65f6\u5e76\u4e0d\u4f1a\u771f\u6b63\u5360\u7528\u8fd9\u4e48\u5927\u7684\u7269\u7406\u5185\u5b58\uff0c\u800c\u662f\u968f\u7740Page\u7684\u5206\u914d\u4e0d\u65ad\u4e0a\u6da8\u7684\u3002\u6bcf\u4e2abuf_block_t\u90fd\u5bf9\u5e94\u4e00\u4e2aBlock\uff0c\u90a3\u5728\u5206\u914d\u8db3\u591f\u591a\u7684buf_block_t\u548cBlock\u540e\uff0c\u53ef\u80fd\u5269\u4f59\u7684\u90a3\u70b9\u513f\u7a7a\u95f4\u4e0d\u591f\u4e00\u5bf9buf_block_t\u548cBlock\u7684\u5927\u5c0f\uff0c\u8fd9\u4e2a\u7528\u4e0d\u5230\u7684\u90a3\u70b9\u513f\u5185\u5b58\u7a7a\u95f4\u5c31\u88ab\u79f0\u4e3a<code>\u788e\u7247</code>\u3002</p> <p>\u770b\u5230\u8fd9\u91cc\u6211\u4eec\u5df2\u7ecf\u6e05\u695a\u4e86Buffer Pool\u4e2d\u6570\u636e\u5b58\u50a8\u7684\u7ed3\u6784\uff0c\u5927\u81f4\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p>"},{"location":"mysql/Buffer%20Pool/#_3","title":"\u4e09\u3001\u9875\u9762\u94fe\u8868\u7ba1\u7406","text":"<p>\u901a\u8fc7\u4e0a\u8ff0\u7bc7\u5e45\u5df2\u7ecf\u4ecb\u7ecd\u4e86Buffer Pool\u4e2d\u7684\u6570\u636e\u5b58\u50a8\u7ed3\u6784\uff0c\u672c\u8282\u4e3b\u8981\u4ecb\u7ecd\u4e0bInnoDB\u662f\u5982\u4f55\u901a\u8fc7\u4e0b\u8ff0\u8fd9\u4e9b\u94fe\u8868\u6765\u7ba1\u7406Buffer Pool\u7684\u6570\u636e\u7684\u3002</p> <p>Buffer Pool\u4e2d\u7684\u6bcf\u4e2a\u94fe\u8868\u90fd\u662f\u53cc\u5411\u94fe\u8868\uff0c\u8282\u70b9\u7c7b\u578b\u90fd\u662f buf_block_t \uff0c\u57fa\u8282\u70b9\u4e2d\u4fdd\u5b58\u4e86\u9996\u5c3e\u8282\u70b9\u4fe1\u606f\u548c\u94fe\u8868\u957f\u5ea6\u7b49\uff0c\u5927\u81f4\u7ed3\u6784\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p> <p>Buffer Pool \u4e2d\u7684\u9875\u9762\u4f7f\u7528\u60c5\u51b5\u5982\u4e0b\u56fe\u6240\u793a\u3002\u5176\u4e2d\u6bcf\u4e2a\u5c0f\u65b9\u683c\u53ef\u89c6\u4e3a\u4e00\u4e2a\u9875\uff0cfree \u8868\u793a\u7a7a\u95f2\u9875\uff0c\u5373\u8be5\u9875\u9762\u5bf9\u5e94\u7684\u6570\u636e\u4e3a\u7a7a\uff0c\u968f\u65f6\u53ef\u4ee5\u586b\u5165\u65b0\u7684\u6570\u636e\uff1bclean \u8868\u793a\u5e72\u51c0\u9875\uff0c\u5373\u8be5\u9875\u9762\u5b58\u5728\u6570\u636e\uff0c\u4e14\u8be5\u6570\u636e\u672a\u88ab\u66f4\u65b0\uff1bdirty \u8868\u793a\u810f\u9875\uff0c\u5373\u8be5\u9875\u9762\u5b58\u5728\u6570\u636e\u5df2\u88ab\u66f4\u65b0\u3002\u5404\u4e2a\u7c7b\u578b\u7684\u9875\u540c\u65f6\u5b58\u5728\u4e8e BP \u4e2d\uff0c\u5b83\u4eec\u88ab\u5404\u4e2a\u94fe\u8868\u4e32\u8d77\u6765\uff0c\u534f\u540c\u7ba1\u7406\u3002</p> <p></p>"},{"location":"mysql/Buffer%20Pool/#31-free-list","title":"3.1 Free List","text":"<p>\u6570\u636e\u5e93\u521a\u542f\u52a8\u65f6\uff0c\u6240\u6709\u7684\u9875\u90fd\u5728Free\u94fe\u8868\u4e2d\u3002\u5f53\u7f13\u51b2\u6c60\u9700\u8981\u4f7f\u7528\u6570\u636e\u9875\u65f6\uff0c\u9996\u5148\u4eceFree\u94fe\u8868\u4e2d\u67e5\u627e\u662f\u5426\u6709\u53ef\u7528\u7684\u7a7a\u95f2\u9875\uff0c\u82e5\u6709\u5219\u5c06\u8be5\u9875\u4eceFree\u94fe\u8868\u4e2d\u5220\u9664\uff0c\u653e\u5230LRU\u94fe\u8868\u4e2d\u3002\u5426\u5219\uff0c\u6839\u636eLRU\u7b97\u6cd5\uff0c\u6dd8\u6c70LRU\u94fe\u8868\u5c3e\u90e8\u7684\u9875\uff0c\u5c06\u5185\u5b58\u7a7a\u95f4\u5206\u914d\u7ed9\u65b0\u7684\u9875\u3002</p>"},{"location":"mysql/Buffer%20Pool/#32-lru-list","title":"3.2 LRU List","text":"<p>LUR\u94fe\u8868\u4fdd\u5b58\u4e86\u7f13\u51b2\u6c60\u7684\u6240\u6709\u6240\u6709\u6570\u636e\u9875\uff0c\u5f53\u5185\u5b58\u7a7a\u95f4\u8fbe\u5230\u4e0a\u9650\u65f6\uff0c\u4f7f\u7528LRU\u7b97\u6cd5\u5c06\u90e8\u5206\u4e0d\u5e38\u7528\u7684\u9875\u6dd8\u6c70\u3002</p>"},{"location":"mysql/Buffer%20Pool/#311","title":"3.1.1 \u5177\u4f53\u5b9e\u73b0","text":"<p>InnoDB\u5b58\u50a8\u5f15\u64ce\uff0c\u5728LRU\u7b97\u6cd5\u7684\u57fa\u7840\u4e0a\u52a0\u5165\u4e86\u4e24\u70b9\u4f18\u5316\uff0c\u7b2c\u4e00\u70b9\u662f\u5f15\u5165\u4e86midlepoint\u4f4d\u7f6e\uff0c\u65b0\u8bfb\u53d6\u7684\u9875\u4e0d\u662f\u653e\u5728\u9996\u90e8\uff0c\u800c\u662f\u653e\u5728midlepoint\u4f4d\u7f6e\u3002\u9ed8\u8ba4\u914d\u7f6e\u4e0b\u8be5\u4f4d\u7f6e\u4f4d\u4e8e\u94fe\u8868\u76845/8\u5904\uff0c\u7531\u53c2\u6570<code>innodb_old_blocks_pct</code>\u63a7\u5236\u3002\u5176\u503c\u9ed8\u8ba4\u4e3a37\uff08\u5927\u7ea6\u4e3a3/8\uff09\u3002\u5728InnoDB\u4e2d\u5c06midlepoint\u4e4b\u524d\u7684\u90e8\u5206\u79f0\u4e3anew sublist\uff0c\u4e4b\u540e\u7684\u90e8\u5206\u79f0\u4e3aold sublist\u3002</p> <pre><code>//\u9ed8\u8ba437\uff0c\u6700\u5927\u503c\u4e3a95\nmysql&gt; set global innodb_old_blocks_pct = 100;\nQuery OK, 0 rows affected, 1 warning (0.00 sec)\n\nmysql&gt; show variables like 'innodb_old_blocks_pct';\n+-----------------------+-------+\n| Variable_name         | Value |\n+-----------------------+-------+\n| innodb_old_blocks_pct | 95    |\n+-----------------------+-------+\n1 row in set (0.00 sec)\n</code></pre> <p>\u7b2c\u4e8c\u70b9\u662f\u5f15\u5165\u4e86\u53e6\u4e00\u4e2a\u53c2\u6570<code>innodb_old_blocks_time</code>\uff0c\u7528\u6765\u6307\u5b9a\u7b2c\u4e00\u6b21\u8bbf\u95ee\u9875\u540e\u7684\u65f6\u95f4\u7a97\u53e3\uff08\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\uff09\uff0c\u5728\u6b64\u671f\u95f4\u53ef\u4ee5\u8bbf\u95ee\u8be5\u9875\u800c\u65e0\u9700\u5c06\u5176\u79fb\u52a8\u5230 new sublist\u7684\u5934\u90e8\u3002</p> <pre><code>mysql&gt; show variables like 'innodb_old_blocks_time';\n+------------------------+-------+\n| Variable_name          | Value |\n+------------------------+-------+\n| innodb_old_blocks_time | 1000  |\n+------------------------+-------+\n1 row in set (0.00 sec)\n</code></pre> <p>InnoDB\u5b58\u50a8\u5f15\u64ce\u7684LRU\u94fe\u8868\uff0c\u7ed3\u6784\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"mysql/Buffer%20Pool/#312","title":"3.1.2 \u4f18\u5316\u539f\u56e0","text":"<p>InnoDB\u5e76\u6ca1\u6709\u91c7\u7528\u4e25\u683c\u7684LRU\u7b97\u6cd5\uff0c\u662f\u4e3a\u4e86\u89e3\u51b3\u9884\u8bfb\u548c\u5168\u8868\u626b\u63cf\u6240\u5e26\u6765\u7684\u95ee\u9898\u3002</p> <ul> <li>\u9884\u8bfb</li> </ul> <p>\u9884\u8bfb\u672c\u8eab\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u673a\u5236\uff0c\u4f46\u662f\u5982\u679c\u7f13\u51b2\u6c60\u5bb9\u91cf\u4e0d\u8db3\u4e14\u9884\u8bfb\u7684\u5927\u91cf\u9875\u9762\u6ca1\u6709\u4f7f\u7528\u5230\u8bdd\uff0c\u90a3\u4e48\u5c06\u9884\u8bfb\u7684\u9875\u9762\u653e\u5230LRU\u7684\u9996\u90e8\uff0c\u5c31\u4f1a\u5bfc\u81f4\u771f\u6b63\u70ed\u70b9\u7684\u9875\u88ab\u6dd8\u6c70\u3002\u6240\u4ee5\u5f15\u5165midpoint\uff0c\u5c06\u65b0\u8bfb\u53d6\u7684\u6570\u636e\u653e\u5230midpoint\u4f4d\u7f6e\uff0c\u5373\u4f7f\u540e\u7eed\u4e0d\u518d\u4f7f\u7528\uff0c\u4e5f\u4e0d\u4f1a\u5bf9\u7f13\u51b2\u6c60\u6709\u8f83\u5927\u7684\u5f71\u54cd\u3002</p> <ul> <li>\u5168\u8868\u626b\u63cf</li> </ul> <p>InnoDB\u4e2d\u6bcf\u6b21\u8bfb\u53d6\u9875\u4e2d\u7684\u4e00\u6761\u8bb0\u5f55\uff0c\u90fd\u7b97\u662f\u5bf9\u9875\u9762\u7684\u4e00\u6b21\u8bbf\u95ee\uff0c\u6240\u4ee5\u7d22\u5f15\u6216\u6570\u636e\u7684\u626b\u63cf\u64cd\u4f5c\uff0c\u4ed6\u4eec\u9700\u8981\u8bbf\u95ee\u8868\u4e2d\u7684\u5f88\u591a\u9875\uff0c\u5e76\u4e14\u4f1a\u8bbf\u95ee\u4e5f\u4e2d\u7684\u5f88\u591a\u6761\u8bb0\u5f55\uff0c\u8fd9\u4e9b\u9875\u901a\u5e38\u4ec5\u5728\u8fd9\u6b21\u67e5\u8be2\u4e2d\u4f7f\u7528\uff0c\u5e76\u4e0d\u662f\u70ed\u70b9\u6570\u636e\uff0c\u90a3\u4e48\u5373\u4f7f\u65b0\u8bfb\u53d6\u65f6\u5c06\u9875\u653e\u5165midpoint\u4f4d\u7f6e\uff0c\u4e5f\u4f1a\u56e0\u4e3a\u626b\u63cf\u64cd\u4f5c\u800c\u5bfc\u81f4\u9875\u88ab\u79fb\u52a8\u5230\u4e86new sublist\u7684\u5934\u90e8\u3002\u56e0\u6b64InnoDB\u5f15\u5165<code>innodb_old_blocks_time</code>\u53c2\u6570\uff0c\u65b0\u8bfb\u53d6\u7684\u9875\u5728\u89c4\u5b9a\u7684\u65f6\u95f4\u7a97\u53e3\u5185\u4e0d\u4f1a\u88ab\u79fb\u52a8\u5230new sublist\u3002</p>"},{"location":"mysql/Buffer%20Pool/#33-flush-list","title":"3.3 Flush List","text":"<p>LRU\u94fe\u8868\u4e2d\u7684\u9875\u88ab\u4fee\u6539\u540e\u79f0\u4e3a\u810f\u9875\uff0cInnoDB\u4f1a\u5c06\u810f\u9875\u5148\u653e\u5230Flush\u94fe\u8868\uff0c\u4e4b\u540e\u4f1a\u901a\u8fc7Checkpoint\u673a\u5236\u5c06\u810f\u9875\u5237\u65b0\u5230\u78c1\u76d8\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\u810f\u9875\u5373\u5b58\u5728\u4e8eLRU\u94fe\u8868\uff0c\u4e5f\u5b58\u5728\u4e0eFlush\u94fe\u8868\u3002LRU\u94fe\u8868\u7528\u6765\u7ba1\u7406\u7f13\u51b2\u6c60\u4e2d\u9875\u7684\u53ef\u7528\u6027\uff0cFlush\u94fe\u8868\u7528\u6765\u5c06\u810f\u9875\u5237\u65b0\u56de\u78c1\u76d8\uff0c\u4e8c\u8005\u4e92\u4e0d\u5f71\u54cd\u3002\u4e4b\u540eInnoDB\u4f1a\u901a\u8fc7checkpoint\u673a\u5236\u5c06\u810f\u9875\u5237\u65b0\u4f1a\u78c1\u76d8\u3002</p>"},{"location":"mysql/Buffer%20Pool/#34-page_hash","title":"3.4 Page_hash","text":"<p>\u5df2\u7ecf\u4ecb\u7ecd\u4e86\u4e09\u79cd\u94fe\u8868\uff0c\u6b64\u65f6\u5982\u679c\u60f3\u8981\u627e\u5230\u7f13\u51b2\u6c60\u4e2d\u7684\u4e00\u4e2a\u9875\uff0c\u5e94\u8be5\u600e\u4e48\u505a\uff1f\u904d\u5386LRU\u94fe\u8868\u5417\uff1f</p> <p>\u5f53\u7136\u4e0d\u662f\uff0cBuffer Pool\u63d0\u4f9b\u4e86\u4e00\u4e2a\u63a5\u53e3\u2014\u2014<code>buf_page_get_gen</code>\uff0c\u8be5\u63a5\u53e3\u7528\u6765\u67e5\u8be2\u5185\u5b58\u4e2d\u7684\u6570\u636e\u9875\uff0c\u5916\u90e8\u90fd\u662f\u901a\u8fc7\u8fd9\u4e2a\u63a5\u53e3\u6765\u67e5\u8be2\u7f13\u51b2\u6c60\u4e2d\u7684\u6570\u636e\u9875\u7684\u3002\u53ef\u4ee5\u60f3\u5230<code>buf_page_get_gen</code>\u4e00\u5b9a\u662f\u9ad8\u9891\u8bbf\u95ee\u7684\u63a5\u53e3\uff0c\u90a3\u4e48\u81ea\u7136\u5c31\u4e0d\u4f1a\u6bcf\u6b21\u67e5\u8be2\u90fd\u904d\u5386LRU\u94fe\u8868\u3002\u5b9e\u9645\u4e0a\u6bcf\u4e2aBuffer Pool\u5b9e\u4f8b\u90fd\u63d0\u4f9b\u4e86\u4e00\u4e2a\u540d\u4e3apage_hash\u7684Hash Table\uff0c\u5728Buffer Pool\u521d\u59cb\u5316\u7684\u65f6\u5019\u4f1a\u5c06\u5f53\u524d\u5b9e\u4f8b\u6240\u6709\u7684\u6570\u636e\u9875\u90fd\u521d\u59cb\u5316\u5230page_hash\u3002 </p> <p>\u7efc\u4e0a\u6240\u8ff0\uff0c\u5f53InnoDB\u8bfb\u53d6Page\u65f6\uff0c\u9996\u5148\u4f1a\u4ece\u5f53\u524dBuffer Pool Instance\u7684page_hash\u67e5\u627e\uff0c\u5927\u81f4\u5206\u4e3a\u4e09\u79cd\u60c5\u51b5\u6765\u5904\u7406\uff1a</p> <ol> <li>\u5982\u679c\u5728page_hash\u627e\u5230\uff0c\u5373Page\u5728LRU List\u4e2d\uff0c\u5219\u4f1a\u5224\u65adPage\u662f\u5728Old\u533a\u8fd8\u662fYoung\u533a\uff0c\u5982\u679c\u662f\u5728Old\u533a\uff0c\u5728\u8bfb\u53d6\u5b8cPage\u540e\u4f1a\u628a\u5b83\u6dfb\u52a0\u5230Young\u533a\u7684\u94fe\u8868\u5934</li> <li>\u5982\u679c\u5728page_hash\u627e\u5230\uff0c\u5e76\u4e14Page\u5728Young\u533a\uff0c\u9700\u8981\u5224\u65adPage\u6240\u5728Young\u533a\u7684\u4f4d\u7f6e\uff0c\u53ea\u6709Page\u5904\u4e8eYoung\u533a\u603b\u957f\u5ea6\u5927\u7ea61/4\u7684\u4f4d\u7f6e\u4e4b\u540e\uff0c\u624d\u4f1a\u5c06\u5176\u6dfb\u52a0\u5230Young\u533a\u7684\u94fe\u8868\u5934\u90e8</li> <li>\u5982\u679c\u672a\u80fd\u5728page_hash\u627e\u5230\uff0c\u5219\u9700\u8981\u53bb\u78c1\u76d8\u4e2d\u7684\u6570\u636e\u6587\u4ef6\u4e2d\u8bfb\u53d6Page\uff0c\u5e76\u5c06\u5176\u6dfb\u52a0\u5230Old\u533a\u7684\u5934\u90e8\u3002</li> </ol>"},{"location":"mysql/Buffer%20Pool/#35-ahi","title":"3.5 AHI","text":"<p>\u4e0a\u6587\u60c5\u51b53\u4e2d\uff0c\u5f53\u6570\u636e\u9875\u4e0d\u5728\u7f13\u51b2\u6c60\u65f6\uff0c\u6211\u4eec\u9700\u8981\u4ece\u78c1\u76d8\u8bfb\u53d6\u6570\u636e\uff0c\u6b64\u65f6\u5c31\u9700\u8981\u4eceB+\u6811\u4e2d\u67e5\u627e\u3002</p> <p>\u4e3a\u4e86\u63d0\u9ad8\u67e5\u8be2B+\u6811\u7684\u6548\u7387\uff0cInnoDB\u5b58\u50a8\u5f15\u64ce\u4f1a\u76d1\u63a7\u8868\u4e2d\u5404\u7d22\u5f15\u9875\u7684\u67e5\u8be2\u3002\u5982\u679c\u89c2\u5bdf\u5230\u5efa\u7acb\u54c8\u5e0c\u7d22\u5f15\u53ef\u4ee5\u5e26\u6765\u901f\u5ea6\u63d0\u5347\uff0c\u5219\u81ea\u52a8\u5efa\u7acb\u54c8\u5e0c\u7d22\u5f15\uff0c\u79f0\u4e4b\u4e3a\u81ea\u9002\u5e94\u54c8\u5e0c\u7d22\u5f15\uff08Adaptive Hash Index\uff0cAHI\uff09\u3002AHI\u662f\u901a\u8fc7\u7f13\u51b2\u6c60\u7684B+\u6811\u9875\u6784\u9020\u800c\u6765\uff0c\u56e0\u6b64\u5efa\u7acb\u7684\u901f\u5ea6\u5f88\u5feb\uff0c\u800c\u4e14\u4e0d\u9700\u8981\u5bf9\u6574\u5f20\u8868\u6784\u5efa\u54c8\u5e0c\u7d22\u5f15\u3002InnoDB\u5b58\u50a8\u5f15\u64ce\u6839\u636e\u8bbf\u95ee\u7684\u9891\u7387\u548c\u6a21\u5f0f\u6765\u81ea\u52a8\u5730\u4e3a\u67d0\u4e9b\u70ed\u70b9\u9875\u5efa\u7acb\u54c8\u5e0c\u7d22\u5f15\u3002</p>"},{"location":"mysql/Buffer%20Pool/#351","title":"3.5.1 \u751f\u6548\u6761\u4ef6","text":"<p>AHI\u4ec5\u5bf9\u7b49\u503c\u67e5\u8be2\u751f\u6548\uff0c\u5e76\u4e14\u8981\u6c42\u5bf9\u4e5f\u5f97\u8fde\u7eed\u8bbf\u95ee\u6a21\u5f0f\u5fc5\u987b\u4e00\u6837\uff0c\u4f8b\u5982\u5bf9\u4e8e\uff08a\uff0cb\uff09\u8fd9\u6837\u7684\u8054\u5408\u7d22\u5f15\u9875\uff0c\u5176\u8bbf\u95ee\u6a21\u5f0f\u53ef\u4ee5\u662f\u4ee5\u4e0b\u60c5\u51b5\uff1a</p> <ul> <li>WHERE a=xxx</li> <li>WHERE a=xxx and b=xxx</li> </ul> <p>\u8bbf\u95ee\u6a21\u5f0f\u4e00\u6837\u6307\u7684\u662f\u67e5\u8be2\u7684\u6761\u4ef6\u4e00\u6837\uff0c\u82e5\u4ea4\u66ff\u8fdb\u884c\u4e0a\u8ff0\u4e24\u79cd\u67e5\u8be2\uff0c\u90a3\u4e48InonDB\u5b58\u50a8\u5f15\u64ce\u4e0d\u4f1a\u5bf9\u8be5\u9875\u6784\u9020AHI\u3002\u6b64\u5916AHI\u8fd8\u6709\u5982\u4e0b\u7684\u8981\u6c42\uff1a</p> <ul> <li>\u4ee5\u8be5\u6a21\u5f0f\u8bbf\u95ee\u4e86100\u6b21</li> <li>\u9875\u901a\u8fc7\u8be5\u6a21\u5f0f\u8bbf\u95ee\u4e86N\u6b21\uff0c\u5176\u4e2dN=\u9875\u4e2d\u8bb0\u5f55*1/16</li> </ul>"},{"location":"mysql/Buffer%20Pool/#36-checkpoint","title":"3.6 Checkpoint\u673a\u5236","text":"<p>\u6240\u8c13\u7684Checkpoint\u673a\u5236\uff0c\u662f\u6307\u4e00\u4e2a\u89e6\u53d1\u70b9\uff08\u65f6\u95f4\u70b9\uff09\uff0c\u5f53\u53d1\u751fCheckpoint\u65f6\uff0c\u4f1a\u5c06\u810f\u9875\uff08\u6570\u636e\u810f\u9875\u548c\u65e5\u5fd7\u810f\u9875\uff09\u5199\u56de\u78c1\u76d8\u3002</p>"},{"location":"mysql/Buffer%20Pool/#361-lsn","title":"3.6.1 LSN","text":"<p>LSN\uff08Log Sequence Number\uff09\u662f\u65e5\u5fd7\u7a7a\u95f4\u4e2d\u6bcf\u6761\u65e5\u5fd7\u7684\u7ed3\u675f\u70b9\uff0c\u7528\u5b57\u8282\u504f\u79fb\u91cf\u6765\u8868\u793a\u3002\u5728 InnoDB \u5b58\u50a8\u5f15\u64ce\u4e2d\uff0cLSN \u53608\u4e2a\u5b57\u8282\uff0c\u5b83\u7684\u503c\u4f1a\u968f\u7740\u65e5\u5fd7\u7684\u5199\u5165\u800c\u9010\u6e10\u53d8\u5927\u3002\u9664\u4e86\u91cd\u505a\u65e5\u5fd7\uff0c\u6bcf\u4e2a\u9875\uff08\u5728\u6bcf\u4e2a\u6570\u636e\u9875\u7684\u5934\u90e8 FILE_HEADER \u90e8\u5206\uff0c\u6709\u4e00\u4e2a FIL_PAGE_LSN \u8bb0\u5f55\u4e86\u8be5\u6570\u636e\u9875\u6700\u540e\u88ab\u4fee\u6539\u7684\u65e5\u5fd7\u5e8f\u5217\u4f4d\u7f6e\uff09\u4ee5\u53ca Checkpoint \u4e5f\u4f1a\u88ab\u5206\u914d\u4e00\u4e2aLSN\uff0c\u4ee5\u4fbf\u5728\u9700\u8981\u65f6\u53ef\u4ee5\u6309\u7167\u987a\u5e8f\u8fdb\u884c\u68c0\u7d22\u548c\u6062\u590d\u3002\u5373 Checkpoint \u662f\u901a\u8fc7LSN\u5b9e\u73b0\uff0c\u5176\u7531\u4e00\u4e2a LSN \u8868\u793a\uff0c\u7528\u6765\u8bb0\u5f55\u5df2\u7ecf\u5237\u56de\u78c1\u76d8\u7684\u6700\u65b0\u9875\u7684\u7248\u672c\u3002</p> <pre><code>mysql&gt; show engine innodb status\\G;\n*************************** 1. row ***************************\n  Type: InnoDB\n  Name: \nStatus: \n=====================================\n2024-01-03 14:51:21 140393160079104 INNODB MONITOR OUTPUT\n=====================================\nPer second averages calculated from the last 32 seconds\n---\nLOG\n---\nLog sequence number          31820389\nLog buffer assigned up to    31820389\nLog buffer completed up to   31820389\nLog written up to            31820389\nLog flushed up to            31820389\nAdded dirty pages up to      31820389\nPages flushed up to          31820389\nLast checkpoint at           31820389\nLog minimum file id is       9\nLog maximum file id is       9\n32 log i/o's done, 0.00 log i/o's/second\n</code></pre>"},{"location":"mysql/Buffer%20Pool/#362-checkpoint","title":"3.6.2 Checkpoint\u4f5c\u7528","text":"\u4f5c\u7528 \u8bf4\u660e \u7f29\u77ed\u6570\u636e\u5e93\u6062\u590d\u65f6\u95f4 \u5f53\u6570\u636e\u5e93\u53d1\u751f\u5b95\u673a\u65f6\uff0c\u6570\u636e\u5e93\u4e0d\u9700\u8981\u91cd\u505a\u6240\u6709\u7684\u65e5\u5fd7\uff0c\u56e0\u4e3aCheckpoint\u4e4b\u524d\u7684\u9875\u90fd\u5df2\u7ecf\u5237\u65b0\u56de\u78c1\u76d8\u3002\u6545\u6570\u636e\u5e93\u53ea\u9700\u5bf9Checkpoint\u540e\u7684\u91cd\u505a\u65e5\u5fd7\u8fdb\u884c\u6062\u590d\u3002 \u7f13\u51b2\u6c60\u4e0d\u591f\u7528\u65f6\uff0c\u5237\u65b0\u810f\u9875\u5230\u78c1\u76d8 \u5f53\u7f13\u51b2\u6c60\u4e0d\u591f\u7528\u65f6\uff0c\u6839\u636eLRU\u7b97\u6cd5\u4f1a\u6ea2\u51fa\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u9875\uff0c\u82e5\u6b64\u9875\u4e3a\u810f\u9875\uff0c\u90a3\u4e48\u9700\u8981\u5f3a\u5236\u6267\u884cCheckpoint\uff0c\u5c06\u810f\u9875\u4e5f\u5c31\u662f\u9875\u7684\u65b0\u7248\u672c\u5237\u56de\u78c1\u76d8\u3002 \u91cd\u505a\u65e5\u5fd7\u4e0d\u53ef\u7528\u65f6\uff0c\u5237\u65b0\u810f\u9875 \u5f53\u91cd\u505a\u65e5\u5fd7\u5faa\u73af\u4f7f\u7528\u65f6\uff0c\u53d1\u73b0\u91cd\u505a\u65e5\u5fd7\u8fd8\u9700\u8981\u4f7f\u7528\uff0c\u90a3\u4e48\u5fc5\u987b\u5f3a\u5236\u4ea7\u751fCheckpoint\uff0c\u5c06\u7f13\u51b2\u6c60\u4e2d\u7684\u9875\u81f3\u5c11\u5237\u65b0\u5230\u5f53\u524d\u91cd\u505a\u65e5\u5fd7\u7684\u4f4d\u7f6e\u3002"},{"location":"mysql/Buffer%20Pool/#363-checkpoint","title":"3.6.3 Checkpoint\u5206\u7c7b","text":"<p>\u5728InnoDB\u5b58\u50a8\u5f15\u64ce\u4e2d\uff0cCheckpoint\u53d1\u751f\u7684\u65f6\u95f4\u3001\u6761\u4ef6\u53ca\u810f\u9875\u7684\u9009\u62e9\u7b49\u90fd\u975e\u5e38\u590d\u6742\u3002\u800cCheckpoint\u6240\u505a\u7684\u4e8b\u60c5\u65e0\u5916\u4e4e\u662f\u5c06\u7f13\u51b2\u6c60\u4e2d\u7684\u810f\u9875\u5237\u56de\u5230\u78c1\u76d8\u3002\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\u6bcf\u6b21\u5237\u65b0\u591a\u5c11\u9875\u5230\u78c1\u76d8\uff0c\u6bcf\u6b21\u4ece\u54ea\u91cc\u53d6\u810f\u9875\uff0c\u4ee5\u53ca\u4ec0\u4e48\u65f6\u95f4\u89e6\u53d1Checkpoint\u3002</p> <p>\u5728InnoDB\u5b58\u50a8\u5f15\u64ce\u5185\u90e8\uff0c\u6709\u4e24Checkpoint\uff0c\u5206\u522b\u4e3a\uff1a</p> <ul> <li>Sharp Checkpoint</li> </ul> <p>Sharp Checkpoint \u53d1\u9001\u5728\u6570\u636e\u5e93\u5173\u95ed\u65f6\u5c06\u6240\u6709\u7684\u810f\u9875\u90fd\u5237\u65b0\u56de\u78c1\u76d8\uff0c\u8fd9\u662f\u9ed8\u8ba4\u7684\u5de5\u4f5c\u65b9\u5f0f\uff0c\u5373\u53c2\u6570 innodb_fast_shutdown=1\u3002</p> <ul> <li>Fuzzy Checkpoint</li> </ul> <p>\u6570\u636e\u5e93\u8fd0\u884c\u65f6\u4f7f\u7528Fuzzy Checkpoint\u673a\u5236\u5c06\u6240\u6709\u4e00\u90e8\u5206\u810f\u9875\u5237\u65b0\u5230\u78c1\u76d8\u3002</p> \u89e6\u53d1\u65f6\u673a \u8bf4\u660e Master Thread Checkpoint Master Thread\u6bcf\u79d2\u6216\u6bcf\u5341\u79d2\u5237\u65b0\u90e8\u5206\u810f\u9875\u5230\u78c1\u76d8\uff0c\u6b64\u64cd\u4f5c\u5f02\u6b65\u6267\u884c\u3002 FLUSH_LRU_LIST Checkpoint Buffer Pool\u7684LRU\u94fe\u8868\u9700\u8981\u4fdd\u7559\u4e00\u5b9a\u6570\u91cf\u7684\u7a7a\u95f2\u9875\u9762\uff0c\u6765\u4fdd\u8bc1Buffer Pool\u4e2d\u6709\u8db3\u591f\u7684\u7a7a\u95f4\u5e94\u5bf9\u65b0\u7684\u6570\u636e\u5e93\u8bf7\u6c42\u3002\u5728\u7a7a\u95f2\u94fe\u8868\u4e0d\u8db3\u65f6\uff0c\u79fb\u9664LRU\u94fe\u8868\u5c3e\u7aef\u7684\u9875\uff0c\u82e5\u79fb\u9664\u7684\u9875\u4e3a\u810f\u9875\uff0c\u5219\u9700\u8981\u8fdb\u884c Checkpoint\u3002\u7a7a\u95f2\u6570\u91cf\u9608\u503c\u662f\u53ef\u4ee5\u914d\u7f6e\u7684\uff08\u9ed8\u8ba4\u662f1024\uff09 Async/Sync Flush Checkpoint \u5f53\u91cd\u505a\u65e5\u5fd7\u4e0d\u53ef\u7528\uff08\u5373 redo log \u5199\u6ee1\uff09\u65f6\uff0c\u9700\u8981\u5f3a\u5236\u5c06\u4e00\u4e9b\u9875\u5237\u65b0\u56de\u78c1\u76d8\uff0c\u6b64\u65f6\u810f\u9875\u4ece\u810f\u9875\u94fe\u8868\u4e2d\u83b7\u53d6 Dirty Page too much Checkpoint \u5f53\u810f\u9875\u6570\u91cf\u592a\u591a\u65f6\u4f1a\u5f3a\u5236\u6267\u884cCheckpoint\uff0c\u4ee5\u4fdd\u8bc1\u7f13\u51b2\u533a\u6709\u8db3\u591f\u7684\u7a7a\u95f2\u9875\u3002\u53c2\u6570<code>innodb_max_dirty_pages_pct</code>\u63a7\u5236\uff0c\u9ed8\u8ba4\u4e3a75\u3002"},{"location":"mysql/Buffer%20Pool/#change-buffer","title":"\u56db\u3001Change Buffer","text":"<p>\u4e0a\u9762\u4e09\u4e2a\u7ae0\u8282\u5df2\u7ecf\u8bb2\u4e86Buffer Pool\u4e2d\u5173\u4e8e\u4f18\u5316\u67e5\u8be2\u7684\u4e00\u7cfb\u5217\u64cd\u4f5c\u3002\u5728Buffer Pool\u4e2d\u8fd8\u6709\u4e00\u5757\u5185\u5b58\uff0c\u4e13\u95e8\u7528\u6765\u4f18\u5316\u6570\u636e\u53d8\u66f4\u7684\u6548\u7387\uff0c\u5b83\u5c31\u662fChange Buffer\u3002</p> <p>\u901a\u5e38\u5e94\u7528\u7a0b\u5e8f\u4e2d\u884c\u8bb0\u5f55\u7684\u63d2\u5165\u987a\u5e8f\u662f\u6309\u7167\u4e3b\u952e\u9012\u589e\u7684\u987a\u5e8f\u8fdb\u884c\u63d2\u5165\u7684\u3002\u56e0\u6b64\uff0c\u63d2\u5165\u805a\u96c6\u7d22\u5f15\uff08Primary Key\uff09\u4e00\u822c\u662f\u987a\u5e8f\u7684\uff0c\u4e0d\u9700\u8981\u78c1\u76d8\u7684\u968f\u673a\u8bfb\u53d6\uff0c\u6545\u63d2\u5165\u901f\u5ea6\u662f\u975e\u5e38\u5feb\u7684\u3002\u4f46\u8868\u4e2d\u4e0d\u53ea\u6709\u4e00\u4e2a\u805a\u96c6\u7d22\u5f15\uff0c\u66f4\u591a\u60c5\u51b5\u4e0b\uff0c\u4e00\u5f20\u8868\u4e0a\u6709\u591a\u4e2a\u975e\u805a\u96c6\u7684\u8f85\u52a9\u7d22\u5f15\u3002\u6b64\u65f6\u8fdb\u884c\u63d2\u5165\u64cd\u4f5c\u65f6\uff0c\u5c31\u9700\u8981\u79bb\u6563\u5730\u8bbf\u95ee\u975e\u805a\u96c6\u7d22\u5f15\u9875\uff0c\u6545\u5bfc\u81f4\u63d2\u5165\u6027\u80fd\u4e0b\u964d\u3002\u8fd9\u662f\u7531B+\u6811\u7684\u7279\u6027\u5bfc\u81f4\u7684\u3002</p> <p>\u6545\u6b64\uff0cInnoDB\u5f15\u5165\u4e86Change Buffer\uff0c\u5bf9\u4e8e\u975e\u805a\u96c6\u7d22\u5f15\u7684\u63d2\u5165\u548c\u66f4\u65b0\u64cd\u4f5c\uff0c\u4e0d\u662f\u6bcf\u6b21\u76f4\u63a5\u63d2\u5165\u5230\u7d22\u5f15\u9875\u4e2d\uff0c\u800c\u662f\u5148\u5224\u65ad\u63d2\u5165\u7684\u975e\u805a\u96c6\u7d22\u5f15\u9875\u662f\u5426\u5728\u7f13\u51b2\u6c60\u4e2d\uff0c\u82e5\u5728\uff0c\u5219\u76f4\u63a5\u63d2\u5165\uff1b\u82e5\u4e0d\u5728\uff0c\u5219\u5148\u653e\u5230\u4e00\u4e2aChange Buffer\u5bf9\u8c61\u4e2d\uff0c\u7136\u540e\u518d\u4ee5\u4e00\u5b9a\u7684\u9891\u7387\u548c\u60c5\u51b5\u8fdb\u884cChange Buffer\u548c\u975e\u805a\u96c6\u7d22\u5f15\u9875\u7684merge\u64cd\u4f5c\u3002\u8fd9\u65f6\u901a\u5e38\u80fd\u5c06\u591a\u4e2a\u63d2\u5165\u5408\u5e76\u5230\u4e00\u4e2a\u64cd\u4f5c\u4e2d\uff08\u56e0\u4e3a\u5728\u4e00\u4e2a\u7d22\u5f15\u9875\u4e2d\uff09\uff0c\u8fd9\u5c31\u5927\u5927\u63d0\u9ad8\u4e86\u5bf9\u4e8e\u975e\u805a\u96c6\u7d22\u5f15\u63d2\u5165\u7684\u6027\u80fd\u3002</p> <p>\u5b9e\u9645\u4e0aChange Buffer\u662f\u5168\u5c40\u552f\u4e00\u7684\u4e00\u9897B+\u6811\uff0c\u7f13\u51b2\u6240\u6709\u5bf9\u8f85\u52a9\u7d22\u5f15\u7684\u53d8\u66f4\u64cd\u4f5c\uff0c\u5177\u4f53\u4fdd\u5b58\u5728\u5171\u4eab\u8868\u7a7a\u95f4\u4e2d\u3002</p>"},{"location":"mysql/Buffer%20Pool/#41","title":"4.1 \u751f\u6548\u6761\u4ef6","text":"<ul> <li>\u7d22\u5f15\u662f\u8f85\u52a9\u7d22\u5f15</li> <li>\u7d22\u5f15\u4e0d\u662f\u552f\u4e00\u7684</li> </ul> <p>\u8f85\u52a9\u7d22\u5f15\u4e0d\u80fd\u662f\u552f\u4e00\u7684\uff0c\u56e0\u4e3a\u5728\u63d2\u5165Change Buffer\u65f6\u4e0d\u4f1a\u53bb\u67e5\u8be2\u7d22\u5f15\u9875\u6765\u5224\u65ad\u63d2\u5165\u7684\u8bb0\u5f55\u662f\u5426\u552f\u4e00\u3002\u5982\u679c\u53bb\u67e5\u4e86\u5c31\u4f1a\u53d1\u751f\u79bb\u6563\u7684\u78c1\u76d8\u8bfb\u53d6\uff0c\u90a3\u4e48Change Buffer\u5c31\u5931\u53bb\u4e86\u610f\u4e49\u3002</p>"},{"location":"mysql/Buffer%20Pool/#42","title":"4.2 \u76f8\u5173\u53d8\u91cf","text":"<ul> <li>show engine innodb status</li> </ul> <pre><code>-------------------------------------\nINSERT BUFFER AND ADAPTIVE HASH INDEX\n-------------------------------------\nIbuf: size 1, free list len 0, seg size 2, 0 merges\nmerged operations:\n insert 0, delete mark 0, delete 0\ndiscarded operations:\n insert 0, delete mark 0, delete 0\nHash table size 34679, node heap has 0 buffer(s)\nHash table size 34679, node heap has 0 buffer(s)\nHash table size 34679, node heap has 4 buffer(s)\nHash table size 34679, node heap has 0 buffer(s)\nHash table size 34679, node heap has 1 buffer(s)\nHash table size 34679, node heap has 0 buffer(s)\nHash table size 34679, node heap has 2 buffer(s)\nHash table size 34679, node heap has 1 buffer(s)\n0.14 hash searches/s, 0.00 non-hash searches/s\n</code></pre> <p>seg size\u663e\u793a\u4e86\u5f53\u524dInsert Buffer\u7684\u5927\u5c0f\u4e3a2\u00d716KB\uff0c\u5927\u7ea6\u4e3a177MB\uff1bfree list len\u4ee3\u8868\u4e86\u7a7a\u95f2\u5217\u8868\u7684\u957f\u5ea6\uff1bsize\u4ee3\u8868\u4e86\u5df2\u7ecf\u5408\u5e76\u8bb0\u5f55\u9875\u7684\u6570\u91cf\u3002</p> <ul> <li>innodb_change_buffer_max_size</li> </ul> <p>\u63a7\u5236Change Buffer\u5360Buffer Pool\u7684\u6bd4\u4f8b\u3002\u9ed8\u8ba425\uff0c\u6700\u592750\u3002</p> <ul> <li>innodb_change_buffering </li> </ul> <p>\u63a7\u5236change buffer\u5bf9\u54ea\u4e9bDML\u8d77\u4f5c\u7528\uff0c\u53ef\u9009\u53c2\u6570\uff1aall\uff08insert\u3001delete\u3001update\uff09\u3001none\uff08\u4e0d\u7f13\u5b58\u4efb\u4f55\u64cd\u7eb5\uff09\u3001inserts\u3001deletes\u3001purges</p>"},{"location":"mysql/Buffer%20Pool/#43","title":"4.3 \u5408\u5e76\u60c5\u51b5","text":"<ul> <li>\u8f85\u52a9\u7d22\u5f15\u9875\u88ab\u8bfb\u53d6\u5230\u7f13\u51b2\u6c60</li> </ul> <p>\u5f53\u8f85\u52a9\u7d22\u5f15\u9875\u88ab\u8bfb\u53d6\u5230\u7f13\u51b2\u6c60\u4e2d\u65f6\uff0c\u9700\u8981\u68c0\u67e5Insert Buffer Bitmap\u9875 \uff0c\u786e\u8ba4\u662f\u5426\u6709\u8be5\u8f85\u52a9\u7d22\u5f15\u9875\u7684\u8bb0\u5f55\u4fdd\u5b58\u5728Insert Buffer B+\u6811\u4e2d\u3002\u82e5\u6709\uff0c\u5219\u9700\u8981\u5c06\u8be5\u9875\u7684\u6240\u6709\u8bb0\u5f55\u63d2\u5165\u5230\u8f85\u52a9\u7d22\u5f15\u9875\u4e2d\uff0c\u6b64\u5904\u8f85\u52a9\u7d22\u5f15\u9875\u7684\u6570\u636e\u624d\u4e3a\u6700\u65b0\u6570\u636e\u3002\u540c\u65f6\u53ef\u4ee5\u53d1\u73b0\uff0c\u6211\u4eec\u5bf9\u8f85\u52a9\u7d22\u5f15\u9875\u7684\u591a\u6b21\u63d2\u5165\u64cd\u4f5c\u901a\u8fc7\u4e00\u4e2a\u64cd\u4f5c\u5408\u5e76\u5230\u4e86\u8f85\u52a9\u7d22\u5f15\u9875\u4e2d\u3002</p> <ul> <li>\u8f85\u52a9\u7d22\u5f15\u9875\u65e0\u53ef\u7528\u7a7a\u95f4</li> </ul> <p>\u5f53\u8bb0\u5f55\u63d2\u5165Insert Buffer B+\u6811\u65f6\u53d1\u73b0\u5bf9\u5e94\u7684\u8f85\u52a9\u7d22\u5f15\u9875\u7684\u53ef\u7528\u7a7a\u95f4\u5c0f\u4e8e1/32\uff0c\u6b64\u65f6\u4f1a\u5f3a\u5236\u8fdb\u884c\u4e00\u6b21\u5408\u5e76\u64cd\u4f5c\uff0c\u5373\u8bfb\u53d6\u8f85\u52a9\u7d22\u5f15\u9875\uff0c\u5c06Insert Buffer B+\u6811\u4e2d\u8be5\u9875\u7684\u6240\u6709\u8bb0\u5f55\u90fd\u5408\u5e76\u5230\u8f85\u52a9\u7d22\u5f15\u9875\u4e2d\u3002</p> <ul> <li>Master Thread</li> </ul> <p>Master Thread\u6bcf\u79d2\u6216\u6bcf\u5341\u79d2\u4f1a\u8fdb\u884c\u4e00\u6b21\u5408\u5e76\u64cd\u4f5c\uff0c\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\u5408\u5e76\u7684\u6570\u91cf\u4e0d\u540c\u3002</p>"},{"location":"mysql/Buffer%20Pool/#_4","title":"\u53c2\u8003","text":"<p>[1] https://dev.mysql.com/doc/dev/mysql-server/latest/</p> <p>[2] https://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html</p> <p>[3] https://mp.weixin.qq.com/s/LQHcuDoQTdPmmjqnd6JeSg</p> <p>[4] http://mysql.taobao.org/monthly/2023/08/01/</p> <p>[5] https://juejin.cn/book/6844733769996304392/section/6844733770063429646</p> <p>[5] \u300aMySQL\u6280\u672f\u5185\u5e55-InnoDB\u5b58\u50a8\u5f15\u64ce\u300b</p>"},{"location":"mysql/InnoDB%E6%A6%82%E8%BF%B0/","title":"Innodb\u7248\u672c\u53ca\u65b0\u7279\u6027","text":""},{"location":"mysql/InnoDB%E6%A6%82%E8%BF%B0/#_1","title":"\u4e00\u3001\u6982\u8ff0","text":"<p>\u4ec0\u4e48\u662fInnoDB\uff1f\u8bf7\u770b\u5b98\u7f51\uff1aIntroduction to InnoDB</p> <p>\u4e0d\u6653\u5f97\u4ece\u4ec0\u4e48\u65f6\u5019\u5f00\u59cbInnoDB\u7684\u7248\u672c\u53f7\u4e0eMySQL\u7684\u7248\u672c\u53f7\u4fdd\u6301\u4e00\u81f4\u4e86\u3002\u901a\u8fc7\u53d8\u91cf<code>innodb_version</code>\u53ef\u4ee5\u67e5\u770b\u3002</p> <ul> <li>mysql5.7</li> </ul> <pre><code>mysql&gt; SHOW VARIABLES LIKE \"innodb_version\";\n+----------------+--------+\n| Variable_name  | Value  |\n+----------------+--------+\n| innodb_version | 5.7.37 |\n+----------------+--------+\n1 row in set (0.01 sec)\n</code></pre> <ul> <li>mysql8.0</li> </ul> <pre><code>mysql&gt; SHOW VARIABLES LIKE \"innodb_version\";\n+----------------+--------+\n| Variable_name  | Value  |\n+----------------+--------+\n| innodb_version | 8.0.32 |\n+----------------+--------+\n1 row in set (0.05 sec)\n</code></pre> <p>\u7248\u672c\u65b0\u589e\u7279\u6027\u5982\u4e0b\uff1a</p> <ul> <li>5.7\u7248\u672c\u65b0\u589e\u7279\u6027\u8bf4\u660e</li> <li>8.0\u7248\u672c\u65b0\u589e\u7279\u6027\u8bf4\u660e</li> </ul>"},{"location":"mysql/InnoDB%E6%A6%82%E8%BF%B0/#_2","title":"\u4e8c\u3001\u4f53\u7cfb\u67b6\u6784","text":""},{"location":"mysql/InnoDB%E6%A6%82%E8%BF%B0/#1innodb","title":"1.InnoDB\u67b6\u6784\u56fe","text":"<ul> <li>5.7\u7248\u672c\u67b6\u6784\u56fe</li> </ul> <ul> <li>8.0\u7248\u672c\u67b6\u6784\u56fe</li> </ul>"},{"location":"mysql/InnoDB%E6%A6%82%E8%BF%B0/#2innodb80","title":"2.Innodb8.0\u7248\u672c\u65b0\u589e\u529f\u80fd","text":""},{"location":"mysql/InnoDB%E6%A6%82%E8%BF%B0/#21-doublewrite-buffer-file","title":"2.1 Doublewrite Buffer File","text":"<p>MySQL 8.0.20\u4e4b\u524d\uff0c\u53cc\u5199\u7f13\u51b2\u533a\u5b58\u50a8\u533a\u57df\u4f4d\u4e8e<code>InnoDB</code>\u7cfb\u7edf\u8868\u7a7a\u95f4\u4e2d\u3002\u4eceMySQL 8.0.20\u5f00\u59cb\uff0c\u53cc\u5199\u7f13\u51b2\u533a\u5b58\u50a8\u533a\u57df\u4f4d\u4e8e\u53cc\u5199\u6587\u4ef6\u4e2d\u3002\u5c06\u5b58\u50a8\u533a\u57df\u79fb\u51fa\u7cfb\u7edf\u8868\u7a7a\u95f4\u53ef\u51cf\u5c11\u5199\u5165\u5ef6\u8fdf\u3001\u63d0\u9ad8\u541e\u5410\u91cf\uff0c\u5e76\u4e3a\u53cc\u5199\u7f13\u51b2\u533a\u9875\u9762\u7684\u653e\u7f6e\u63d0\u4f9b\u7075\u6d3b\u6027\u3002\u4e3a\u53cc\u5199\u7f13\u51b2\u533a\u914d\u7f6e\u63d0\u4f9b\u4ee5\u4e0b\u53d8\u91cf\uff1a</p> <ul> <li><code>innodb_doublewrite_dir</code></li> </ul> <p>\u5b9a\u4e49\u53cc\u5199\u7f13\u51b2\u533a\u6587\u4ef6\u76ee\u5f55\u3002</p> <ul> <li><code>innodb_doublewrite_files</code></li> </ul> <p>\u5b9a\u4e49\u53cc\u5199\u6587\u4ef6\u7684\u6570\u91cf\u3002</p> <ul> <li><code>innodb_doublewrite_pages</code></li> </ul> <p>\u5b9a\u4e49\u6279\u91cf\u5199\u5165\u7684\u6bcf\u4e2a\u7ebf\u7a0b\u7684\u6700\u5927\u53cc\u5199\u9875\u6570\u3002</p> <ul> <li><code>innodb_doublewrite_batch_size</code></li> </ul> <p>\u5b9a\u4e49\u6279\u91cf\u5199\u5165\u7684\u53cc\u5199\u9875\u6570\u3002</p>"},{"location":"mysql/InnoDB%E6%A6%82%E8%BF%B0/#22","title":"2.2 \u5176\u4ed6\u7684\u4ee5\u540e\u9047\u5230\u518d\u8bf4","text":""},{"location":"mysql/Innodb%E6%95%B0%E6%8D%AE%E8%AE%B0%E5%BD%95%E5%92%8C%E9%A1%B5/","title":"InnoDB\u6570\u636e\u8bb0\u5f55\u548c\u9875","text":""},{"location":"mysql/Innodb%E6%95%B0%E6%8D%AE%E8%AE%B0%E5%BD%95%E5%92%8C%E9%A1%B5/#_1","title":"\u4e00\u3001\u6982\u8ff0","text":"<p>InnoDB\u5c06\u78c1\u76d8\u4e2d\u7684\u6570\u636e\u5212\u5206\u4e3a\u82e5\u5e72\u4e2a\u9875\uff0c\u9ed8\u8ba4\u5927\u5c0f\u4e3a16K\uff0c\u6bcf\u6b21\u4ece\u78c1\u76d8\u4ee5\u9875\u4e3a\u6700\u5c0f\u5355\u4f4d\u8bfb\u53d6\u6570\u636e\u3002\u800c\u6570\u636e\u8bb0\u5f55\u5219\u4fdd\u5b58\u5728\u9875\u4e2d\uff0cInnoDB\u89c4\u5b9a\u6bcf\u9875\u6700\u5c11\u4fdd\u5b58\u4e24\u6761\u8bb0\u5f55\u3002\u5f53\u8bb0\u5f55\u4e2d\u7684\u6570\u636e\u592a\u591a\uff0c\u5f53\u524d\u9875\u653e\u4e0d\u4e0b\u7684\u65f6\u5019\uff0c\u4f1a\u628a\u591a\u4f59\u7684\u6570\u636e\u5b58\u50a8\u5230\u5176\u4ed6\u9875\u4e2d\uff0c\u8fd9\u79cd\u73b0\u8c61\u79f0\u4e3a<code>\u884c\u6ea2\u51fa</code>\u3002</p>"},{"location":"mysql/Innodb%E6%95%B0%E6%8D%AE%E8%AE%B0%E5%BD%95%E5%92%8C%E9%A1%B5/#_2","title":"\u4e8c\u3001\u8bb0\u5f55\u683c\u5f0f","text":"<p>InnoDB\u76ee\u524d\u63d0\u4f9b\u56db\u79cd\u683c\u5f0f\uff1aCompact\u3001Redundant\u3001Dynamic\u548cCompressed\u3002</p> <ul> <li> <p>Redundant\u662fMySQL5.0\u7248\u672c\u4e4b\u524d\u4e00\u79cd\u975e\u7d27\u51d1\u7684\u884c\u683c\u5f0f\uff0c\u73b0\u5728\u57fa\u672c\u6ca1\u4eba\u7528\u4e86\u3002</p> </li> <li> <p>Compact\u662fMySQL5.0\u4e4b\u540e\u5f15\u5165\u7684\u4e00\u79cd\u7d27\u51d1\u7684\u884c\u683c\u5f0f\uff0c\u4e3a\u4e86\u8ba9\u4e00\u4e2a\u6570\u636e\u9875\u4e2d\u53ef\u4ee5\u5b58\u653e\u66f4\u591a\u7684\u884c\u8bb0\u5f55</p> </li> <li> <p>Dynamic\u548cCompressed\u4e24\u4e2a\u90fd\u662f\u7d27\u51d1\u7684\u884c\u683c\u5f0f\uff0c\u5b83\u4eec\u7684\u884c\u683c\u5f0f\u90fd\u548cCompact\u5dee\u4e0d\u591a\uff0c\u56e0\u4e3a\u90fd\u662f\u57fa\u4e8eCompact\u6539\u8fdb\u4e00\u70b9\u4e1c\u897f\u3002\u4eceMySQL5.7\u7248\u672c\u4e4b\u540e\uff0c\u9ed8\u8ba4\u4f7f\u7528Dynamic\u884c\u683c\u5f0f\u3002</p> </li> </ul>"},{"location":"mysql/Innodb%E6%95%B0%E6%8D%AE%E8%AE%B0%E5%BD%95%E5%92%8C%E9%A1%B5/#21-compact","title":"2.1 Compact","text":""},{"location":"mysql/Innodb%E6%95%B0%E6%8D%AE%E8%AE%B0%E5%BD%95%E5%92%8C%E9%A1%B5/#221","title":"2.2.1 \u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868","text":"<p>\u6211\u4eec\u77e5\u9053<code>MySQL</code>\u652f\u6301\u4e00\u4e9b\u53d8\u957f\u7684\u6570\u636e\u7c7b\u578b\uff0c\u6bd4\u5982<code>VARCHAR(M)</code>\u3001<code>VARBINARY(M)</code>\u3001\u5404\u79cd<code>TEXT</code>\u7c7b\u578b\uff0c\u5404\u79cd<code>BLOB</code>\u7c7b\u578b\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u628a\u62e5\u6709\u8fd9\u4e9b\u6570\u636e\u7c7b\u578b\u7684\u5217\u79f0\u4e3a<code>\u53d8\u957f\u5b57\u6bb5</code>\uff0c\u53d8\u957f\u5b57\u6bb5\u4e2d\u5b58\u50a8\u591a\u5c11\u5b57\u8282\u7684\u6570\u636e\u662f\u4e0d\u56fa\u5b9a\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u5b58\u50a8\u771f\u5b9e\u6570\u636e\u7684\u65f6\u5019\u9700\u8981\u987a\u4fbf\u628a\u8fd9\u4e9b\u6570\u636e\u5360\u7528\u7684\u5b57\u8282\u6570\u4e5f\u5b58\u8d77\u6765\uff0c\u8fd9\u6837\u624d\u4e0d\u81f3\u4e8e\u628a<code>MySQL</code>\u670d\u52a1\u5668\u641e\u61f5\uff0c\u6240\u4ee5\u8fd9\u4e9b\u53d8\u957f\u5b57\u6bb5\u5360\u7528\u7684\u5b58\u50a8\u7a7a\u95f4\u5206\u4e3a\u4e24\u90e8\u5206\uff1a</p> <ol> <li>\u771f\u6b63\u7684\u6570\u636e\u5185\u5bb9\uff08\u4fdd\u5b58\u5728<code>\u771f\u5b9e\u6570\u636e</code>\uff09</li> <li>\u5360\u7528\u7684\u5b57\u8282\u6570\uff08\u4fdd\u5b58\u5728<code>\u53d8\u957f\u5b57\u6bb5\u5217\u8868</code>\uff09</li> </ol> <p>\u5728<code>Compact</code>\u884c\u683c\u5f0f\u4e2d\uff0c\u628a\u6240\u6709\u53d8\u957f\u5b57\u6bb5\u7684\u771f\u5b9e\u6570\u636e\u5360\u7528\u7684\u5b57\u8282\u957f\u5ea6\u90fd\u5b58\u653e\u5728\u8bb0\u5f55\u7684\u5f00\u5934\u90e8\u4f4d\uff0c\u4ece\u800c\u5f62\u6210\u4e00\u4e2a\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\uff0c\u5404\u53d8\u957f\u5b57\u6bb5\u6570\u636e\u5360\u7528\u7684\u5b57\u8282\u6570\u4ee516\u8fdb\u5236\u683c\u5f0f\u6309\u7167\u5217\u7684\u987a\u5e8f\u9006\u5e8f\u5b58\u653e\uff0c\u9006\u5e8f\u5b58\u653e\uff01</p>"},{"location":"mysql/Innodb%E6%95%B0%E6%8D%AE%E8%AE%B0%E5%BD%95%E5%92%8C%E9%A1%B5/#222-null","title":"2.2.2 NULL\u503c\u5217\u8868","text":"<p>\u6211\u4eec\u77e5\u9053\u8868\u4e2d\u7684\u67d0\u4e9b\u5217\u53ef\u80fd\u5b58\u50a8<code>NULL</code>\u503c\uff0c\u5982\u679c\u628a\u8fd9\u4e9b<code>NULL</code>\u503c\u90fd\u653e\u5230<code>\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e</code>\u4e2d\u5b58\u50a8\u4f1a\u5f88\u5360\u5730\u65b9\uff0c\u6240\u4ee5<code>Compact</code>\u884c\u683c\u5f0f\u628a\u8fd9\u4e9b\u503c\u4e3a<code>NULL</code>\u7684\u5217\u7edf\u4e00\u7ba1\u7406\u8d77\u6765\uff0c\u5b58\u50a8\u5230<code>NULL</code>\u503c\u5217\u8868\u4e2d\u3002</p>"},{"location":"mysql/Innodb%E6%95%B0%E6%8D%AE%E8%AE%B0%E5%BD%95%E5%92%8C%E9%A1%B5/#223","title":"2.2.3 \u8bb0\u5f55\u5934\u4fe1\u606f","text":"<p>\u9664\u4e86<code>\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868</code>\u3001<code>NULL\u503c\u5217\u8868</code>\u4e4b\u5916\uff0c\u8fd8\u6709\u4e00\u4e2a\u7528\u4e8e\u63cf\u8ff0\u8bb0\u5f55\u7684<code>\u8bb0\u5f55\u5934\u4fe1\u606f</code>\uff0c\u5b83\u662f\u7531\u56fa\u5b9a\u7684<code>5</code>\u4e2a\u5b57\u8282\u7ec4\u6210\u3002<code>5</code>\u4e2a\u5b57\u8282\u4e5f\u5c31\u662f<code>40</code>\u4e2a\u4e8c\u8fdb\u5236\u4f4d\uff0c\u4e0d\u540c\u7684\u4f4d\u4ee3\u8868\u4e0d\u540c\u7684\u610f\u601d\uff0c\u5982\u56fe\uff1a</p> <p></p> <p>\u8fd9\u4e9b\u4e8c\u8fdb\u5236\u4f4d\u4ee3\u8868\u7684\u8be6\u7ec6\u4fe1\u606f\u5982\u4e0b\u8868\uff1a</p> \u540d\u79f0 \u5927\u5c0f\uff08\u5355\u4f4d\uff1abit\uff09 \u63cf\u8ff0 <code>\u9884\u7559\u4f4d1</code> <code>1</code> \u6ca1\u6709\u4f7f\u7528 <code>\u9884\u7559\u4f4d2</code> <code>1</code> \u6ca1\u6709\u4f7f\u7528 <code>delete_mask</code> <code>1</code> \u6807\u8bb0\u8be5\u8bb0\u5f55\u662f\u5426\u88ab\u5220\u9664 <code>min_rec_mask</code> <code>1</code> B+\u6811\u7684\u6bcf\u5c42\u975e\u53f6\u5b50\u8282\u70b9\u4e2d\u7684\u6700\u5c0f\u8bb0\u5f55\u90fd\u4f1a\u6dfb\u52a0\u8be5\u6807\u8bb0 <code>n_owned</code> <code>4</code> \u8868\u793a\u5f53\u524d\u8bb0\u5f55\u62e5\u6709\u7684\u8bb0\u5f55\u6570 <code>heap_no</code> <code>13</code> \u8868\u793a\u5f53\u524d\u8bb0\u5f55\u5728\u8bb0\u5f55\u5806\u7684\u4f4d\u7f6e\u4fe1\u606f <code>record_type</code> <code>3</code> \u8868\u793a\u5f53\u524d\u8bb0\u5f55\u7684\u7c7b\u578b\uff0c<code>0</code>\u8868\u793a\u666e\u901a\u8bb0\u5f55\uff0c<code>1</code>\u8868\u793aB+\u6811\u975e\u53f6\u5b50\u8282\u70b9\u8bb0\u5f55\uff0c<code>2</code>\u8868\u793a\u6700\u5c0f\u8bb0\u5f55\uff0c<code>3</code>\u8868\u793a\u6700\u5927\u8bb0\u5f55 <code>next_record</code> <code>16</code> \u8868\u793a\u4e0b\u4e00\u6761\u8bb0\u5f55\u7684\u76f8\u5bf9\u4f4d\u7f6e"},{"location":"mysql/Innodb%E6%95%B0%E6%8D%AE%E8%AE%B0%E5%BD%95%E5%92%8C%E9%A1%B5/#224","title":"2.2.4 \u771f\u5b9e\u6570\u636e","text":"<p>\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u6211\u4eec\u81ea\u5df1\u5b9a\u4e49\u7684\u5217\u7684\u6570\u636e\u4ee5\u5916\uff0c<code>MySQL</code>\u4f1a\u4e3a\u6bcf\u4e2a\u8bb0\u5f55\u9ed8\u8ba4\u7684\u6dfb\u52a0\u4e00\u4e9b\u5217\uff08\u4e5f\u79f0\u4e3a<code>\u9690\u85cf\u5217</code>\uff09\uff0c\u5177\u4f53\u7684\u5217\u5982\u4e0b\uff1a</p> \u5217\u540d \u662f\u5426\u5fc5\u987b \u5360\u7528\u7a7a\u95f4 \u63cf\u8ff0 <code>row_id</code> \u5426 <code>6</code>\u5b57\u8282 \u884cID\uff0c\u552f\u4e00\u6807\u8bc6\u4e00\u6761\u8bb0\u5f55 <code>transaction_id</code> \u662f <code>6</code>\u5b57\u8282 \u4e8b\u52a1ID <code>roll_pointer</code> \u662f <code>7</code>\u5b57\u8282 \u56de\u6eda\u6307\u9488 <p>\u73b0\u5728\u770b\u4e00\u4e0b\u52a0\u4e0a<code>\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e</code>\u7684\u4e24\u4e2a\u8bb0\u5f55\u957f\u4ec0\u4e48\u6837\u5427\uff1a</p> <p></p>"},{"location":"mysql/Innodb%E6%95%B0%E6%8D%AE%E8%AE%B0%E5%BD%95%E5%92%8C%E9%A1%B5/#22-dynamiccompressed","title":"2.2 Dynamic\u548cCompressed","text":"<p>\u8fd9\u4e24\u79cd\u884c\u683c\u5f0f\u7c7b\u4f3c\u4e8e<code>COMPACT\u884c\u683c\u5f0f</code>\uff0c\u53ea\u4e0d\u8fc7\u5728\u5904\u7406\u884c\u6ea2\u51fa\u6570\u636e\u65f6\u6709\u70b9\u513f\u5206\u6b67\uff0c\u5b83\u4eec\u4e0d\u4f1a\u5728\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u5904\u5b58\u50a8\u5b57\u7b26\u4e32\u7684\u524d768\u4e2a\u5b57\u8282\uff0c\u800c\u662f\u628a\u6240\u6709\u7684\u5b57\u8282\u90fd\u5b58\u50a8\u5230\u5176\u4ed6\u9875\u9762\u4e2d\uff0c\u53ea\u5728\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u5904\u5b58\u50a8\u5176\u4ed6\u9875\u9762\u7684\u5730\u5740\u3002</p> <p>\u53e6\u5916\uff0c<code>Compressed</code>\u884c\u683c\u5f0f\u4f1a\u91c7\u7528\u538b\u7f29\u7b97\u6cd5\u5bf9\u9875\u9762\u8fdb\u884c\u538b\u7f29\u3002</p>"},{"location":"mysql/Innodb%E6%95%B0%E6%8D%AE%E8%AE%B0%E5%BD%95%E5%92%8C%E9%A1%B5/#_3","title":"\u4e09\u3001\u9875\u683c\u5f0f","text":"<p>\u4e00\u4e2a<code>InnoDB</code>\u6570\u636e\u9875\u7684\u5b58\u50a8\u7a7a\u95f4\u5927\u81f4\u88ab\u5212\u5206\u6210\u4e86<code>7</code>\u4e2a\u90e8\u5206\uff0c\u6709\u7684\u90e8\u5206\u5360\u7528\u7684\u5b57\u8282\u6570\u662f\u786e\u5b9a\u7684\uff0c\u6709\u7684\u90e8\u5206\u5360\u7528\u7684\u5b57\u8282\u6570\u662f\u4e0d\u786e\u5b9a\u7684\u3002\u5982\u4e0b\u8868\u6240\u793a\uff1a</p> \u540d\u79f0 \u4e2d\u6587\u540d \u5360\u7528\u7a7a\u95f4\u5927\u5c0f \u7b80\u5355\u63cf\u8ff0 <code>File Header</code> \u6587\u4ef6\u5934\u90e8 <code>38</code>\u5b57\u8282 \u9875\u7684\u4e00\u4e9b\u901a\u7528\u4fe1\u606f <code>Page Header</code> \u9875\u9762\u5934\u90e8 <code>56</code>\u5b57\u8282 \u6570\u636e\u9875\u4e13\u6709\u7684\u4e00\u4e9b\u4fe1\u606f <code>Infimum + Supremum</code> \u6700\u5c0f\u8bb0\u5f55\u548c\u6700\u5927\u8bb0\u5f55 <code>26</code>\u5b57\u8282 \u4e24\u4e2a\u865a\u62df\u7684\u884c\u8bb0\u5f55 <code>User Records</code> \u7528\u6237\u8bb0\u5f55 \u4e0d\u786e\u5b9a \u5b9e\u9645\u5b58\u50a8\u7684\u884c\u8bb0\u5f55\u5185\u5bb9 <code>Free Space</code> \u7a7a\u95f2\u7a7a\u95f4 \u4e0d\u786e\u5b9a \u9875\u4e2d\u5c1a\u672a\u4f7f\u7528\u7684\u7a7a\u95f4 <code>Page Directory</code> \u9875\u9762\u76ee\u5f55 \u4e0d\u786e\u5b9a \u9875\u4e2d\u7684\u67d0\u4e9b\u8bb0\u5f55\u7684\u76f8\u5bf9\u4f4d\u7f6e <code>File Trailer</code> \u6587\u4ef6\u5c3e\u90e8 <code>8</code>\u5b57\u8282 \u6821\u9a8c\u9875\u662f\u5426\u5b8c\u6574 <p>page\u9875\u7ed3\u6784\u56fe\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p>"},{"location":"mysql/Innodb%E6%95%B0%E6%8D%AE%E8%AE%B0%E5%BD%95%E5%92%8C%E9%A1%B5/#31-file-header","title":"3.1 File Header","text":"<p>\u7f13\u51b2\u6c60\u4e2d\u9875\u662f\u901a\u8fc7\u53cc\u5411\u94fe\u8868\u6765\u7ba1\u7406\u7684\uff0c\u5177\u4f53\u5b9e\u73b0\u5c31\u662f\u5728<code>File Header</code>\u4e2d\u4fdd\u5b58\u4e86\u4e0a\u4e00\u4e2apage\u548c\u4e0b\u4e00\u4e2apage\u9875\u7684\u9875\u53f7\u3002</p>"},{"location":"mysql/Innodb%E6%95%B0%E6%8D%AE%E8%AE%B0%E5%BD%95%E5%92%8C%E9%A1%B5/#32-user-records","title":"3.2 User Records","text":"<p>\u4fdd\u5b58\u771f\u5b9e\u7684\u6570\u636e\u8bb0\u5f55\uff0c\u901a\u8fc7\u5355\u94fe\u8868\u7ba1\u7406\u3002</p>"},{"location":"mysql/Innodb%E6%95%B0%E6%8D%AE%E8%AE%B0%E5%BD%95%E5%92%8C%E9%A1%B5/#33-page-directory","title":"3.3 Page Directory","text":"<p><code>InnoDB</code>\u4f1a\u628a\u9875\u4e2d\u7684\u8bb0\u5f55\u5212\u5206\u4e3a\u82e5\u5e72\u4e2a\u7ec4\uff0c\u6bcf\u4e2a\u7ec4\u7684\u6700\u540e\u4e00\u4e2a\u8bb0\u5f55\u7684\u5730\u5740\u504f\u79fb\u91cf\u4f5c\u4e3a\u4e00\u4e2a<code>\u69fd</code>\uff0c\u5b58\u653e\u5728<code>Page Directory</code>\u4e2d\uff0c\u6240\u4ee5\u5728\u4e00\u4e2a\u9875\u4e2d\u6839\u636e\u4e3b\u952e\u67e5\u627e\u8bb0\u5f55\u662f\u975e\u5e38\u5feb\u7684\uff0c\u5206\u4e3a\u4e24\u6b65\uff1a</p> <ul> <li>\u901a\u8fc7\u4e8c\u5206\u6cd5\u786e\u5b9a\u8be5\u8bb0\u5f55\u6240\u5728\u7684\u69fd\u3002</li> <li>\u901a\u8fc7\u8bb0\u5f55\u7684next_record\u5c5e\u6027\u904d\u5386\u8be5\u69fd\u6240\u5728\u7684\u7ec4\u4e2d\u7684\u5404\u4e2a\u8bb0\u5f55\u3002</li> </ul>"},{"location":"mysql/MySQL%E6%8A%80%E6%9C%AF%E8%A7%84%E8%8C%83/","title":"MySQL\u6280\u672f\u89c4\u8303","text":""},{"location":"mysql/MySQL%E6%8A%80%E6%9C%AF%E8%A7%84%E8%8C%83/#_1","title":"\u4e00\u3001\u5206\u8868/\u5206\u533a","text":""},{"location":"mysql/MySQL%E6%8A%80%E6%9C%AF%E8%A7%84%E8%8C%83/#1","title":"1\u3001\u89c4\u8303\u8981\u6c42","text":"<pre><code>\u6574\u4e2a\u5b9e\u4f8b\u7684\u6570\u636e\u6587\u4ef6\u4e2a\u6570\uff0c\u4e0d\u5e94\u8d85\u8fc7131062\u4e2a\uff0c\u4e0d\u5b9c\u8d85\u8fc760000\u4e2a\n</code></pre>"},{"location":"mysql/MySQL%E6%8A%80%E6%9C%AF%E8%A7%84%E8%8C%83/#2","title":"2\u3001\u539f\u7406\u8bf4\u660e","text":"<ul> <li>\u751f\u4ea7\u73af\u5883\u4f7f\u7528XtraBackup\u5bf9MySQL\u8fdb\u884c\u6570\u636e\u5907\u4efd\uff0c\u5907\u4efd\u65f6\u6240\u9700\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u4e2a\u6570\u6700\u591a\u4e3a\uff08\u6570\u636e\u6587\u4ef6\u4e2a\u6570+10\uff09\uff0c\u8be5\u6570\u91cf\u4e0d\u80fd\u8d85\u8fc7\u64cd\u4f5c\u7cfb\u7edfulimit\u7684nofile\u4e0a\u9650\uff08\u6211\u884cMySQL\u670d\u52a1\u5668\u6700\u5927\u57fa\u7ebf\u4e3a131072\uff09\uff0c\u5426\u5219\u5907\u4efd\u4f1a\u5931\u8d25\u3002\u56e0\u6b64\uff0c\u4e00\u4e2aMySQL\u5b9e\u529b\u7684\u6570\u636e\u6587\u4ef6\u683c\u5f0f\u4e0d\u5e94\u8d85\u8fc7\uff08131072 - 10\uff09=131062\u3002</li> <li>\u6570\u636e\u6587\u4ef6\u8ba1\u7b97\u516c\u5f0f\uff1a\u5bf9\u4e8e\u5206\u533a\u8868\uff0c\u6bcf\u4e2a\u5206\u533a\u5bf9\u5e94\u4e00\u4e2a\u6570\u636e\u6587\u4ef6\uff0c\u5bf9\u4e8e\u975e\u5206\u533a\u8868\uff0c\u6bcf\u4e2a\u8868\u5bf9\u5e94\u4e00\u4e2a\u6570\u636e\u6587\u4ef6\u3002\u5373MySQL\u5b9e\u4f8b\u6570\u636e\u6587\u4ef6\u4e2a\u6570 = \u8868\u5206\u533a\u6570 + \u975e\u5206\u533a\u8868\u4e2a\u6570\u3002\u5982\u679c\u4f7f\u7528\u5b50\u5206\u533a\uff0c\u6bcf\u4e2a\u5b50\u5206\u533a\u4e5f\u662f\u5bf9\u5e94\u4e00\u4e2a\u6570\u636e\u6587\u4ef6\u3002</li> <li>\u8868/\u5206\u533a\u4e2a\u6570\u8d8a\u591a\uff0cMySQL\u5185\u5b58\u5360\u7528\u8d8a\u5927\u3002</li> </ul>"},{"location":"mysql/MySQL%E6%8A%80%E6%9C%AF%E8%A7%84%E8%8C%83/#3","title":"3\u3001\u6848\u4f8b","text":"<p>\u6570\u636e\u6587\u4ef6\u8f83\u591a\u7684\u4e00\u4e2a\u6848\u4f8b\uff1a</p> <pre><code>select count(*) from information_schema.tables;\n+----------+\n| count(*) |\n+----------+\n|     803  |\n+----------+\n\nselect count(*) from information_schema.partitions;\n+----------+\n| count(*) |\n+----------+\n|   104530 |\n+----------+\n</code></pre>"},{"location":"mysql/MySQL%E6%8A%80%E6%9C%AF%E8%A7%84%E8%8C%83/#_2","title":"\u4e8c\u3001\u4e3b\u952e","text":""},{"location":"mysql/MySQL%E6%8A%80%E6%9C%AF%E8%A7%84%E8%8C%83/#1_1","title":"1\u3001\u89c4\u8303\u8981\u6c42","text":"<pre><code>\u5bf9\u4e8e\u8bb0\u5f55\u6570\u8d85\u8fc71\u4e07\u6761\u7684\u8868\uff0c\u5e94\u4f7f\u7528\u81ea\u589e\u4e3b\u952e\uff0c\u4e14\u7c7b\u578b\u4e3a\uff1a[\u6ee1\u8db3\u6761\u4ef6\u7684int\u7c7b\u578b] unsigned\u3002\n</code></pre>"},{"location":"mysql/MySQL%E6%8A%80%E6%9C%AF%E8%A7%84%E8%8C%83/#2_1","title":"2\u3001\u539f\u7406\u8bf4\u660e\u3010\u5f85\u5b8c\u5584\u3011","text":"<ul> <li>MySQL\u7684\u8868\u793a\u805a\u96c6\u7d22\u5f15\u8868\uff08Clustered Index Table\uff09\uff0c\u8ddfOracle\u3001DB2\u4e0d\u4e00\u6837\u3002\u5982\u679c\u4e3b\u952e\u662f\u9012\u589e\u63d2\u5165\u7684\uff0c\u8bfb\u5199\u6027\u80fd\u6bd4\u8f83\u9ad8\u3002</li> </ul>"},{"location":"mysql/MySQL%E6%8A%80%E6%9C%AF%E8%A7%84%E8%8C%83/#3_1","title":"3\u3001\u5173\u4e8e\u4e1a\u52a1\u4e3b\u952e","text":"<p>\u4f7f\u7528\u81ea\u589e\u5217\u4f5c\u4e3a\u4e3b\u952e\u65f6\uff0c\u4e1a\u52a1\u903b\u8f91\u8bbe\u7f6e\u4e3a\u552f\u4e00\u7d22\u5f15\u3002</p>"},{"location":"mysql/MySQL%E6%8A%80%E6%9C%AF%E8%A7%84%E8%8C%83/#_3","title":"\u4e09\u3001\u8fde\u63a5","text":""},{"location":"mysql/MySQL%E6%8A%80%E6%9C%AF%E8%A7%84%E8%8C%83/#1_2","title":"1\u3001\u89c4\u8303\u8981\u6c42","text":"<pre><code>\u5982\u679c\u5e94\u7528\u4f7f\u7528\u6570\u636e\u5e93\u8fde\u63a5\u6c60\uff0c\u5e94\u6709\u5fc3\u8df3\u673a\u5236\u3002\n\u5e94\u7528\u4e0e\u6570\u636e\u5e93\u7684\u8fde\u63a5\u6570\uff0c\u4e0d\u5e94\u8d85\u8fc7\u6570\u636e\u5e93 max_connections \u53c2\u6570\u8bbe\u7f6e\u3002\n\u5e94\u7528\u5e94\u901a\u8fc7\u6b63\u5e38\u7684\u65b9\u5f0f\u5173\u95ed\u6570\u636e\u5e93\u8fde\u63a5\u3002\n</code></pre>"},{"location":"mysql/MySQL%E6%8A%80%E6%9C%AF%E8%A7%84%E8%8C%83/#2_2","title":"2\u3001\u539f\u7406\u8bf4\u660e","text":"<ul> <li>\u53c2\u6570wait_timeout: \u5982\u679c\u6570\u636e\u5e93\u8fde\u63a5\u7684\u7a7a\u95f2\u65f6\u95f4\u8d85\u8fc7\u8be5\u503c\uff0cMySQL\u4e3b\u52a8\u65ad\u5f00\u3002\u5927\u57fa\u7ebf\uff1a1\u5c0f\u65f6\u3002</li> <li>\u53c2\u6570max_connections\u8bbe\u7f6e\u6570\u636e\u5e93\u5141\u8bb8\u7684\u6700\u5927\u8fde\u63a5\u6570\uff0c\u5982\u679c\u8d85\u8fc7\u62a5\"Too many connections\"\uff0c\u8be5\u503c\u5e76\u4e0d\u662f\u8d8a\u5927\u8d8a\u597d\uff0c\u5e76\u53d1\u7684\u7528\u6237\u6d3b\u52a8\u6570\u8d8a\u5927\uff0c\u7528\u6237\u7ebf\u7a0b\u5360\u7528\u7684\u5185\u5b58\u8d8a\u591a\u3002\u5927\u57fa\u7ebf\uff1a512\u3002</li> <li>\u4e0d\u6b63\u5e38\u5173\u95ed\u8fde\u63a5\uff0c\u53ef\u80fd\u5bfc\u81f4\u8fde\u63a5\u6cc4\u9732\u3002\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u8ba4\u4e3a\u8be5\u8fde\u63a5\u4ecd\u5728\u4f7f\u7528\u4e2d\uff0c\u4e0d\u4f1a\u63d0\u4f9b\u7ed9\u5176\u4ed6\u7a0b\u5e8f\u4f7f\u7528\uff0c\u6700\u5bfc\u81f4\u53ef\u7528\u8fde\u63a5\u8017\u5c3d\uff0c\u7a0b\u5e8f\u62a5\u9519\u3002</li> </ul>"},{"location":"mysql/MySQL%E6%8A%80%E6%9C%AF%E8%A7%84%E8%8C%83/#3_2","title":"3\u3001\u89e3\u51b3\u65b9\u6848","text":"<ul> <li>\u8bbe\u7f6e\u8fde\u63a5\u6c60\u7684\u5b9a\u65f6\u5fc3\u8df3\uff08\u6216\u79f0\u63a2\u6d3b\uff09\uff0c\u53ef\u4ee5\u907f\u514d\u8be5\u95ee\u9898\u3002</li> </ul> <p>But \u73b0\u5b9e\u73af\u5883\u4e2d\u9700\u8981\u4f60\u8003\u8651\u7684\u662f\uff08\u5047\u8bbe\u8fde\u63a5\u6c60\u4f7f\u7528c3p0\uff09\uff1a</p> <ol> <li>\u4f60\u8bbe\u7f6e\u591a\u4e45\u68c0\u67e5\u4e00\u6b21\u8fde\u63a5\u6709\u6548\u7684\u65f6\u95f4 \u4f9d\u636e\u662f\u4ec0\u4e48\uff1f</li> <li>\u9ed8\u8ba4\u52a0\u5927/\u51cf\u5c0fwait_timeout\u9664\u4e86\u89e3\u51b3\u5f53\u524d\u95ee\u9898\uff0c\u4f1a\u4e0d\u4f1a\u5e26\u6765\u5176\u4ed6\u5f71\u54cd\uff1f</li> </ol> <p>\u4e2a\u4eba\u5f53\u524d\u89c9\u5f97\u6b64\u9898 \u7b2c\u4e00\u9700\u8003\u8651\u7684\u662f\uff1a  1. \u4f60\u4e1a\u52a1\u5f53\u524d\u9ad8\u5cf0\u671fmysql_connection\u662f\u591a\u5c11\uff1f\u4fdd\u7559\u591a\u4e45connection\u5728\u9ad8\u5cf0\u671f\u90fd\u4e0d\u4f1a\u6491\u7206\u4f60\u6570\u636e\u5e93\u8fde\u63a5\u6c60\uff1f 2. \u5982\u679c\u4f60\u77e5\u9053\u8fd9\u4e2a\u6c60-\u90a3\u4e48\u662f\u6539mysql \uff1f\u8fd8\u662f\u6539c3p0\uff1f\u8fd8\u662f\u53cc\u7ba1\u9f50\u4e0b\u90fd\u662f\u6709\u636e\u53ef\u5faa\u4e14\u4e0d\u4f1a\u5e26\u6765\u540e\u9057\u75c7\u7684-\u6700\u4f73\u89e3\u51b3\u65b9\u6848</p> <p>\u4f8b\u5982\u4e00\u4e2a\u540e\u53f0\u7ba1\u7406\u7cfb\u7edf\uff0c\u4f7f\u7528\u4eba\u6570\u572850\u4ee5\u5185\uff0c\u90a3\u4e48\u6211wait_timeout \u5c31\u662f\u9ed8\u8ba48\u5c0f\u65f6\uff0cc3p0\u4e0d\u7528\u505a\u8fde\u63a5\u6709\u6548\u6027\u68c0\u67e5\u7b49\uff0c\u90fd\u662f\u4e07\u4e8bok\u7684\u3002</p> <p>\u800c\u6211\u8fd8\u6709\u4e00\u4e2aEPG\u524d\u53f0\u7ba1\u7406\u7cfb\u7edf\uff0c\u7528\u6237\u91cf\u5728300\u4e07\u4ee5\u5185\uff0c\u5982\u679c\u6211wait_timeout\u4e3a8\u5c0f\u65f6\uff0c\u90a3\u6211\u4e00\u5230\u9ad8\u5cf0\u671f\u80af\u5b9a\u5c31\u662f\u6b7b\u7fd8\u7fd8\u7684\uff0c\u4f1a\u6709\u592a\u591a\u7684TCP\u8fde\u63a5\u6ca1\u5173\u95ed\uff0c\u6570\u636e\u5e93\u8fde\u63a5\u6570\u80af\u5b9a\u662f\u4e0d\u591f\u7684\u3002\u56e0EPG\u7684\u4e00\u4e2a\u8bbf\u95ee\u5bf9\u6570\u636e\u5e93\u64cd\u4f5c\u91cf\u4e0d\u5927\uff0c\u67e5\u8be2\u5b8c\u6570\u636e\u5c31\u5b8c\u6210ok\u5566\uff0cwait_timeout \u8bbe\u7f6e\u5728120s\u5185\u5e94\u8be5\u662f\u591f\u7528\u5566\uff0c\u90a3\u4e48\u76f8\u5bf9\u5e94\u7684c3p0\u4e2d \u8bbe\u7f6e\u5c0f\u4e8ewait_timeout \u7684\u65f6\u95f4\u6709\u6548\u6027\u68c0\u67e5\uff0c\u5c31\u80fd\u786e\u4fdd\u83b7\u53d6\u5230\u8fde\u63a5\u662f\u6709\u6548\u7684\u3002</p> <p>\u8bf7\u6839\u636e\u4e1a\u52a1\u573a\u666f\uff0c\u6765\u914d\u7f6e\u53c2\u6570\uff0c\u4e0d\u8981\u89e3\u51b3\u4e86A\u95ee\u9898\uff0c\u5e26\u6765\u4e86B\u95ee\u9898\u3002</p>"},{"location":"mysql/MySQL%E6%8A%80%E6%9C%AF%E8%A7%84%E8%8C%83/#_4","title":"\u56db\u3001\u7d22\u5f15\u5339\u914d","text":""},{"location":"mysql/MySQL%E6%8A%80%E6%9C%AF%E8%A7%84%E8%8C%83/#_5","title":"\u4e94\u3001\u6570\u636e\u66f4\u65b0","text":""},{"location":"mysql/MySQL%E6%8A%80%E6%9C%AF%E8%A7%84%E8%8C%83/#_6","title":"\u516d\u3001\u6570\u636e\u6e05\u7406","text":""},{"location":"mysql/MySQL%E6%8A%80%E6%9C%AF%E8%A7%84%E8%8C%83/#_7","title":"\u4e03\u3001\u4e8b\u52a1","text":""},{"location":"mysql/MySQL%E6%8A%80%E6%9C%AF%E8%A7%84%E8%8C%83/#_8","title":"\u516b\u3001\u8868\u7ed3\u6784\u53d8\u66f4","text":""},{"location":"mysql/MySQL%E6%9F%A5%E8%AF%A2/","title":"MySQL\u67e5\u8be2\u539f\u7406","text":""},{"location":"mysql/MySQL%E6%9F%A5%E8%AF%A2/#_1","title":"\u4e00\u3001\u5355\u8868\u8bbf\u95ee\u65b9\u6cd5","text":"<p>MySQL\u6267\u884c\u67e5\u8be2\u8bed\u53e5\u7684\u65b9\u5f0f\u79f0\u4e4b\u4e3a<code>\u8bbf\u95ee\u65b9\u6cd5</code>\u6216\u8005<code>\u8bbf\u95ee\u7c7b\u578b</code>\u3002</p>"},{"location":"mysql/MySQL%E6%9F%A5%E8%AF%A2/#11-const","title":"1.1 const","text":"<p>MySQL\u4e2d\u628a\u901a\u8fc7\u4e3b\u952e\u6216\u8005\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u5217\u4e0e\u5e38\u91cf\u7684\u7b49\u503c\u6bd4\u8f83\u6765\u5b9a\u4f4d\u4e00\u6761\u8bb0\u5f55\u7684\u8bbf\u95ee\u65b9\u6cd5\u5b9a\u4e49\u4e3a\uff1a<code>const</code>\uff0c\u610f\u601d\u662f\u5e38\u6570\u7ea7\u522b\u7684\uff0c\u4ee3\u4ef7\u662f\u53ef\u4ee5\u5ffd\u7565\u4e0d\u8ba1\u7684\u3002</p> <pre><code>SELECT * FROM table WHERE key = 'value'; //key\u4e3a\u4e3b\u952e\u6216\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\n</code></pre>"},{"location":"mysql/MySQL%E6%9F%A5%E8%AF%A2/#12-ref","title":"1.2 ref","text":"<p>MySQL\u4e2d\u628a\u901a\u8fc7\u666e\u901a\u4e8c\u7ea7\u7d22\u5f15\u5217\u4e0e\u5e38\u91cf\u7684\u7b49\u503c\u6bd4\u8f83\u6765\u5b9a\u4f4d\u8bb0\u5f55\u7684\u8bbf\u95ee\u65b9\u6cd5\u5b9a\u4e49\u4e3a\uff1a<code>ref</code>\u3002\u56e0\u4e3a\u666e\u901a\u4e8c\u7ea7\u7d22\u5f15\u53f6\u5b50\u8282\u70b9\u7684\u6570\u636e\u4e0d\u5177\u6709\u552f\u4e00\u6027\uff0c\u6240\u4ee5\u53ef\u80fd\u627e\u5230\u591a\u6761\u5bf9\u5e94\u7684\u8bb0\u5f55\uff0c\u7136\u540e\u518d\u53bb\u56de\u8868\u3002</p> <pre><code>SELECT * FROM table WHERE key1 = 'value'; //key1\u4e3a\u666e\u901a\u4e8c\u7ea7\u7d22\u5f15\n</code></pre>"},{"location":"mysql/MySQL%E6%9F%A5%E8%AF%A2/#13-ref_or_null","title":"1.3 ref_or_null","text":"<p>\u6709\u65f6\u5019\u6211\u4eec\u4e0d\u4ec5\u60f3\u627e\u51fa\u67d0\u4e2a\u4e8c\u7ea7\u7d22\u5f15\u5217\u7684\u503c\u7b49\u4e8e\u67d0\u4e2a\u5e38\u6570\u7684\u8bb0\u5f55\uff0c\u8fd8\u60f3\u628a\u8be5\u5217\u7684\u503c\u4e3aNULL\u7684\u8bb0\u5f55\u4e5f\u627e\u51fa\u6765\uff0c\u5c31\u50cf\u4e0b\u8fb9\u8fd9\u4e2a\u67e5\u8be2\uff1a</p> <pre><code>SELECT * FROM table WHERE key1 = 'abc' OR key1 IS NULL;\n</code></pre> <p>\u5f53\u4f7f\u7528\u4e8c\u7ea7\u7d22\u5f15\u800c\u4e0d\u662f\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u6267\u884c\u8be5\u67e5\u8be2\u65f6\uff0c\u8fd9\u79cd\u7c7b\u578b\u7684\u67e5\u8be2\u4f7f\u7528\u7684\u8bbf\u95ee\u65b9\u6cd5\u5c31\u79f0\u4e3a\uff1a<code>ref_or_null</code></p> <p></p>"},{"location":"mysql/MySQL%E6%9F%A5%E8%AF%A2/#14-range","title":"1.4 range","text":"<p>\u5f53\u641c\u7d22\u6761\u4ef6\u4e0d\u53ea\u662f\u8981\u6c42\u7d22\u5f15\u5217\u4e0e\u5e38\u6570\u7684\u7b49\u503c\u5339\u914d\uff0c\u800c\u662f\u7d22\u5f15\u5217\u9700\u8981\u5339\u914d\u67d0\u4e2a\u6216\u67d0\u4e9b\u8303\u56f4\u7684\u503c\u65f6\uff0c\u4f8b\u5982</p> <pre><code>SELECT * FROM single_table WHERE key2 IN (1438, 6328) OR (key2 &gt;= 38 AND key2 &lt;= 79);\n</code></pre> <p>\u6b64\u4e8b\u5982\u679c\u91c7\u7528<code>\u4e8c\u7ea7\u7d22\u5f15 + \u56de\u8868</code>\u7684\u65b9\u5f0f\u6765\u67e5\u8be2\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u628a\u8fd9\u79cd\u5229\u7528\u7d22\u5f15\u8fdb\u884c\u8303\u56f4\u5339\u914d\u7684\u8bbf\u95ee\u65b9\u6cd5\u79f0\u4e4b\u4e3a\uff1a<code>range</code>\u3002</p>"},{"location":"mysql/MySQL%E6%9F%A5%E8%AF%A2/#15-index","title":"1.5 index","text":"<p>\u5f53\u67e5\u8be2\u5217\u8868\u4e2d\u7684\u5b57\u6bb5\u548c\u67e5\u8be2\u6761\u4ef6\u4e2d\u7684\u5b57\u6bb5\u90fd\u5305\u542b\u4e8e\u67d0\u4e2a\u590d\u5408\u7d22\u5f15\u4e2d\u65f6\uff0cMySQL\u53ea\u9700\u8981\u904d\u5386\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u5373\u53ef\uff0c\u6211\u4eec\u5c06\u8fd9\u79cd\u6267\u884c\u65b9\u5f0f\u79f0\u4e4b\u4e3a\uff1a<code>index</code>\u3002</p> <pre><code>SELECT key_part1, key_part2, key_part3 FROM single_table WHERE key_part2 = 'abc';\n</code></pre>"},{"location":"mysql/MySQL%E6%9F%A5%E8%AF%A2/#16-all","title":"1.6 all","text":"<p>\u4f7f\u7528\u5168\u8868\u626b\u63cf\u6267\u884c\u67e5\u8be2\u7684\u65b9\u5f0f\u79f0\u4e4b\u4e3a\uff1a<code>all</code>\u3002</p>"},{"location":"mysql/MySQL%E6%9F%A5%E8%AF%A2/#_2","title":"\u4e8c\u3001\u8868\u8fde\u63a5","text":""},{"location":"mysql/MySQL%E6%9F%A5%E8%AF%A2/#21","title":"2.1 \u8fde\u63a5\u7684\u672c\u8d28","text":"<p><code>\u8fde\u63a5(JOIN)</code>\u7684\u672c\u8d28\u5c31\u662f\u628a\u5404\u4e2a\u8fde\u63a5\u8868\u4e2d\u7684\u8bb0\u5f55\u90fd\u53d6\u51fa\u6765\u4f9d\u6b21\u5339\u914d\u7684\u7ec4\u5408\u52a0\u5165\u7ed3\u679c\u96c6\u5e76\u8fd4\u56de\u7ed9\u7528\u6237\u3002\u6240\u4ee5\u6211\u4eec\u628at1\u548ct2\u4e24\u4e2a\u8868\u8fde\u63a5\u8d77\u6765\u7684\u8fc7\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u770b\u8d77\u6765\u5c31\u662f\u628a<code>t1</code>\u8868\u7684\u8bb0\u5f55\u548c<code>t2</code>\u7684\u8bb0\u5f55\u8fde\u8d77\u6765\u7ec4\u6210\u65b0\u7684\u66f4\u5927\u7684\u8bb0\u5f55\uff0c\u6240\u4ee5\u8fd9\u4e2a\u67e5\u8be2\u8fc7\u7a0b\u79f0\u4e4b\u4e3a\u8fde\u63a5\u67e5\u8be2\u3002\u8fde\u63a5\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\u4e2d\u5305\u542b\u4e00\u4e2a\u8868\u4e2d\u7684\u6bcf\u4e00\u6761\u8bb0\u5f55\u4e0e\u53e6\u4e00\u4e2a\u8868\u4e2d\u7684\u6bcf\u4e00\u6761\u8bb0\u5f55\u76f8\u4e92\u5339\u914d\u7684\u7ec4\u5408\uff0c\u50cf\u8fd9\u6837\u7684\u7ed3\u679c\u96c6\u5c31\u53ef\u4ee5\u79f0\u4e4b\u4e3a<code>\u7b1b\u5361\u5c14\u79ef</code>\u3002</p>"},{"location":"mysql/MySQL%E6%9F%A5%E8%AF%A2/#22","title":"2.2 \u5185\u8fde\u63a5\u548c\u5916\u8fde\u63a5","text":"<ul> <li> <p>\u5bf9\u4e8e<code>\u5185\u8fde\u63a5</code>\u7684\u4e24\u4e2a\u8868\uff0c\u9a71\u52a8\u8868\u4e2d\u7684\u8bb0\u5f55\u5728\u88ab\u9a71\u52a8\u8868\u4e2d\u627e\u4e0d\u5230\u5339\u914d\u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u4e0d\u4f1a\u52a0\u5165\u5230\u6700\u540e\u7684\u7ed3\u679c\u96c6\u3002</p> </li> <li> <p>\u5bf9\u4e8e<code>\u5916\u8fde\u63a5</code>\u7684\u4e24\u4e2a\u8868\uff0c\u9a71\u52a8\u8868\u4e2d\u7684\u8bb0\u5f55\u5373\u4f7f\u5728\u88ab\u9a71\u52a8\u8868\u4e2d\u6ca1\u6709\u5339\u914d\u7684\u8bb0\u5f55\uff0c\u4e5f\u4ecd\u7136\u9700\u8981\u52a0\u5165\u5230\u7ed3\u679c\u96c6\u3002</p> </li> </ul> <p>\u5728<code>MySQL</code>\u4e2d\uff0c\u6839\u636e\u9009\u53d6\u9a71\u52a8\u8868\u7684\u4e0d\u540c\uff0c\u5916\u8fde\u63a5\u4ecd\u7136\u53ef\u4ee5\u7ec6\u5206\u4e3a2\u79cd\uff1a</p> <ul> <li> <p>\u5de6\u5916\u8fde\u63a5</p> <p>\u9009\u53d6\u5de6\u4fa7\u7684\u8868\u4e3a\u9a71\u52a8\u8868\u3002</p> </li> <li> <p>\u53f3\u5916\u8fde\u63a5</p> <p>\u9009\u53d6\u53f3\u4fa7\u7684\u8868\u4e3a\u9a71\u52a8\u8868\u3002</p> </li> </ul>"},{"location":"mysql/MySQL%E6%9F%A5%E8%AF%A2/#23","title":"2.3 \u8fde\u63a5\u7684\u539f\u7406","text":""},{"location":"mysql/MySQL%E6%9F%A5%E8%AF%A2/#231-nested-loop-join","title":"2.3.1 Nested-Loop Join","text":"<p>\u9996\u5148\u786e\u5b9a\u7b2c\u4e00\u4e2a\u9700\u8981\u67e5\u8be2\u7684\u8868\uff0c\u8fd9\u4e2a\u8868\u79f0\u4e4b\u4e3a<code>\u9a71\u52a8\u8868</code>\u3002\u6839\u636e\u9a71\u52a8\u8868\u7684\u67e5\u8be2\u6761\u4ef6\u5f97\u5230\u4e00\u4e2a\u7ed3\u679c\u96c6\uff0c\u7136\u540e\u904d\u5386\u8be5\u7ed3\u679c\u96c6\u4f9d\u6b21\u4e0e\u53e6\u4e00\u4e2a\u8868\u53bb\u5339\u914d\uff0c\u6211\u4eec\u5c06\u53e6\u4e00\u4e2a\u8868\u79f0\u4e3a<code>\u88ab\u9a71\u52a8\u8868</code>\u3002\u6211\u4eec\u628a\u5bf9\u9a71\u52a8\u8868\u8fdb\u884c\u67e5\u8be2\u540e\u5f97\u5230\u7684\u8bb0\u5f55\u6761\u6570\u79f0\u4e4b\u4e3a\u9a71\u52a8\u8868\u7684<code>\u6247\u51fa</code>\uff08\u82f1\u6587\u540d\uff1a<code>fanout</code>\uff09\u3002\u56e0\u6b64\u53ef\u4ee5\u5f97\u77e5\u9a71\u52a8\u8868\u53ea\u4f1a\u88ab\u8bbf\u95ee\u4e00\u904d\uff0c\u4f46\u88ab\u9a71\u52a8\u8868\u5374\u8981\u88ab\u8bbf\u95ee\u591a\u6b21\uff0c\u8bbf\u95ee\u6b21\u6570\u53d6\u51b3\u4e8e\u5bf9\u9a71\u52a8\u8868\u6247\u51fa\u503c\u3002\u8fc7\u7a0b\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <p>\u5982\u679c\u67093\u4e2a\u8868\u8fdb\u884c\u8fde\u63a5\u7684\u8bdd\uff0c\u90a3\u4e48<code>\u6b65\u9aa42</code>\u4e2d\u5f97\u5230\u7684\u7ed3\u679c\u96c6\u5c31\u50cf\u662f\u65b0\u7684\u9a71\u52a8\u8868\uff0c\u7136\u540e\u7b2c\u4e09\u4e2a\u8868\u5c31\u6210\u4e3a\u4e86\u88ab\u9a71\u52a8\u8868\uff0c\u91cd\u590d\u4e0a\u8fb9\u8fc7\u7a0b\u3002</p> <p>\u6211\u4eec\u5c06\u8fd9\u79cd\u8fde\u63a5\u6267\u884c\u65b9\u5f0f\u79f0\u4e4b\u4e3a<code>\u5d4c\u5957\u5faa\u73af\u8fde\u63a5</code>\uff08<code>Nested-Loop Join</code>\uff09\uff0c\u8fd9\u662f\u6700\u7b80\u5355\uff0c\u4e5f\u662f\u6700\u7b28\u62d9\u7684\u4e00\u79cd\u8fde\u63a5\u67e5\u8be2\u7b97\u6cd5\u3002</p>"},{"location":"mysql/MySQL%E6%9F%A5%E8%AF%A2/#232","title":"2.3.2 \u4f7f\u7528\u7d22\u5f15\u52a0\u5feb\u8fde\u63a5\u901f\u5ea6","text":"<p>\u5d4c\u5957\u5faa\u73af\u94fe\u63a5\u4e2d\u662f\u9700\u8981\u591a\u6b21\u8bbf\u95ee\u88ab\u9a71\u52a8\u8868\uff0c\u5982\u679c\u6bcf\u6b21\u90fd\u662f\u5168\u8868\u626b\u63cf\u7684\u8bdd\uff0c\u90a3\u4e48\u6548\u7387\u5c31\u975e\u5e38\u4f4e\u3002\u56e0\u6b64\u53ef\u4ee5\u8003\u8651\u6dfb\u52a0\u7d22\u5f15\u6765\u63d0\u5347\u67e5\u8be2\u901f\u5ea6\u3002</p> <pre><code>SELECT * FROM t1, t2 WHERE t1.m1 &gt; 1 AND t1.m1 = t2.m2 AND t2.n2 &lt; 'd';\n</code></pre> <p>\u8be5\u8bed\u53e5\u67e5\u8be2\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u5047\u8bbe\u9a71\u52a8\u8868<code>t1</code>\u540e\u7684\u7ed3\u679c\u96c6\u4e2d\u6709\u4e24\u6761\u8bb0\u5f55\uff0c<code>\u5d4c\u5957\u5faa\u73af\u8fde\u63a5</code>\u7b97\u6cd5\u9700\u8981\u5bf9\u88ab\u9a71\u52a8\u8868\u67e5\u8be22\u6b21\uff1a</p> <ul> <li>\u5f53<code>t1.m1 = 2</code>\u65f6\uff0c\u53bb\u67e5\u8be2\u4e00\u904d<code>t2</code>\u8868\uff0c\u5bf9<code>t2</code>\u8868\u7684\u67e5\u8be2\u8bed\u53e5\u76f8\u5f53\u4e8e\uff1a</li> </ul> <pre><code>SELECT * FROM t2 WHERE t2.m2 = 2 AND t2.n2 &lt; 'd';\n</code></pre> <ul> <li>\u5f53<code>t1.m1 = 3</code>\u65f6\uff0c\u518d\u53bb\u67e5\u8be2\u4e00\u904d<code>t2</code>\u8868\uff0c\u6b64\u65f6\u5bf9<code>t2</code>\u8868\u7684\u67e5\u8be2\u8bed\u53e5\u76f8\u5f53\u4e8e\uff1a</li> </ul> <pre><code>SELECT * FROM t2 WHERE t2.m2 = 3 AND t2.n2 &lt; 'd';\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u539f\u6765\u7684<code>t1.m1 = t2.m2</code>\u8fd9\u4e2a\u6d89\u53ca\u4e24\u4e2a\u8868\u7684\u8fc7\u6ee4\u6761\u4ef6\u5728\u9488\u5bf9<code>t2</code>\u8868\u505a\u67e5\u8be2\u65f6\u5173\u4e8e<code>t1</code>\u8868\u7684\u6761\u4ef6\u5c31\u5df2\u7ecf\u786e\u5b9a\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u5355\u5355\u4f18\u5316\u5bf9<code>t2</code>\u8868\u7684\u67e5\u8be2\u4e86\uff0c\u4e0a\u8ff0\u4e24\u4e2a\u5bf9<code>t2</code>\u8868\u7684\u67e5\u8be2\u8bed\u53e5\u4e2d\u5229\u7528\u5230\u7684\u5217\u662f<code>m2</code>\u548c<code>n2</code>\u5217\uff0c\u6211\u4eec\u53ef\u4ee5\uff1a</p> <ul> <li>m2\u5217\u6dfb\u52a0\u7d22\u5f15\uff0c\u56e0\u4e3a\u5bf9m2\u662f\u7b49\u503c\u67e5\u8be2\uff0c\u6240\u4ee5\u5176\u8bbf\u95ee\u65b9\u5f0f\u4e3aref\uff0c\u56de\u8868\u4e4b\u540e\u518d\u5224\u65ad<code>t2.n2 &lt; d</code>\u8fd9\u4e2a\u6761\u4ef6\u662f\u5426\u6210\u7acb</li> </ul> <p>\u5047\u5982m2\u662f\u4e3b\u952e\u6216\u8005\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\uff0c\u90a3\u4e48\u5176\u8bbf\u95ee\u662f\u5e38\u6570\u7ea7\u522b\u7684\u3002\u5728\u5355\u8868\u4e2d\u4f7f\u7528\u4e3b\u952e\u503c\u6216\u8005\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u5217\u7684\u503c\u8fdb\u884c\u7b49\u503c\u67e5\u627e\u7684\u65b9\u5f0f\u79f0\u4e4b\u4e3a<code>const</code>\u3002\u5728\u8fde\u63a5\u67e5\u8be2\u4e2d\u5bf9\u88ab\u9a71\u52a8\u8868\u4f7f\u7528\u4e3b\u952e\u503c\u6216\u8005\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u5217\u7684\u503c\u8fdb\u884c\u7b49\u503c\u67e5\u627e\u7684\u67e5\u8be2\u6267\u884c\u65b9\u5f0f\u79f0\u4e4b\u4e3a\uff1a<code>eq_ref</code>\u3002</p> <ul> <li> <p>\u5728<code>n2</code>\u5217\u4e0a\u5efa\u7acb\u7d22\u5f15\uff0c\u6d89\u53ca\u5230\u7684\u6761\u4ef6\u662f<code>t2.n2 &lt; 'd'</code>\uff0c\u53ef\u80fd\u7528\u5230<code>range</code>\u7684\u8bbf\u95ee\u65b9\u6cd5\uff0c\u5047\u8bbe\u4f7f\u7528<code>range</code>\u7684\u8bbf\u95ee\u65b9\u6cd5\u5bf9<code>t2</code>\u8868\u7684\u67e5\u8be2\u7684\u8bdd\uff0c\u9700\u8981\u56de\u8868\u4e4b\u540e\u518d\u5224\u65ad\u5728<code>m2</code>\u5217\u4e0a\u7684\u6761\u4ef6\u662f\u5426\u6210\u7acb\u3002</p> </li> <li> <p>\u5efa\u7acb\u590d\u5408\u7d22\u5f15(m2,n2)\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5e94\u8be5\u662f\u6700\u597d\u7684\u65b9\u6848\uff0c\u53ef\u4ee5\u51cf\u5c11\u56de\u8868\u7684\u6b21\u6570\u3002</p> </li> </ul>"},{"location":"mysql/MySQL%E6%9F%A5%E8%AF%A2/#233-block-nested-loop-join","title":"2.3.3 Block Nested-Loop Join","text":"<p>\u4ece MySQL 8.0.20 \u5f00\u59cb\uff0c\u5220\u9664\u4e86\u5bf9\u5757\u5d4c\u5957\u5faa\u73af\u7684\u652f\u6301\uff0c\u5e76\u4e14\u670d\u52a1\u5668\u5728\u4ee5\u524d\u4f7f\u7528\u5757\u5d4c\u5957\u5faa\u73af\u7684\u4efb\u4f55\u5730\u65b9\u90fd\u91c7\u7528\u54c8\u5e0c\u8fde\u63a5\u3002</p>"},{"location":"mysql/read_ahead/","title":"\u9884\u8bfb","text":"<p>\u8bfb\u53d6\u9884\u53d6\u8bf7\u6c42\u662f\u4e00\u79cd\u5f02\u6b65\u7684I/O\u8bf7\u6c42\uff0c\u7528\u4e8e\u5728\u9884\u671f\u5373\u5c06\u9700\u8981\u8fd9\u4e9b\u9875\u9762\u65f6\uff0c\u5c06\u591a\u4e2a\u9875\u9762\u63d0\u524d\u52a0\u8f7d\u5230\u7f13\u51b2\u6c60\u4e2d\u3002\u8fd9\u4e9b\u8bf7\u6c42\u4f1a\u4e00\u6b21\u6027\u83b7\u53d6\u4e00\u4e2a\u533a\u6bb5\u4e2d\u7684\u6240\u6709\u9875\u9762\u3002InnoDB\u4f7f\u7528\u4e24\u79cd\u8bfb\u53d6\u9884\u53d6\u7b97\u6cd5\u6765\u63d0\u9ad8I/O\u6027\u80fd\uff1a</p> <ul> <li>\u7ebf\u6027\u8bfb\u53d6\u9884\u53d6\u662f\u4e00\u79cd\u9884\u6d4b\u54ea\u4e9b\u9875\u9762\u53ef\u80fd\u5f88\u5feb\u88ab\u9700\u8981\u7684\u6280\u5de7\uff0c\u57fa\u4e8e\u7f13\u51b2\u6c60\u4e2d\u6309\u987a\u5e8f\u8bbf\u95ee\u7684\u9875\u9762\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574\u89e6\u53d1\u5f02\u6b65\u8bfb\u53d6\u8bf7\u6c42\u6240\u9700\u7684\u8fde\u7eed\u9875\u9762\u8bbf\u95ee\u6b21\u6570\u6765\u63a7\u5236InnoDB\u4f55\u65f6\u6267\u884c\u8bfb\u53d6\u9884\u53d6\u64cd\u4f5c\uff0c\u4f7f\u7528\u914d\u7f6e\u53c2\u6570<code>innodb_read_ahead_threshold</code>\u3002</li> <li>\u968f\u673a\u8bfb\u53d6\u9884\u53d6\u662f\u4e00\u79cd\u9884\u6d4b\u9875\u9762\u53ef\u80fd\u5f88\u5feb\u88ab\u9700\u8981\u7684\u6280\u5de7\uff0c\u57fa\u4e8e\u7f13\u51b2\u6c60\u4e2d\u5df2\u7ecf\u5b58\u5728\u7684\u9875\u9762\uff0c\u800c\u4e0d\u8003\u8651\u8fd9\u4e9b\u9875\u9762\u7684\u8bfb\u53d6\u987a\u5e8f\u3002\u5982\u679c\u7f13\u51b2\u6c60\u4e2d\u6709\u6765\u81ea\u540c\u4e00\u533a\u6bb5\u768413\u4e2a\u8fde\u7eed\u9875\u9762\uff0cInnoDB\u5c06\u5f02\u6b65\u53d1\u51fa\u8bf7\u6c42\uff0c\u9884\u53d6\u8be5\u533a\u6bb5\u4e2d\u5269\u4f59\u7684\u9875\u9762\u3002\u8981\u542f\u7528\u6b64\u529f\u80fd\uff0c\u8bf7\u5c06\u914d\u7f6e\u53d8\u91cf<code>innodb_random_read_ahead</code>\u8bbe\u7f6e\u4e3aON\u3002</li> </ul> <p><code>SHOW ENGINE INNODB STATUS</code>\u547d\u4ee4\u4f1a\u663e\u793a\u7edf\u8ba1\u4fe1\u606f\uff0c\u4ee5\u5e2e\u52a9\u60a8\u8bc4\u4f30\u8bfb\u53d6\u9884\u53d6\u7b97\u6cd5\u7684\u6709\u6548\u6027\u3002\u8fd9\u4e9b\u7edf\u8ba1\u4fe1\u606f\u5305\u62ec\u4ee5\u4e0b\u5168\u5c40\u72b6\u6001\u53d8\u91cf\u7684\u8ba1\u6570\u5668\u4fe1\u606f\uff1a</p> <ul> <li><code>Innodb_buffer_pool_read_ahead</code></li> <li><code>Innodb_buffer_pool_read_ahead_evicted</code></li> <li><code>Innodb_buffer_pool_read_ahead_rnd</code></li> </ul> <p>\u8fd9\u4e9b\u4fe1\u606f\u5728\u5fae\u8c03<code>innodb_random_read_ahead</code>\u8bbe\u7f6e\u65f6\u975e\u5e38\u6709\u7528\u3002</p>"},{"location":"blog/archive/2023/","title":"2023","text":""},{"location":"blog/category/linux/","title":"Linux","text":""},{"location":"blog/category/%E7%B2%BE%E9%80%89%E6%96%87%E7%AB%A0/","title":"\u7cbe\u9009\u6587\u7ae0","text":""},{"location":"blog/category/mysql/","title":"MySQL","text":""}]}